!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ChatAdapter=t():e.ChatAdapter=t()}(self,(()=>(()=>{var e={781:(e,t,n)=>{"use strict";var r=n(611),o=n(5777),i=n(1219),s=n(5923);function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=a(r),d=a(o),u=a(i),l=a(s),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function f(e,t){return e(t={exports:{}},t.exports),t.exports}var g=f((function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Timespan=t.toJson=t.fetchWithTimeout=void 0,t.fetchWithTimeout=function(e,t){var n,r=new Promise((function(t,r){fetch(e).then((function(e){void 0!==n&&clearTimeout(n),t(e)})).catch((function(e){void 0!==n&&clearTimeout(n),r(e)}))}));if(0!==t){var o=new Promise((function(r,o){n=setTimeout(o,t,new Error("Fetch for '".concat(e.url,"' timed out")))}));return Promise.race([r,o])}return r},t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type ".concat(typeof e)}};var r=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=r},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.createRegistrarClient=t.RegistrarClient=void 0;var a=n(0),c=["skype","aad","cae"],d=function(e){function t(t){var n=e.call(this,t)||this;return n.name="CancelationError",n}return r(t,e),t}(Error),u=function(){function e(t,n,r){this.logger=t,this.maxBackoffInMs=n,this.initialDelay=r,this.backoffCount=0,this.id=++e.idCounter}return e.prototype.delay=function(e){var t=this;if(void 0!==this.timerHandle)throw new Error("Retry sequence logical failure");if(-1===this.backoffCount)return new Promise((function(e,t){t(new d("Cancelled"))}));var n=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off ".concat(e," for ").concat(n," milliseconds with ID ").concat(this.id)),new Promise((function(r,o){t.cancelFunc=o,t.timerHandle=setTimeout((function(){t.logger.info("[RegistrarClient] Back off for ".concat(e," with ID ").concat(t.id," complete")),t.timerHandle=void 0,r()}),n)}))},e.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new d("Cancelled"))),this.backoffCount=-1},e.prototype.calculateNextBackoffMs=function(){var e=1+.4*(Math.random()-.5),t=this.initialDelay*Math.pow(2,this.backoffCount)*e;return t=Math.round(t),Math.min(this.maxBackoffInMs,t)},e.idCounter=0,e}(),l=function(){function e(e,t,n){var r;this.logger=e,this.tokenProvider=t,this.options=n,this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN=15,this.DEFAULT_MAX_BACKOFF_TIME_IN_MS=3e5,this.backoffs={},this.maxBackOffTime=this.options.maxRetryDelayMs>0?this.options.maxRetryDelayMs:this.DEFAULT_MAX_BACKOFF_TIME_IN_MS,this.maxRetriesForGetToken=void 0===n.maxRetriesForGetToken||null===n.maxRetriesForGetToken?this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN:n.maxRetriesForGetToken,this.proxyUrlRewrite=null!==(r=n.proxyUrlRewrite)&&void 0!==r?r:function(e){return e}}return e.prototype.setTelemetryLogger=function(e){this.eventLogger=e},e.prototype.register=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this.performRegistration(e,t,"pr_set_registration")];case 1:return n.sent(),this.cachedRegistrationParams=[e,t],[2]}}))}))},e.prototype.unregister=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),e=new Request(this.proxyUrlRewrite("".concat(this.options.registrarUrl,"/").concat(this.options.registrationId)),{method:"DELETE",mode:"cors",headers:new Headers(o(o({},this.options.extraRegistrationHeaders),{accept:"application/json, text/javascript"}))}),[4,this.callRegistrar(e,"pr_delete_registration")];case 1:return t.sent(),[2]}}))}))},e.prototype.cancelPendingRequests=function(){var e=this;Object.keys(this.backoffs).forEach((function(t){e.backoffs[t].cancel()})),this.backoffs={}},e.prototype.resendRegistration=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return e.sent(),[2]}}))}))},e.prototype.performRegistration=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),r={clientDescription:e,registrationId:this.options.registrationId,nodeId:"",transports:t},i=new Request(this.proxyUrlRewrite(this.options.registrarUrl),{method:"POST",mode:"cors",headers:new Headers(o(o({},this.options.extraRegistrationHeaders),{"content-type":"application/json",accept:"application/json, text/javascript"})),body:(0,a.toJson)(r)}),[4,this.callRegistrar(i,n)];case 1:return s.sent(),[2]}}))}))},e.prototype.startBackoff=function(){var e=new u(this.logger,this.maxBackOffTime,this.options.initialRetryDelayMs);return this.backoffs[e.id]=e,e},e.prototype.stopBackoff=function(e){e.cancel(),delete this.backoffs[e.id]},e.prototype.getToken=function(e){return i(this,void 0,void 0,(function(){var t,n,r,o,i,a,d;return s(this,(function(s){switch(s.label){case 0:t=this.startBackoff(),n=0,s.label=1;case 1:return s.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new token"),[4,this.tokenProvider({needFresh:!0,supportedTokenTypes:c,wwwAuthenticateHeader:e,purpose:"registrar"})];case 2:return r=s.sent(),this.stopBackoff(t),[2,r];case 3:o=s.sent(),s.label=4;case 4:return s.trys.push([4,6,,7]),n++,i=JSON.stringify(o),n>this.maxRetriesForGetToken?(a="[RegistrarClient] getToken retry limit hit. Will not retry now. Error: ".concat(i),this.logger.error(a),this.stopBackoff(t),[2,Promise.reject(a)]):(this.logger.warn("[RegistrarClient] Retrying for a new token. Retry Count: ".concat(n," Error: ").concat(i)),[4,t.delay("Fetching a new token")]);case 5:return s.sent(),[3,8];case 6:throw d=s.sent(),this.stopBackoff(t),d;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},e.prototype.callRegistrar=function(e,t){var n,r,o;return i(this,void 0,void 0,(function(){var i,d,u,l,p,h,f,g,m,v,y,S,E,T,C,A;return s(this,(function(s){switch(s.label){case 0:return i=this.startBackoff(),[4,this.tokenProvider({needFresh:!1,supportedTokenTypes:c,wwwAuthenticateHeader:void 0,purpose:"registrar"})];case 1:d=s.sent(),this.setTokenHeader(e,d),u=new a.Timespan,l=0,s.label=2;case 2:p=void 0,s.label=3;case 3:return s.trys.push([3,10,15,16]),h=e.clone(),[4,(0,a.fetchWithTimeout)(h,this.options.requestTimeoutMs)];case 4:return 401!==(p=s.sent()).status?[3,8]:++l>this.maxRetriesForGetToken?(f="[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '".concat(e.url,"' failed with ").concat(p.status," ").concat(p.statusText),this.logger.error(f),this.stopBackoff(i),[2,Promise.reject(f)]):(this.logger.warn("[RegistrarClient] Retry Count ".concat(l,". Request '").concat(e.url,"' failed with ").concat(p.status," ").concat(p.statusText)),g=null!==(r=null===(n=p.headers)||void 0===n?void 0:n.get("www-authenticate"))&&void 0!==r?r:void 0,m=this.setTokenHeader,v=[e],[4,this.getToken(g)]);case 5:return m.apply(this,v.concat([s.sent()])),l>1?[4,i.delay("Registrar call retry after 401")]:[3,7];case 6:s.sent(),s.label=7;case 7:return[3,22];case 8:if(p.status>=500&&p.status<600)throw new Error("Fetch for '".concat(e.url,"' failed with ").concat(p.status," ").concat(p.statusText));s.label=9;case 9:return[3,16];case 10:y=s.sent(),this.logger.error("[RegistrarClient] Request failed with ".concat(y)),s.label=11;case 11:return s.trys.push([11,13,,14]),[4,i.delay("Registrar call retry")];case 12:return s.sent(),[3,22];case 13:throw S=s.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(i),S;case 14:return[3,16];case 15:return this.sendTelemetryEvent(t,e,p,u),[7];case 16:return this.stopBackoff(i),p.ok?[2,p]:[3,17];case 17:E=void 0,s.label=18;case 18:return s.trys.push([18,20,,21]),C=(T=JSON).stringify,[4,p.json()];case 19:return E=C.apply(T,[s.sent()]),[3,21];case 20:return s.sent(),E="no details",[3,21];case 21:throw A="Fetch for '".concat(e.url,"' failed with ").concat(p.status," ").concat(p.statusText," (").concat(E,", MS-CV: ").concat(null===(o=p.headers)||void 0===o?void 0:o.get("MS-CV"),")"),this.logger.error("[RegistrarClient] ".concat(A)),new Error(A);case 22:return[3,2];case 23:return[2]}}))}))},e.prototype.setTokenHeader=function(e,t){switch(e.headers.delete("X-Skypetoken"),e.headers.delete("Authorization"),e.headers.delete("X-MS-Migration"),t.tokenType.toLowerCase()){case"skype":e.headers.set("X-Skypetoken",t.token);break;case"aad":case"cae":e.headers.set("Authorization","Bearer ".concat(t.token));break;default:throw new Error("unsupported token type: ".concat(t.tokenType))}!1===this.options.usingLegacyTokenApi&&e.headers.set("X-MS-Migration","True")},e.prototype.sendTelemetryEvent=function(e,t,n,r){if(void 0!==this.eventLogger){var o={name:e,properties:{url:{value:t.url},result_code:{value:void 0!==n?n.status:0},begin_timestamp:{value:r.startTime},elapsed:{value:r.duration}}};this.eventLogger.logEvent(o)}},e}();t.RegistrarClient=l,t.createRegistrarClient=function(e,t,n){return new l(e,t,n)}}])}));h(g);var m=f((function(e,t){var n;e.exports=(n=g,function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=20)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var r=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("[".concat(this.name,"] ").concat(e))},e.prototype.info=function(e){this.logger.info("[".concat(this.name,"] ").concat(e))},e.prototype.warn=function(e){this.logger.warn("[".concat(this.name,"] ").concat(e))},e.prototype.error=function(e){this.logger.error("[".concat(this.name,"] ").concat(e))},e}();t.Logger=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.USER_AUTHENTICATE_EVENT_NAME=t.SUPPORTED_TOKEN_TYPES=t.FAILED_MESSAGE_ACK=t.UNHANDLED_MESSAGE_ACK=t.HANDLED_MESSAGE_ACK=t.CLIENT_VERSION=t.constants=void 0,t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2024.14.01.55",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500,t.SUPPORTED_TOKEN_TYPES=["skype","aad","cae"],t.USER_AUTHENTICATE_EVENT_NAME="user.authenticate"},function(e,t,n){var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterState=t.UserActivityState=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Active=1]="Active",e[e.Inactive=2]="Inactive"}(r||(t.UserActivityState=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(o||(t.TrouterState=o={}))},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Timespan=t.CorrelationVector=t.fetchWithTimeout=t.calculateExpireTsInSec=t.calculateTtlInSec=t.toJson=void 0,t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type ".concat(typeof e)}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e},t.fetchWithTimeout=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){return r=new Promise((function(t,r){fetch(e).then((function(e){clearTimeout(n),t(e)})).catch((function(e){clearTimeout(n),r(e)}))})),0!==t?(i=new Promise((function(r,o){var i=new URL(e.url),s=new Error("".concat(e.method," ").concat(i.origin).concat(i.pathname," timed out"));n=setTimeout(o,t,s)})),[2,Promise.race([r,i])]):[2,r]}))}))};var i=function(){function e(e){this.base=void 0!==e?e:this.createCorrelationVectorBase(),this.extension=0}return e.extend=function(t){return new e(t)},e.prototype.increase=function(){this.extension++},e.prototype.value=function(){return"".concat(this.base,".").concat(this.extension)},e.prototype.createCorrelationVectorBase=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+",t="AQgw",n="",r=0;r<21;r++)n+=e.charAt(Math.floor(64*Math.random()));return n+t.charAt(Math.floor(4*Math.random()))},e}();t.CorrelationVector=i;var s=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManagerState=t.UserActivityEventReason=t.ServerState=void 0;var r,o,i=n(3),s=function(){function e(e,t,n,r,o,i,s){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=r,this.url=o,this.c2cUrlBase=i,this.expirationTsSec=s}return e.prototype.getRemainingTtlInSec=function(){return(0,i.calculateTtlInSec)(this.expirationTsSec)},e}();t.ServerState=s,function(e){e[e.Unknown=0]="Unknown",e[e.Modified=1]="Modified",e[e.Snapshot=2]="Snapshot",e[e.Connected=3]="Connected"}(r||(t.UserActivityEventReason=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching",e[e.TerminalError=10]="TerminalError"}(o||(t.TrouterManagerState=o={}))},function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.redirectUrlIfPresent=t.ensureNumber=t.reconnectParamsWithoutUrls=t.adaptUrl=t.isV4ConnectEvent=t.usedProtocolAfterFallback=t.usedProtocol=void 0,t.usedProtocol=function(e,t){return"skype"===e&&"1"!==function(e){return"string"==typeof e?e:"number"==typeof e?e.toString():void 0}(null==t?void 0:t.scae)?"v4a":"v4c"},t.usedProtocolAfterFallback=function(e,t){return"v4c-websocket-failure"===(null==t?void 0:t.kind)?"v4a":e},t.isV4ConnectEvent=function(e){return Object.prototype.hasOwnProperty.call(e,"connectparams")},t.adaptUrl=function(e,t){return"v4a"===t?e.replace(/\/v4\/c\b/,"/v4/a").replace("wss://","https://").replace("ws://","http://"):e.replace(/\/v4\/a\b/,"/v4/c").replace("https://","wss://").replace("http://","ws://")},t.reconnectParamsWithoutUrls=function(e){if(void 0!==e)return r(r({},e),{reconnectUrl:void 0,serviceUrl:void 0})},t.ensureNumber=function(e){return"string"==typeof e?parseInt(e,10):e},t.redirectUrlIfPresent=function(e){if("redirect"===(null==e?void 0:e.kind)&&void 0!==e.host){var t=e.host;return t.endsWith("/")&&(t=t.substring(0,t.length-1)),t.endsWith("/v4/c")||t.endsWith("/v4/a")||(t+="/v4/c"),t}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterFsm=t.State=void 0;var r,o,i=n(4),s=n(0),a=n(5);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.AnonymousConnecting=5]="AnonymousConnecting",e[e.WebsocketAuthenticating=6]="WebsocketAuthenticating",e[e.Connected=7]="Connected",e[e.Unregistering=8]="Unregistering",e[e.TerminalError=9]="TerminalError"}(r||(t.State=r={})),function(e){e[e.Initial=0]="Initial",e[e.Registering=1]="Registering",e[e.RegisteringButResendPending=2]="RegisteringButResendPending",e[e.Retrying=3]="Retrying",e[e.Registered=4]="Registered",e[e.RegistrationDisabled=5]="RegistrationDisabled"}(o||(o={}));var c=function(){function e(e,t,n,i){this.worker=t,this.incallModeEnabled=n,this.protocolSelector=i,this.state=r.Initial,this.autoReconnect=!0,this.logger=new s.Logger("ConnectionFsm",e),this.registrationState=o.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===r.Allocating||this.state===r.Connected||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.RetrievingToken||this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating},e.prototype.isConnecting=function(){return this.state===r.Allocating||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.AnonymousConnecting},e.prototype.start=function(){return this.state===r.Initial?(this.setState(r.RetrievingToken),this.worker.getToken(!0,!1,void 0),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e,t){e&&(this.registrationState=o.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent("connection stopped"),this.registrationState!==o.Registered&&this.registrationState!==o.Registering&&this.registrationState!==o.RegisteringButResendPending||this.state===r.Unregistering?t?(this.setState(r.TerminalError),this.worker.dispatchTerminalError()):(this.setState(r.Initial),this.worker.dispatchDisconnected()):(this.registrationState=o.Initial,this.setState(r.Unregistering),this.worker.sendUnregisterRequest())},e.prototype.onTokenReceived=function(e,t,n){this.state===r.RetrievingToken?"v4c"===(0,a.usedProtocolAfterFallback)(this.protocolSelector(e.tokenType,n),t)?(this.setState(r.AnonymousConnecting),this.worker.startConnectionTimer(),this.worker.connectV4c(e,t)):(this.setState(r.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(e)):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e&&this.onPingInterval()},e.prototype.onAllocationSucceed=function(e){return this.state===r.Allocating&&this.registrationState===o.Registered&&this.worker.dispatchUnregistered(),this.state===r.Allocating?(this.setState(r.Handshaking),this.registrationState=o.Initial,this.worker.startSocketIo(e),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e,t){this.state===r.Allocating?this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!e,claimsChallenge:t}):this.showIgnored("onAllocationFailed")},e.prototype.onV4cException=function(){this.state!==r.AnonymousConnecting&&this.state!==r.WebsocketAuthenticating||(this.logger.error("v4c exception, falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}}))},e.prototype.onConnectingTimeout=function(){this.state===r.Allocating||this.state===r.Connecting||this.state===r.Handshaking||this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0}):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===r.Handshaking?this.setState(r.Connecting):this.showIgnored("onConnecting")},e.prototype.onSocketConnect=function(e){this.state===r.AnonymousConnecting?(this.setState(r.WebsocketAuthenticating),this.worker.sendV4cAuthenticationEvent(e)):this.showIgnored("onSocketConnect")},e.prototype.onConnectingFailed=function(){this.state===r.Connecting?this.onConnectingTimeout():this.state===r.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?(this.logger.info("/v4/c falling back to longpoll"),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"v4c-websocket-failure"}})):this.showIgnored("onConnectingFailed")},e.prototype.onSocketDisconnect=function(e){this.state===r.Handshaking||this.state===r.Connected||this.state===r.WebsocketAuthenticating?(this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent(null==e?void 0:e.toTelemetryString()),this.state===r.WebsocketAuthenticating&&this.worker.countDisconnectBeforeConnectionEstablishment(),"skypetoken-deprecated"===(null==e?void 0:e.reason)?(this.logger.error("Skypetoken deprecated response, not retrying any further"),this.onTerminalError()):this.cleanUpAndInitiateReconnect({backoff:this.state!==r.Connected&&"dup"!==(null==e?void 0:e.reason),allowCachedToken:"unauthorized"!==(null==e?void 0:e.reason),claimsChallenge:null==e?void 0:e.claims})):this.showIgnored("onSocketDisconnect")},e.prototype.onTrouterConnected=function(){this.state===r.Connecting||this.state===r.WebsocketAuthenticating?(this.setState(r.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(i.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.worker.shouldSkipRegistration()?(this.registrationState=o.RegistrationDisabled,this.worker.dispatchRegistered()):(this.registrationState=o.Registering,this.worker.sendRegisterRequest())):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(e,t,n){this.state===r.AnonymousConnecting||this.state===r.WebsocketAuthenticating?void 0===n||"host"!==n.target||void 0===n.url||""===n.url?(this.logger.error("unexpected reconnect arguments: ".concat(null==n?void 0:n.target," ").concat(null==n?void 0:n.url,", reconnecting without cache")),this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect-no-host"}})):this.cleanUpAndInitiateReconnect({backoff:!0,allowCachedToken:!0,fallbackReason:{kind:"redirect",host:n.url}}):this.worker.dispatchReconnectIsRequired(e,t)},e.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},e.prototype.onDownstreamRequest=function(e){this.state===r.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onTrouterMessageLost=function(e){this.state===r.Connected?this.worker.dispatchTrouterMessageLost(e):this.showIgnored("onTrouterMessageLost")},e.prototype.onPingInterval=function(){this.state===r.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===r.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(){this.state===r.Connected&&this.registrationState===o.Registering?(this.worker.dispatchUnregistered(),this.registrationState=o.Retrying,this.worker.startRegistrationRetryTimer()):this.state===r.Connected&&this.registrationState===o.RegisteringButResendPending?(this.registrationState=o.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationFailed")},e.prototype.onRetryRegistration=function(){this.state===r.Connected&&this.registrationState===o.Retrying?(this.registrationState=o.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRetryRegistration")},e.prototype.onRegistrationSucceeded=function(){this.state===r.Connected&&this.registrationState===o.Registering?(this.registrationState=o.Registered,this.worker.dispatchRegistered(),this.worker.startRegistrationTimer()):this.state===r.Connected&&this.registrationState===o.RegisteringButResendPending?(this.registrationState=o.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationSucceeded")},e.prototype.onRegistrationNearExpiry=function(){this.state===r.Connected&&this.registrationState===o.Registered?(this.registrationState=o.Registering,this.worker.sendRegisterRequest()):this.showIgnored("onRegistrationNearExpiry")},e.prototype.onUnregistrationDone=function(){this.state===r.Unregistering?(this.setState(r.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationDone")},e.prototype.onResendRegistration=function(){this.worker.dispatchUnregistered(),this.state===r.Connected&&this.registrationState===o.Registered?(this.registrationState=o.Registering,this.worker.stopRegistrationTimer(),this.worker.sendRegisterRequest()):this.state===r.Connected&&this.registrationState===o.Registering&&(this.registrationState=o.RegisteringButResendPending)},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===r.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.onSetNewUserActivityState=function(){this.worker.sendUserActivityState(i.UserActivityEventReason.Modified,this.state===r.Connected)},e.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},e.prototype.forceReconnect=function(e){this.state===r.Connected&&this.worker.sendDisconnectTelemetryEvent(e),this.worker.resetTokenBackoff(),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})},e.prototype.onTerminalError=function(){this.logger.error("Cannot proceed, reached terminal state. Switching from state '".concat(r[this.state],"' to ").concat(r[r.TerminalError])),this.stop(!0,!0),this.setState(r.TerminalError)},e.prototype.onMissedResponse=function(e){this.state===r.Connected?(this.worker.sendDisconnectTelemetryEvent(e),this.cleanUpAndInitiateReconnect({backoff:!1,allowCachedToken:!0})):this.showIgnored(e)},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '".concat(e,"' in state '").concat(r[this.state],"'"))},e.prototype.setState=function(e){this.logger.info("Switching from state '".concat(r[this.state],"' to state '").concat(r[e],"'")),this.state!==e?this.state=e:this.logger.error("Attempt to switch to the current state '".concat(r[e],"'"))},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e.prototype.cleanUpAndInitiateReconnect=function(e){if(!this.autoReconnect)return this.logger.info("Automatic reconnect is disabled, stopping this connection"),void this.stop(!0);this.worker.cancelPendingRegistrationRequests(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearSentEventTimers(),this.worker.stopRegistrationTimer(),this.worker.stopSocketIo(),this.setState(r.RetrievingToken),this.worker.dispatchReconnecting(),this.worker.getToken(e.allowCachedToken,e.backoff,e.claimsChallenge,e.fallbackReason)},e}();t.TrouterFsm=c},function(e,t,n){function r(e,t){var n=t?void 0:{"X-MS-Migration":"True"};switch(e.tokenType.toLowerCase()){case"skype":return s({"X-Skypetoken":e.token},n);case"aad":case"cae":return s({Authorization:"Bearer ".concat(e.token)},n);default:throw new Error("unsupported token type: ".concat(e.tokenType))}}function o(e){return"object"==typeof e&&null!==e&&void 0!==e.stack?(0,l.toJson)(e.stack):'"(no error.stack)"'}function i(e){return"object"==typeof e&&null!==e&&"string"==typeof e.message?e.message:"(no error.message)"}var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},s.apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterConnection=t.ReconnectReason=void 0;var d,u=n(21),l=n(3),p=n(15),h=n(1),f=n(16),g=n(17),m=n(2),v=n(4),y=n(0),S=n(5),E=n(6),T=n(12),C=function(){this.cv=h.CLIENT_VERSION,this.ua="",this.hr="",this.v=""},A=function(){function e(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}return e.prototype.rewriteUrlForProxy=function(e){return e},e}(),b="MS-CV",I=function(){function e(e,t){this.logger=t,this.cvCounter=0;var n=JSON.parse(e);this.startTS=this.safeJsonNumber(n,"startTS",0),this.url=this.safeJsonString(n,"url",""),this.shortUrl=this.safeJsonString(n,"shortUrl",""),this.body=this.safeJsonString(n,"body",""),this.headers=this.safeJsonRecord(n,"headers",{}),this.id=this.safeJsonNumber(n,"id",-1),this.method=this.safeJsonString(n,"method",""),this.replied=!1,this.timedout=!1,this.receivedCv=this.headers[b],this.updateCvHeader()}return Object.defineProperty(e.prototype,"correlationVector",{get:function(){return this.receivedCv?"".concat(this.receivedCv,".").concat(this.cvCounter):""},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},e.prototype.updateCvHeader=function(){var e=this.correlationVector;e&&(this.headers[b]=e)},e.prototype.safeJsonNumber=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var o=e;if("number"==typeof o[t])return o[t];if("string"==typeof o[t])return parseFloat(o[t]);null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof o[t]))}return n},e.prototype.safeJsonString=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var o=e;if("string"==typeof o[t])return o[t];null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof o[t]))}return n},e.prototype.safeJsonRecord=function(e,t,n){var r;if(null!=e&&Object.prototype.hasOwnProperty.call(e,t)){var o=e;if("object"==typeof o[t])return o[t];null===(r=this.logger)||void 0===r||r.warn("unexpected type of '".concat(t,"': ").concat(typeof o[t]))}return n},e}(),R=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),w=function(e){this.name=e,this.args={},this.timeoutTimerId=0};!function(e){e[e.Configuration=0]="Configuration",e[e.ServerInitiated=1]="ServerInitiated"}(d||(t.ReconnectReason=d={}));var O=function(){function e(e,t,n,r,o,i,s,a){var c,d=this;this.options=t,this.manager=n,this.tokenProvider=r,this.usingLegacyTokenApi=o,this.protocolSelector=s,this.audienceSubscriptionState=a,this.WEBSOCKET_TRANSPORT_NAME="websocket",this.XHR_POLLING_TRANSPORT_NAME="xhr-polling",this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR="Error",this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED="Unsubscribed",this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT="Timeout",this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST="BadRequest",this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX=/&audienceSubscriptionState=[^&]*|^audienceSubscriptionState=[^&]*&?/,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.isNavigatorOnline=!0,this.onNavigatorOnlineStatusUpdateBound=this.onNavigatorOnlineStatusUpdate.bind(this),this.c2cUrlBase="",this.connectingErrorsInRow=0,this.unauthorizedErrorCount=0,this.pendingSentEventTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.connectingErrorsThreshold=3,this.pendingAudienceSubscription=void 0,this.logger=new y.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff=new g.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname);var l=new C;l.cv=h.CLIENT_VERSION,l.ua="",(null===(c=this.options)||void 0===c?void 0:c.clientInfo)&&(l.ua=this.safeString(this.options.clientInfo.ua),l.v=this.safeString(this.options.clientInfo.v)),this.clientInfo=l,this.connectionTracker=new p.ConnectionTracker(e,this.clientID,this.clientInfo,(function(){return d.getServerState()}),this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(t);var f=this.options.incallModeTimeoutMs>0;if(this.fsm=new E.TrouterFsm(e,this,f,this.protocolSelector),t.registration){var m={registrarUrl:t.registration.registrarUrl,proxyUrlRewrite:t.rewriteUrlForProxy,registrationId:t.registration.registrationId,requestTimeoutMs:t.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:t.timeoutOptions.maxBackoffMs,usingLegacyTokenApi:this.usingLegacyTokenApi,maxRetriesForGetToken:t.retryLimitOnTokenFetch,extraRegistrationHeaders:t.extraConnectionHeaders};this.registrarClient=(0,u.createRegistrarClient)(e,this.tokenProvider,m)}this.userActivityState=i}return e.prototype.start=function(e){this.logger.info("Starting"),this.reconnectParams=e,"undefined"!=typeof window&&window.navigator&&window.addEventListener?(this.isNavigatorOnline=window.navigator.onLine,window.addEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.addEventListener("offline",this.onNavigatorOnlineStatusUpdateBound),this.logger.debug("Registered for browser online notifications - current state: ".concat(this.isNavigatorOnline))):this.isNavigatorOnline=!0,this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),"undefined"!=typeof window&&window.navigator&&(window.removeEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.removeEventListener("offline",this.onNavigatorOnlineStatusUpdateBound)),this.fsm.stop(e),this.connectionTracker.close()},e.prototype.configure=function(e){var t=this.options.trouterUrl!==e.trouterUrl;this.options=e,this.applyConnectionTrackerOptions(e),t&&(this.logger.info("Configuration changed. Reconnection required."),this.fsm.onReconnectRequired(!1,d.Configuration))},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with ".concat(e)),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(p.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegistrationTimer(),this.cancelPendingRegistrationRequests(),this.fsm.disableAutoReconnect()},e.prototype.getServerState=function(){return new v.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.getToken=function(e,t,n,r,o){var i=this;void 0===o&&(o=0),this.logger.info("Getting token ".concat(t?"with backoff":"without backoff"));var s=function(){i.connectionTracker.trackStart("token");var t={needFresh:!e,wwwAuthenticateHeader:n,supportedTokenTypes:h.SUPPORTED_TOKEN_TYPES,purpose:"trouter"};i.logger.info("Requesting token: needFresh=".concat(t.needFresh," ")+"types=[".concat(h.SUPPORTED_TOKEN_TYPES,"], ")+"wwwAuthenticateHeader is ".concat(t.wwwAuthenticateHeader?"non empty":"empty")),i.tokenProvider(t).then((function(e){i.logger.debug("".concat(e.tokenType," token is received")),i.connectionTracker.trackEnd("token"),i.fsm.onTokenReceived(e,r,i.reconnectParams)})).catch((function(t){var s=(0,l.toJson)(t.stack);if(i.logger.error("Getting token failed, will retry after timeout. Error: ".concat(s)),i.connectionTracker.trackError("token",s),!i.canRetryTokenFetchRequest(o+i.unauthorizedErrorCount))return i.connectionTracker.trackError("token","getToken retry limit hit, reached terminal error state"),i.resetTokenBackoff(),void i.fsm.onTerminalError();i.getToken(e,!0,n,r,o+1)}))};t?this.tokenBackoff.backoff("getting token",s):(this.resetTokenBackoff(),s())},e.prototype.startConnectionTimer=function(){var e=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for ".concat(this.timeoutOptions.connectionTimeoutMs," ms")),this.connectionTimeoutId=setTimeout((function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()}),this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for ".concat(this.timeoutOptions.pingTimeoutMs," ms")),this.pingTimerId=setInterval((function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()}),this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport ".concat(this.transportTypeName))},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegistrationTtl=function(){var e,t;return void 0!==(null===(e=this.options.registration)||void 0===e?void 0:e.registrarTtlSec)&&0!==(null===(t=this.options.registration)||void 0===t?void 0:t.registrarTtlSec)},e.prototype.startRegistrationTimer=function(){var e=this;this.stopRegistrationTimer();var t=this.getRegistrationTtl(),n=t[0],r=t[1];if(n<=30||!r)return this.logger.debug("Starting registration expiration timer (TTL ".concat(n," sec)")),void(this.registrationTimerId=setTimeout((function(){e.registrationTimerId=void 0,e.logger.warn("Registration expired but the connection is still alive. Should never happen"),e.dispatchUnregistered()}),1e3*n));var o=n-30;this.logger.debug("Starting registration extension timer for ".concat(o," sec")),this.registrationTimerId=setTimeout((function(){e.logger.info("Registration extension timer fired"),e.registrationTimerId=setTimeout((function(){e.registrationTimerId=void 0,e.logger.debug("Registration extension did not happen in time"),e.dispatchUnregistered()}),3e4),e.fsm.onRegistrationNearExpiry()}),1e3*o)},e.prototype.startRegistrationRetryTimer=function(){var e=this;this.stopRegistrationTimer(),this.registrationTimerId=setTimeout((function(){e.registrationTimerId=void 0,e.fsm.onRetryRegistration()}),123e3)},e.prototype.stopRegistrationTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.fsm.onResendRegistration(),Promise.resolve()},e.prototype.buildSocketIoUrlParams=function(e,t){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");for(var n={},r=this.allocateResult.connectparams,o=0,i=Object.keys(r);o<i.length;o++){var s=i[o];if(void 0!==r[s]){var a=r[s];"string"==typeof a||"number"==typeof a?n[s]=a:this.logger.error("signatureData[".concat(s,"] has unsupported type ").concat(typeof a))}}return n.v="v4",n.tc=encodeURI((0,l.toJson)(this.clientInfo)),n.timeout=this.timeoutOptions.pingTimeoutMs/1e3,n.auth="true",this.options.endpointId&&(n.epid=this.options.endpointId),e&&(n.userActivity=encodeURI((0,l.toJson)(e))),t&&(n.audienceSubscriptionState=encodeURIComponent((0,l.toJson)(t))),this.appendConnectedClientIds(this.buildQuery(n),!0)},e.prototype.startSocketIo=function(e){var t,n;if(this.logger.debug("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var o=this.options.ioOptions?s({},this.options.ioOptions):new A,i=this.userActivityState.state!==m.UserActivityState.Unknown?this.userActivityState.increaseCvAndGetEventObject():void 0,a=null===(t=this.audienceSubscriptionState)||void 0===t?void 0:t.increaseCvAndGetEventObject();if(o["force new connection"]=!0,o.reconnect=!1,o.rewriteUrlForProxy=this.options.rewriteUrlForProxy,o.requestHeaders=s(s({},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)),o.query=this.buildSocketIoUrlParams(i,a),this.logger.info("connecting to ".concat(this.allocateResult.socketio,"?").concat(o.query)),this.stopSocketIo(),this.socket=(null!==(n=this.options.io)&&void 0!==n?n:T).connect(this.allocateResult.socketio,o),void 0===this.socket)throw new Error("Can't create Socket.io object");this.attachSocketIoHandlers(this.socket,e,i,a)},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.debug("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","close_during_connecting","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket. Error: ".concat(o(e)))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},e.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.debug("dispatching downstream request");try{var n=new R(e,new p.ResponseData(e.id),(function(e,n){return t.logger.debug("sending response to downstream"),t.sendResponse(e,n)}));this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message. Error : ".concat(o(e)))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(e,t){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this,e,t)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.dispatchTerminalError=function(){this.logger.info("dispatching terminal error"),this.manager.onTerminalError(this)},e.prototype.dispatchTrouterMessageLost=function(e){this.logger.info("dispatching trouter message lost"),this.manager.onTrouterMessageLost(e)},e.prototype.countDisconnectBeforeConnectionEstablishment=function(){this.logger.warn("counting disconnect before connection was fully established as a connection failure"),++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold()},e.prototype.sendProcessedDroppedIndicators=function(e){var t=this;try{this.logger.debug("emitting processed flow tags to the server");var n=new w("trouter.processed_message_loss");n.args={droppedIndicators:e},this.sendDownstreamEvent(n,(function(){t.logger.info("emitted processed flow tags to the server")}))}catch(e){var r=o(e);this.logger.error("unable to send processed message loss event. Error: ".concat(r)),this.connectionTracker.trackError("trouter.processed_message_loss",r,!1)}},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n,o=this.options.trouterUrl,i=this.reconnectParams,a="string"==typeof(null==i?void 0:i.se)?parseInt(i.se,10):"number"==typeof(null==i?void 0:i.se)?i.se:void 0;a&&a<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: ".concat(new Date(a))),this.reconnectParams=i=void 0),i&&i.serviceUrl!==o&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(i.serviceUrl,", now ").concat(o,")")),this.reconnectParams=i=void 0),(null==i?void 0:i.reconnectUrl)&&(o=i.reconnectUrl),n=i?s(s({},i),{serviceUrl:void 0,reconnectUrl:void 0}):null,o=(0,S.adaptUrl)(o,"v4a"),o=this.appendCorrelationIds(o,!1),o=this.appendEndpointId(o,!1),n&&(o+="&".concat(this.buildQuery(n)),n.v||(o+="&v=".concat("v4"))),o=this.options.rewriteUrlForProxy(o);var c=new Request(o,{method:"POST",mode:"cors",headers:new Headers(s(s({"Content-Type":"text/plain"},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)))});this.logger.info("sendAllocateRequest: POST ".concat(o)),this.connectionTracker.trackStart("allocation");var d,u=Date.now(),p=-1,h=!1;(0,l.fetchWithTimeout)(c,this.timeoutOptions.fetchTimeoutMs).then((function(e){var n;if(p=e.status,!e.ok)throw d=null!==(n=e.headers.get("www-authenticate"))&&void 0!==n?n:void 0,h="1"===e.headers.get("x-trouter-skypetoken-deprecated"),t.logger.warn("Allocation request got response status ".concat(e.status,", www-authenticate header was ").concat(d?"not empty":"empty")),new Error(e.statusText);var r=e.headers.get("content-type");if(!r||"application/json"!==r&&!r.startsWith("application/json;"))throw new Error("Content-type '".concat(r,"' is unexpected"));return t.connectionTracker.trackEnd("allocation"),e.json()})).then((function(n){t.unauthorizedErrorCount=0,t.onAllocationResponse(n,e)})).catch((function(e){t.connectingErrorsInRow++;var n="".concat(e).concat(p>=0?", status code ".concat(p):"");if(t.logger.error("".concat(t.connectingErrorsInRow," failed connecting attempt(s) in a row. ").concat(n)),t.connectionTracker.trackError("allocation",n),h){var r="Skypetoken deprecated response, not retrying any further";return t.logger.error(r),t.connectionTracker.trackError("allocation",r),void t.fsm.onTerminalError()}if(401===p&&t.unauthorizedErrorCount++,!t.canRetryTokenFetchRequest(t.unauthorizedErrorCount))return r="getToken retry limit hit, reached terminal error state",t.connectionTracker.trackError("allocation",r),void t.fsm.onTerminalError();if(-1!==p||t.isNavigatorOnline){if(t.reconnectParams&&t.connectingErrorsInRow>=t.connectingErrorsThreshold)if(p>=400&&p<=599)t.resetReconnectParamsOnErrorThreshold();else if(t.reconnectParams.reconnectUrl&&t.connectingErrorsInRow%3==0){t.logger.warn("".concat(t.connectingErrorsInRow," connection attempts, testing nominal service URL"));var o=Math.min(t.timeoutOptions.connectionTimeoutMs-(Date.now()-u)-500,t.timeoutOptions.fetchTimeoutMs);return void t.testNominalUrlConnectivity(o).then((function(e){t.connectionTracker.trackProgress("nomcheck",e?"ok":"failed"),e?(t.logger.warn("Nominal service URL is reachable, erasing cached reconnect URL"),t.reconnectParams&&delete t.reconnectParams.reconnectUrl):t.logger.warn("Nominal service URL is not reachable either, keeping cached reconnect URL"),t.fsm.onAllocationFailed(!1,void 0)}),(function(){t.fsm.onAllocationFailed(!1,void 0)}))}}else t.logger.info("Expected failure, the browser says it is not online at the moment");t.fsm.onAllocationFailed(401===p,d)}))},e.prototype.testNominalUrlConnectivity=function(e){var t,n=this;if(e<1e3)return this.logger.warn("There is no time left to reasonably perform the nominal service URL connectivity check (".concat(e," ms), falling back to assuming that the connectivity is fine")),Promise.resolve(!0);try{var r=new URL(this.options.trouterUrl);r.pathname="/",r.search="?"+this.buildQuery({check:Date.now(),cor_id:encodeURIComponent(this.options.clientCorrelationID),epid:encodeURIComponent(this.options.endpointId?this.options.endpointId:""),tc:encodeURIComponent((0,l.toJson)(this.clientInfo))}),t=new Request(this.options.rewriteUrlForProxy(r.toString()),{method:"GET",headers:{Accept:"text/plain"}})}catch(e){return this.logger.warn("Nominal service URL connectivity test request could not be created (".concat(e,"), falling back to assuming that the connectivity is fine")),Promise.resolve(!0)}return(0,l.fetchWithTimeout)(t,e).then((function(e){if(200!==e.status)throw new Error("Not 200 OK: ".concat(e.status," ").concat(e.statusText));return e.text()})).then((function(e){if("Trouter"!==e)throw new Error('Not "Trouter": '.concat(e.substring(0,16)).concat(e.length>16?"...":""));return!0})).catch((function(e){return n.logger.error("Nominal service URL connectivity test failed: ".concat(e)),!1}))},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.debug("emitting ping event");var t=!1;this.socket.emit("ping",(function(){!0!==t&&e.onPingResponse()})),this.pingResponseTimerId=setTimeout((function(){e.logger.error("Ping response timeout is fired"),t=!0,e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()}),this.timeoutOptions.pongTimeoutMs)}catch(e){var n=o(e);this.logger.error("unable to send ping. Error: ".concat(n)),this.connectionTracker.trackError("ping",n,!1)}},e.prototype.connectV4c=function(e,t){var n,r,o,i,a,c,d=this.options.ioOptions?s({},this.options.ioOptions):new A;d["force new connection"]=!0,d.reconnect=!1,(null===(n=this.reconnectParams)||void 0===n?void 0:n.serviceUrl)&&(0,S.adaptUrl)(this.reconnectParams.serviceUrl,"v4c")!==(0,S.adaptUrl)(this.options.trouterUrl,"v4c")&&(this.logger.warn("Dropping cached connection parameters for a different environment (".concat(this.reconnectParams.serviceUrl,", now ").concat(this.options.trouterUrl,")")),this.reconnectParams=void 0);var u=null!==(i=null!==(r=(0,S.redirectUrlIfPresent)(t))&&void 0!==r?r:"redirect-no-host"!==(null==t?void 0:t.kind)?null===(o=this.reconnectParams)||void 0===o?void 0:o.reconnectUrl:void 0)&&void 0!==i?i:this.options.trouterUrl,l=(0,S.adaptUrl)(u,"v4c");d["skipped handshake data"]={timeout:70,websocketUrl:l},d.query=this.buildV4cUrlParams(),d.rewriteUrlForProxy=this.options.rewriteUrlForProxy;try{if(this.stopSocketIo(),this.transportTypeName="websocket",this.socket=(null!==(a=this.options.io)&&void 0!==a?a:T).connect(this.options.trouterUrl,d),void 0===this.socket)throw new Error("failed to create Socket.io object");var p=null===(c=this.audienceSubscriptionState)||void 0===c?void 0:c.increaseCvAndGetEventObject();this.attachSocketIoHandlers(this.socket,e,void 0,p)}catch(e){this.logger.error("".concat(e)),this.connectionTracker.trackError("v4c","".concat(e)),this.fsm.onV4cException()}},e.prototype.sendV4cAuthenticationEvent=function(e){var t,n={headers:s(s({},this.options.extraConnectionHeaders),r(e,this.usingLegacyTokenApi)),connectparams:(0,S.reconnectParamsWithoutUrls)(this.reconnectParams)};null===(t=this.socket)||void 0===t||t.emit(h.USER_AUTHENTICATE_EVENT_NAME,n)},e.prototype.setUserActivityState=function(e){var t=e.state!==this.userActivityState.state;this.userActivityState=e,t?(this.logger.info("Changing user activity state to '".concat(e.toEventJSON(),"'")),this.fsm.onSetNewUserActivityState()):(this.logger.debug("Not changing the same user activity state '".concat(e.toEventJSON(),"'")),this.manager.onUserActivityStateAccepted(e.correlationVector.value()))},e.prototype.sendUserActivityState=function(e,t){this.userActivityState.state!==m.UserActivityState.Unknown&&("websocket"===this.transportTypeName&&t?e===v.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):"xhr-polling"===this.transportTypeName&&e===v.UserActivityEventReason.Modified&&this.fsm.forceReconnect("user activity/force reconnect"))},e.prototype.setAudienceSubscriptionsAsync=function(e,t){var n=this.audienceSubscriptionState;if(this.audienceSubscriptionState=e,this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME)return this.setAudienceSubscriptionsInternalAsync(e.increaseCvAndGetEventObject(),t);if(this.transportTypeName===this.XHR_POLLING_TRANSPORT_NAME){var r=this.setAudienceSubscriptionsLongpollInternalAsync(e.increaseCvAndGetEventObject(),t,n);return this.fsm.forceReconnect("set audience subscription force reconnect"),r}throw new Error("set audience subscription executed on an unknown transport")},e.prototype.setAudienceSubscriptionsUnsafeAsync=function(e){if(e)return this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?this.setAudienceSubscriptionsInternalAsync(e,15e3):void 0},e.prototype.setAudienceSubscriptionsInternalAsync=function(e,t){return a(this,void 0,void 0,(function(){var n,r,o=this;return c(this,(function(i){switch(i.label){case 0:return this.logger.info("[WebSocket] Audience subscription set requested."),(n=new w("audience.subscribe")).args=e,[4,new Promise((function(r){var i=!1,s=setTimeout((function(){return i=!0,r(o.buildAudienceSubscriptionsTimeoutResponse(e))}),t);o.sendDownstreamEvent(n,(function(e,t){i||(clearTimeout(s),o.logger.debug("[Websocket] Audience subscription response: ".concat(t)),o.pendingAudienceSubscription&&o.onAudienceSubscriptionResult(t),r(t))}))}))];case 1:return r=i.sent(),this.manager.onAudiencesSetResolved(r,e.cv),[2,r]}}))}))},e.prototype.setAudienceSubscriptionsLongpollInternalAsync=function(e,t,n){var r;return a(this,void 0,void 0,(function(){var o,i,s,a,d,u,l=this;return c(this,(function(c){switch(c.label){case 0:return this.logger.info("[XHR Polling] Audience subscription set requested."),this.pendingAudienceSubscription&&(this.logger.error("Racing audience subscriptions occured. This situation resolves into undefined scenario and/or nasal demons."),clearTimeout(this.pendingAudienceSubscription.timeoutId)),0===e.audiences.length?[2,this.handleAudienceUnsubscribeLongpoll(e.cv,n)]:[4,new Promise((function(n){var r=setTimeout((function(){return l.pendingAudienceSubscription=void 0,n(l.buildAudienceSubscriptionsTimeoutResponse(e))}),t);l.pendingAudienceSubscription={audienceSetResolve:n,timeoutId:r}}))];case 1:return o=c.sent(),this.manager.getState()===m.TrouterState.Unknown||this.transportTypeName===this.WEBSOCKET_TRANSPORT_NAME?[2,o]:(null==(i=o.responses[0])?void 0:i.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(o,e.cv),[2,o]):(s=o.responses.find((function(t){return t.audienceId===e.audiences[0].id})),(null==s?void 0:s.result.audienceSubscriptionState)===this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR?(this.clearAudienceSubscriptionStateQueryParam(),this.manager.onAudiencesSetResolved(o,e.cv),[2,o]):(a=(null===(r=null==n?void 0:n.audienceSubscriptionModel.audienceSubscriptions[0])||void 0===r?void 0:r.id)!==(null==i?void 0:i.audienceId),n&&a&&(d=this.mapToSyntheticAudienceSubscriptionResponses(n.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200),(u=o.responses).push.apply(u,d)),this.manager.onAudiencesSetResolved(o,e.cv),[2,o]))}}))}))},e.prototype.clearAudienceSubscriptionStateQueryParam=function(){var e,t,n;(null===(n=null===(t=null===(e=this.socket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.options)||void 0===n?void 0:n.query)&&(this.socket.socket.options.query=this.socket.socket.options.query.replace(this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX,""))},e.prototype.handleAudienceUnsubscribeLongpoll=function(e,t){var n;this.audienceSubscriptionState=void 0;var r={responses:[]};if(t){var o=this.mapToSyntheticAudienceSubscriptionResponses(t.audienceSubscriptionModel.audienceSubscriptions,this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED,200);(n=r.responses).push.apply(n,o)}return this.manager.onAudiencesSetResolved(r,e),r},e.prototype.buildAudienceSubscriptionsTimeoutResponse=function(e){return this.logger.error("Audience subscription attempt has timed out."),{responses:this.mapToSyntheticAudienceSubscriptionResponses(e.audiences,this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT)}},e.prototype.mapToSyntheticAudienceSubscriptionResponses=function(e,t,n){return e.map((function(e){return{audienceId:e.id,result:{audienceSubscriptionState:t,responseStatus:n}}}))},e.prototype.expediteBackoff=function(){this.tokenBackoff.expediteIfPending()},e.prototype.sendRegisterRequest=function(){var e=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var t=new l.Timespan;this.connectionTracker.trackStart("registration");var n=this.getRegistrationTtl()[0];this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:n}]}).then((function(){e.logger.info("Register request successful"),e.connectionTracker.trackEnd("registration"),e.fsm.onRegistrationSucceeded(),e.connectionTracker.sendTelemetry(p.ClientEventName.Registration,{duration:t.duration},[])})).catch((function(n){e.logger.error("Register request failed. Error: ".concat(n)),e.connectionTracker.trackError("registration",i(n)),e.fsm.onRegistrationFailed(),e.connectionTracker.sendTelemetry(p.ClientEventName.Registration,{duration:t.duration},[])}))},e.prototype.sendUnregisterRequest=function(){var e=this;this.logger.info("sending unregister request");var t=new l.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then((function(){e.logger.info("Unregister request successful"),e.connectionTracker.trackEnd("unregistration"),e.fsm.onUnregistrationDone(),e.connectionTracker.sendTelemetry(p.ClientEventName.Unregistration,{duration:t.duration},[])})).catch((function(n){e.logger.error("Unregister request failed. Error: ".concat(n)),e.connectionTracker.trackError("unregistration",i(n)),e.fsm.onUnregistrationDone(),e.connectionTracker.sendTelemetry(p.ClientEventName.Unregistration,{duration:t.duration},[])}))},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.cancelPendingRegistrationRequests=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},e.prototype.clearSentEventTimers=function(){var e=Object.keys(this.pendingSentEventTimers);if(e.length>0){this.logger.debug("Clearing all pending downstream events related timers");for(var t=0,n=e;t<n.length;t++){var r=n[t];this.clearSentEventTimer(Number(r))}}},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout((function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()}),this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.sendDisconnectTelemetryEvent=function(e){var t={reason:e,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(t),this.connectionTracker.clearConnectedInfo()},e.prototype.forceReconnectDueToNoRegistration=function(){this.fsm.forceReconnect("force reconnect due to no registration")},e.prototype.resetReconnectParamsOnErrorThreshold=function(){this.logger.warn("".concat(this.connectingErrorsInRow," connection attempts, server-side failure: erasing cached connection parameters")),this.reconnectParams=void 0},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting(".concat(e,")")),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(e){this.logger.info("onSocketConnect"),this.fsm.onSocketConnect(e)},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",e,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(e){var t=this.connectionTracker.getSessionLength()||0,n=f.DisconnectReason.fromRawReason(e);this.logger.error("onSocketDisconnect, reason: ".concat(n.reason)),"dup"===n.reason&&"dup"===this.lastDisconnectReason&&t<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row "+"after ".concat(t," ms which is below the threshold of ")+"".concat(this.options.duplicateDisconnectThresholdMs," ms. Resetting cached ")+"connection parameters and making a new allocation."),this.reconnectParams=void 0),this.lastDisconnectReason=n.reason,this.fsm.onSocketDisconnect(n),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '".concat(e,"'")),this.fsm.onSocketDisconnect(f.DisconnectReason.fromSocketIoEventData("reconnecterror",e))},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '".concat((0,l.toJson)(e),"'")),this.fsm.isConnecting()&&++this.connectingErrorsInRow>=this.connectingErrorsThreshold&&this.resetReconnectParamsOnErrorThreshold(),this.connectionTracker.trackError("connectSocket",function(e){return null!=e&&"function"==typeof e.toString?e.toString():"[".concat(typeof e,"]")}(e)),this.fsm.onSocketDisconnect(f.DisconnectReason.fromSocketIoEventData("socketerror",e))},e.prototype.onSocketMessage=function(e){var t,n,r=this;this.logger.debug("onSocketMessage");try{var s=null===(t=(n=new I(e,this.logger)).headers)||void 0===t?void 0:t["X-Microsoft-Skype-Chain-ID"],a=s?" Chain-Id ".concat(s):"";this.logger.info("Received request N ".concat(n.id).concat(a," CV ").concat(n.correlationVector," to '").concat(n.url,"'")),n.startTS=Date.now(),n.url&&this.urlPath&&n.url.startsWith(this.urlPath)&&(n.shortUrl=n.url.substring(this.urlPath.length))}catch(e){var c=o(e);return this.logger.error("unable to parse request. Error: ".concat(c)),this.connectionTracker.trackRequest(void 0,c),void this.connectionTracker.sendResponseError("unable to parse request, error: ".concat(e))}n.timeoutTimerId=setTimeout((function(){if(!n.replied){r.logger.error("Request ".concat(n.id," timed out"));var e=new p.ResponseData(n.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},r.sendResponse(n,e),n.timedout=!0}}),this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(n),this.fsm.onDownstreamRequest(n)}catch(e){this.logger.error("exception in socket.on message. Error: ".concat(o(e))),this.connectionTracker.sendResponseError(i(e),n,void 0)}},e.prototype.onTrouterConnected=function(e,t,n){var r,o,i,a,c=this;if((0,S.isV4ConnectEvent)(e)){var d=e;this.allocateResult=s(s({},d),{ttl:e.ttl.toString()}),this.populateAndCacheReconnectParams(d,d.reconnectUrl),this.populateConnectionStateFields(d)}else if(!this.allocateResult)return void this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set");this.connectingErrorsInRow=0,this.logger.info("onTrouterConnected: ".concat(this.allocateResult.url)),"xhr-polling"===this.transportTypeName&&t&&this.manager.onUserActivityStateAccepted(t.cv),(null===(i=null===(o=null===(r=this.socket)||void 0===r?void 0:r.socket)||void 0===o?void 0:o.options)||void 0===i?void 0:i.query)&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var u=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=(0,l.calculateExpireTsInSec)((0,S.ensureNumber)(e.ttl)),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(u,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),null===(a=this.setAudienceSubscriptionsUnsafeAsync(n))||void 0===a||a.catch((function(e){return c.logger.error("Re-subscribe to audiences has failed with ".concat(e))})),this.fsm.onTrouterConnected()},e.prototype.onTrouterReconnect=function(e){var t=e.target;this.logger.info("onTrouterReconnect target: ".concat(t)),"self"===t?this.fsm.onReconnectRequired(!0,d.ServerInitiated):this.fsm.onReconnectRequired(!1,d.ServerInitiated,e)},e.prototype.onTrouterMessageLoss=function(e){this.logger.debug("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(e.droppedIndicators)},e.prototype.onAudienceSubscriptionResult=function(e){this.logger.info("onAudienceSubscriptionResult"),this.pendingAudienceSubscription&&(clearTimeout(this.pendingAudienceSubscription.timeoutId),this.pendingAudienceSubscription.audienceSetResolve(e),this.pendingAudienceSubscription=void 0)},e.prototype.buildV4cUrlParams=function(){var e={};return e.tc=encodeURI((0,l.toJson)(this.clientInfo)),e.timeout=Math.floor(this.timeoutOptions.pingTimeoutMs/1e3),this.options.endpointId&&(e.epid=this.options.endpointId),this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.attachSocketIoHandlers=function(e,t,n,r){var o=this;e.on("connecting",(function(e){o.onSocketConnecting(e)})),e.on("connect",(function(){o.onSocketConnect(t)})),e.on("connect_failed",(function(e){o.onSocketConnectFailed(e)})),e.on("close_during_connecting",(function(e){o.onSocketConnectFailed(e)})),e.on("disconnect",(function(e){o.onSocketDisconnect(e)})),e.on("reconnect",(function(){o.onSocketReconnect()})),e.on("reconnect_failed",(function(e){o.onSocketReconnectFailed(e)})),e.on("reconnecting",(function(){o.onSocketReconnecting()})),e.on("error",(function(e){o.onSocketError(e)})),e.on("message",(function(e){o.onSocketMessage(e)})),e.on("trouter.connected",(function(e){o.onTrouterConnected(e,n,r)})),e.on("trouter.reconnect",(function(e){o.onTrouterReconnect(e)})),e.on("trouter.message_loss",(function(e){o.onTrouterMessageLoss(e)})),e.on("audience.subscriptionresult",(function(e,t){o.onAudienceSubscriptionResult(t)}))},e.prototype.onNavigatorOnlineStatusUpdate=function(){var e=window.navigator.onLine;this.logger.debug("Browser online status update - new state: ".concat(e,", previously: ").concat(this.isNavigatorOnline)),e&&!this.isNavigatorOnline?(this.isNavigatorOnline=!0,this.tokenBackoff.expediteIfPending(),this.connectionTracker.trackProgress("browserNet","online")):!e&&this.isNavigatorOnline&&(this.isNavigatorOnline=!1,this.connectionTracker.trackProgress("browserNet","offline"))},e.prototype.onAllocationResponse=function(e,t){this.logger.info("Received allocation response ".concat(JSON.stringify(e))),this.allocateResult=e,this.populateAndCacheReconnectParams(this.allocateResult,"".concat(this.allocateResult.socketio,"v4/a")),this.populateConnectionStateFields(this.allocateResult),this.fsm.onAllocationSucceed(t)},e.prototype.populateAndCacheReconnectParams=function(e,t){this.reconnectParams=s({serviceUrl:this.options.trouterUrl,reconnectUrl:t},e.connectparams),this.manager.onConnectionParametersUpdated(this.reconnectParams)},e.prototype.populateConnectionStateFields=function(e){var t,n,r="string"==typeof e.ttl?parseInt(e.ttl,10):e.ttl;if(this.connectionExpireTimestampInSecs=(0,l.calculateExpireTsInSec)(r),this.connectionId=null!==(t=e.id)&&void 0!==t?t:"",this.connectedClientId=e.ccid,this.logger.debug("connected client id set {connectedClientId:".concat(this.connectedClientId,"}")),this.c2cUrlBase=null!==(n=e.curlb)&&void 0!==n?n:"",""===this.c2cUrlBase){var o=e.surl.indexOf("://");o>=0&&(o=e.surl.indexOf("/",o+3))>=5&&":3443"===e.surl.substr(o-5,5)&&(this.c2cUrlBase=e.surl.substr(0,o-5))}},e.prototype.onPingResponse=function(){this.logger.debug("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];void 0!==e[o]&&t.push("".concat(o,"=").concat(e[o]))}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.includes("ccid=")||(n="ccid=".concat(this.connectedClientId,"&")),this.domId&&(n+="dom=".concat(this.domId,"&")),n.length>0&&(n=n.slice(0,-1));var r=t||e.includes("?")?"&":"?";return this.appendCorrelationIds(e+r+n,t)},e.prototype.appendEndpointId=function(e,t){var n=t||e.includes("?")?"&":"?";return!e.includes("epid")&&this.options.endpointId?"".concat(e).concat(n,"epid=").concat(this.options.endpointId):e},e.prototype.appendCorrelationIds=function(e,t){var n=t||e.includes("?")?"&":"?";return e.includes("cor_id")?e:"".concat(e).concat(n,"cor_id=").concat(this.options.clientCorrelationID)+"&con_num=".concat(this.clientID,"_").concat(this.connectionAttempt)},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){var n,r,i;if(e.timedout)return this.logger.error("Request ".concat(e.id," already timed out")),1;if(e.replied)return this.logger.error("Response for request ".concat(e.id," already sent")),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=void 0,e.replied=!0,t.headers=null!==(n=t.headers)&&void 0!==n?n:{};var s=e.correlationVector;this.logger.info("Sending response N ".concat(e.id," CV ").concat(s," with status ").concat(t.status)),s&&(t.headers[b]=s),(null===(r=e.headers)||void 0===r?void 0:r["trouter-request"])&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var a=Date.now()-e.startTS;if(t.headers["trouter-client"]=(0,l.toJson)({cd:a}),(null===(i=e.headers)||void 0===i?void 0:i["trouter-is-broadcast"])&&(t.headers["trouter-is-broadcast"]=e.headers["trouter-is-broadcast"]),this.logger.debug("response: ".concat((0,l.toJson)(t))),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send((0,l.toJson)(t)),t.sentTS=Date.now(),e.incrementCorrelationVector(),this.connectionTracker.trackResponse(e,a,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var c="unable to send data on response.end. Error: ".concat(o(n));return this.logger.error(c),this.connectionTracker.sendResponseError(c,e,t),4}},e.prototype.sendUserActivityStateMultiple=function(e){var t=this,n=new w("user.activity"),r=this.userActivityState.increaseCvAndGetEventObject();n.args=r,this.logger.debug("Sending user activity '".concat(this.userActivityState.toEventJSON(),"', remaining ").concat(e-1));var o=!1;this.sendDownstreamEvent(n,(function(){if(!0!==o&&(t.logger.info("User activity state: ".concat(r.state,", cv: ").concat(r.cv," accepted")),t.manager.onUserActivityStateAccepted(r.cv),t.clearSentEventTimer(n.timeoutTimerId),e>1)){var i=setTimeout((function(){t.clearSentEventTimer(i),t.sendUserActivityStateMultiple(e-1)}),t.options.userActivitySecondResendDelayMs);t.registerSentEventTimer(i,"user.activity/resend")}})),n.timeoutTimerId=setTimeout((function(){t.logger.error("Activity state response timeout is fired"),o=!0,t.fsm.onActivityStateResponseTimeout(),t.clearSentEventTimer(n.timeoutTimerId)}),this.timeoutOptions.userActivityResponseTimeoutMs),this.registerSentEventTimer(n.timeoutTimerId,"user.activity/response")},e.prototype.sendDownstreamEvent=function(e,t){this.logger.debug("Sending downstream event ".concat(e.name)),this.socket&&this.socket.emit(e.name,e.args,t)},e.prototype.registerSentEventTimer=function(e,t){this.logger.debug("registering timer ".concat(e," -> ").concat(t)),this.pendingSentEventTimers[e]=t},e.prototype.clearSentEventTimer=function(e){var t=this.pendingSentEventTimers[e];this.logger.debug("clearing timer ".concat(e," -> ").concat(t)),delete this.pendingSentEventTimers[e],clearTimeout(e)},e.prototype.getRegistrationTtl=function(){var e,t,n=(0,l.calculateTtlInSec)(this.connectionExpireTimestampInSecs);if(this.logger.debug("Current connectionID will expire in ".concat(n," seconds")),(null===(e=this.options.registration)||void 0===e?void 0:e.registrarTtlSec)&&n>0){var r=this.options.registration.registrarTtlSec<n;return[Math.min(this.options.registration.registrarTtlSec,n),r]}return(null===(t=this.options.registration)||void 0===t?void 0:t.registrarTtlSec)?[this.options.registration.registrarTtlSec,!1]:n>0?[n,!1]:[3600,!1]},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e.prototype.applyConnectionTrackerOptions=function(e){try{e.eventLogger&&"function"==typeof e.eventLogger.logEvent?(this.connectionTracker.mergeSettings(e.telemetrySettings),this.connectionTracker.enable(e.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.logger.warn("Trouter client event logging disabled. Error: ".concat(o(e))),this.connectionTracker.disable()}},e.prototype.canRetryTokenFetchRequest=function(e){var t=this.options.retryLimitOnTokenFetch;return null==t||e<t||(this.logger.warn("Reached limit on maximum number of token fetch request. Current count: ".concat(e,", retry limit: ").concat(t)),!1)},e}();t.TrouterConnection=O},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandlerRegistry=void 0;var r=n(1),o=n(0),i=function(){function e(e){this.messageHandlers=[],this.logger=new o.Logger("MessageHandlers",e)}return e.prototype.register=function(e){if(this.messageHandlers.some((function(t){return t===e})))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:r.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,o=this.messageHandlers;n<o.length;n++){var i=o[n],s=this.safeExecuteHandle(i,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=r.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("Trouter message handler threw an exception: ".concat(e))}},e}();t.MessageHandlerRegistry=i},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=void 0,t.addCacheAsBackupTo=function(e){var t,n=this;return function(i){return r(n,void 0,void 0,(function(){return o(this,(function(n){return i&&(t=void 0),[2,new Promise((function(n,r){e(i).then((function(e){t=e,n(e)})).catch((function(e){void 0!==t&&t.length>0&&n(t),r(e)}))}))]}))}))}}},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManager=t.AudienceSubscriptionState=t.UserActivityObject=void 0;var i=n(3),s=n(2),a=n(4),c=n(0),d=n(5),u=n(18),l=n(7),p=n(6),h=n(19),f=function(){function e(e,t){this.state=e,this.correlationVector=void 0!==t?t:i.CorrelationVector.extend()}return e.prototype.getStateString=function(){switch(this.state){case s.UserActivityState.Active:return"active";case s.UserActivityState.Inactive:return"inactive";case s.UserActivityState.Unknown:return"unknown";default:return"undefined"}},e.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},e.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return(0,i.toJson)(this.toEventObject())},e}();t.UserActivityObject=f;var g=function(){function e(e,t){void 0===t&&(t=i.CorrelationVector.extend()),this.audienceSubscriptionModel=e,this.correlationVector=t}return e.prototype.increaseCvAndGetEventObject=function(){return this.correlationVector.increase(),this.toEventObject()},e.prototype.toEventObject=function(){return{audiences:this.audienceSubscriptionModel.audienceSubscriptions,cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return(0,i.toJson)(this.toEventObject())},e}();t.AudienceSubscriptionState=g;var m=function(){function e(e,t,n,r,o,a){var u=this;this.logFunc=e,this.options=t,this.tokenProvider=n,this.usingLegacyTokenApi=r,this.listener=o,this.tokenTypeProtocolSelector=function(e,t){return u.options.forceV4aProtocol?"v4a":(0,d.usedProtocol)(e,t)},this.logger=new c.Logger("Manager",e),this.logger.info("Created TrouterManager with options ".concat((0,i.toJson)(this.options))),this.fsm=new h.TrouterManagerFsm(e,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new f(s.UserActivityState.Unknown),this.protocolSelector=null!=a?a:this.tokenTypeProtocolSelector.bind(this)}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(e){this.fsm.stop(e)},e.prototype.configure=function(e){this.options=e,void 0!==this.firstConnection&&this.firstConnection.configure(e),void 0!==this.secondConnection&&this.secondConnection.configure(e),this.logger.info("Reconfigured TrouterManager with options ".concat((0,i.toJson)(this.options)))},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.resendRegistration=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){return void 0!==this.secondConnection?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])}))}))},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.isInTerminalState=function(){return this.fsm.getInternalState()===a.TrouterManagerState.TerminalError},e.prototype.reportStateInfo=function(){var e=this.firstConnection?p.State[this.firstConnection.getState()]:"Unknown",t=a.TrouterManagerState[this.fsm.getInternalState()];if(this.secondConnection){var n=p.State[this.secondConnection.getState()];return"Manager ".concat(t,"; 1st ").concat(e,"; 2nd ").concat(n)}return"Manager ".concat(t,"; Connection ").concat(e)},e.prototype.startFirstConnection=function(){var e=new l.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.firstConnection=e,this.getConnectionCache().then((function(t){e.start(t)})).catch((function(){}))},e.prototype.startSecondConnection=function(e){var t=new l.TrouterConnection(this.logFunc,this.options,this.configuredTrouterManager(),this.tokenProvider,this.usingLegacyTokenApi,this.userActivityObject,this.protocolSelector,this.audienceSubscriptionState);this.secondConnection=t,void 0!==this.firstConnection&&this.firstConnection.disableRegistrationsAndAutoReconnect(),e?this.getConnectionCache().then((function(e){t.start(e)})).catch((function(){})):t.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(e),this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var e=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in ".concat(Math.round(this.options.lingeringConnectionDelayMs/1e3),"s")),setTimeout((function(){e.stop(!0)}),this.options.lingeringConnectionDelayMs)}},e.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t=e.url.endsWith("/")?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,c2cUrlBase:e.c2cUrlBase,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchDisconnected=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchTerminalError=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchRegistrationState=function(e){this.options.registrationStateCallback&&this.options.registrationStateCallback(e)},e.prototype.expediteBackoffOnConnections=function(){var e;void 0!==this.lastExpediteBackoffCallAt&&Date.now()-this.lastExpediteBackoffCallAt<(null!==(e=this.options.expediteBackoffOnStartMinimumDelayMs)&&void 0!==e?e:1e4)?this.logger.info("Expedite backoff due to start() too frequent, skipping"):(this.lastExpediteBackoffCallAt=Date.now(),void 0!==this.firstConnection&&this.firstConnection.expediteBackoff(),void 0!==this.secondConnection&&this.secondConnection.expediteBackoff())},e.prototype.onDownstreamRequest=function(e,t,n){var r={id:t.id,method:t.method,path:"/".concat(t.shortUrl),body:t.body,headers:t.headers},o={id:t.id,status:0,headers:{},body:"",send:function(){return o.status<=100||o.status>=999?3:(n.writeHead(o.status,o.headers),n.end(o.body))}};this.listener.onTrouterRequest(r,o)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onUnregistered=function(e){this.fsm.onUnregistered(e===this.firstConnection||e===this.storedFirstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e,t,n){this.fsm.onReconnectionRequired(e===this.firstConnection,t,n)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.firstConnection||e==this.storedFirstConnection),this.storedFirstConnection=void 0},e.prototype.onTerminalError=function(){this.fsm.onTerminalError(),this.storedFirstConnection=void 0},e.prototype.onUserActivityStateAccepted=function(e){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(e)},e.prototype.onAudiencesSetResolved=function(e,t){var n,r;null===(r=(n=this.listener).onAudiencesSetResolved)||void 0===r||r.call(n,e,t)},e.prototype.onConnectionParametersUpdated=function(e){this.setConnectionCache(e)},e.prototype.setUserActivityState=function(e,t){return this.userActivityObject=new f(e,i.CorrelationVector.extend(t)),void 0!==this.secondConnection?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the second/new connection")),void this.secondConnection.setUserActivityState(this.userActivityObject)):void 0!==this.firstConnection?(this.logger.info("Setting user activity ".concat(this.userActivityObject.toEventJSON()," on the first/current connection")),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},e.prototype.setAudienceSubscriptionsAsync=function(e,t,n){if(this.audienceSubscriptionState=new g(e,i.CorrelationVector.extend(n)),this.secondConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on second/new connection")),this.secondConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,t);if(this.firstConnection)return this.logger.info("Setting audience subscriptions ".concat(this.audienceSubscriptionState.toEventJSON()," on first/current connection")),this.firstConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState,t);throw new Error("No connection found")},e.prototype.onTrouterMessageLost=function(e){var t=this;if(this.listener.onTrouterMessageLoss)if(null==e?void 0:e.length){var n=e.filter((function(e){return void 0!==t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]}));if(n.length&&(this.logger.info("onTrouterMessageLoss - immediately acknowledging ".concat(n.length," seen dropped indicators")),this.sendProcessedDroppedIndicators(n),!(e=e.filter((function(e){return void 0===t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]}))).length))return void this.logger.info("onTrouterMessageLoss - all declared dropped indicators have been seen before");if(!this.listener.onTrouterMessageLoss(e.map((function(e){return e.tag}))))return void this.logger.warn("onTrouterMessageLoss - some flow tag(s) have not been processed by listeners");e.forEach((function(e){t.processedMessageLoss["".concat(e.tag,"-").concat(e.etag)]=""})),this.sendProcessedDroppedIndicators(e)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},e.prototype.getConnectionCache=function(){var e=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then((function(e){var t=e?JSON.parse(e):void 0;return"object"==typeof t?t:void 0})).catch((function(t){return e.logger.warn("Invalid connection cache content provided: ".concat(t)),e.connectionCache}))):Promise.resolve(this.connectionCache)},e.prototype.setConnectionCache=function(e){if(this.connectionCache=e,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(e))}catch(e){this.logger.warn("Error setting external connection cache: ".concat(e))}},e.prototype.sendProcessedDroppedIndicators=function(e){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(e):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(e):void 0},e.prototype.configuredTrouterManager=function(){return new u.RegistrationEnforcer(this,this.options.connectionDependsOnRegistration,this.options.delayEventsUntilRegistered)},e}();t.TrouterManager=m},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterUrlPromise=void 0;var r=n(0),o=function(){function e(e){this.logger=new r.Logger("UrlPromise",e)}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("returning previously resolved url: ".concat(this.url)),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("creating and returning promise"),this.pendingPromise=new Promise((function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n}))):this.logger.debug("returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("got url: ".concat(this.url));var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=o},function(e,t,n){(function(e,n){!function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var o,i,s=n.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),o=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,r),!a["force new connection"]&&n.sockets[o]||(i=new n.Socket(a)),!a["force new connection"]&&i&&(n.sockets[o]=i),i=i||n.sockets[o],a["skipped handshake data"]?i.of(""):i.of(s.path.length>1?s.path:"")}}(n.exports,void 0===e?window:e);var r=n.exports;!function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=r.exec(e||""),n={},i=14;i--;)n[o[i]]=t[i]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,o=e.port;return"document"in t?(r=r||document.domain,o=o||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",o||"https"!=n||(o=443)),(n||"http")+"://"+r+":"+(o||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),o=[];for(var i in n.merge(r,n.chunkQuery(t||"")),r)r.hasOwnProperty(i)&&o.push(i+"="+r[i]);return o.length?"?"+o.join("&"):""},n.chunkQuery=function(e){for(var t,n={},r=e.split("&"),o=0,i=r.length;o<i;++o)(t=r[o].split("="))[0]&&(n[t[0]]=t[1]);return n};var i=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||i)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load((function(){i=!0})),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load((function(){setTimeout(e,100)}))},n.merge=function(e,t,r,o){var i,s=o||[],a=void 0===r?2:r;for(i in t)t.hasOwnProperty(i)&&n.indexOf(s,i)<0&&("object"==typeof e[i]&&a?n.merge(e[i],t[i],a-1,s):(e[i]=t[i],s.push(t[i])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var r=[],o=e.length>t.length?e:t,i=e.length>t.length?t:e,s=0,a=i.length;s<a;s++)~n.indexOf(o,i[s])&&r.push(i[s]);return r},n.indexOf=function(e,t,n){var r=e.length;for(n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==r?r:n.exports,void 0===e?window:e),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var o=-1,i=0,s=r.length;i<s;i++)if(r[i]===n||r[i].listener&&r[i].listener===n){o=i;break}if(o<0)return this;r.splice(o,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(var o=n.slice(),i=0,s=o.length;i<s;i++)o[i].apply(this,r)}return!0}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){if(t&&t.parse)return e.JSON={parse:t.parse,stringify:t.stringify};throw new Error("JSON not available")}(void 0!==r?r:n.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],o=n.reasons=["transport not supported","client not handshaken","unauthorized"],i=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(r,e.type),n=e.id||"",c=e.endpoint||"",d=e.ack,u=null;switch(e.type){case"error":var l=e.reason?a(o,e.reason):"",p=e.advice?a(i,e.advice):"";""===l&&""===p||(u=l+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":var h={name:e.name};e.args&&e.args.length&&(h.args=e.args),u=s.stringify(h);break;case"json":u=s.stringify(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,n+("data"==d?"+":""),c];return null!=u&&f.push(u),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+=""+e[n].length+""+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:r[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=o[a[0]]||"",n.advice=i[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var d=s.parse(e);n.name=d.name,n.args=d.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}break;case"disconnect":n.reason=e}return n},n.decodePayload=function(e){if(""==e.charAt(0)){for(var t=[],r=1,o="";r<e.length;r++)""==e.charAt(r)?(t.push(n.decodePacket(e.substr(r+1).substr(0,o))),r+=Number(o)+1,o=""):o+=e.charAt(r);return t}return[n.decodePacket(e)]}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,o=n.length;r<o;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout((function(){e.onDisconnect()}),this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(e){var n=this.socket.options;if(n["skipped handshake data"])return n.rewriteUrlForProxy(n["skipped handshake data"].websocketUrl+(e||""));var r=this.scheme()+"://"+n.host+":"+n.port+"/"+n.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid+(e||"");return n.rewriteUrlForProxy(r)},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",(function(){r.disconnectSync()}),!1)}this.options["auto connect"]&&this.connect()}function o(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,i=this.options;if(!r.disconnected){var s=i.rewriteUrlForProxy(["http"+(i.secure?"s":"")+":/",i.host+":"+i.port,i.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/"));if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push((function(e){n(e),c.parentNode.removeChild(c)}))}else{var d=t.util.request();d.open("GET",s,!0);var u=this.options.requestHeaders;void 0!==u&&Object.keys(u).forEach((function(e){d.setRequestHeader(e,u[e])})),d.onreadystatechange=function(){4==d.readyState&&(d.onreadystatechange=o,200==d.status?n(d.responseText):!r.reconnecting&&r.onError(d.responseText))},d.send(null)}}},r.prototype.getTransport=function(e){for(var n,r=e||this.transports,o=0;n=r[o];o++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting||this.disconnected)return this;var n=this,r=function(r,o,i,s){function a(){if(!n.connected&&!n.disconnected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport||n.disconnected)return n.publish("connect_failed");n.transport.ready(n,(function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout((function(){a()}),n.options["connect timeout"]))}))}n.sessionid=r,n.closeTimeout=1e3*i+2e3,n.heartbeatTimeout=1e3*o+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",(function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()}))};if(this.options["skipped handshake data"]){var o=this.options["skipped handshake data"];r("v4c-"+(new Date).getTime(),o.timeout,o.timeout,"websocket")}else this.handshake(r);return this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout((function(){e.transport.onClose()}),this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t?(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()):this.publish("close_during_connecting",e))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=o}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<i&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],o=this.options["try multiple transports"],i=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason||"");break;case"message":case"json":var o=["message",e.data];"data"==e.ack?o.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,o);break;case"event":o=[e.name].concat(e.args),"data"==e.ack&&o.push(n),this.$emit.apply(this,o);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}function o(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(e){var r,o=t.util.query(this.socket.options.query),i=this;return this.connectErrorCallback=e,r||(r=n.MozWebSocket||n.WebSocket),this.websocket=new r(this.prepareUrl(o)),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(e){i.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=o),this},t.transports.push("websocket")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(e){e&&t.Transport.apply(this,arguments)}function o(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,o=e.length;r<o;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=o,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=o,200==this.status?(clearTimeout(this.ackTimeoutTimer),t.socket.setBuffer(!1)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout((function(){t.onClose()}),t.socket.options.ackTimeoutMs)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);n.open(e||"GET",this.prepareUrl(r),!0);var o=this.socket.options.requestHeaders;if(void 0!==o&&Object.keys(o).forEach((function(e){n.setRequestHeader(e,o[e])})),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var o=t.util.request(r),i=n.XDomainRequest&&o instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(o&&(!i||!s))return!0}catch(e){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=o),this}}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function o(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},r.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=o,this.onerror=o,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=o,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=o;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer((function(){n.call(r)}))},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=o),this},t.transports.push("xhr-polling")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),t.io=r}).call(t,n(13),n(14)(e))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionTracker=t.Properties=t.TrackerStep=t.ClientEventName=t.ResponseData=void 0;var r,o=n(3),i=n(1),s=n(0),a=function(e){this.id=e,this.status=200,this.headers={},this.body=""};t.ResponseData=a,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(r||(t.ClientEventName=r={}));var c=function(e,t,n,r,o){this.stepName=e,this.operation=t,this.delta=n,this.ts=r,this.error=o};t.TrackerStep=c;var d=function(){};t.Properties=d;var u=function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0},l=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0},p=function(){function e(e,t,n,r,i,a,c){this.clientId=t,this.clientInfo=n,this.getServerState=r,this.endpointId=i,this.clientCorrelationID=a,this.environment=c,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==a?a:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new o.Timespan,this.eventLogSettings=new l,this.connectedInfo=new u}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(r.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout((function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})}),1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];void 0!==t[o]&&(e[o.replace(/-/g,"_")]={value:t[o]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var r=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:(0,o.toJson)(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:i.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:r.connectionId},connectedClientId:{value:r.connectedClientId},domId:{value:r.domId},url:{value:r.unsecureUrl},surl:{value:r.url},ttlInSecs:{value:r.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event ".concat(e,": ").concat((0,o.toJson)(t)))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration,Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var o=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(r.Progress,{reason:"flush"},o)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,o){void 0===n&&(n=!0),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(void 0===o&&(o="error"),!0===n&&this.addStep(e,o,t),this.sendTelemetry(r.Error,{},[this.createStep(e,o,t)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),o=this.totalStepCount,i=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(r.Connected,{stepCount:n.length,totalStepCount:o,connectionEstablishmentMs_Total:i},n),this.cancelProgressTimer()},e.prototype.getSessionLength=function(){return Date.now()-this.connectedInfo.connectedTimestamp},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=this.getSessionLength(),this.sendTelemetry(r.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS,n.correlationVector=e.correlationVector;for(var i=e.headers,s=0,a=Object.keys(i);s<a.length;s++){var c=a[s];n[c]=i[c]}}}catch(e){n.hasError=!0,n.error="".concat(n.error," error creating request context ").concat((0,o.toJson)(e))}this.sendTelemetry(r.Request,n,[])},e.prototype.trackResponse=function(e,t,n,i){var s={};void 0!==i&&(s.hasError=!0,s.error=i);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl,s.correlationVector=e.correlationVector;for(var a=e.headers,c=0,d=Object.keys(a);c<d.length;c++){var u=d[c];s[u]=a[u]}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error="".concat(s.error," error creating response context ").concat((0,o.toJson)(e))}this.sendTelemetry(r.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0));var t=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var n=0,o=Object.keys(r).map((function(e){return r[e]}));n<o.length;n++){var i=o[n];void 0!==e[i]&&(this.eventLogSettings[i]=e[i])}this.eventLogSettings.sendProgressTimeoutSecs!==t&&(this.eventLogSettings.sendProgressTimeoutSecs=t,this.resetProgressSendTimer())}},e}();t.ConnectionTracker=p},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DisconnectReason=void 0;var r=function(){function e(e,t,n){this.reason=e,this.claims=t,this.details=n}return e.fromRawReason=function(t,n){if(""===t||"dup"===t)return new e(t);try{var r=JSON.parse(t);return"object"!=typeof r||void 0===r.reason?(null==n||n.error("invalid disconnect reason format"),new e("unknown",void 0,t)):new e(r.reason,r.claims,r.details)}catch(n){return new e("disconnect",void 0,t)}},e.fromSocketIoEventData=function(t,n){return"string"==typeof n?new e(t,void 0,n):void 0},e.prototype.toTelemetryString=function(){return"socketerror"===this.reason||"reconnecterror"===this.reason||"disconnect"===this.reason?this.details:this.reason},e}();t.DisconnectReason=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ExponentialBackoff=void 0;var r=function(){function e(e,t,n){void 0===n&&(n={tolerance:2,minimumWaitMs:1e4}),this.logger=e,this.maxBackoffInMs=t,this.gapDetectionSettings=n,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),r=1e3*Math.pow(2,e)*n;return r=Math.round(r),Math.min(t,r)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var r=this;if(void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),void 0!==this.previousCompleteTime){var o=Date.now()-this.previousCompleteTime;o>this.maxBackoffInMs*this.gapDetectionSettings.tolerance&&o>this.gapDetectionSettings.minimumWaitMs&&(this.logger.info("Back off for ".concat(t," with ID ").concat(this.backoffId," will be reset due to a lot of time having passed since the previous backoff (").concat(o," ms)")),this.backoffCount=0,this.previousCompleteTime=void 0)}var i=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off ".concat(t," for ").concat(i," milliseconds with ID ").concat(this.backoffId)),this.callback=function(e,o){(function(e,t,n){if(void 0===e||void 0===t)return!1;var r=Date.now()-e;return r>t*n.tolerance&&r>n.minimumWaitMs})(e,o,r.gapDetectionSettings)&&(r.logger.info("Back off for ".concat(t," with ID ").concat(r.backoffId," will be reset due to the wait (").concat(Date.now()-(null!=e?e:0)," ms) being longer than expected (").concat(o," ms)")),r.backoffCount=0),r.logger.info("Back off for ".concat(t," with ID ").concat(r.backoffId," complete, invoking handler")),r.timerHandle=void 0,r.callback=void 0,r.previousCompleteTime=Date.now(),n()};var s=Date.now();this.timerHandle=setTimeout((function(){var e;return null===(e=r.callback)||void 0===e?void 0:e.call(r,s,i)}),i)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0,this.callback=void 0),this.backoffCount=0},e.prototype.expediteIfPending=function(){if(this.backoffCount=0,void 0!==this.timerHandle){this.logger.debug("Expediting back off with ID ".concat(this.backoffId)),clearTimeout(this.timerHandle),this.timerHandle=void 0;var e=this.callback;this.callback=void 0,e&&e()}},e}();t.ExponentialBackoff=r},function(e,t,n){var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingManagerConsumer=t.RegistrationEnforcer=void 0;var o=n(6),i=function(){function e(e,t,n){this.wrapped=e,this.shouldConnectionDependOnRegistration=t,this.shouldHoldBackEvents=n,this.isRegistered=!1,this.heldBackEvents=[]}return e.prototype.onDownstreamRequest=function(e,t,n){this.passIfRegisteredOrNotNeeded("onDownstreamRequest",e,t,n)},e.prototype.onConnected=function(e){this.passIfRegisteredOrNotNeeded("onConnected",e)},e.prototype.onRegistered=function(e){this.isRegistered=!0,this.wrapped.onRegistered(e),this.fireHeldBackEvents()},e.prototype.onUnregistered=function(e){this.isRegistered=!1,this.wrapped.onUnregistered(e),e.getState()===o.State.Connected&&this.shouldConnectionDependOnRegistration()&&e.forceReconnectDueToNoRegistration()},e.prototype.onReconnecting=function(e){this.wrapped.onReconnecting(e)},e.prototype.onReconnectIsRequired=function(e,t,n){this.wrapped.onReconnectIsRequired(e,t,n)},e.prototype.onDisconnected=function(e){this.isRegistered=!1,this.dropHeldBackEvents(),this.wrapped.onDisconnected(e)},e.prototype.onTerminalError=function(e){this.wrapped.onTerminalError(e)},e.prototype.onConnectionParametersUpdated=function(e){this.wrapped.onConnectionParametersUpdated(e)},e.prototype.onTrouterMessageLost=function(e){this.passIfRegisteredOrNotNeeded("onTrouterMessageLost",e)},e.prototype.onUserActivityStateAccepted=function(e){this.passIfRegisteredOrNotNeeded("onUserActivityStateAccepted",e)},e.prototype.onAudiencesSetResolved=function(e,t){this.passIfRegisteredOrNotNeeded("onAudiencesSetResolved",e,t)},e.prototype.getState=function(){return this.wrapped.getState()},e.prototype.holdBackEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.heldBackEvents.push({kind:e,args:t})},e.prototype.passIfRegisteredOrNotNeeded=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var i=this.shouldConnectionDependOnRegistration(),s=this.shouldHoldBackEvents();i&&s||this.fireHeldBackEvents(i?function(e){return"onConnected"!==e.kind}:void 0),this.isRegistered||!i||!1===s&&"onConnected"!==e?(t=this.wrapped)[e].apply(t,n):this.holdBackEvent.apply(this,r([e],n,!1))},e.prototype.fireHeldBackEvents=function(e){for(var t,n=0,r=this.heldBackEvents;n<r.length;n++){var o=r[n];(void 0===e||e(o))&&(t=this.wrapped)[o.kind].apply(t,o.args)}this.heldBackEvents=void 0===e?[]:this.heldBackEvents.filter((function(t){return!e(t)}))},e.prototype.dropHeldBackEvents=function(){this.heldBackEvents=[]},e}();t.RegistrationEnforcer=i;var s=function(){function e(e,t,n,r){this.wrapped=e,this.prefix=t,this.logger=n,this.onEventAction=r}return e.prototype.onEvent=function(e,t){var n;void 0!==this.onEventAction?this.onEventAction(e,t):(null!==(n=this.logger)&&void 0!==n?n:console).log("".concat(this.prefix," TracingEnforcer: ").concat(e,"(").concat(t,")"))},e.prototype.onDownstreamRequest=function(e,t,n){this.onEvent("onDownstreamRequest",JSON.stringify({request:t,response:n})),this.wrapped.onDownstreamRequest(e,t,n)},e.prototype.onConnected=function(e){this.onEvent("onConnected",e.getState().toString()),this.wrapped.onConnected(e)},e.prototype.onRegistered=function(e){this.onEvent("onRegistered",e.getState().toString()),this.wrapped.onRegistered(e)},e.prototype.onUnregistered=function(e){this.onEvent("onUnregistered",e.getState().toString()),this.wrapped.onUnregistered(e)},e.prototype.onReconnecting=function(e){this.onEvent("onReconnecting",e.getState().toString()),this.wrapped.onReconnecting(e)},e.prototype.onReconnectIsRequired=function(e,t,n){this.onEvent("onReconnectIsRequired",JSON.stringify({connection:e.getState().toString(),useConnectParamsFromCache:t,reason:n})),this.wrapped.onReconnectIsRequired(e,t,n)},e.prototype.onDisconnected=function(e){this.onEvent("onDisconnected",e.getState().toString()),this.wrapped.onDisconnected(e)},e.prototype.onTerminalError=function(e){this.onEvent("onTerminalError",JSON.stringify({connection:e})),this.wrapped.onTerminalError(e)},e.prototype.onConnectionParametersUpdated=function(e){this.onEvent("onConnectionParametersUpdated",JSON.stringify({connectParams:e})),this.wrapped.onConnectionParametersUpdated(e)},e.prototype.onTrouterMessageLost=function(e){this.onEvent("onTrouterMessageLost",JSON.stringify({flowTags:e})),this.wrapped.onTrouterMessageLost(e)},e.prototype.onUserActivityStateAccepted=function(e){this.onEvent("onUserActivityStateAccepted",JSON.stringify({cv:e})),this.wrapped.onUserActivityStateAccepted(e)},e.prototype.onAudiencesSetResolved=function(e,t){this.onEvent("onAudiencesSetResolved",JSON.stringify({audienceSubscriptionsResponse:e,cv:t})),this.wrapped.onAudiencesSetResolved(e,t)},e.prototype.getState=function(){return this.wrapped.getState()},e}();t.LoggingManagerConsumer=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterManagerFsm=void 0;var r=n(2),o=n(4),i=n(0),s=n(7),a=function(){function e(e,t){this.worker=t,this.state=o.TrouterManagerState.Unknown,this.logger=new i.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===o.TrouterManagerState.Unknown?(this.setState(o.TrouterManagerState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):(this.logger.info("start called in state '".concat(o.TrouterManagerState[this.state],"', expediting pending backoffs, if any")),this.worker.expediteBackoffOnConnections())},e.prototype.stop=function(e){this.state!==o.TrouterManagerState.Unknown?(this.setState(o.TrouterManagerState.Unknown),this.worker.stopFirstConnection(!0===e),this.worker.stopSecondConnection(!0===e)):this.showIgnored("stop")},e.prototype.getState=function(){switch(this.state){case o.TrouterManagerState.Unknown:case o.TrouterManagerState.Connected:case o.TrouterManagerState.Disconnected:case o.TrouterManagerState.Switching:return this.state;case o.TrouterManagerState.TerminalError:return r.TrouterState.Disconnected}},e.prototype.getInternalState=function(){return this.state},e.prototype.onConnected=function(e){this.state===o.TrouterManagerState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(o.TrouterManagerState.Switching):(this.setState(o.TrouterManagerState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected(".concat(e,")"))},e.prototype.onRegistered=function(e){this.state!==o.TrouterManagerState.Disconnected||e?this.state!==o.TrouterManagerState.Switching||e?this.state===o.TrouterManagerState.Disconnected&&e&&(this.setState(o.TrouterManagerState.Connected),this.worker.dispatchConnected()):(this.setState(o.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(o.TrouterManagerState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},e.prototype.onUnregistered=function(e){e&&this.worker.dispatchRegistrationState(!1)},e.prototype.onReconnecting=function(e){this.state!==o.TrouterManagerState.Connected&&this.state!==o.TrouterManagerState.Switching||!e?this.showIgnored("onReconnecting(".concat(e,")")):(this.setState(o.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected())},e.prototype.onReconnectionRequired=function(e,t,n){this.state===o.TrouterManagerState.Connected&&e?(this.setState(o.TrouterManagerState.Switching),this.worker.startSecondConnection(t)):this.state===o.TrouterManagerState.Disconnected&&e?this.worker.startSecondConnection(t):this.state===o.TrouterManagerState.Switching&&e&&n===s.ReconnectReason.Configuration?(this.logger.debug("onReconnectionRequired: switch requested while already in Switching state"),this.worker.stopSecondConnection(!0),this.worker.startSecondConnection(t)):this.showIgnored("onReconnectionRequired(".concat(e,")"))},e.prototype.onDisconnected=function(e){this.state==o.TrouterManagerState.Unknown&&e?this.worker.dispatchDisconnected():this.state==o.TrouterManagerState.Switching&&e?(this.worker.switchConnections(),this.worker.stopSecondConnection(!1),this.setState(o.TrouterManagerState.Disconnected),this.worker.dispatchDisconnected()):this.showIgnored("onDisconnected(".concat(e,")"))},e.prototype.onTerminalError=function(){this.setState(o.TrouterManagerState.TerminalError),this.worker.dispatchTerminalError()},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '".concat(e,"' in state '").concat(o.TrouterManagerState[this.state],"'"))},e.prototype.setState=function(e){this.logger.info("Switching from state '".concat(o.TrouterManagerState[this.state],"' to state '").concat(o.TrouterManagerState[e],"'")),this.state!==e?this.state=e:this.logger.error("Attempt to switch to the current state '".concat(o.TrouterManagerState[e],"'"))},e}();t.TrouterManagerFsm=a},function(e,t,n){function r(e,t){if(!t)return e;var n=i(i({},e),{enabled:t.TelemetryEnabled});return void 0!==t.ClientTelemetryEventEnabled&&(n=i(i({},n),t.ClientTelemetryEventEnabled)),n}function o(e,t,n){var o,s,a,c,d,u,l,p,h,f,g=function(n){return e.proxyUrlRewrite?(t.info("Using rewritten URL for proxy"),e.proxyUrlRewrite(n)):n};return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3,rewriteUrlForProxy:g},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:r(e.telemetryConfig.settings,n),eventLogger:e.telemetryConfig.eventLogger,endpointId:e.trouterSettings.registrationId,trouterUrl:(null==n?void 0:n.TrouterConnectionUrl)||e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:null!==(o=e.trouterSettings.registrationId)&&void 0!==o?o:"",pnhAppId:null!==(s=e.trouterSettings.pnhAppId)&&void 0!==s?s:"",platform:null!==(a=e.trouterSettings.platform)&&void 0!==a?a:"",pnhTemplateKey:null!==(c=e.trouterSettings.pnhTemplate)&&void 0!==c?c:"",platformUIVersion:null!==(d=e.trouterSettings.platformUIVersion)&&void 0!==d?d:"",productContext:e.trouterSettings.pnhProductContext||void 0,context:null!==(u=e.trouterSettings.pnhContext)&&void 0!==u?u:"",registrarTtlSec:(null!==(l=e.trouterSettings.maxRegistrationTimeInMs)&&void 0!==l?l:0)/1e3}:void 0,connectionDependsOnRegistration:void 0===e.trouterSettings.registrarServiceUrl?function(){return!1}:null!==(p=e.trouterSettings.connectionDependsOnRegistration)&&void 0!==p?p:function(){return!1},delayEventsUntilRegistered:null!==(h=e.trouterSettings.delayEventsUntilRegistered)&&void 0!==h?h:function(){return!1},timeoutOptions:i({connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:"TeamsCDL"===e.trouterSettings.productName?3e5:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.timeoutOptions),incallTimeoutOptions:i({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:"TeamsCDL"===e.trouterSettings.productName?3e5:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:null!==(f=e.trouterSettings.incallModeTimeoutMs)&&void 0!==f?f:0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:e.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:e.connectionCache,registrationStateCallback:e.registrationStateCallbackForAcsDoNotUse,rewriteUrlForProxy:g,retryLimitOnTokenFetch:e.trouterSettings.retryLimitOnTokenFetch,extraConnectionHeaders:e.trouterSettings.extraConnectionHeaders,expediteBackoffOnStartMinimumDelayMs:1e4,toJSON:function(){return i(i({},this),{connectionCache:this.connectionCache?{}:this.connectionCache})}}}var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,n[0]&&(c=0)),c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.replaceTrouterUrlBase=t.getTrouterServiceVersion=t.createTrouterService=t.TrouterService=t.UserActivityState=t.TrouterState=void 0;var c=n(1),d=n(2);Object.defineProperty(t,"TrouterState",{enumerable:!0,get:function(){return d.TrouterState}}),Object.defineProperty(t,"UserActivityState",{enumerable:!0,get:function(){return d.UserActivityState}});var u=n(0),l=n(8),p=n(9),h=n(10),f=n(11),g=function(){function e(e){this.logProvider=e,this.stateChangedListeners=[],this.logger=new u.Logger("Trouter",e),this.trouterUrlPromise=new f.TrouterUrlPromise(e),this.messageHandlers=new l.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version ".concat(c.CLIENT_VERSION))}return e.prototype.start=function(e){var t;if(this.logger.info("Start"),!e.skypeTokenProvider&&!e.authTokenProvider)throw new Error("no token provider has been configured, either skypeTokenProvider or authTokenProvider must be populated");e.skypeTokenProvider&&!e.trouterSettings.disableInternalSkypeTokenCache&&(e.skypeTokenProvider=(0,p.addCacheAsBackupTo)(e.skypeTokenProvider)),this.trouterCfg=e;var n=o(e,this.logger,this.ecsCfg);!1===e.internalEnableV4cProtocol&&(n.forceV4aProtocol=!0);var r=function(e,t){var n,r=this;return function(o){return s(r,void 0,void 0,(function(){var r,i,s;return a(this,(function(a){switch(a.label){case 0:r=new Date,i=setInterval((function(){var t=Math.round((Date.now()-r.getTime())/6e4);e.warn("Note: Trouter auth token request promise from ".concat(r.toISOString()," has not been resolved for ").concat(t," minutes. The client is blocked from operating properly"))}),3e5),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,t(o)];case 2:return s=a.sent(),o.needFresh&&s.token===n&&e.error("API violation: Trouter auth token provider got a request with needRefresh=true, but returned the same token as last time anyway. Please fix the host app"),n=s.token,[2,s];case 3:return clearInterval(i),[7];case 4:return[2]}}))}))}}(this.logger,null!==(t=e.authTokenProvider)&&void 0!==t?t:function(e){var t=this;return function(n){return s(t,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return t={},[4,e(n.needFresh)];case 1:return[2,(t.token=r.sent(),t.tokenType="skype",t)]}}))}))}}(e.skypeTokenProvider));void 0===this.trouterServer&&(this.trouterServer=new h.TrouterManager(this.logProvider,n,r,void 0===e.authTokenProvider,this)),void 0!==this.pendingActivityState&&(this.trouterServer.setUserActivityState(this.pendingActivityState[0],this.pendingActivityState[1]),this.pendingActivityState=void 0),this.trouterServer.start()},e.prototype.stop=function(e){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop(e)},e.prototype.setEcsConfig=function(e){return s(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,new Promise((function(n){if(t.ecsCfg=e.TrouterJScriptClient,t.logger.info("Setting ECS configuration to ".concat(JSON.stringify(t.ecsCfg))),void 0!==t.trouterServer&&void 0!==t.trouterCfg){var r=o(t.trouterCfg,t.logger,t.ecsCfg);t.trouterServer.configure(r)}n()}))]}))}))},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(null!=e&&e)},e.prototype.resendRegistration=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]}))}))},e.prototype.registerListener=function(e,t){return""===t||!t.startsWith("/")||t.includes("?")||t.includes("#")?(this.logger.error("Listener path '".concat(t,"' is not valid")),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '".concat(t,"'")),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '".concat(t,"' registered")),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n];this.listeners[o]===e&&t.push(o)}if(0===t.length)return!1;for(var i=0,s=t;i<s.length;i++)o=s[i],delete this.listeners[o];return this.logger.debug("Listener for path(s) '".concat(t.join("', '"),"' unregistered")),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n];try{this.listeners[o].onTrouterConnected(t.baseEndpointUrl+o,t)}catch(e){this.logger.error("Listener '".concat(o,"' threw an exception from onTrouterConnected(): ").concat(e))}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(d.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],r=this.listeners[n];if(r.onTrouterDisconnected)try{r.onTrouterDisconnected()}catch(e){this.logger.error("Listener '".concat(n,"' threw an exception from onTrouterDisconnected(): ").concat(e))}}this.notifyStateChanged(d.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",r=0,o=Object.keys(this.listeners);r<o.length;r++){var i=o[r];e.path.startsWith(i)&&i.length>n.length&&(n=i)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '".concat(n,"' threw an exception from onTrouterRequest(): ").concat(e)),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss called with tags [".concat(e,"]"));for(var t=!0,n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n],i=this.listeners[o];if(i.onTrouterMessageLoss)try{void 0===(t=i.onTrouterMessageLoss(e)&&t)&&(this.logger.error("Listener '".concat(o,"' did not return a boolean value from onTrouterMessageLoss()")),t=!1)}catch(e){this.logger.error("Listener '".concat(o,"' threw an exception from onTrouterMessageLoss(): ").concat(e)),t=!1}}return t},e.prototype.onTrouterUserActivityStateAccepted=function(e){this.logger.debug("onTrouterUserActivityStateAccepted cv: ".concat(e));for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],o=this.listeners[r];if(o.onTrouterUserActivityStateAccepted)try{o.onTrouterUserActivityStateAccepted(e)}catch(e){this.logger.error("Listener '".concat(r,"' threw an exception from onTrouterUserActivityStateAccepted(): ").concat(e))}}},e.prototype.onAudiencesSetResolved=function(e,t){this.logger.debug("onAudiencesSetResolved cv: ".concat(t));for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n],i=this.listeners[o];if(i.onAudiencesSetResolved)try{i.onAudiencesSetResolved(e,t)}catch(e){this.logger.error("Listener '".concat(o,"' threw an exception from onAudienceSubscribed(): ").concat(e))}}},e.prototype.setUserActivityState=function(e,t){if(e!==d.UserActivityState.Active&&e!==d.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value ".concat(e));this.logger.info("setUserActivityState called with value ".concat(d.UserActivityState[e])),this.trouterServer&&this.state()!==d.TrouterState.Unknown?this.trouterServer.setUserActivityState(e,t):(this.pendingActivityState=[e,t],this.logger.warn("setUserActivityState called before start() or after stop()"))},e.prototype.setAudienceSubscriptions=function(e,t){if(e.audienceSubscriptions.length>1)throw new Error("Only singular audience subscription is supported");if(this.trouterServer&&this.state()!==d.TrouterState.Unknown)return this.trouterServer.setAudienceSubscriptionsAsync(e,15e3,t);throw new Error("audience subscribe called before start() or after stop()")},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():d.TrouterState.Unknown},e.prototype.isInTerminalState=function(){return void 0!==this.trouterServer&&this.trouterServer.isInTerminalState()},e.prototype.reportStateInfo=function(){return void 0===this.trouterServer?"":this.trouterServer.reportStateInfo()},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter((function(e){return void 0===e.wrappedCallback}));else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter((function(t){return t.wrappedCallback!==e})),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to ".concat(this.stateChangedListeners.length," listeners")),this.stateChangedListeners.forEach((function(r){try{r(e,t)}catch(e){n.logger.error("Error in callback ".concat(e))}}))},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,r=null;try{r=(n=JSON.parse(e.body))&&(n.evt||n.eventId)||null}catch(e){}var o={eventId:r,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},i=this.messageHandlers.handleMessage(o);return!!i.isHandled&&(t.status=i.resultCode,i.responseHeaders&&(t.headers=i.responseHeaders),i.responseBody&&(t.body=i.responseBody),t.send(),!0)},e}();t.TrouterService=g,t.createTrouterService=function(e){return new g(e)},t.getTrouterServiceVersion=function(){return c.CLIENT_VERSION},t.replaceTrouterUrlBase=function(e,t){var n=e.indexOf("://");if(n>=0){var r=e.indexOf("/",n+3);if(r>=0)return t+e.substr(r)}return""}},function(e,t){e.exports=n}]))}));h(m);var v=f((function(e,t){var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PACKAGE_VERSION=t.CONFIG_API_VERSION=t.EudbCountries=t.CloudPrefix=t.CloudType=t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=void 0,t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=3,function(e){e.Public="Public",e.GccHigh="GCC High",e.Dod="DoD"}(n||(t.CloudType=n={})),function(e){e.OrgId="orgid",e.Acs="acs",e.Spool="spool",e.GccHigh="gcch",e.GccHighAcs="gcch-acs",e.Dod="dod",e.DodAcs="dod-acs"}(r||(t.CloudPrefix=r={})),t.EudbCountries=["europe","france","germany","norway","switzerland","sweden"],t.CONFIG_API_VERSION="2024-09-01",t.PACKAGE_VERSION="1.0.0-beta.30"}));h(v),v.PACKAGE_VERSION,v.CONFIG_API_VERSION,v.EudbCountries,v.CloudPrefix,v.CloudType,v.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES;var y=v,S=f((function(e,t){var n=p&&p.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.isEudbLocation=t.parseTokenCredential=t.base64decode=t.toTelemetrySender=t.toLogProvider=t.toMessageHandler=void 0,t.generateUuid=function(){return(0,c.default.v4)()};const r=new Map([["chatMessageReceived",200],["typingIndicatorReceived",245],["readReceiptReceived",246],["chatMessageEdited",247],["chatMessageDeleted",248],["streamingChatMessageStarted",250],["streamingChatMessageChunkReceived",251],["chatThreadCreated",257],["chatThreadPropertiesUpdated",258],["chatThreadDeleted",259],["participantsAdded",260],["participantsRemoved",261]]);function o(e,t,n){let r=f(e.streaming);return{threadId:e.groupId,sender:h(e.senderId),senderDisplayName:e.senderDisplayName,recipient:h(e.recipientMri),id:e.messageId,createdOn:new Date(e.originalArrivalTime),version:e.version,type:e.messageType,message:e.messageBody,metadata:f(e.acsChatMessageMetadata)||{},attachments:m(f(e.attachments)||[],t,n),streamingMetadata:{streamingMessageType:null==r?void 0:r.contentType,streamEndReason:null==r?void 0:r.streamEndReason,streamingSequenceNumber:Number(null==r?void 0:r.sequenceNumber)}}}function i(e,t,n){return Object.assign(Object.assign({},o(e,t,n)),{editedOn:new Date(e.edittime),policyViolation:l(f(e.policyViolation))})}t.toMessageHandler=(e,t,n,o)=>{const i=r.get(e);return{handleMessage(r){let a=null;if((null==r?void 0:r.rawBody)&&(a=JSON.parse(r.rawBody)),null===a||a.eventId!==i)return;const c=s(e,a,n,o);return null!==c?(t(c),{isHandled:!0,resultCode:200}):void 0}}};const s=(e,t,n,r)=>{if("chatMessageReceived"===e)return o(t,n,r);if("streamingChatMessageStarted"==e)return o(t,n,r);if("streamingChatMessageChunkReceived"==e)return i(t,n,r);if("chatMessageEdited"===e)return i(t,n,r);if("chatMessageDeleted"===e){const e=t;return{threadId:e.groupId,sender:h(e.senderId),senderDisplayName:e.senderDisplayName,recipient:h(e.recipientMri),id:e.messageId,createdOn:new Date(e.originalArrivalTime),version:e.version,deletedOn:new Date(e.deletetime),type:e.messageType}}if("typingIndicatorReceived"===e){const e=t;return{threadId:e.groupId,sender:h(e.senderId),senderDisplayName:e.senderDisplayName,recipient:h(e.recipientMri),version:e.version,receivedOn:new Date(e.originalArrivalTime)}}if("readReceiptReceived"===e){const e=t,n=JSON.parse(e.messageBody).consumptionhorizon.split(";");return{threadId:e.groupId,sender:h(e.senderId),senderDisplayName:"",recipient:h(e.recipientMri),chatMessageId:e.messageId,readOn:new Date(+n[1])}}if("chatThreadCreated"===e){const e=t,n=JSON.parse(unescape(e.createdBy)),r=JSON.parse(unescape(e.members)),o=a(n),i=r.map((e=>a(e)));return{threadId:e.threadId,createdOn:new Date(e.createTime),createdBy:o,version:e.version,participants:i,properties:u(JSON.parse(unescape(e.properties)))}}if("chatThreadPropertiesUpdated"===e){const e=t,n=JSON.parse(unescape(e.editedBy)),r=a(n);return{threadId:e.threadId,updatedOn:new Date(e.editTime),updatedBy:r,version:e.version,properties:u(JSON.parse(unescape(e.properties)))}}if("chatThreadDeleted"===e){const e=t,n=a(JSON.parse(unescape(e.deletedBy)));return{threadId:e.threadId,deletedOn:new Date(e.deleteTime),deletedBy:n,version:e.version}}if("participantsAdded"===e){const e=t,n=JSON.parse(unescape(e.addedBy)),r=JSON.parse(unescape(e.participantsAdded)),o=a(n),i=r.map((e=>a(e)));return{threadId:e.threadId,addedOn:new Date(e.time),addedBy:o,version:e.version,participantsAdded:i}}if("participantsRemoved"===e){const e=t,n=JSON.parse(unescape(e.removedBy)),r=JSON.parse(unescape(e.participantsRemoved)),o=a(n),i=r.map((e=>a(e)));return{threadId:e.threadId,removedOn:new Date(e.time),removedBy:o,version:e.version,participantsRemoved:i}}return null},a=e=>{var t;const n={id:h(e.participantId),displayName:e.displayName,metadata:f(null!==(t=e.memberMetaData)&&void 0!==t?t:"")||{}};return e.shareHistoryTime&&(n.shareHistoryTime=new Date(e.shareHistoryTime)),n},u=e=>{var t;return{topic:e.topic,metadata:f(null!==(t=e.acsChatThreadMetadata)&&void 0!==t?t:"")||{}}},l=e=>{if(e&&void 0!==(null==e?void 0:e.result))return{result:e.result}};t.toLogProvider=e=>({log:(...t)=>e.info(t),warn:(...t)=>e.warning(t),error:(...t)=>e.error(t),debug:(...t)=>e.verbose(t),info:(...t)=>e.verbose(t)}),t.toTelemetrySender=e=>({logEvent:t=>e.info(t)});const h=e=>e.startsWith("8:orgid:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(8),isAnonymous:!1,cloud:"public"}:e.startsWith("8:dod:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(6),isAnonymous:!1,cloud:"dod"}:e.startsWith("8:gcch:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(7),isAnonymous:!1,cloud:"gcch"}:e.startsWith("8:teamsvisitor:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(15),isAnonymous:!0}:e.startsWith("4:")?{kind:"phoneNumber",rawId:e,phoneNumber:e.substring(2)}:e.startsWith("8:acs:")||e.startsWith("8:gcch-acs:")||e.startsWith("8:dod-acs:")||e.startsWith("8:spool:")?{kind:"communicationUser",communicationUserId:e}:{kind:"unknown",id:e},f=e=>{if(null!=e&&""!==e&&"null"!==e&&"{}"!==e&&"[]"!==e)return JSON.parse(e)},g=(e,t,n)=>{let r;try{r=new URL(e),"http:"!==r.protocol&&"https:"!==r.protocol||(r=new URL(r.pathname,t))}catch(n){try{r=new URL(e,t)}catch(t){return e}}return r.searchParams.set("api-version",n),r.toString()},m=(e,t,n)=>null!=t&&""!==t&&(e=>{let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol})(t)?(e.filter((e=>e.attachmentType.toLowerCase()==="image".toLowerCase())).map((e=>{e.previewUrl&&(e.previewUrl=g(e.previewUrl,t,n)),e.url&&(e.url=g(e.url,t,n))})),e):e;t.base64decode=e=>d.default.isNodeLike?Buffer.from(e,"base64").toString():atob(e),t.parseTokenCredential=e=>n(void 0,void 0,void 0,(function*(){const n=yield e.getToken(),r=null==n?void 0:n.token,o=(e=>{let[,n]=null==e?void 0:e.split(".");if(void 0===n)throw new Error("Invalid token");return n=n.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape((0,t.base64decode)(n))))})(r),i=o.skypeid;return{jwtToken:r,acsResourceId:o.resourceId,identityMri:i,cloudType:function(e){switch(e.substring(0,e.indexOf(":"))){case y.CloudPrefix.OrgId:case y.CloudPrefix.Acs:case y.CloudPrefix.Spool:return y.CloudType.Public;case y.CloudPrefix.GccHigh:case y.CloudPrefix.GccHighAcs:return y.CloudType.GccHigh;case y.CloudPrefix.Dod:case y.CloudPrefix.DodAcs:return y.CloudType.Dod;default:return y.CloudType.Public}}(i),resourceLocation:o.resourceLocation||""}})),t.isEudbLocation=e=>!!e&&!!y.EudbCountries.find((t=>t===e))}));h(S),S.isEudbLocation,S.parseTokenCredential,S.base64decode,S.toTelemetrySender,S.toLogProvider,S.toMessageHandler,S.generateUuid;var E=f((function(e,t){var n=p&&p.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),r=p&&p.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=p&&p.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return r(t,e),t},i=p&&p.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RealTimeNotificationConfiguration=t.TrouterConfigClient=void 0;const s=o(u.default);class a extends s.ServiceClient{constructor(e,t){t||(t={});const n=`azsdk-js-communication-signaling/${y.PACKAGE_VERSION}`,r=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${n}`:`${n}`;super(Object.assign(Object.assign({},t),{userAgentOptions:{userAgentPrefix:r},additionalPolicies:t.additionalPolicies})),this.apiVersion=y.CONFIG_API_VERSION,this.endpoint=e,this.httpClient=(0,l.default.createDefaultHttpClient)()}fetchServiceUrls(e){return i(this,void 0,void 0,(function*(){try{const t=(yield e.getToken()).token,n=(0,l.default.createPipelineRequest)({url:`${this.endpoint}/chat/config/realTimeNotifications?api-version=${this.apiVersion}`,method:"GET",headers:(0,l.default.createHttpHeaders)({Authorization:`Bearer ${t}`})}),r=yield this.pipeline.sendRequest(this.httpClient,n);if(200!==r.status||!r.bodyAsText)throw new Error(`Failed to fetch service URLs. Status: ${r.status}, Body: ${r.bodyAsText||"No response body"}`);const o=JSON.parse(r.bodyAsText);if(!o.trouterServiceUrl||!o.registrarServiceUrl||!o.cloudType)throw new Error("One or more required fields are missing in the response data");return new c(o.trouterServiceUrl,o.registrarServiceUrl,o.cloudType)}catch(e){throw new Error(`Error fetching real-time notification configuration from Chat Gateway: ${e.message}`)}}))}}t.TrouterConfigClient=a;class c{constructor(e,t,n){this.trouterServiceUrl=e,this.registrarServiceUrl=t,this.cloudType=n}}t.RealTimeNotificationConfiguration=c}));h(E),E.RealTimeNotificationConfiguration,E.TrouterConfigClient;var T=S,C=E,A=f((function(e,t){var n=p&&p.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTelemetrySettings=t.createSettings=void 0;const r={version:"1.0.0",registrationId:"",sessionId:"",pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_Chat_2.0",platform:"SPOOL",platformUIVersion:"0.0.0",environment:"",productName:"acs-chat-web",trouterServiceUrl:"",registrarServiceUrl:"",registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:72e5};t.createSettings=(e,t)=>n(void 0,void 0,void 0,(function*(){var n;const o=null==t?void 0:t.resourceEndpoint;if(void 0===o)throw new Error("'endpoint' cannot be null");const i=Object.assign({},r);i.registrationId=(0,T.generateUuid)(),i.sessionId=(0,T.generateUuid)();const s=new C.TrouterConfigClient(o,t),a=yield s.fetchServiceUrls(e);return i.trouterServiceUrl=`${a.trouterServiceUrl}/v4/a`,i.registrarServiceUrl=`${a.registrarServiceUrl}/v3/registrations`,"int"===a.cloudType&&(i.pnhAppId="cns-e2e-test",i.pnhTemplate="cns-e2e-test:2.0"),i.maxRegistrationTimeInMs=null!==(n=null==t?void 0:t.registrationTimeInMs)&&void 0!==n?n:r.maxRegistrationTimeInMs,i})),t.defaultTelemetrySettings={enabled:!1}}));h(A),A.defaultTelemetrySettings,A.createSettings;var b=A,I=f((function(e,t){var n=p&&p.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CommunicationSignalingClient=void 0,t.CommunicationSignalingClient=class{constructor(e,t,n){this.credential=e,this.logger=t,this.options=n,this.stateChangedListener=null,this.tokenFetchRetries=0,this.trouter=(0,m.createTrouterService)((0,T.toLogProvider)(t))}start(){return n(this,void 0,void 0,(function*(){var e,t;if(this.resourceEndpoint=null===(e=this.options)||void 0===e?void 0:e.resourceEndpoint,void 0===this.resourceEndpoint)throw new Error("'endpoint' cannot be null");this.gatewayApiVersion=(null===(t=this.options)||void 0===t?void 0:t.gatewayApiVersion)||"2024-03-07",void 0===this.config&&(this.config={trouterSettings:yield(0,b.createSettings)(this.credential,this.options),skypeTokenProvider:e=>n(this,void 0,void 0,(function*(){if(e){if(this.tokenFetchRetries+=1,this.tokenFetchRetries>y.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)throw yield this.stop(!0),new Error(`Access token is expired and failed to fetch a valid one after ${y.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES} retries`)}else this.tokenFetchRetries=0;return Promise.resolve((yield this.credential.getToken()).token)})),telemetryConfig:{eventLogger:(0,T.toTelemetrySender)(this.logger),settings:b.defaultTelemetrySettings}}),this.trouter.start(this.config),this.trouter.setUserActivityState(m.UserActivityState.Active)}))}stop(e){return n(this,void 0,void 0,(function*(){this.trouter.offStateChanged(this.stateChangedListener),this.trouter.clearMessageHandlers(),this.trouter.stop(null!=e?e:this.tokenFetchRetries>y.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES)}))}on(e,t){if("connectionChanged"===e)return this.trouter.offStateChanged(this.stateChangedListener),this.stateChangedListener=(e,n)=>t(e),void this.trouter.onStateChanged(this.stateChangedListener);this.trouter.registerMessageHandler((0,T.toMessageHandler)(e,t,this.resourceEndpoint,this.gatewayApiVersion))}}}));h(I),I.CommunicationSignalingClient;var R=I,w=h(f((function(e,t){var n=p&&p.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),r=p&&p.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(R,t)})));e.exports=w},947:(e,t,n)=>{"use strict";n.d(t,{y:()=>c});const r={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function o(e={}){let t=new i(e.parentContext);return e.span&&(t=t.setValue(r.span,e.span)),e.namespace&&(t=t.setValue(r.namespace,e.namespace)),t}class i{constructor(e){this._contextMap=e instanceof i?new Map(e._contextMap):new Map}setValue(e,t){const n=new i(this);return n._contextMap.set(e,t),n}getValue(e){return this._contextMap.get(e)}deleteValue(e){const t=new i(this);return t._contextMap.delete(e),t}}let s;function a(){return s||(s={createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(e,t)=>({span:{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{}},tracingContext:o({parentContext:t.tracingContext})}),withContext:(e,t,...n)=>t(...n)}),s}function c(e){const{namespace:t,packageName:n,packageVersion:o}=e;function i(e,i,s){var c;const d=a().startSpan(e,Object.assign(Object.assign({},s),{packageName:n,packageVersion:o,tracingContext:null===(c=null==i?void 0:i.tracingOptions)||void 0===c?void 0:c.tracingContext}));let u=d.tracingContext;const l=d.span;return u.getValue(r.namespace)||(u=u.setValue(r.namespace,t)),l.setAttribute("az.namespace",u.getValue(r.namespace)),{span:l,updatedOptions:Object.assign({},i,{tracingOptions:Object.assign(Object.assign({},null==i?void 0:i.tracingOptions),{tracingContext:u})})}}function s(e,t,...n){return a().withContext(e,t,...n)}return{startSpan:i,withSpan:async function(e,t,n,r){const{span:o,updatedOptions:a}=i(e,t,r);try{const e=await s(a.tracingOptions.tracingContext,(()=>Promise.resolve(n(a,o))));return o.setStatus({status:"success"}),e}catch(e){throw o.setStatus({status:"error",error:e}),e}finally{o.end()}},withContext:s,parseTraceparentHeader:function(e){return a().parseTraceparentHeader(e)},createRequestHeaders:function(e){return a().createRequestHeaders(e)}}}},3526:(e,t,n)=>{"use strict";n.d(t,{KV:()=>T});const r="undefined"!=typeof process&&process.env&&process.env.DEBUG||void 0;let o,i=[],s=[];const a=[];r&&d(r);const c=Object.assign((e=>l(e)),{enable:d,enabled:u,disable:function(){const e=o||"";return d(""),e},log:function(...e){if(e.length>0){const t=String(e[0]);t.includes(":error")?console.error(...e):t.includes(":warning")?console.warn(...e):t.includes(":info")?console.info(...e):(t.includes(":verbose"),console.debug(...e))}}});function d(e){o=e,i=[],s=[];const t=/\*/g,n=e.split(",").map((e=>e.trim().replace(t,".*?")));for(const e of n)e.startsWith("-")?s.push(new RegExp(`^${e.substr(1)}$`)):i.push(new RegExp(`^${e}$`));for(const e of a)e.enabled=u(e.namespace)}function u(e){if(e.endsWith("*"))return!0;for(const t of s)if(t.test(e))return!1;for(const t of i)if(t.test(e))return!0;return!1}function l(e){const t=Object.assign((function(...n){t.enabled&&(n.length>0&&(n[0]=`${e} ${n[0]}`),t.log(...n))}),{enabled:u(e),destroy:p,log:c.log,namespace:e,extend:h});return a.push(t),t}function p(){const e=a.indexOf(this);return e>=0&&(a.splice(e,1),!0)}function h(e){const t=l(`${this.namespace}:${e}`);return t.log=this.log,t}const f=c,g=new Set,m="undefined"!=typeof process&&process.env&&process.env.AZURE_LOG_LEVEL||void 0;let v;const y=f("azure");y.log=(...e)=>{f.log(...e)};const S=["verbose","info","warning","error"];m&&(I(m)?function(e){if(e&&!I(e))throw new Error(`Unknown log level '${e}'. Acceptable values: ${S.join(",")}`);v=e;const t=[];for(const e of g)b(e)&&t.push(e.namespace);f.enable(t.join(","))}(m):console.error(`AZURE_LOG_LEVEL set to unknown log level '${m}'; logging is not enabled. Acceptable values: ${S.join(", ")}.`));const E={verbose:400,info:300,warning:200,error:100};function T(e){const t=y.extend(e);return C(y,t),{error:A(t,"error"),warning:A(t,"warning"),info:A(t,"info"),verbose:A(t,"verbose")}}function C(e,t){t.log=(...t)=>{e.log(...t)}}function A(e,t){const n=Object.assign(e.extend(t),{level:t});if(C(e,n),b(n)){const e=f.disable();f.enable(e+","+n.namespace)}return g.add(n),n}function b(e){return Boolean(v&&E[e.level]<=E[v])}function I(e){return S.includes(e)}},7007:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}g(e,t,i,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var o,i,s,d;if(a(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=c(e))>0&&s.length>o&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,d=u,console&&console.warn&&console.warn(d)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=u.bind(r);return o.listener=n,r.wrapFn=o,o}function p(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):f(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){r.once&&e.removeEventListener(t,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var d=c.length,u=f(c,d);for(n=0;n<d;++n)r(u[n],this,t)}return!0},i.prototype.addListener=function(e,t){return d(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return d(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,o,i,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},5581:e=>{var t="undefined"!=typeof window?window:self;e.exports=t.crypto||t.msCrypto},7162:(e,t,n)=>{e.exports=function(e){if(!e)return Math.random;var t=Math.pow(2,32),n=new Uint32Array(1);return function(){return e.getRandomValues(n)[0]/t}}(n(5581))},611:(e,t,n)=>{"use strict";var r;n.r(t),n.d(t,{NIL:()=>P,parse:()=>m,stringify:()=>u,v1:()=>g,v3:()=>I,v4:()=>R,v5:()=>_,validate:()=>a,version:()=>D});var o=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));const u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n};var l,p,h=0,f=0;const g=function(e,t,n){var r=t&&n||0,o=t||new Array(16),s=(e=e||{}).node||l,a=void 0!==e.clockseq?e.clockseq:p;if(null==s||null==a){var c=e.random||(e.rng||i)();null==s&&(s=l=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==a&&(a=p=16383&(c[6]<<8|c[7]))}var d=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:f+1,m=d-h+(g-f)/1e4;if(m<0&&void 0===e.clockseq&&(a=a+1&16383),(m<0||d>h)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=d,f=g,p=a;var v=(1e4*(268435455&(d+=122192928e5))+g)%4294967296;o[r++]=v>>>24&255,o[r++]=v>>>16&255,o[r++]=v>>>8&255,o[r++]=255&v;var y=d/4294967296*1e4&268435455;o[r++]=y>>>8&255,o[r++]=255&y,o[r++]=y>>>24&15|16,o[r++]=y>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var S=0;S<6;++S)o[r+S]=s[S];return t||u(o)},m=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function v(e,t,n){function r(e,r,o,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=m(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(r),s.set(e,r.length),(s=n(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,o){i=i||0;for(var a=0;a<16;++a)o[i+a]=s[a];return o}return u(s)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function y(e){return 14+(e+64>>>9<<4)+1}function S(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function E(e,t,n,r,o,i){return S((s=S(S(t,e),S(r,i)))<<(a=o)|s>>>32-a,n);var s,a}function T(e,t,n,r,o,i,s){return E(t&n|~t&r,e,t,o,i,s)}function C(e,t,n,r,o,i,s){return E(t&r|n&~r,e,t,o,i,s)}function A(e,t,n,r,o,i,s){return E(t^n^r,e,t,o,i,s)}function b(e,t,n,r,o,i,s){return E(n^(t|~r),e,t,o,i,s)}const I=v("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",o=0;o<n;o+=8){var i=e[o>>5]>>>o%32&255,s=parseInt(r.charAt(i>>>4&15)+r.charAt(15&i),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[y(t)-1]=t;for(var n=1732584193,r=-271733879,o=-1732584194,i=271733878,s=0;s<e.length;s+=16){var a=n,c=r,d=o,u=i;n=T(n,r,o,i,e[s],7,-680876936),i=T(i,n,r,o,e[s+1],12,-389564586),o=T(o,i,n,r,e[s+2],17,606105819),r=T(r,o,i,n,e[s+3],22,-1044525330),n=T(n,r,o,i,e[s+4],7,-176418897),i=T(i,n,r,o,e[s+5],12,1200080426),o=T(o,i,n,r,e[s+6],17,-1473231341),r=T(r,o,i,n,e[s+7],22,-45705983),n=T(n,r,o,i,e[s+8],7,1770035416),i=T(i,n,r,o,e[s+9],12,-1958414417),o=T(o,i,n,r,e[s+10],17,-42063),r=T(r,o,i,n,e[s+11],22,-1990404162),n=T(n,r,o,i,e[s+12],7,1804603682),i=T(i,n,r,o,e[s+13],12,-40341101),o=T(o,i,n,r,e[s+14],17,-1502002290),n=C(n,r=T(r,o,i,n,e[s+15],22,1236535329),o,i,e[s+1],5,-165796510),i=C(i,n,r,o,e[s+6],9,-1069501632),o=C(o,i,n,r,e[s+11],14,643717713),r=C(r,o,i,n,e[s],20,-373897302),n=C(n,r,o,i,e[s+5],5,-701558691),i=C(i,n,r,o,e[s+10],9,38016083),o=C(o,i,n,r,e[s+15],14,-660478335),r=C(r,o,i,n,e[s+4],20,-405537848),n=C(n,r,o,i,e[s+9],5,568446438),i=C(i,n,r,o,e[s+14],9,-1019803690),o=C(o,i,n,r,e[s+3],14,-187363961),r=C(r,o,i,n,e[s+8],20,1163531501),n=C(n,r,o,i,e[s+13],5,-1444681467),i=C(i,n,r,o,e[s+2],9,-51403784),o=C(o,i,n,r,e[s+7],14,1735328473),n=A(n,r=C(r,o,i,n,e[s+12],20,-1926607734),o,i,e[s+5],4,-378558),i=A(i,n,r,o,e[s+8],11,-2022574463),o=A(o,i,n,r,e[s+11],16,1839030562),r=A(r,o,i,n,e[s+14],23,-35309556),n=A(n,r,o,i,e[s+1],4,-1530992060),i=A(i,n,r,o,e[s+4],11,1272893353),o=A(o,i,n,r,e[s+7],16,-155497632),r=A(r,o,i,n,e[s+10],23,-1094730640),n=A(n,r,o,i,e[s+13],4,681279174),i=A(i,n,r,o,e[s],11,-358537222),o=A(o,i,n,r,e[s+3],16,-722521979),r=A(r,o,i,n,e[s+6],23,76029189),n=A(n,r,o,i,e[s+9],4,-640364487),i=A(i,n,r,o,e[s+12],11,-421815835),o=A(o,i,n,r,e[s+15],16,530742520),n=b(n,r=A(r,o,i,n,e[s+2],23,-995338651),o,i,e[s],6,-198630844),i=b(i,n,r,o,e[s+7],10,1126891415),o=b(o,i,n,r,e[s+14],15,-1416354905),r=b(r,o,i,n,e[s+5],21,-57434055),n=b(n,r,o,i,e[s+12],6,1700485571),i=b(i,n,r,o,e[s+3],10,-1894986606),o=b(o,i,n,r,e[s+10],15,-1051523),r=b(r,o,i,n,e[s+1],21,-2054922799),n=b(n,r,o,i,e[s+8],6,1873313359),i=b(i,n,r,o,e[s+15],10,-30611744),o=b(o,i,n,r,e[s+6],15,-1560198380),r=b(r,o,i,n,e[s+13],21,1309151649),n=b(n,r,o,i,e[s+4],6,-145523070),i=b(i,n,r,o,e[s+11],10,-1120210379),o=b(o,i,n,r,e[s+2],15,718787259),r=b(r,o,i,n,e[s+9],21,-343485551),n=S(n,a),r=S(r,c),o=S(o,d),i=S(i,u)}return[n,r,o,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(y(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))})),R=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return u(r)};function w(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function O(e,t){return e<<t|e>>>32-t}const _=v("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var o=0;o<r.length;++o)e.push(r.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,s=Math.ceil(i/16),a=new Array(s),c=0;c<s;++c){for(var d=new Uint32Array(16),u=0;u<16;++u)d[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];a[c]=d}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var l=0;l<s;++l){for(var p=new Uint32Array(80),h=0;h<16;++h)p[h]=a[l][h];for(var f=16;f<80;++f)p[f]=O(p[f-3]^p[f-8]^p[f-14]^p[f-16],1);for(var g=n[0],m=n[1],v=n[2],y=n[3],S=n[4],E=0;E<80;++E){var T=Math.floor(E/20),C=O(g,5)+w(T,m,v,y)+S+t[T]+p[E]>>>0;S=y,y=v,v=O(m,30)>>>0,m=g,g=C}n[0]=n[0]+g>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+y>>>0,n[4]=n[4]+S>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),P="00000000-0000-0000-0000-000000000000",D=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},7698:(e,t,n)=>{"use strict";n(3792),n(6099),n(3362),n(7764),n(3811),n(4147),n(9150),n(4648),n(7333),n(3064),n(2679),n(9920),n(6967),n(1393),n(4905),n(8159),n(9320),n(6994),n(2953);var r=n(9167);e.exports=r.AsyncIterator},6330:(e,t,n)=>{"use strict";var r=n(1327);e.exports=r},6691:(e,t,n)=>{"use strict";var r=n(884);n(6401),n(1202),n(3275),n(465),e.exports=r},3216:(e,t,n)=>{"use strict";n(9908);var r=n(9167);e.exports=r.Object.is},9281:(e,t,n)=>{"use strict";n(8706),n(6099),n(2675),n(6412),n(9463),n(193),n(2168),n(2259),n(6964),n(3142),n(3237),n(1833),n(7947),n(1073),n(5700),n(8125),n(326),n(4731),n(479),n(5472);var r=n(9167);e.exports=r.Symbol},5245:(e,t,n)=>{"use strict";n(2711)},8435:(e,t,n)=>{"use strict";e.exports=n(3049)},2493:(e,t,n)=>{"use strict";e.exports=n(3068)},2440:(e,t,n)=>{"use strict";n(7414)},2711:(e,t,n)=>{"use strict";var r=n(7698);n(4847),n(5182),e.exports=r},3049:(e,t,n)=>{"use strict";var r=n(6330);e.exports=r},3068:(e,t,n)=>{"use strict";n(2917),n(2793),n(6099),n(7764),n(2953);var r=n(9167);e.exports=r.Observable},7414:(e,t,n)=>{"use strict";var r=n(6691);n(3070),n(3032),n(9604),n(2793),n(7153),n(3803),n(3976),n(8999),n(7208),n(3440),e.exports=r},9306:(e,t,n)=>{"use strict";var r=n(4901),o=n(6823),i=TypeError;e.exports=function(e){if(r(e))return e;throw new i(o(e)+" is not a function")}},5548:(e,t,n)=>{"use strict";var r=n(3517),o=n(6823),i=TypeError;e.exports=function(e){if(r(e))return e;throw new i(o(e)+" is not a constructor")}},3506:(e,t,n)=>{"use strict";var r=n(3925),o=String,i=TypeError;e.exports=function(e){if(r(e))return e;throw new i("Can't set "+o(e)+" as a prototype")}},6469:(e,t,n)=>{"use strict";var r=n(8227),o=n(2360),i=n(4913).f,s=r("unscopables"),a=Array.prototype;void 0===a[s]&&i(a,s,{configurable:!0,value:o(null)}),e.exports=function(e){a[s][e]=!0}},679:(e,t,n)=>{"use strict";var r=n(1625),o=TypeError;e.exports=function(e,t){if(r(t,e))return e;throw new o("Incorrect invocation")}},8551:(e,t,n)=>{"use strict";var r=n(34),o=String,i=TypeError;e.exports=function(e){if(r(e))return e;throw new i(o(e)+" is not an object")}},9617:(e,t,n)=>{"use strict";var r=n(5397),o=n(5610),i=n(6198),s=function(e){return function(t,n,s){var a=r(t),c=i(a);if(0===c)return!e&&-1;var d,u=o(s,c);if(e&&n!=n){for(;c>u;)if((d=a[u++])!=d)return!0}else for(;c>u;u++)if((e||u in a)&&a[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},9213:(e,t,n)=>{"use strict";var r=n(6080),o=n(9504),i=n(7055),s=n(8981),a=n(6198),c=n(1469),d=o([].push),u=function(e){var t=1===e,n=2===e,o=3===e,u=4===e,l=6===e,p=7===e,h=5===e||l;return function(f,g,m,v){for(var y,S,E=s(f),T=i(E),C=a(T),A=r(g,m),b=0,I=v||c,R=t?I(f,C):n||p?I(f,0):void 0;C>b;b++)if((h||b in T)&&(S=A(y=T[b],b,E),e))if(t)R[b]=S;else if(S)switch(e){case 3:return!0;case 5:return y;case 6:return b;case 2:d(R,y)}else switch(e){case 4:return!1;case 7:d(R,y)}return l?-1:o||u?u:R}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterReject:u(7)}},597:(e,t,n)=>{"use strict";var r=n(9039),o=n(8227),i=n(7388),s=o("species");e.exports=function(e){return i>=51||!r((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},7680:(e,t,n)=>{"use strict";var r=n(9504);e.exports=r([].slice)},7433:(e,t,n)=>{"use strict";var r=n(4376),o=n(3517),i=n(34),s=n(8227)("species"),a=Array;e.exports=function(e){var t;return r(e)&&(t=e.constructor,(o(t)&&(t===a||r(t.prototype))||i(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?a:t}},1469:(e,t,n)=>{"use strict";var r=n(7433);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},4074:(e,t,n)=>{"use strict";var r=n(9565),o=n(8551),i=n(2360),s=n(5966),a=n(6279),c=n(1181),d=n(7751),u=n(3982),l=n(2529),p=d("Promise"),h="AsyncFromSyncIterator",f=c.set,g=c.getterFor(h),m=function(e,t,n){var r=e.done;p.resolve(e.value).then((function(e){t(l(e,r))}),n)},v=function(e){e.type=h,f(this,e)};v.prototype=a(i(u),{next:function(){var e=g(this);return new p((function(t,n){var i=o(r(e.next,e.iterator));m(i,t,n)}))},return:function(){var e=g(this).iterator;return new p((function(t,n){var i=s(e,"return");if(void 0===i)return t(l(void 0,!0));var a=o(r(i,e));m(a,t,n)}))}}),e.exports=v},772:(e,t,n)=>{"use strict";var r=n(9565),o=n(7751),i=n(5966);e.exports=function(e,t,n,s){try{var a=i(e,"return");if(a)return o("Promise").resolve(r(a,e)).then((function(){t(n)}),(function(e){s(e)}))}catch(e){return s(e)}t(n)}},2059:(e,t,n)=>{"use strict";var r=n(9565),o=n(1103),i=n(8551),s=n(2360),a=n(6699),c=n(6279),d=n(8227),u=n(1181),l=n(7751),p=n(5966),h=n(3982),f=n(2529),g=n(9539),m=l("Promise"),v=d("toStringTag"),y="AsyncIteratorHelper",S="WrapForValidAsyncIterator",E=u.set,T=function(e){var t=!e,n=u.getterFor(e?S:y),a=function(e){var r=o((function(){return n(e)})),i=r.error,s=r.value;return i||t&&s.done?{exit:!0,value:i?m.reject(s):m.resolve(f(void 0,!0))}:{exit:!1,value:s}};return c(s(h),{next:function(){var e=a(this),t=e.value;if(e.exit)return t;var n=o((function(){return i(t.nextHandler(m))})),r=n.error,s=n.value;return r&&(t.done=!0),r?m.reject(s):m.resolve(s)},return:function(){var t=a(this),n=t.value;if(t.exit)return n;n.done=!0;var s,c,d=n.iterator,u=o((function(){if(n.inner)try{g(n.inner.iterator,"normal")}catch(e){return g(d,"throw",e)}return p(d,"return")}));return s=c=u.value,u.error?m.reject(c):void 0===s?m.resolve(f(void 0,!0)):(c=(u=o((function(){return r(s,d)}))).value,u.error?m.reject(c):e?m.resolve(c):m.resolve(c).then((function(e){return i(e),f(void 0,!0)})))}})},C=T(!0),A=T(!1);a(A,v,"Async Iterator Helper"),e.exports=function(e,t){var n=function(n,r){r?(r.iterator=n.iterator,r.next=n.next):r=n,r.type=t?S:y,r.nextHandler=e,r.counter=0,r.done=!1,E(this,r)};return n.prototype=t?C:A,n}},7481:(e,t,n)=>{"use strict";var r=n(9565),o=n(1750),i=function(e,t){return[t,e]};e.exports=function(){return r(o,this,i)}},6639:(e,t,n)=>{"use strict";var r=n(9565),o=n(9306),i=n(8551),s=n(34),a=n(6837),c=n(7751),d=n(1767),u=n(772),l=function(e){var t=0===e,n=1===e,l=2===e,p=3===e;return function(e,h,f){i(e);var g=void 0!==h;!g&&t||o(h);var m=d(e),v=c("Promise"),y=m.iterator,S=m.next,E=0;return new v((function(e,o){var c=function(e){u(y,o,e,o)},d=function(){try{if(g)try{a(E)}catch(e){c(e)}v.resolve(i(r(S,y))).then((function(r){try{if(i(r).done)t?(f.length=E,e(f)):e(!p&&(l||void 0));else{var a=r.value;try{if(g){var m=h(a,E),S=function(r){if(n)d();else if(l)r?d():u(y,e,!1,o);else if(t)try{f[E++]=r,d()}catch(e){c(e)}else r?u(y,e,p||a,o):d()};s(m)?v.resolve(m).then(S,c):S(m)}else f[E++]=a,d()}catch(e){c(e)}}}catch(e){o(e)}}),o)}catch(e){o(e)}};d()}))}};e.exports={toArray:l(0),forEach:l(1),every:l(2),some:l(3),find:l(4)}},1750:(e,t,n)=>{"use strict";var r=n(9565),o=n(9306),i=n(8551),s=n(34),a=n(1767),c=n(2059),d=n(2529),u=n(772),l=c((function(e){var t=this,n=t.iterator,o=t.mapper;return new e((function(a,c){var l=function(e){t.done=!0,c(e)},p=function(e){u(n,l,e,l)};e.resolve(i(r(t.next,n))).then((function(n){try{if(i(n).done)t.done=!0,a(d(void 0,!0));else{var r=n.value;try{var c=o(r,t.counter++),u=function(e){a(d(e,!1))};s(c)?e.resolve(c).then(u,p):u(c)}catch(e){p(e)}}}catch(e){l(e)}}),l)}))}));e.exports=function(e){return i(this),o(e),new l(a(this),{mapper:e})}},3982:(e,t,n)=>{"use strict";var r,o,i=n(4475),s=n(7629),a=n(4901),c=n(2360),d=n(2787),u=n(6840),l=n(8227),p=n(6395),h="USE_FUNCTION_CONSTRUCTOR",f=l("asyncIterator"),g=i.AsyncIterator,m=s.AsyncIteratorPrototype;if(m)r=m;else if(a(g))r=g.prototype;else if(s[h]||i[h])try{o=d(d(d(Function("return async function*(){}()")()))),d(o)===Object.prototype&&(r=o)}catch(e){}r?p&&(r=c(r)):r={},a(r[f])||u(r,f,(function(){return this})),e.exports=r},4690:(e,t,n)=>{"use strict";var r=n(9565),o=n(2059);e.exports=o((function(){return r(this.next,this.iterator)}),!0)},4428:(e,t,n)=>{"use strict";var r=n(8227)("iterator"),o=!1;try{var i=0,s={next:function(){return{done:!!i++}},return:function(){o=!0}};s[r]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){try{if(!t&&!o)return!1}catch(e){return!1}var n=!1;try{var i={};i[r]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(e){}return n}},4576:(e,t,n)=>{"use strict";var r=n(9504),o=r({}.toString),i=r("".slice);e.exports=function(e){return i(o(e),8,-1)}},6955:(e,t,n)=>{"use strict";var r=n(2140),o=n(4901),i=n(4576),s=n(8227)("toStringTag"),a=Object,c="Arguments"===i(function(){return arguments}());e.exports=r?i:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=a(e),s))?n:c?i(t):"Object"===(r=i(t))&&o(t.callee)?"Arguments":r}},7740:(e,t,n)=>{"use strict";var r=n(9297),o=n(5031),i=n(7347),s=n(4913);e.exports=function(e,t,n){for(var a=o(t),c=s.f,d=i.f,u=0;u<a.length;u++){var l=a[u];r(e,l)||n&&r(n,l)||c(e,l,d(t,l))}}},2211:(e,t,n)=>{"use strict";var r=n(9039);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},2529:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},6699:(e,t,n)=>{"use strict";var r=n(3724),o=n(4913),i=n(6980);e.exports=r?function(e,t,n){return o.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},6980:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4659:(e,t,n)=>{"use strict";var r=n(3724),o=n(4913),i=n(6980);e.exports=function(e,t,n){r?o.f(e,t,i(0,n)):e[t]=n}},2106:(e,t,n)=>{"use strict";var r=n(283),o=n(4913);e.exports=function(e,t,n){return n.get&&r(n.get,t,{getter:!0}),n.set&&r(n.set,t,{setter:!0}),o.f(e,t,n)}},6840:(e,t,n)=>{"use strict";var r=n(4901),o=n(4913),i=n(283),s=n(9433);e.exports=function(e,t,n,a){a||(a={});var c=a.enumerable,d=void 0!==a.name?a.name:t;if(r(n)&&i(n,d,a),a.global)c?e[t]=n:s(t,n);else{try{a.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=n:o.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},6279:(e,t,n)=>{"use strict";var r=n(6840);e.exports=function(e,t,n){for(var o in t)r(e,o,t[o],n);return e}},9433:(e,t,n)=>{"use strict";var r=n(4475),o=Object.defineProperty;e.exports=function(e,t){try{o(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},3724:(e,t,n)=>{"use strict";var r=n(9039);e.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4055:(e,t,n)=>{"use strict";var r=n(4475),o=n(34),i=r.document,s=o(i)&&o(i.createElement);e.exports=function(e){return s?i.createElement(e):{}}},6837:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},7400:e=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},9296:(e,t,n)=>{"use strict";var r=n(4055)("span").classList,o=r&&r.constructor&&r.constructor.prototype;e.exports=o===Object.prototype?void 0:o},7290:(e,t,n)=>{"use strict";var r=n(516),o=n(9088);e.exports=!r&&!o&&"object"==typeof window&&"object"==typeof document},516:e=>{"use strict";e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},28:(e,t,n)=>{"use strict";var r=n(9392);e.exports=/ipad|iphone|ipod/i.test(r)&&"undefined"!=typeof Pebble},8119:(e,t,n)=>{"use strict";var r=n(9392);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},9088:(e,t,n)=>{"use strict";var r=n(4475),o=n(4576);e.exports="process"===o(r.process)},6765:(e,t,n)=>{"use strict";var r=n(9392);e.exports=/web0s(?!.*chrome)/i.test(r)},9392:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7388:(e,t,n)=>{"use strict";var r,o,i=n(4475),s=n(9392),a=i.process,c=i.Deno,d=a&&a.versions||c&&c.version,u=d&&d.v8;u&&(o=(r=u.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!o&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(o=+r[1]),e.exports=o},8727:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6518:(e,t,n)=>{"use strict";var r=n(4475),o=n(7347).f,i=n(6699),s=n(6840),a=n(9433),c=n(7740),d=n(2796);e.exports=function(e,t){var n,u,l,p,h,f=e.target,g=e.global,m=e.stat;if(n=g?r:m?r[f]||a(f,{}):r[f]&&r[f].prototype)for(u in t){if(p=t[u],l=e.dontCallGetSet?(h=o(n,u))&&h.value:n[u],!d(g?u:f+(m?".":"#")+u,e.forced)&&void 0!==l){if(typeof p==typeof l)continue;c(p,l)}(e.sham||l&&l.sham)&&i(p,"sham",!0),s(n,u,p,e)}}},9039:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},8745:(e,t,n)=>{"use strict";var r=n(616),o=Function.prototype,i=o.apply,s=o.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(i):function(){return s.apply(i,arguments)})},6080:(e,t,n)=>{"use strict";var r=n(7476),o=n(9306),i=n(616),s=r(r.bind);e.exports=function(e,t){return o(e),void 0===t?e:i?s(e,t):function(){return e.apply(t,arguments)}}},616:(e,t,n)=>{"use strict";var r=n(9039);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},9565:(e,t,n)=>{"use strict";var r=n(616),o=Function.prototype.call;e.exports=r?o.bind(o):function(){return o.apply(o,arguments)}},350:(e,t,n)=>{"use strict";var r=n(3724),o=n(9297),i=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=o(i,"name"),c=a&&"something"===function(){}.name,d=a&&(!r||r&&s(i,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:d}},6706:(e,t,n)=>{"use strict";var r=n(9504),o=n(9306);e.exports=function(e,t,n){try{return r(o(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}},7476:(e,t,n)=>{"use strict";var r=n(4576),o=n(9504);e.exports=function(e){if("Function"===r(e))return o(e)}},9504:(e,t,n)=>{"use strict";var r=n(616),o=Function.prototype,i=o.call,s=r&&o.bind.bind(i,i);e.exports=r?s:function(e){return function(){return i.apply(e,arguments)}}},133:(e,t,n)=>{"use strict";var r=n(9565),o=n(4901),i=n(8551),s=n(1767),a=n(851),c=n(5966),d=n(8227),u=n(4074),l=d("asyncIterator");e.exports=function(e){var t,n=i(e),d=!0,p=c(n,l);return o(p)||(p=a(n),d=!1),void 0!==p?t=r(p,n):(t=n,d=!0),i(t),s(d?t:new u(s(t)))}},7751:(e,t,n)=>{"use strict";var r=n(4475),o=n(4901);e.exports=function(e,t){return arguments.length<2?(n=r[e],o(n)?n:void 0):r[e]&&r[e][t];var n}},1767:e=>{"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},851:(e,t,n)=>{"use strict";var r=n(6955),o=n(5966),i=n(4117),s=n(6269),a=n(8227)("iterator");e.exports=function(e){if(!i(e))return o(e,a)||o(e,"@@iterator")||s[r(e)]}},81:(e,t,n)=>{"use strict";var r=n(9565),o=n(9306),i=n(8551),s=n(6823),a=n(851),c=TypeError;e.exports=function(e,t){var n=arguments.length<2?a(e):t;if(o(n))return i(r(n,e));throw new c(s(e)+" is not iterable")}},6933:(e,t,n)=>{"use strict";var r=n(9504),o=n(4376),i=n(4901),s=n(4576),a=n(655),c=r([].push);e.exports=function(e){if(i(e))return e;if(o(e)){for(var t=e.length,n=[],r=0;r<t;r++){var d=e[r];"string"==typeof d?c(n,d):"number"!=typeof d&&"Number"!==s(d)&&"String"!==s(d)||c(n,a(d))}var u=n.length,l=!0;return function(e,t){if(l)return l=!1,t;if(o(this))return t;for(var r=0;r<u;r++)if(n[r]===e)return t}}}},5966:(e,t,n)=>{"use strict";var r=n(9306),o=n(4117);e.exports=function(e,t){var n=e[t];return o(n)?void 0:r(n)}},4475:function(e,t,n){"use strict";var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:(e,t,n)=>{"use strict";var r=n(9504),o=n(8981),i=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return i(o(e),t)}},421:e=>{"use strict";e.exports={}},3138:e=>{"use strict";e.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}},397:(e,t,n)=>{"use strict";var r=n(7751);e.exports=r("document","documentElement")},5917:(e,t,n)=>{"use strict";var r=n(3724),o=n(9039),i=n(4055);e.exports=!r&&!o((function(){return 7!==Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},7055:(e,t,n)=>{"use strict";var r=n(9504),o=n(9039),i=n(4576),s=Object,a=r("".split);e.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===i(e)?a(e,""):s(e)}:s},3706:(e,t,n)=>{"use strict";var r=n(9504),o=n(4901),i=n(7629),s=r(Function.toString);o(i.inspectSource)||(i.inspectSource=function(e){return s(e)}),e.exports=i.inspectSource},1181:(e,t,n)=>{"use strict";var r,o,i,s=n(8622),a=n(4475),c=n(34),d=n(6699),u=n(9297),l=n(7629),p=n(6119),h=n(421),f="Object already initialized",g=a.TypeError,m=a.WeakMap;if(s||l.state){var v=l.state||(l.state=new m);v.get=v.get,v.has=v.has,v.set=v.set,r=function(e,t){if(v.has(e))throw new g(f);return t.facade=e,v.set(e,t),t},o=function(e){return v.get(e)||{}},i=function(e){return v.has(e)}}else{var y=p("state");h[y]=!0,r=function(e,t){if(u(e,y))throw new g(f);return t.facade=e,d(e,y,t),t},o=function(e){return u(e,y)?e[y]:{}},i=function(e){return u(e,y)}}e.exports={set:r,get:o,has:i,enforce:function(e){return i(e)?o(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!c(t)||(n=o(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return n}}}},4209:(e,t,n)=>{"use strict";var r=n(8227),o=n(6269),i=r("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||s[i]===e)}},4376:(e,t,n)=>{"use strict";var r=n(4576);e.exports=Array.isArray||function(e){return"Array"===r(e)}},4901:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},3517:(e,t,n)=>{"use strict";var r=n(9504),o=n(9039),i=n(4901),s=n(6955),a=n(7751),c=n(3706),d=function(){},u=a("Reflect","construct"),l=/^\s*(?:class|function)\b/,p=r(l.exec),h=!l.test(d),f=function(e){if(!i(e))return!1;try{return u(d,[],e),!0}catch(e){return!1}},g=function(e){if(!i(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!p(l,c(e))}catch(e){return!0}};g.sham=!0,e.exports=!u||o((function(){var e;return f(f.call)||!f(Object)||!f((function(){e=!0}))||e}))?g:f},2796:(e,t,n)=>{"use strict";var r=n(9039),o=n(4901),i=/#|\.prototype\./,s=function(e,t){var n=c[a(e)];return n===u||n!==d&&(o(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(i,".").toLowerCase()},c=s.data={},d=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},4117:e=>{"use strict";e.exports=function(e){return null==e}},34:(e,t,n)=>{"use strict";var r=n(4901);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},3925:(e,t,n)=>{"use strict";var r=n(34);e.exports=function(e){return r(e)||null===e}},6395:e=>{"use strict";e.exports=!1},757:(e,t,n)=>{"use strict";var r=n(7751),o=n(4901),i=n(1625),s=n(7040),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return o(t)&&i(t.prototype,a(e))}},2652:(e,t,n)=>{"use strict";var r=n(6080),o=n(9565),i=n(8551),s=n(6823),a=n(4209),c=n(6198),d=n(1625),u=n(81),l=n(851),p=n(9539),h=TypeError,f=function(e,t){this.stopped=e,this.result=t},g=f.prototype;e.exports=function(e,t,n){var m,v,y,S,E,T,C,A=n&&n.that,b=!(!n||!n.AS_ENTRIES),I=!(!n||!n.IS_RECORD),R=!(!n||!n.IS_ITERATOR),w=!(!n||!n.INTERRUPTED),O=r(t,A),_=function(e){return m&&p(m,"normal",e),new f(!0,e)},P=function(e){return b?(i(e),w?O(e[0],e[1],_):O(e[0],e[1])):w?O(e,_):O(e)};if(I)m=e.iterator;else if(R)m=e;else{if(!(v=l(e)))throw new h(s(e)+" is not iterable");if(a(v)){for(y=0,S=c(e);S>y;y++)if((E=P(e[y]))&&d(g,E))return E;return new f(!1)}m=u(e,v)}for(T=I?e.next:m.next;!(C=o(T,m)).done;){try{E=P(C.value)}catch(e){p(m,"throw",e)}if("object"==typeof E&&E&&d(g,E))return E}return new f(!1)}},9539:(e,t,n)=>{"use strict";var r=n(9565),o=n(8551),i=n(5966);e.exports=function(e,t,n){var s,a;o(e);try{if(!(s=i(e,"return"))){if("throw"===t)throw n;return n}s=r(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw n;if(a)throw s;return o(s),n}},3994:(e,t,n)=>{"use strict";var r=n(7657).IteratorPrototype,o=n(2360),i=n(6980),s=n(687),a=n(6269),c=function(){return this};e.exports=function(e,t,n,d){var u=t+" Iterator";return e.prototype=o(r,{next:i(+!d,n)}),s(e,u,!1,!0),a[u]=c,e}},1088:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(6395),s=n(350),a=n(4901),c=n(3994),d=n(2787),u=n(2967),l=n(687),p=n(6699),h=n(6840),f=n(8227),g=n(6269),m=n(7657),v=s.PROPER,y=s.CONFIGURABLE,S=m.IteratorPrototype,E=m.BUGGY_SAFARI_ITERATORS,T=f("iterator"),C="keys",A="values",b="entries",I=function(){return this};e.exports=function(e,t,n,s,f,m,R){c(n,t,s);var w,O,_,P=function(e){if(e===f&&U)return U;if(!E&&e&&e in k)return k[e];switch(e){case C:case A:case b:return function(){return new n(this,e)}}return function(){return new n(this)}},D=t+" Iterator",N=!1,k=e.prototype,M=k[T]||k["@@iterator"]||f&&k[f],U=!E&&M||P(f),x="Array"===t&&k.entries||M;if(x&&(w=d(x.call(new e)))!==Object.prototype&&w.next&&(i||d(w)===S||(u?u(w,S):a(w[T])||h(w,T,I)),l(w,D,!0,!0),i&&(g[D]=I)),v&&f===A&&M&&M.name!==A&&(!i&&y?p(k,"name",A):(N=!0,U=function(){return o(M,this)})),f)if(O={values:P(A),keys:m?U:P(C),entries:P(b)},R)for(_ in O)(E||N||!(_ in k))&&h(k,_,O[_]);else r({target:t,proto:!0,forced:E||N},O);return i&&!R||k[T]===U||h(k,T,U,{name:f}),g[t]=U,O}},7657:(e,t,n)=>{"use strict";var r,o,i,s=n(9039),a=n(4901),c=n(34),d=n(2360),u=n(2787),l=n(6840),p=n(8227),h=n(6395),f=p("iterator"),g=!1;[].keys&&("next"in(i=[].keys())?(o=u(u(i)))!==Object.prototype&&(r=o):g=!0),!c(r)||s((function(){var e={};return r[f].call(e)!==e}))?r={}:h&&(r=d(r)),a(r[f])||l(r,f,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:g}},6269:e=>{"use strict";e.exports={}},6198:(e,t,n)=>{"use strict";var r=n(8014);e.exports=function(e){return r(e.length)}},283:(e,t,n)=>{"use strict";var r=n(9504),o=n(9039),i=n(4901),s=n(9297),a=n(3724),c=n(350).CONFIGURABLE,d=n(3706),u=n(1181),l=u.enforce,p=u.get,h=String,f=Object.defineProperty,g=r("".slice),m=r("".replace),v=r([].join),y=a&&!o((function(){return 8!==f((function(){}),"length",{value:8}).length})),S=String(String).split("String"),E=e.exports=function(e,t,n){"Symbol("===g(h(t),0,7)&&(t="["+m(h(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||c&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),y&&n&&s(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=l(e);return s(r,"source")||(r.source=v(S,"string"==typeof t?t:"")),e};Function.prototype.toString=E((function(){return i(this)&&p(this).source||d(this)}),"toString")},741:e=>{"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},1955:(e,t,n)=>{"use strict";var r,o,i,s,a,c=n(4475),d=n(3389),u=n(6080),l=n(9225).set,p=n(8265),h=n(8119),f=n(28),g=n(6765),m=n(9088),v=c.MutationObserver||c.WebKitMutationObserver,y=c.document,S=c.process,E=c.Promise,T=d("queueMicrotask");if(!T){var C=new p,A=function(){var e,t;for(m&&(e=S.domain)&&e.exit();t=C.get();)try{t()}catch(e){throw C.head&&r(),e}e&&e.enter()};h||m||g||!v||!y?!f&&E&&E.resolve?((s=E.resolve(void 0)).constructor=E,a=u(s.then,s),r=function(){a(A)}):m?r=function(){S.nextTick(A)}:(l=u(l,c),r=function(){l(A)}):(o=!0,i=y.createTextNode(""),new v(A).observe(i,{characterData:!0}),r=function(){i.data=o=!o}),T=function(e){C.head||r(),C.add(e)}}e.exports=T},6043:(e,t,n)=>{"use strict";var r=n(9306),o=TypeError,i=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new o("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new i(e)}},4149:e=>{"use strict";var t=RangeError;e.exports=function(e){if(e==e)return e;throw new t("NaN is not allowed")}},2360:(e,t,n)=>{"use strict";var r,o=n(8551),i=n(6801),s=n(8727),a=n(421),c=n(397),d=n(4055),u=n(6119),l="prototype",p="script",h=u("IE_PROTO"),f=function(){},g=function(e){return"<"+p+">"+e+"</"+p+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;v="undefined"!=typeof document?document.domain&&r?m(r):(t=d("iframe"),n="java"+p+":",t.style.display="none",c.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):m(r);for(var o=s.length;o--;)delete v[l][s[o]];return v()};a[h]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f[l]=o(e),n=new f,f[l]=null,n[h]=e):n=v(),void 0===t?n:i.f(n,t)}},6801:(e,t,n)=>{"use strict";var r=n(3724),o=n(8686),i=n(4913),s=n(8551),a=n(5397),c=n(1072);t.f=r&&!o?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),o=c(t),d=o.length,u=0;d>u;)i.f(e,n=o[u++],r[n]);return e}},4913:(e,t,n)=>{"use strict";var r=n(3724),o=n(5917),i=n(8686),s=n(8551),a=n(6969),c=TypeError,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor,l="enumerable",p="configurable",h="writable";t.f=r?i?function(e,t,n){if(s(e),t=a(t),s(n),"function"==typeof e&&"prototype"===t&&"value"in n&&h in n&&!n[h]){var r=u(e,t);r&&r[h]&&(e[t]=n.value,n={configurable:p in n?n[p]:r[p],enumerable:l in n?n[l]:r[l],writable:!1})}return d(e,t,n)}:d:function(e,t,n){if(s(e),t=a(t),s(n),o)try{return d(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new c("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},7347:(e,t,n)=>{"use strict";var r=n(3724),o=n(9565),i=n(8773),s=n(6980),a=n(5397),c=n(6969),d=n(9297),u=n(5917),l=Object.getOwnPropertyDescriptor;t.f=r?l:function(e,t){if(e=a(e),t=c(t),u)try{return l(e,t)}catch(e){}if(d(e,t))return s(!o(i.f,e,t),e[t])}},298:(e,t,n)=>{"use strict";var r=n(4576),o=n(5397),i=n(8480).f,s=n(7680),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"===r(e)?function(e){try{return i(e)}catch(e){return s(a)}}(e):i(o(e))}},8480:(e,t,n)=>{"use strict";var r=n(1828),o=n(8727).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},3717:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},2787:(e,t,n)=>{"use strict";var r=n(9297),o=n(4901),i=n(8981),s=n(6119),a=n(2211),c=s("IE_PROTO"),d=Object,u=d.prototype;e.exports=a?d.getPrototypeOf:function(e){var t=i(e);if(r(t,c))return t[c];var n=t.constructor;return o(n)&&t instanceof n?n.prototype:t instanceof d?u:null}},1625:(e,t,n)=>{"use strict";var r=n(9504);e.exports=r({}.isPrototypeOf)},1828:(e,t,n)=>{"use strict";var r=n(9504),o=n(9297),i=n(5397),s=n(9617).indexOf,a=n(421),c=r([].push);e.exports=function(e,t){var n,r=i(e),d=0,u=[];for(n in r)!o(a,n)&&o(r,n)&&c(u,n);for(;t.length>d;)o(r,n=t[d++])&&(~s(u,n)||c(u,n));return u}},1072:(e,t,n)=>{"use strict";var r=n(1828),o=n(8727);e.exports=Object.keys||function(e){return r(e,o)}},8773:(e,t)=>{"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,o=r&&!n.call({1:2},1);t.f=o?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},2967:(e,t,n)=>{"use strict";var r=n(6706),o=n(34),i=n(7750),s=n(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=r(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return i(n),s(r),o(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0)},3179:(e,t,n)=>{"use strict";var r=n(2140),o=n(6955);e.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},4270:(e,t,n)=>{"use strict";var r=n(9565),o=n(4901),i=n(34),s=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&o(n=e.toString)&&!i(a=r(n,e)))return a;if(o(n=e.valueOf)&&!i(a=r(n,e)))return a;if("string"!==t&&o(n=e.toString)&&!i(a=r(n,e)))return a;throw new s("Can't convert object to primitive value")}},5031:(e,t,n)=>{"use strict";var r=n(7751),o=n(9504),i=n(8480),s=n(3717),a=n(8551),c=o([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=i.f(a(e)),n=s.f;return n?c(t,n(e)):t}},9167:(e,t,n)=>{"use strict";var r=n(4475);e.exports=r},1103:e=>{"use strict";e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},916:(e,t,n)=>{"use strict";var r=n(4475),o=n(550),i=n(4901),s=n(2796),a=n(3706),c=n(8227),d=n(7290),u=n(516),l=n(6395),p=n(7388),h=o&&o.prototype,f=c("species"),g=!1,m=i(r.PromiseRejectionEvent),v=s("Promise",(function(){var e=a(o),t=e!==String(o);if(!t&&66===p)return!0;if(l&&(!h.catch||!h.finally))return!0;if(!p||p<51||!/native code/.test(e)){var n=new o((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[f]=r,!(g=n.then((function(){}))instanceof r))return!0}return!t&&(d||u)&&!m}));e.exports={CONSTRUCTOR:v,REJECTION_EVENT:m,SUBCLASSING:g}},550:(e,t,n)=>{"use strict";var r=n(4475);e.exports=r.Promise},3438:(e,t,n)=>{"use strict";var r=n(8551),o=n(34),i=n(6043);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},537:(e,t,n)=>{"use strict";var r=n(550),o=n(4428),i=n(916).CONSTRUCTOR;e.exports=i||!o((function(e){r.all(e).then(void 0,(function(){}))}))},8265:e=>{"use strict";var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},e.exports=t},7750:(e,t,n)=>{"use strict";var r=n(4117),o=TypeError;e.exports=function(e){if(r(e))throw new o("Can't call method on "+e);return e}},3389:(e,t,n)=>{"use strict";var r=n(4475),o=n(3724),i=Object.getOwnPropertyDescriptor;e.exports=function(e){if(!o)return r[e];var t=i(r,e);return t&&t.value}},3470:e=>{"use strict";e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},7633:(e,t,n)=>{"use strict";var r=n(7751),o=n(2106),i=n(8227),s=n(3724),a=i("species");e.exports=function(e){var t=r(e);s&&t&&!t[a]&&o(t,a,{configurable:!0,get:function(){return this}})}},687:(e,t,n)=>{"use strict";var r=n(4913).f,o=n(9297),i=n(8227)("toStringTag");e.exports=function(e,t,n){e&&!n&&(e=e.prototype),e&&!o(e,i)&&r(e,i,{configurable:!0,value:t})}},6119:(e,t,n)=>{"use strict";var r=n(5745),o=n(3392),i=r("keys");e.exports=function(e){return i[e]||(i[e]=o(e))}},7629:(e,t,n)=>{"use strict";var r=n(6395),o=n(4475),i=n(9433),s="__core-js_shared__",a=e.exports=o[s]||i(s,{});(a.versions||(a.versions=[])).push({version:"3.37.0",mode:r?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:(e,t,n)=>{"use strict";var r=n(7629);e.exports=function(e,t){return r[e]||(r[e]=t||{})}},2293:(e,t,n)=>{"use strict";var r=n(8551),o=n(5548),i=n(4117),s=n(8227)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||i(n=r(a)[s])?t:o(n)}},8183:(e,t,n)=>{"use strict";var r=n(9504),o=n(1291),i=n(655),s=n(7750),a=r("".charAt),c=r("".charCodeAt),d=r("".slice),u=function(e){return function(t,n){var r,u,l=i(s(t)),p=o(n),h=l.length;return p<0||p>=h?e?"":void 0:(r=c(l,p))<55296||r>56319||p+1===h||(u=c(l,p+1))<56320||u>57343?e?a(l,p):r:e?d(l,p,p+2):u-56320+(r-55296<<10)+65536}};e.exports={codeAt:u(!1),charAt:u(!0)}},4495:(e,t,n)=>{"use strict";var r=n(7388),o=n(9039),i=n(4475).String;e.exports=!!Object.getOwnPropertySymbols&&!o((function(){var e=Symbol("symbol detection");return!i(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},8242:(e,t,n)=>{"use strict";var r=n(9565),o=n(7751),i=n(8227),s=n(6840);e.exports=function(){var e=o("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,a=i("toPrimitive");t&&!t[a]&&s(t,a,(function(e){return r(n,this)}),{arity:1})}},2586:(e,t,n)=>{"use strict";var r=n(7751),o=n(9504),i=r("Symbol"),s=i.keyFor,a=o(i.prototype.valueOf);e.exports=i.isRegisteredSymbol||function(e){try{return void 0!==s(a(e))}catch(e){return!1}}},2104:(e,t,n)=>{"use strict";for(var r=n(5745),o=n(7751),i=n(9504),s=n(757),a=n(8227),c=o("Symbol"),d=c.isWellKnownSymbol,u=o("Object","getOwnPropertyNames"),l=i(c.prototype.valueOf),p=r("wks"),h=0,f=u(c),g=f.length;h<g;h++)try{var m=f[h];s(c[m])&&a(m)}catch(e){}e.exports=function(e){if(d&&d(e))return!0;try{for(var t=l(e),n=0,r=u(p),o=r.length;n<o;n++)if(p[r[n]]==t)return!0}catch(e){}return!1}},1296:(e,t,n)=>{"use strict";var r=n(4495);e.exports=r&&!!Symbol.for&&!!Symbol.keyFor},9225:(e,t,n)=>{"use strict";var r,o,i,s,a=n(4475),c=n(8745),d=n(6080),u=n(4901),l=n(9297),p=n(9039),h=n(397),f=n(7680),g=n(4055),m=n(2812),v=n(8119),y=n(9088),S=a.setImmediate,E=a.clearImmediate,T=a.process,C=a.Dispatch,A=a.Function,b=a.MessageChannel,I=a.String,R=0,w={},O="onreadystatechange";p((function(){r=a.location}));var _=function(e){if(l(w,e)){var t=w[e];delete w[e],t()}},P=function(e){return function(){_(e)}},D=function(e){_(e.data)},N=function(e){a.postMessage(I(e),r.protocol+"//"+r.host)};S&&E||(S=function(e){m(arguments.length,1);var t=u(e)?e:A(e),n=f(arguments,1);return w[++R]=function(){c(t,void 0,n)},o(R),R},E=function(e){delete w[e]},y?o=function(e){T.nextTick(P(e))}:C&&C.now?o=function(e){C.now(P(e))}:b&&!v?(s=(i=new b).port2,i.port1.onmessage=D,o=d(s.postMessage,s)):a.addEventListener&&u(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!p(N)?(o=N,a.addEventListener("message",D,!1)):o=O in g("script")?function(e){h.appendChild(g("script"))[O]=function(){h.removeChild(this),_(e)}}:function(e){setTimeout(P(e),0)}),e.exports={set:S,clear:E}},5610:(e,t,n)=>{"use strict";var r=n(1291),o=Math.max,i=Math.min;e.exports=function(e,t){var n=r(e);return n<0?o(n+t,0):i(n,t)}},5397:(e,t,n)=>{"use strict";var r=n(7055),o=n(7750);e.exports=function(e){return r(o(e))}},1291:(e,t,n)=>{"use strict";var r=n(741);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},8014:(e,t,n)=>{"use strict";var r=n(1291),o=Math.min;e.exports=function(e){var t=r(e);return t>0?o(t,9007199254740991):0}},8981:(e,t,n)=>{"use strict";var r=n(7750),o=Object;e.exports=function(e){return o(r(e))}},9590:(e,t,n)=>{"use strict";var r=n(1291),o=RangeError;e.exports=function(e){var t=r(e);if(t<0)throw new o("The argument can't be less than 0");return t}},2777:(e,t,n)=>{"use strict";var r=n(9565),o=n(34),i=n(757),s=n(5966),a=n(4270),c=n(8227),d=TypeError,u=c("toPrimitive");e.exports=function(e,t){if(!o(e)||i(e))return e;var n,c=s(e,u);if(c){if(void 0===t&&(t="default"),n=r(c,e,t),!o(n)||i(n))return n;throw new d("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},6969:(e,t,n)=>{"use strict";var r=n(2777),o=n(757);e.exports=function(e){var t=r(e,"string");return o(t)?t:t+""}},2140:(e,t,n)=>{"use strict";var r={};r[n(8227)("toStringTag")]="z",e.exports="[object z]"===String(r)},655:(e,t,n)=>{"use strict";var r=n(6955),o=String;e.exports=function(e){if("Symbol"===r(e))throw new TypeError("Cannot convert a Symbol value to a string");return o(e)}},6823:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},3392:(e,t,n)=>{"use strict";var r=n(9504),o=0,i=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++o+i,36)}},7040:(e,t,n)=>{"use strict";var r=n(4495);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:(e,t,n)=>{"use strict";var r=n(3724),o=n(9039);e.exports=r&&o((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},2812:e=>{"use strict";var t=TypeError;e.exports=function(e,n){if(e<n)throw new t("Not enough arguments");return e}},8622:(e,t,n)=>{"use strict";var r=n(4475),o=n(4901),i=r.WeakMap;e.exports=o(i)&&/native code/.test(String(i))},511:(e,t,n)=>{"use strict";var r=n(9167),o=n(9297),i=n(1951),s=n(4913).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});o(t,e)||s(t,e,{value:i.f(e)})}},1951:(e,t,n)=>{"use strict";var r=n(8227);t.f=r},8227:(e,t,n)=>{"use strict";var r=n(4475),o=n(5745),i=n(9297),s=n(3392),a=n(4495),c=n(7040),d=r.Symbol,u=o("wks"),l=c?d.for||d:d&&d.withoutSetter||s;e.exports=function(e){return i(u,e)||(u[e]=a&&i(d,e)?d[e]:l("Symbol."+e)),u[e]}},8706:(e,t,n)=>{"use strict";var r=n(6518),o=n(9039),i=n(4376),s=n(34),a=n(8981),c=n(6198),d=n(6837),u=n(4659),l=n(1469),p=n(597),h=n(8227),f=n(7388),g=h("isConcatSpreadable"),m=f>=51||!o((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),v=function(e){if(!s(e))return!1;var t=e[g];return void 0!==t?!!t:i(e)};r({target:"Array",proto:!0,arity:1,forced:!m||!p("concat")},{concat:function(e){var t,n,r,o,i,s=a(this),p=l(s,0),h=0;for(t=-1,r=arguments.length;t<r;t++)if(v(i=-1===t?s:arguments[t]))for(o=c(i),d(h+o),n=0;n<o;n++,h++)n in i&&u(p,h,i[n]);else d(h+1),u(p,h++,i);return p.length=h,p}})},3792:(e,t,n)=>{"use strict";var r=n(5397),o=n(6469),i=n(6269),s=n(1181),a=n(4913).f,c=n(1088),d=n(2529),u=n(6395),l=n(3724),p="Array Iterator",h=s.set,f=s.getterFor(p);e.exports=c(Array,"Array",(function(e,t){h(this,{type:p,target:r(e),index:0,kind:t})}),(function(){var e=f(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,d(void 0,!0);switch(e.kind){case"keys":return d(n,!1);case"values":return d(t[n],!1)}return d([n,t[n]],!1)}),"values");var g=i.Arguments=i.Array;if(o("keys"),o("values"),o("entries"),!u&&l&&"values"!==g.name)try{a(g,"name",{value:"values"})}catch(e){}},3110:(e,t,n)=>{"use strict";var r=n(6518),o=n(7751),i=n(8745),s=n(9565),a=n(9504),c=n(9039),d=n(4901),u=n(757),l=n(7680),p=n(6933),h=n(4495),f=String,g=o("JSON","stringify"),m=a(/./.exec),v=a("".charAt),y=a("".charCodeAt),S=a("".replace),E=a(1..toString),T=/[\uD800-\uDFFF]/g,C=/^[\uD800-\uDBFF]$/,A=/^[\uDC00-\uDFFF]$/,b=!h||c((function(){var e=o("Symbol")("stringify detection");return"[null]"!==g([e])||"{}"!==g({a:e})||"{}"!==g(Object(e))})),I=c((function(){return'"\\udf06\\ud834"'!==g("\udf06\ud834")||'"\\udead"'!==g("\udead")})),R=function(e,t){var n=l(arguments),r=p(t);if(d(r)||void 0!==e&&!u(e))return n[1]=function(e,t){if(d(r)&&(t=s(r,this,f(e),t)),!u(t))return t},i(g,null,n)},w=function(e,t,n){var r=v(n,t-1),o=v(n,t+1);return m(C,e)&&!m(A,o)||m(A,e)&&!m(C,r)?"\\u"+E(y(e,0),16):e};g&&r({target:"JSON",stat:!0,arity:3,forced:b||I},{stringify:function(e,t,n){var r=l(arguments),o=i(b?R:g,null,r);return I&&"string"==typeof o?S(o,T,w):o}})},4731:(e,t,n)=>{"use strict";var r=n(4475);n(687)(r.JSON,"JSON",!0)},479:(e,t,n)=>{"use strict";n(687)(Math,"Math",!0)},9773:(e,t,n)=>{"use strict";var r=n(6518),o=n(4495),i=n(9039),s=n(3717),a=n(8981);r({target:"Object",stat:!0,forced:!o||i((function(){s.f(1)}))},{getOwnPropertySymbols:function(e){var t=s.f;return t?t(a(e)):[]}})},9908:(e,t,n)=>{"use strict";n(6518)({target:"Object",stat:!0},{is:n(3470)})},6099:(e,t,n)=>{"use strict";var r=n(2140),o=n(6840),i=n(3179);r||o(Object.prototype,"toString",i,{unsafe:!0})},6499:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(9306),s=n(6043),a=n(1103),c=n(2652);r({target:"Promise",stat:!0,forced:n(537)},{all:function(e){var t=this,n=s.f(t),r=n.resolve,d=n.reject,u=a((function(){var n=i(t.resolve),s=[],a=0,u=1;c(e,(function(e){var i=a++,c=!1;u++,o(n,t,e).then((function(e){c||(c=!0,s[i]=e,--u||r(s))}),d)})),--u||r(s)}));return u.error&&d(u.value),n.promise}})},2003:(e,t,n)=>{"use strict";var r=n(6518),o=n(6395),i=n(916).CONSTRUCTOR,s=n(550),a=n(7751),c=n(4901),d=n(6840),u=s&&s.prototype;if(r({target:"Promise",proto:!0,forced:i,real:!0},{catch:function(e){return this.then(void 0,e)}}),!o&&c(s)){var l=a("Promise").prototype.catch;u.catch!==l&&d(u,"catch",l,{unsafe:!0})}},436:(e,t,n)=>{"use strict";var r,o,i,s=n(6518),a=n(6395),c=n(9088),d=n(4475),u=n(9565),l=n(6840),p=n(2967),h=n(687),f=n(7633),g=n(9306),m=n(4901),v=n(34),y=n(679),S=n(2293),E=n(9225).set,T=n(1955),C=n(3138),A=n(1103),b=n(8265),I=n(1181),R=n(550),w=n(916),O=n(6043),_="Promise",P=w.CONSTRUCTOR,D=w.REJECTION_EVENT,N=w.SUBCLASSING,k=I.getterFor(_),M=I.set,U=R&&R.prototype,x=R,L=U,j=d.TypeError,q=d.document,F=d.process,G=O.f,B=G,H=!!(q&&q.createEvent&&d.dispatchEvent),z="unhandledrejection",$=function(e){var t;return!(!v(e)||!m(t=e.then))&&t},V=function(e,t){var n,r,o,i=t.value,s=1===t.state,a=s?e.ok:e.fail,c=e.resolve,d=e.reject,l=e.domain;try{a?(s||(2===t.rejection&&X(t),t.rejection=1),!0===a?n=i:(l&&l.enter(),n=a(i),l&&(l.exit(),o=!0)),n===e.promise?d(new j("Promise-chain cycle")):(r=$(n))?u(r,n,c,d):c(n)):d(i)}catch(e){l&&!o&&l.exit(),d(e)}},W=function(e,t){e.notified||(e.notified=!0,T((function(){for(var n,r=e.reactions;n=r.get();)V(n,e);e.notified=!1,t&&!e.rejection&&J(e)})))},K=function(e,t,n){var r,o;H?((r=q.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),d.dispatchEvent(r)):r={promise:t,reason:n},!D&&(o=d["on"+e])?o(r):e===z&&C("Unhandled promise rejection",n)},J=function(e){u(E,d,(function(){var t,n=e.facade,r=e.value;if(Y(e)&&(t=A((function(){c?F.emit("unhandledRejection",r,n):K(z,n,r)})),e.rejection=c||Y(e)?2:1,t.error))throw t.value}))},Y=function(e){return 1!==e.rejection&&!e.parent},X=function(e){u(E,d,(function(){var t=e.facade;c?F.emit("rejectionHandled",t):K("rejectionhandled",t,e.value)}))},Q=function(e,t,n){return function(r){e(t,r,n)}},Z=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,W(e,!0))},ee=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new j("Promise can't be resolved itself");var r=$(t);r?T((function(){var n={done:!1};try{u(r,t,Q(ee,n,e),Q(Z,n,e))}catch(t){Z(n,t,e)}})):(e.value=t,e.state=1,W(e,!1))}catch(t){Z({done:!1},t,e)}}};if(P&&(L=(x=function(e){y(this,L),g(e),u(r,this);var t=k(this);try{e(Q(ee,t),Q(Z,t))}catch(e){Z(t,e)}}).prototype,(r=function(e){M(this,{type:_,done:!1,notified:!1,parent:!1,reactions:new b,rejection:!1,state:0,value:void 0})}).prototype=l(L,"then",(function(e,t){var n=k(this),r=G(S(this,x));return n.parent=!0,r.ok=!m(e)||e,r.fail=m(t)&&t,r.domain=c?F.domain:void 0,0===n.state?n.reactions.add(r):T((function(){V(r,n)})),r.promise})),o=function(){var e=new r,t=k(e);this.promise=e,this.resolve=Q(ee,t),this.reject=Q(Z,t)},O.f=G=function(e){return e===x||void 0===e?new o(e):B(e)},!a&&m(R)&&U!==Object.prototype)){i=U.then,N||l(U,"then",(function(e,t){var n=this;return new x((function(e,t){u(i,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete U.constructor}catch(e){}p&&p(U,L)}s({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:x}),h(x,_,!1,!0),f(_)},3362:(e,t,n)=>{"use strict";n(436),n(6499),n(2003),n(7743),n(1481),n(280)},7743:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(9306),s=n(6043),a=n(1103),c=n(2652);r({target:"Promise",stat:!0,forced:n(537)},{race:function(e){var t=this,n=s.f(t),r=n.reject,d=a((function(){var s=i(t.resolve);c(e,(function(e){o(s,t,e).then(n.resolve,r)}))}));return d.error&&r(d.value),n.promise}})},1481:(e,t,n)=>{"use strict";var r=n(6518),o=n(6043);r({target:"Promise",stat:!0,forced:n(916).CONSTRUCTOR},{reject:function(e){var t=o.f(this);return(0,t.reject)(e),t.promise}})},280:(e,t,n)=>{"use strict";var r=n(6518),o=n(7751),i=n(6395),s=n(550),a=n(916).CONSTRUCTOR,c=n(3438),d=o("Promise"),u=i&&!a;r({target:"Promise",stat:!0,forced:i||a},{resolve:function(e){return c(u&&this===d?s:this,e)}})},5472:(e,t,n)=>{"use strict";var r=n(6518),o=n(4475),i=n(687);r({global:!0},{Reflect:{}}),i(o.Reflect,"Reflect",!0)},7764:(e,t,n)=>{"use strict";var r=n(8183).charAt,o=n(655),i=n(1181),s=n(1088),a=n(2529),c="String Iterator",d=i.set,u=i.getterFor(c);s(String,"String",(function(e){d(this,{type:c,string:o(e),index:0})}),(function(){var e,t=u(this),n=t.string,o=t.index;return o>=n.length?a(void 0,!0):(e=r(n,o),t.index+=e.length,a(e,!1))}))},6412:(e,t,n)=>{"use strict";n(511)("asyncIterator")},6761:(e,t,n)=>{"use strict";var r=n(6518),o=n(4475),i=n(9565),s=n(9504),a=n(6395),c=n(3724),d=n(4495),u=n(9039),l=n(9297),p=n(1625),h=n(8551),f=n(5397),g=n(6969),m=n(655),v=n(6980),y=n(2360),S=n(1072),E=n(8480),T=n(298),C=n(3717),A=n(7347),b=n(4913),I=n(6801),R=n(8773),w=n(6840),O=n(2106),_=n(5745),P=n(6119),D=n(421),N=n(3392),k=n(8227),M=n(1951),U=n(511),x=n(8242),L=n(687),j=n(1181),q=n(9213).forEach,F=P("hidden"),G="Symbol",B="prototype",H=j.set,z=j.getterFor(G),$=Object[B],V=o.Symbol,W=V&&V[B],K=o.RangeError,J=o.TypeError,Y=o.QObject,X=A.f,Q=b.f,Z=T.f,ee=R.f,te=s([].push),ne=_("symbols"),re=_("op-symbols"),oe=_("wks"),ie=!Y||!Y[B]||!Y[B].findChild,se=function(e,t,n){var r=X($,t);r&&delete $[t],Q(e,t,n),r&&e!==$&&Q($,t,r)},ae=c&&u((function(){return 7!==y(Q({},"a",{get:function(){return Q(this,"a",{value:7}).a}})).a}))?se:Q,ce=function(e,t){var n=ne[e]=y(W);return H(n,{type:G,tag:e,description:t}),c||(n.description=t),n},de=function(e,t,n){e===$&&de(re,t,n),h(e);var r=g(t);return h(n),l(ne,r)?(n.enumerable?(l(e,F)&&e[F][r]&&(e[F][r]=!1),n=y(n,{enumerable:v(0,!1)})):(l(e,F)||Q(e,F,v(1,y(null))),e[F][r]=!0),ae(e,r,n)):Q(e,r,n)},ue=function(e,t){h(e);var n=f(t),r=S(n).concat(fe(n));return q(r,(function(t){c&&!i(le,n,t)||de(e,t,n[t])})),e},le=function(e){var t=g(e),n=i(ee,this,t);return!(this===$&&l(ne,t)&&!l(re,t))&&(!(n||!l(this,t)||!l(ne,t)||l(this,F)&&this[F][t])||n)},pe=function(e,t){var n=f(e),r=g(t);if(n!==$||!l(ne,r)||l(re,r)){var o=X(n,r);return!o||!l(ne,r)||l(n,F)&&n[F][r]||(o.enumerable=!0),o}},he=function(e){var t=Z(f(e)),n=[];return q(t,(function(e){l(ne,e)||l(D,e)||te(n,e)})),n},fe=function(e){var t=e===$,n=Z(t?re:f(e)),r=[];return q(n,(function(e){!l(ne,e)||t&&!l($,e)||te(r,ne[e])})),r};d||(w(W=(V=function(){if(p(W,this))throw new J("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?m(arguments[0]):void 0,t=N(e),n=function(e){var r=void 0===this?o:this;r===$&&i(n,re,e),l(r,F)&&l(r[F],t)&&(r[F][t]=!1);var s=v(1,e);try{ae(r,t,s)}catch(e){if(!(e instanceof K))throw e;se(r,t,s)}};return c&&ie&&ae($,t,{configurable:!0,set:n}),ce(t,e)})[B],"toString",(function(){return z(this).tag})),w(V,"withoutSetter",(function(e){return ce(N(e),e)})),R.f=le,b.f=de,I.f=ue,A.f=pe,E.f=T.f=he,C.f=fe,M.f=function(e){return ce(k(e),e)},c&&(O(W,"description",{configurable:!0,get:function(){return z(this).description}}),a||w($,"propertyIsEnumerable",le,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!d,sham:!d},{Symbol:V}),q(S(oe),(function(e){U(e)})),r({target:G,stat:!0,forced:!d},{useSetter:function(){ie=!0},useSimple:function(){ie=!1}}),r({target:"Object",stat:!0,forced:!d,sham:!c},{create:function(e,t){return void 0===t?y(e):ue(y(e),t)},defineProperty:de,defineProperties:ue,getOwnPropertyDescriptor:pe}),r({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:he}),x(),L(V,G),D[F]=!0},9463:(e,t,n)=>{"use strict";var r=n(6518),o=n(3724),i=n(4475),s=n(9504),a=n(9297),c=n(4901),d=n(1625),u=n(655),l=n(2106),p=n(7740),h=i.Symbol,f=h&&h.prototype;if(o&&c(h)&&(!("description"in f)||void 0!==h().description)){var g={},m=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:u(arguments[0]),t=d(f,this)?new h(e):void 0===e?h():h(e);return""===e&&(g[t]=!0),t};p(m,h),m.prototype=f,f.constructor=m;var v="Symbol(description detection)"===String(h("description detection")),y=s(f.valueOf),S=s(f.toString),E=/^Symbol\((.*)\)[^)]+$/,T=s("".replace),C=s("".slice);l(f,"description",{configurable:!0,get:function(){var e=y(this);if(a(g,e))return"";var t=S(e),n=v?C(t,7,-1):T(t,E,"$1");return""===n?void 0:n}}),r({global:!0,constructor:!0,forced:!0},{Symbol:m})}},1510:(e,t,n)=>{"use strict";var r=n(6518),o=n(7751),i=n(9297),s=n(655),a=n(5745),c=n(1296),d=a("string-to-symbol-registry"),u=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=s(e);if(i(d,t))return d[t];var n=o("Symbol")(t);return d[t]=n,u[n]=t,n}})},193:(e,t,n)=>{"use strict";n(511)("hasInstance")},2168:(e,t,n)=>{"use strict";n(511)("isConcatSpreadable")},2259:(e,t,n)=>{"use strict";n(511)("iterator")},2675:(e,t,n)=>{"use strict";n(6761),n(1510),n(7812),n(3110),n(9773)},7812:(e,t,n)=>{"use strict";var r=n(6518),o=n(9297),i=n(757),s=n(6823),a=n(5745),c=n(1296),d=a("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!c},{keyFor:function(e){if(!i(e))throw new TypeError(s(e)+" is not a symbol");if(o(d,e))return d[e]}})},3142:(e,t,n)=>{"use strict";n(511)("matchAll")},6964:(e,t,n)=>{"use strict";n(511)("match")},3237:(e,t,n)=>{"use strict";n(511)("replace")},1833:(e,t,n)=>{"use strict";n(511)("search")},7947:(e,t,n)=>{"use strict";n(511)("species")},1073:(e,t,n)=>{"use strict";n(511)("split")},5700:(e,t,n)=>{"use strict";var r=n(511),o=n(8242);r("toPrimitive"),o()},8125:(e,t,n)=>{"use strict";var r=n(7751),o=n(511),i=n(687);o("toStringTag"),i(r("Symbol"),"Symbol")},326:(e,t,n)=>{"use strict";n(511)("unscopables")},4847:(e,t,n)=>{"use strict";n(6518)({target:"AsyncIterator",name:"indexed",proto:!0,real:!0,forced:!0},{asIndexedPairs:n(7481)})},4147:(e,t,n)=>{"use strict";var r=n(9565),o=n(6840),i=n(7751),s=n(5966),a=n(9297),c=n(8227),d=n(3982),u=c("asyncDispose"),l=i("Promise");a(d,u)||o(d,u,(function(){var e=this;return new l((function(t,n){var o=s(e,"return");o?l.resolve(r(o,e)).then((function(){t(void 0)}),n):t(void 0)}))}))},3811:(e,t,n)=>{"use strict";var r=n(6518),o=n(679),i=n(2787),s=n(6699),a=n(9297),c=n(8227),d=n(3982),u=n(6395),l=c("toStringTag"),p=TypeError,h=function(){if(o(this,d),i(this)===d)throw new p("Abstract class AsyncIterator not directly constructable")};h.prototype=d,a(d,l)||s(d,l,"AsyncIterator"),!u&&a(d,"constructor")&&d.constructor!==Object||s(d,"constructor",h),r({global:!0,constructor:!0,forced:u},{AsyncIterator:h})},9150:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(8551),s=n(1767),a=n(4149),c=n(9590),d=n(2059),u=n(2529),l=n(6395),p=d((function(e){var t=this;return new e((function(n,r){var s=function(e){t.done=!0,r(e)},a=function(){try{e.resolve(i(o(t.next,t.iterator))).then((function(e){try{i(e).done?(t.done=!0,n(u(void 0,!0))):t.remaining?(t.remaining--,a()):n(u(e.value,!1))}catch(e){s(e)}}),s)}catch(e){s(e)}};a()}))}));r({target:"AsyncIterator",proto:!0,real:!0,forced:l},{drop:function(e){i(this);var t=c(a(+e));return new p(s(this),{remaining:t})}})},4648:(e,t,n)=>{"use strict";var r=n(6518),o=n(6639).every;r({target:"AsyncIterator",proto:!0,real:!0},{every:function(e){return o(this,e)}})},7333:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(9306),s=n(8551),a=n(34),c=n(1767),d=n(2059),u=n(2529),l=n(772),p=n(6395),h=d((function(e){var t=this,n=t.iterator,r=t.predicate;return new e((function(i,c){var d=function(e){t.done=!0,c(e)},p=function(e){l(n,d,e,d)},h=function(){try{e.resolve(s(o(t.next,n))).then((function(n){try{if(s(n).done)t.done=!0,i(u(void 0,!0));else{var o=n.value;try{var c=r(o,t.counter++),l=function(e){e?i(u(o,!1)):h()};a(c)?e.resolve(c).then(l,p):l(c)}catch(e){p(e)}}}catch(e){d(e)}}),d)}catch(e){d(e)}};h()}))}));r({target:"AsyncIterator",proto:!0,real:!0,forced:p},{filter:function(e){return s(this),i(e),new h(c(this),{predicate:e})}})},3064:(e,t,n)=>{"use strict";var r=n(6518),o=n(6639).find;r({target:"AsyncIterator",proto:!0,real:!0},{find:function(e){return o(this,e)}})},2679:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(9306),s=n(8551),a=n(34),c=n(1767),d=n(2059),u=n(2529),l=n(133),p=n(772),h=n(6395),f=d((function(e){var t=this,n=t.iterator,r=t.mapper;return new e((function(i,c){var d=function(e){t.done=!0,c(e)},h=function(e){p(n,d,e,d)},f=function(){try{e.resolve(s(o(t.next,n))).then((function(n){try{if(s(n).done)t.done=!0,i(u(void 0,!0));else{var o=n.value;try{var c=r(o,t.counter++),p=function(e){try{t.inner=l(e),g()}catch(e){h(e)}};a(c)?e.resolve(c).then(p,h):p(c)}catch(e){h(e)}}}catch(e){d(e)}}),d)}catch(e){d(e)}},g=function(){var n=t.inner;if(n)try{e.resolve(s(o(n.next,n.iterator))).then((function(e){try{s(e).done?(t.inner=null,f()):i(u(e.value,!1))}catch(e){h(e)}}),h)}catch(e){h(e)}else f()};g()}))}));r({target:"AsyncIterator",proto:!0,real:!0,forced:h},{flatMap:function(e){return s(this),i(e),new f(c(this),{mapper:e,inner:null})}})},9920:(e,t,n)=>{"use strict";var r=n(6518),o=n(6639).forEach;r({target:"AsyncIterator",proto:!0,real:!0},{forEach:function(e){return o(this,e)}})},6967:(e,t,n)=>{"use strict";var r=n(6518),o=n(8981),i=n(1625),s=n(133),a=n(3982),c=n(4690);r({target:"AsyncIterator",stat:!0,forced:n(6395)},{from:function(e){var t=s("string"==typeof e?o(e):e);return i(a,t.iterator)?t.iterator:new c(t)}})},5182:(e,t,n)=>{"use strict";n(6518)({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{indexed:n(7481)})},1393:(e,t,n)=>{"use strict";var r=n(6518),o=n(1750);r({target:"AsyncIterator",proto:!0,real:!0,forced:n(6395)},{map:o})},4905:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(9306),s=n(8551),a=n(34),c=n(7751),d=n(1767),u=n(772),l=c("Promise"),p=TypeError;r({target:"AsyncIterator",proto:!0,real:!0},{reduce:function(e){s(this),i(e);var t=d(this),n=t.iterator,r=t.next,c=arguments.length<2,h=c?void 0:arguments[1],f=0;return new l((function(t,i){var d=function(e){u(n,i,e,i)},g=function(){try{l.resolve(s(o(r,n))).then((function(n){try{if(s(n).done)c?i(new p("Reduce of empty iterator with no initial value")):t(h);else{var r=n.value;if(c)c=!1,h=r,g();else try{var o=e(h,r,f),u=function(e){h=e,g()};a(o)?l.resolve(o).then(u,d):u(o)}catch(e){d(e)}}f++}catch(e){i(e)}}),i)}catch(e){i(e)}};g()}))}})},8159:(e,t,n)=>{"use strict";var r=n(6518),o=n(6639).some;r({target:"AsyncIterator",proto:!0,real:!0},{some:function(e){return o(this,e)}})},9320:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(8551),s=n(1767),a=n(4149),c=n(9590),d=n(2059),u=n(2529),l=n(6395),p=d((function(e){var t,n=this,r=n.iterator;if(!n.remaining--){var s=u(void 0,!0);return n.done=!0,void 0!==(t=r.return)?e.resolve(o(t,r,void 0)).then((function(){return s})):s}return e.resolve(o(n.next,r)).then((function(e){return i(e).done?(n.done=!0,u(void 0,!0)):u(e.value,!1)})).then(null,(function(e){throw n.done=!0,e}))}));r({target:"AsyncIterator",proto:!0,real:!0,forced:l},{take:function(e){i(this);var t=c(a(+e));return new p(s(this),{remaining:t})}})},6994:(e,t,n)=>{"use strict";var r=n(6518),o=n(6639).toArray;r({target:"AsyncIterator",proto:!0,real:!0},{toArray:function(){return o(this,void 0,[])}})},6401:(e,t,n)=>{"use strict";var r=n(8227),o=n(4913).f,i=r("metadata"),s=Function.prototype;void 0===s[i]&&o(s,i,{value:null})},5239:(e,t,n)=>{"use strict";var r=n(6518),o=n(9565),i=n(3724),s=n(7633),a=n(9306),c=n(8551),d=n(679),u=n(4901),l=n(4117),p=n(34),h=n(5966),f=n(6840),g=n(6279),m=n(2106),v=n(3138),y=n(8227),S=n(1181),E=y("observable"),T="Observable",C="Subscription",A="SubscriptionObserver",b=S.getterFor,I=S.set,R=b(T),w=b(C),O=b(A),_=function(e){this.observer=c(e),this.cleanup=void 0,this.subscriptionObserver=void 0};_.prototype={type:C,clean:function(){var e=this.cleanup;if(e){this.cleanup=void 0;try{e()}catch(e){v(e)}}},close:function(){if(!i){var e=this.facade,t=this.subscriptionObserver;e.closed=!0,t&&(t.closed=!0)}this.observer=void 0},isClosed:function(){return void 0===this.observer}};var P=function(e,t){var n,r=I(this,new _(e));i||(this.closed=!1);try{(n=h(e,"start"))&&o(n,e,this)}catch(e){v(e)}if(!r.isClosed()){var s=r.subscriptionObserver=new D(r);try{var c=t(s),d=c;l(c)||(r.cleanup=u(c.unsubscribe)?function(){d.unsubscribe()}:a(c))}catch(e){return void s.error(e)}r.isClosed()&&r.clean()}};P.prototype=g({},{unsubscribe:function(){var e=w(this);e.isClosed()||(e.close(),e.clean())}}),i&&m(P.prototype,"closed",{configurable:!0,get:function(){return w(this).isClosed()}});var D=function(e){I(this,{type:A,subscriptionState:e}),i||(this.closed=!1)};D.prototype=g({},{next:function(e){var t=O(this).subscriptionState;if(!t.isClosed()){var n=t.observer;try{var r=h(n,"next");r&&o(r,n,e)}catch(e){v(e)}}},error:function(e){var t=O(this).subscriptionState;if(!t.isClosed()){var n=t.observer;t.close();try{var r=h(n,"error");r?o(r,n,e):v(e)}catch(e){v(e)}t.clean()}},complete:function(){var e=O(this).subscriptionState;if(!e.isClosed()){var t=e.observer;e.close();try{var n=h(t,"complete");n&&o(n,t)}catch(e){v(e)}e.clean()}}}),i&&m(D.prototype,"closed",{configurable:!0,get:function(){return O(this).subscriptionState.isClosed()}});var N=function(e){d(this,k),I(this,{type:T,subscriber:a(e)})},k=N.prototype;g(k,{subscribe:function(e){var t=arguments.length;return new P(u(e)?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:p(e)?e:{},R(this).subscriber)}}),f(k,E,(function(){return this})),r({global:!0,constructor:!0,forced:!0},{Observable:N}),s(T)},9035:(e,t,n)=>{"use strict";var r=n(6518),o=n(7751),i=n(9565),s=n(8551),a=n(3517),c=n(81),d=n(5966),u=n(2652),l=n(8227)("observable");r({target:"Observable",stat:!0,forced:!0},{from:function(e){var t=a(this)?this:o("Observable"),n=d(s(e),l);if(n){var r=s(i(n,e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}var p=c(e);return new t((function(e){u(p,(function(t,n){if(e.next(t),e.closed)return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}),e.complete()}))}})},2917:(e,t,n)=>{"use strict";n(5239),n(9035),n(8662)},8662:(e,t,n)=>{"use strict";var r=n(6518),o=n(7751),i=n(3517),s=o("Array");r({target:"Observable",stat:!0,forced:!0},{of:function(){for(var e=i(this)?this:o("Observable"),t=arguments.length,n=s(t),r=0;r<t;)n[r]=arguments[r++];return new e((function(e){for(var r=0;r<t;r++)if(e.next(n[r]),e.closed)return;e.complete()}))}})},1202:(e,t,n)=>{"use strict";var r=n(4475),o=n(511),i=n(4913).f,s=n(7347).f,a=r.Symbol;if(o("asyncDispose"),a){var c=s(a,"asyncDispose");c.enumerable&&c.configurable&&c.writable&&i(a,"asyncDispose",{value:c.value,enumerable:!1,configurable:!1,writable:!1})}},9604:(e,t,n)=>{"use strict";n(511)("customMatcher")},3275:(e,t,n)=>{"use strict";var r=n(4475),o=n(511),i=n(4913).f,s=n(7347).f,a=r.Symbol;if(o("dispose"),a){var c=s(a,"dispose");c.enumerable&&c.configurable&&c.writable&&i(a,"dispose",{value:c.value,enumerable:!1,configurable:!1,writable:!1})}},3070:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0},{isRegisteredSymbol:n(2586)})},7153:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:n(2586)})},3032:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:n(2104)})},3803:(e,t,n)=>{"use strict";n(6518)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:n(2104)})},3976:(e,t,n)=>{"use strict";n(511)("matcher")},8999:(e,t,n)=>{"use strict";n(511)("metadataKey")},465:(e,t,n)=>{"use strict";n(511)("metadata")},2793:(e,t,n)=>{"use strict";n(511)("observable")},7208:(e,t,n)=>{"use strict";n(511)("patternMatch")},3440:(e,t,n)=>{"use strict";n(511)("replaceAll")},2953:(e,t,n)=>{"use strict";var r=n(4475),o=n(7400),i=n(9296),s=n(3792),a=n(6699),c=n(687),d=n(8227)("iterator"),u=s.values,l=function(e,t){if(e){if(e[d]!==u)try{a(e,d,u)}catch(t){e[d]=u}if(c(e,t,!0),o[t])for(var n in s)if(e[n]!==s[n])try{a(e,n,s[n])}catch(t){e[n]=s[n]}}};for(var p in o)l(r[p]&&r[p].prototype,p);l(i,"DOMTokenList")},1327:(e,t,n)=>{"use strict";var r=n(3216);e.exports=r},884:(e,t,n)=>{"use strict";var r=n(9281);n(2953),e.exports=r},1219:(e,t,n)=>{"use strict";function r(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function o(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}n.r(t),n.d(t,{MapperTypeNames:()=>E,ServiceClient:()=>q,XML_ATTRKEY:()=>i,XML_CHARKEY:()=>s,authorizeRequestOnClaimChallenge:()=>F,authorizeRequestOnTenantChallenge:()=>B,createClientPipeline:()=>M,createSerializer:()=>l,deserializationPolicy:()=>P,deserializationPolicyName:()=>_,serializationPolicy:()=>k,serializationPolicyName:()=>N});const i="$",s="_",a=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,c=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;function d(e,t){var n,r;const o=e.parsedHeaders;if("HEAD"===e.request.method)return Object.assign(Object.assign({},o),{body:e.parsedBody});const i=t&&t.bodyMapper,s=Boolean(null==i?void 0:i.nullable),a=null==i?void 0:i.type.name;if("Stream"===a)return Object.assign(Object.assign({},o),{blobBody:e.blobBody,readableStreamBody:e.readableStreamBody});const c="Composite"===a&&i.type.modelProperties||{},d=Object.keys(c).some((e=>""===c[e].serializedName));if("Sequence"===a||d){const t=null!==(n=e.parsedBody)&&void 0!==n?n:[];for(const n of Object.keys(c))c[n].serializedName&&(t[n]=null===(r=e.parsedBody)||void 0===r?void 0:r[n]);if(o)for(const e of Object.keys(o))t[e]=o[e];return!s||e.parsedBody||o||0!==Object.getOwnPropertyNames(c).length?t:null}return function(e){const t=Object.assign(Object.assign({},e.headers),e.body);return e.hasNullableType&&0===Object.getOwnPropertyNames(t).length?e.shouldWrapBody?{body:null}:null:e.shouldWrapBody?Object.assign(Object.assign({},e.headers),{body:e.body}):t}({body:e.parsedBody,headers:o,hasNullableType:s,shouldWrapBody:(u=e.parsedBody,l=a,"Composite"!==l&&"Dictionary"!==l&&("string"==typeof u||"number"==typeof u||"boolean"==typeof u||null!==(null==l?void 0:l.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i))||null==u))});var u,l}class u{constructor(e={},t=!1){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const{ExclusiveMaximum:n,ExclusiveMinimum:o,InclusiveMaximum:i,InclusiveMinimum:s,MaxItems:a,MaxLength:c,MinItems:d,MinLength:u,MultipleOf:l,Pattern:p,UniqueItems:h}=e.constraints;if(void 0!==n&&t>=n&&r("ExclusiveMaximum",n),void 0!==o&&t<=o&&r("ExclusiveMinimum",o),void 0!==i&&t>i&&r("InclusiveMaximum",i),void 0!==s&&t<s&&r("InclusiveMinimum",s),void 0!==a&&t.length>a&&r("MaxItems",a),void 0!==c&&t.length>c&&r("MaxLength",c),void 0!==d&&t.length<d&&r("MinItems",d),void 0!==u&&t.length<u&&r("MinLength",u),void 0!==l&&t%l!=0&&r("MultipleOf",l),p){const e="string"==typeof p?new RegExp(p):p;"string"==typeof t&&null!==t.match(e)||r("Pattern",p)}h&&t.some(((e,t,n)=>n.indexOf(e)!==t))&&r("UniqueItems",h)}}serialize(e,t,n,o={xml:{}}){var d,u,l;const m={xml:{rootName:null!==(d=o.xml.rootName)&&void 0!==d?d:"",includeRoot:null!==(u=o.xml.includeRoot)&&void 0!==u&&u,xmlCharKey:null!==(l=o.xml.xmlCharKey)&&void 0!==l?l:s}};let S={};const E=e.type.name;n||(n=e.serializedName),null!==E.match(/^Sequence$/i)&&(S=[]),e.isConstant&&(t=e.defaultValue);const{required:T,nullable:C}=e;if(T&&C&&void 0===t)throw new Error(`${n} cannot be undefined.`);if(T&&!C&&null==t)throw new Error(`${n} cannot be null or undefined.`);if(!T&&!1===C&&null===t)throw new Error(`${n} cannot be null.`);return null==t||null!==E.match(/^any$/i)?S=t:null!==E.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i)?S=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||(r=n,!c.test(r)))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)){const e=typeof n;if(!("string"===e||"function"==typeof n.pipe||"function"==typeof n.tee||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob||"function"===e))throw new Error(`${t} must be a string, Blob, ArrayBuffer, ArrayBufferView, ReadableStream, or () => ReadableStream.`)}var r;return n}(E,n,t):null!==E.match(/^Enum$/i)?S=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some((e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n)))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t):null!==E.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?S=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123 format.`);t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.`);t=function(e){if(e)return"string"==typeof e.valueOf()&&(e=new Date(e)),Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!function(e){return a.test(e)}(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(E,t,n):null!==E.match(/^ByteArray$/i)?S=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=r(t)}return t}(n,t):null!==E.match(/^Base64Url$/i)?S=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=function(e){if(e){if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e){let t=e.length;for(;t-1>=0&&"="===e[t-1];)--t;return e.substr(0,t)}(r(e)).replace(/\+/g,"-").replace(/\//g,"_")}}(t)}return t}(n,t):null!==E.match(/^Sequence$/i)?S=function(e,t,n,r,o,s){var a;if(!Array.isArray(n))throw new Error(`${r} must be of type Array.`);let c=t.type.element;if(!c||"object"!=typeof c)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);"Composite"===c.type.name&&c.type.className&&(c=null!==(a=e.modelMappers[c.type.className])&&void 0!==a?a:c);const d=[];for(let t=0;t<n.length;t++){const a=e.serialize(c,n[t],r,s);if(o&&c.xmlNamespace){const e=c.xmlNamespacePrefix?`xmlns:${c.xmlNamespacePrefix}`:"xmlns";"Composite"===c.type.name?(d[t]=Object.assign({},a),d[t][i]={[e]:c.xmlNamespace}):(d[t]={},d[t][s.xml.xmlCharKey]=a,d[t][i]={[e]:c.xmlNamespace})}else d[t]=a}return d}(this,e,t,n,Boolean(this.isXML),m):null!==E.match(/^Dictionary$/i)?S=function(e,t,n,r,o,s){if("object"!=typeof n)throw new Error(`${r} must be of type object.`);const a=t.type.value;if(!a||"object"!=typeof a)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const c={};for(const t of Object.keys(n)){const i=e.serialize(a,n[t],r,s);c[t]=g(a,i,o,s)}if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns",n=c;return n[i]={[e]:t.xmlNamespace},n}return c}(this,e,t,n,Boolean(this.isXML),m):null!==E.match(/^Composite$/i)&&(S=function(e,t,n,r,o,s){if(y(e,t)&&(t=v(e,t,n,"clientName")),null!=n){const a={},c=f(e,t,r);for(const d of Object.keys(c)){const u=c[d];if(u.readOnly)continue;let l,h=a;if(e.isXML)l=u.xmlIsWrapped?u.xmlName:u.xmlElementName||u.xmlName;else{const e=p(u.serializedName);l=e.pop();for(const t of e){null==h[t]&&(void 0!==n[d]&&null!==n[d]||void 0!==u.defaultValue)&&(h[t]={}),h=h[t]}}if(null!=h){if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns";h[i]=Object.assign(Object.assign({},h[i]),{[e]:t.xmlNamespace})}const a=""!==u.serializedName?r+"."+u.serializedName:r;let c=n[d];const p=y(e,t);p&&p.clientName===d&&null==c&&(c=t.serializedName);const f=e.serialize(u,c,a,s);if(void 0!==f&&null!=l){const e=g(u,f,o,s);o&&u.xmlIsAttribute?(h[i]=h[i]||{},h[i][l]=f):o&&u.xmlIsWrapped?h[l]={[u.xmlElementName]:e}:h[l]=e}}}const d=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=h(e,t,n);return null==r?void 0:r.type.additionalProperties}return r}(e,t,r);if(d){const t=Object.keys(c);for(const o in n)t.every((e=>e!==o))&&(a[o]=e.serialize(d,n[o],r+'["'+o+'"]',s))}return a}return n}(this,e,t,n,Boolean(this.isXML),m)),S}deserialize(e,t,n,r={xml:{}}){var a,c,d,u;const l={xml:{rootName:null!==(a=r.xml.rootName)&&void 0!==a?a:"",includeRoot:null!==(c=r.xml.includeRoot)&&void 0!==c&&c,xmlCharKey:null!==(d=r.xml.xmlCharKey)&&void 0!==d?d:s},ignoreUnknownProperties:null!==(u=r.ignoreUnknownProperties)&&void 0!==u&&u};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let h;const g=e.type.name;if(n||(n=e.serializedName),null!==g.match(/^Composite$/i))h=function(e,t,n,r,o){var a,c;const d=null!==(a=o.xml.xmlCharKey)&&void 0!==a?a:s;y(e,t)&&(t=v(e,t,n,"serializedName"));const u=f(e,t,r);let l={};const h=[];for(const s of Object.keys(u)){const a=u[s],f=p(u[s].serializedName);h.push(f[0]);const{serializedName:g,xmlName:m,xmlElementName:v}=a;let y=r;""!==g&&void 0!==g&&(y=r+"."+g);const S=a.headerCollectionPrefix;if(S){const t={};for(const r of Object.keys(n))r.startsWith(S)&&(t[r.substring(S.length)]=e.deserialize(a.type.value,n[r],y,o)),h.push(r);l[s]=t}else if(e.isXML)if(a.xmlIsAttribute&&n[i])l[s]=e.deserialize(a,n[i][m],y,o);else if(a.xmlIsMsText)void 0!==n[d]?l[s]=n[d]:"string"==typeof n&&(l[s]=n);else{const t=v||m||g;if(a.xmlIsWrapped){const t=n[m],r=null!==(c=null==t?void 0:t[v])&&void 0!==c?c:[];l[s]=e.deserialize(a,r,y,o),h.push(m)}else{const r=n[t];l[s]=e.deserialize(a,r,y,o),h.push(t)}}else{let r,i=n,c=0;for(const e of f){if(!i)break;c++,i=i[e]}null===i&&c<f.length&&(i=void 0),r=i;const d=t.type.polymorphicDiscriminator;let p;if(d&&s===d.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[s])&&""===u[s].serializedName){r=n[s];const t=e.deserialize(a,r,y,o);for(const[e,n]of Object.entries(l))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);l=t}else void 0===r&&void 0===a.defaultValue||(p=e.deserialize(a,r,y,o),l[s]=p)}}const g=t.type.additionalProperties;if(g){const t=e=>{for(const t in u)if(p(u[t].serializedName)[0]===e)return!1;return!0};for(const i in n)t(i)&&(l[i]=e.deserialize(g,n[i],r+'["'+i+'"]',o))}else if(n&&!o.ignoreUnknownProperties)for(const e of Object.keys(n))void 0!==l[e]||h.includes(e)||m(e,o)||(l[e]=n[e]);return l}(this,e,t,n,l);else{if(this.isXML){const e=l.xml.xmlCharKey;void 0!==t[i]&&void 0!==t[e]&&(t=t[e])}null!==g.match(/^Number$/i)?(h=parseFloat(t),isNaN(h)&&(h=t)):null!==g.match(/^Boolean$/i)?h="true"===t||"false"!==t&&t:null!==g.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?h=t:null!==g.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?h=new Date(t):null!==g.match(/^UnixTime$/i)?h=function(e){if(e)return new Date(1e3*e)}(t):null!==g.match(/^ByteArray$/i)?h=o(t):null!==g.match(/^Base64Url$/i)?h=function(e){if(e){if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return o(e=e.replace(/-/g,"+").replace(/_/g,"/"))}}(t):null!==g.match(/^Sequence$/i)?h=function(e,t,n,r,o){var i;let s=t.type.element;if(!s||"object"!=typeof s)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}`);if(n){Array.isArray(n)||(n=[n]),"Composite"===s.type.name&&s.type.className&&(s=null!==(i=e.modelMappers[s.type.className])&&void 0!==i?i:s);const t=[];for(let i=0;i<n.length;i++)t[i]=e.deserialize(s,n[i],`${r}[${i}]`,o);return t}return n}(this,e,t,n,l):null!==g.match(/^Dictionary$/i)&&(h=function(e,t,n,r,o){const i=t.type.value;if(!i||"object"!=typeof i)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}`);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(i,n[s],r,o);return t}return n}(this,e,t,n,l))}return e.isConstant&&(h=e.defaultValue),h}}function l(e={},t=!1){return new u(e,t)}function p(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function h(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function f(e,t,n){let r=t.type.modelProperties;if(!r){const o=h(e,t,n);if(!o)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=null==o?void 0:o.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(o)}" of type "${t.type.className}" for object "${n}".`)}return r}function g(e,t,n,r){if(!n||!e.xmlNamespace)return t;const o=e.xmlNamespacePrefix?`xmlns:${e.xmlNamespacePrefix}`:"xmlns",s={[o]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[i])return t;{const e=Object.assign({},t);return e[i]=s,e}}const a={};return a[r.xml.xmlCharKey]=t,a[i]=s,a}function m(e,t){return[i,t.xml.xmlCharKey].includes(e)}function v(e,t,n,r){var o;const i=y(e,t);if(i){let s=i[r];if(s){"serializedName"===r&&(s=s.replace(/\\/gi,""));const i=n[s],a=null!==(o=t.type.uberParent)&&void 0!==o?o:t.type.className;if("string"==typeof i&&a){const n=function(e,t,n){const r=[n];for(;r.length;){const n=r.shift(),o=t===n?t:n+"."+t;if(Object.prototype.hasOwnProperty.call(e,o))return e[o];for(const[t,o]of Object.entries(e))t.startsWith(n+".")&&o.type.uberParent===n&&o.type.className&&r.push(o.type.className)}}(e.modelMappers.discriminators,i,a);n&&(t=n)}}}return t}function y(e,t){return t.type.polymorphicDiscriminator||S(e,t.type.uberParent)||S(e,t.type.className)}function S(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}const E={Base64Url:"Base64Url",Boolean:"Boolean",ByteArray:"ByteArray",Composite:"Composite",Date:"Date",DateTime:"DateTime",DateTimeRfc1123:"DateTimeRfc1123",Dictionary:"Dictionary",Enum:"Enum",Number:"Number",Object:"Object",Sequence:"Sequence",String:"String",Stream:"Stream",TimeSpan:"TimeSpan",UnixTime:"UnixTime"};var T=n(5923);const C={operationRequestMap:new WeakMap};function A(e,t,n){let r=t.parameterPath;const o=t.mapper;let i;if("string"==typeof r&&(r=[r]),Array.isArray(r)){if(r.length>0)if(o.isConstant)i=o.defaultValue;else{let t=b(e,r);!t.propertyFound&&n&&(t=b(n,r));let s=!1;t.propertyFound||(s=o.required||"options"===r[0]&&2===r.length),i=s?o.defaultValue:t.propertyValue}}else{o.required&&(i={});for(const t in r){const s=o.type.modelProperties[t],a=A(e,{parameterPath:r[t],mapper:s},n);void 0!==a&&(i||(i={}),i[t]=a)}}return i}function b(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(!e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}const I=Symbol.for("@azure/core-client original request");function R(e){if(function(e){return I in e}(e))return R(e[I]);let t=C.operationRequestMap.get(e);return t||(t={},C.operationRequestMap.set(e,t)),t}const w=["application/json","text/json"],O=["application/xml","application/atom+xml"],_="deserializationPolicy";function P(e={}){var t,n,r,o,i,a,c;const d=null!==(n=null===(t=e.expectedContentTypes)||void 0===t?void 0:t.json)&&void 0!==n?n:w,u=null!==(o=null===(r=e.expectedContentTypes)||void 0===r?void 0:r.xml)&&void 0!==o?o:O,l=e.parseXML,p=e.serializerOptions,h={xml:{rootName:null!==(i=null==p?void 0:p.xml.rootName)&&void 0!==i?i:"",includeRoot:null!==(a=null==p?void 0:p.xml.includeRoot)&&void 0!==a&&a,xmlCharKey:null!==(c=null==p?void 0:p.xml.xmlCharKey)&&void 0!==c?c:s}};return{name:_,async sendRequest(e,t){const n=await t(e);return async function(e,t,n,r,o){const i=await async function(e,t,n,r,o){var i;if(!(null===(i=n.request.streamResponseStatusCodes)||void 0===i?void 0:i.has(n.status))&&n.bodyAsText){const i=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map((e=>e.toLowerCase())):[];try{if(0===a.length||a.some((t=>-1!==e.indexOf(t))))return n.parsedBody=JSON.parse(i),n;if(a.some((e=>-1!==t.indexOf(e)))){if(!o)throw new Error("Parsing XML not supported.");const e=await o(i,r.xml);return n.parsedBody=e,n}}catch(e){const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||T.RestError.PARSE_ERROR;throw new T.RestError(t,{code:r,statusCode:n.status,request:n.request,response:n})}}return n}(e,t,n,r,o);if(!function(e){const t=R(e.request),n=null==t?void 0:t.shouldDeserialize;let r;return r=void 0===n||("boolean"==typeof n?n:n(e)),r}(i))return i;const s=R(i.request),a=null==s?void 0:s.operationSpec;if(!a||!a.responses)return i;const c=function(e){let t;const n=R(e.request),r=null==n?void 0:n.operationSpec;return r&&(t=(null==n?void 0:n.operationResponseGetter)?null==n?void 0:n.operationResponseGetter(r,e):r.responses[e.status]),t}(i),{error:d,shouldReturnResponse:u}=function(e,t,n,r){var o;const i=200<=e.status&&e.status<300,s=function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?i:!!n;if(s){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const a=null!=n?n:t.responses.default,c=(null===(o=e.request.streamResponseStatusCodes)||void 0===o?void 0:o.has(e.status))?`Unexpected status code: ${e.status}`:e.bodyAsText,d=new T.RestError(c,{statusCode:e.status,request:e.request,response:e});if(!a)throw d;const u=a.bodyMapper,l=a.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let o;if(u){let e=n;if(t.isXML&&u.type.name===E.Sequence){e=[];const t=u.xmlElementName;"object"==typeof n&&t&&(e=n[t])}o=t.serializer.deserialize(u,e,"error.response.parsedBody",r)}const i=n.error||o||n;d.code=i.code,i.message&&(d.message=i.message),u&&(d.response.parsedBody=o)}e.headers&&l&&(d.response.parsedHeaders=t.serializer.deserialize(l,e.headers.toJSON(),"operationRes.parsedHeaders"))}catch(t){d.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:d,shouldReturnResponse:!1}}(i,a,c,r);if(d)throw d;if(u)return i;if(c){if(c.bodyMapper){let e=i.parsedBody;a.isXML&&c.bodyMapper.type.name===E.Sequence&&(e="object"==typeof e?e[c.bodyMapper.xmlElementName]:[]);try{i.parsedBody=a.serializer.deserialize(c.bodyMapper,e,"operationRes.parsedBody",r)}catch(e){throw new T.RestError(`Error ${e} occurred in deserializing the responseBody - ${i.bodyAsText}`,{statusCode:i.status,request:i.request,response:i})}}else"HEAD"===a.httpMethod&&(i.parsedBody=n.status>=200&&n.status<300);c.headersMapper&&(i.parsedHeaders=a.serializer.deserialize(c.headersMapper,i.headers.toJSON(),"operationRes.parsedHeaders",{xml:{},ignoreUnknownProperties:!0}))}return i}(d,u,n,h,l)}}}function D(e){const{parameterPath:t,mapper:n}=e;let r;return r="string"==typeof t?t:Array.isArray(t)?t.join("."):n.serializedName,r}const N="serializationPolicy";function k(e={}){const t=e.stringifyXML;return{name:N,async sendRequest(e,n){const r=R(e),o=null==r?void 0:r.operationSpec,a=null==r?void 0:r.operationArguments;return o&&a&&(function(e,t,n){var r,o;if(n.headerParameters)for(const r of n.headerParameters){let o=A(t,r);if(null!=o||r.mapper.required){o=n.serializer.serialize(r.mapper,o,D(r));const t=r.mapper.headerCollectionPrefix;if(t)for(const n of Object.keys(o))e.headers.set(t+n,o[n]);else e.headers.set(r.mapper.serializedName||D(r),o)}}const i=null===(o=null===(r=t.options)||void 0===r?void 0:r.requestOptions)||void 0===o?void 0:o.customHeaders;if(i)for(const t of Object.keys(i))e.headers.set(t,i[t])}(e,a,o),function(e,t,n,r=function(){throw new Error("XML serialization unsupported!")}){var o,a,c,d,u;const l=null===(o=t.options)||void 0===o?void 0:o.serializerOptions,p={xml:{rootName:null!==(a=null==l?void 0:l.xml.rootName)&&void 0!==a?a:"",includeRoot:null!==(c=null==l?void 0:l.xml.includeRoot)&&void 0!==c&&c,xmlCharKey:null!==(d=null==l?void 0:l.xml.xmlCharKey)&&void 0!==d?d:s}},h=p.xml.xmlCharKey;if(n.requestBody&&n.requestBody.mapper){e.body=A(t,n.requestBody);const o=n.requestBody.mapper,{required:s,serializedName:a,xmlName:c,xmlElementName:d,xmlNamespace:l,xmlNamespacePrefix:f,nullable:g}=o,m=o.type.name;try{if(void 0!==e.body&&null!==e.body||g&&null===e.body||s){const t=D(n.requestBody);e.body=n.serializer.serialize(o,e.body,t,p);const s=m===E.Stream;if(n.isXML){const t=f?`xmlns:${f}`:"xmlns",n=function(e,t,n,r,o){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[o.xml.xmlCharKey]=r,n[i]={[t]:e},n}return r}(l,t,m,e.body,p);m===E.Sequence?e.body=r(function(e,t,n,r){if(Array.isArray(e)||(e=[e]),!n||!r)return{[t]:e};const o={[t]:e};return o[i]={[n]:r},o}(n,d||c||a,t,l),{rootName:c||a,xmlCharKey:h}):s||(e.body=r(n,{rootName:c||a,xmlCharKey:h}))}else{if(m===E.String&&((null===(u=n.contentType)||void 0===u?void 0:u.match("text/plain"))||"text"===n.mediaType))return;s||(e.body=JSON.stringify(e.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(a,void 0,"  ")}.`)}}else if(n.formDataParameters&&n.formDataParameters.length>0){e.formData={};for(const r of n.formDataParameters){const o=A(t,r);if(null!=o){const t=r.mapper.serializedName||D(r);e.formData[t]=n.serializer.serialize(r.mapper,o,D(r),p)}}}}(e,a,o,t)),n(e)}}}function M(e={}){const t=(0,T.createPipelineFromOptions)(null!=e?e:{});return e.credentialOptions&&t.addPolicy((0,T.bearerTokenAuthenticationPolicy)({credential:e.credentialOptions.credential,scopes:e.credentialOptions.credentialScopes})),t.addPolicy(k(e.serializationOptions),{phase:"Serialize"}),t.addPolicy(P(e.deserializationOptions),{phase:"Deserialize"}),t}let U;const x={CSV:",",SSV:" ",Multi:"Multi",TSV:"\t",Pipes:"|"};function L(e,t){let n=e;for(const[e,r]of t)n=n.split(e).join(r);return n}const j=(0,n(3526).KV)("core-client");class q{constructor(e={}){var t,n;if(this._requestContentType=e.requestContentType,this._endpoint=null!==(t=e.endpoint)&&void 0!==t?t:e.baseUri,e.baseUri&&j.warning("The baseUri option for SDK Clients has been deprecated, please use endpoint instead."),this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||(U||(U=(0,T.createDefaultHttpClient)()),U),this.pipeline=e.pipeline||function(e){const t=function(e){if(e.credentialScopes)return e.credentialScopes;if(e.endpoint)return`${e.endpoint}/.default`;if(e.baseUri)return`${e.baseUri}/.default`;if(e.credential&&!e.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy")}(e),n=e.credential&&t?{credentialScopes:t,credential:e.credential}:void 0;return M(Object.assign(Object.assign({},e),{credentialOptions:n}))}(e),null===(n=e.additionalPolicies)||void 0===n?void 0:n.length)for(const{policy:t,position:n}of e.additionalPolicies){const e="perRetry"===n?"Sign":void 0;this.pipeline.addPolicy(t,{afterPhase:e})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){const n=t.baseUrl||this._endpoint;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.");const r=function(e,t,n,r){const o=function(e,t,n){var r;const o=new Map;if(null===(r=e.urlParameters)||void 0===r?void 0:r.length)for(const r of e.urlParameters){let i=A(t,r,n);const s=D(r);i=e.serializer.serialize(r.mapper,i,s),r.skipEncoding||(i=encodeURIComponent(i)),o.set(`{${r.mapper.serializedName||s}}`,i)}return o}(t,n,r);let i=!1,s=L(e,o);if(t.path){let e=L(t.path,o);"/{nextLink}"===t.path&&e.startsWith("/")&&(e=e.substring(1)),e.includes("://")?(s=e,i=!0):s=function(e,t){if(!t)return e;const n=new URL(e);let r=n.pathname;r.endsWith("/")||(r=`${r}/`),t.startsWith("/")&&(t=t.substring(1));const o=t.indexOf("?");if(-1!==o){const e=t.substring(0,o),i=t.substring(o+1);r+=e,i&&(n.search=n.search?`${n.search}&${i}`:i)}else r+=t;return n.pathname=r,n.toString()}(s,e)}const{queryParams:a,sequenceParams:c}=function(e,t,n){var r;const o=new Map,i=new Set;if(null===(r=e.queryParameters)||void 0===r?void 0:r.length)for(const r of e.queryParameters){"Sequence"===r.mapper.type.name&&r.mapper.serializedName&&i.add(r.mapper.serializedName);let s=A(t,r,n);if(null!=s||r.mapper.required){s=e.serializer.serialize(r.mapper,s,D(r));const t=r.collectionFormat?x[r.collectionFormat]:"";if(Array.isArray(s)&&(s=s.map((e=>null==e?"":e))),"Multi"===r.collectionFormat&&0===s.length)continue;!Array.isArray(s)||"SSV"!==r.collectionFormat&&"TSV"!==r.collectionFormat||(s=s.join(t)),r.skipEncoding||(s=Array.isArray(s)?s.map((e=>encodeURIComponent(e))):encodeURIComponent(s)),!Array.isArray(s)||"CSV"!==r.collectionFormat&&"Pipes"!==r.collectionFormat||(s=s.join(t)),o.set(r.mapper.serializedName||D(r),s)}}return{queryParams:o,sequenceParams:i}}(t,n,r);return s=function(e,t,n,r=!1){if(0===t.size)return e;const o=new URL(e),i=function(e){const t=new Map;if(!e||"?"!==e[0])return t;const n=(e=e.slice(1)).split("&");for(const e of n){const[n,r]=e.split("=",2),o=t.get(n);o?Array.isArray(o)?o.push(r):t.set(n,[o,r]):t.set(n,r)}return t}(o.search);for(const[e,o]of t){const t=i.get(e);if(Array.isArray(t))if(Array.isArray(o)){t.push(...o);const n=new Set(t);i.set(e,Array.from(n))}else t.push(o);else t?(Array.isArray(o)?o.unshift(t):n.has(e)&&i.set(e,[t,o]),r||i.set(e,o)):i.set(e,o)}const s=[];for(const[e,t]of i)if("string"==typeof t)s.push(`${e}=${t}`);else if(Array.isArray(t))for(const n of t)s.push(`${e}=${n}`);else s.push(`${e}=${t}`);return o.search=s.length?`?${s.join("&")}`:"",o.toString()}(s,a,c,i),s}(n,t,e,this),o=(0,T.createPipelineRequest)({url:r});o.method=t.httpMethod;const i=R(o);i.operationSpec=t,i.operationArguments=e;const s=t.contentType||this._requestContentType;s&&t.requestBody&&o.headers.set("Content-Type",s);const a=e.options;if(a){const e=a.requestOptions;e&&(e.timeout&&(o.timeout=e.timeout),e.onUploadProgress&&(o.onUploadProgress=e.onUploadProgress),e.onDownloadProgress&&(o.onDownloadProgress=e.onDownloadProgress),void 0!==e.shouldDeserialize&&(i.shouldDeserialize=e.shouldDeserialize),e.allowInsecureConnection&&(o.allowInsecureConnection=!0)),a.abortSignal&&(o.abortSignal=a.abortSignal),a.tracingOptions&&(o.tracingOptions=a.tracingOptions)}this._allowInsecureConnection&&(o.allowInsecureConnection=!0),void 0===o.streamResponseStatusCodes&&(o.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===E.Stream&&t.add(Number(n))}return t}(t));try{const e=await this.sendRequest(o),n=d(e,t.responses[e.status]);return(null==a?void 0:a.onResponse)&&a.onResponse(e,n),n}catch(e){if("object"==typeof e&&(null==e?void 0:e.response)){const n=e.response,r=d(n,t.responses[e.statusCode]||t.responses.default);e.details=r,(null==a?void 0:a.onResponse)&&a.onResponse(n,r,e)}throw e}}}async function F(e){const{scopes:t,response:n}=e,r=e.logger||j,o=n.headers.get("WWW-Authenticate");if(!o)return r.info("The WWW-Authenticate header was missing. Failed to perform the Continuous Access Evaluation authentication flow."),!1;const i=function(e){return`, ${e.trim()}`.split(", Bearer ").filter((e=>e)).map((e=>`${e.trim()}, `.split('", ').filter((e=>e)).map((e=>(([e,t])=>({[e]:t}))(e.trim().split('="')))).reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{})))}(o)||[],s=i.find((e=>e.claims));if(!s)return r.info('The WWW-Authenticate header was missing the necessary "claims" to perform the Continuous Access Evaluation authentication flow.'),!1;const a=await e.getAccessToken(s.scope?[s.scope]:t,{claims:(c=s.claims,atob(c))});var c;return!!a&&(e.request.headers.set("Authorization",`Bearer ${a.token}`),!0)}const G="authorization",B=async e=>{const t={abortSignal:(n=e.request).abortSignal,requestOptions:{timeout:n.timeout},tracingOptions:n.tracingOptions};var n;const r=function(e){const t=e.headers.get("WWW-Authenticate");if(401===e.status&&t)return t}(e.response);if(r){const n=function(e){return`${e.slice(7).trim()} `.split(" ").filter((e=>e)).map((e=>(([e,t])=>({[e]:t}))(e.trim().split("=")))).reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{})}(r),o=function(e,t){if(!t.resource_id)return e.scopes;const n=new URL(t.resource_id);n.pathname="/.default";let r=n.toString();return"https://disk.azure.com/.default"===r&&(r="https://disk.azure.com//.default"),[r]}(e,n),i=function(e){const t=new URL(e.authorization_uri).pathname.split("/")[1];if(t&&/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(t))return t}(n);if(!i)return!1;const s=await e.getAccessToken(o,Object.assign(Object.assign({},t),{tenantId:i}));return!!s&&(e.request.headers.set(G,`Bearer ${s.token}`),!0)}return!1}},5923:(e,t,n)=>{"use strict";n.r(t),n.d(t,{RestError:()=>Se,auxiliaryAuthenticationHeaderPolicy:()=>Ye,auxiliaryAuthenticationHeaderPolicyName:()=>We,bearerTokenAuthenticationPolicy:()=>He,bearerTokenAuthenticationPolicyName:()=>je,createDefaultHttpClient:()=>we,createEmptyPipeline:()=>i,createFile:()=>D,createFileFromStream:()=>P,createHttpHeaders:()=>ie,createPipelineFromOptions:()=>be,createPipelineRequest:()=>_e,decompressResponsePolicy:()=>F,decompressResponsePolicyName:()=>q,defaultRetryPolicy:()=>ne,exponentialRetryPolicy:()=>De,exponentialRetryPolicyName:()=>Pe,formDataPolicy:()=>ae,formDataPolicyName:()=>se,getDefaultProxySettings:()=>ue,isRestError:()=>Ee,logPolicy:()=>f,logPolicyName:()=>h,multipartPolicy:()=>j,multipartPolicyName:()=>U,ndJsonPolicy:()=>Ve,ndJsonPolicyName:()=>$e,proxyPolicy:()=>le,proxyPolicyName:()=>ce,redirectPolicy:()=>v,redirectPolicyName:()=>g,retryPolicy:()=>ee,setClientRequestIdPolicy:()=>he,setClientRequestIdPolicyName:()=>pe,systemErrorRetryPolicy:()=>ke,systemErrorRetryPolicyName:()=>Ne,throttlingRetryPolicy:()=>Ue,throttlingRetryPolicyName:()=>Me,tlsPolicy:()=>ge,tlsPolicyName:()=>fe,tracingPolicy:()=>Ce,tracingPolicyName:()=>Te,userAgentPolicy:()=>b,userAgentPolicyName:()=>A});const r=new Set(["Deserialize","Serialize","Retry","Sign"]);class o{constructor(e){var t;this._policies=[],this._policies=null!==(t=null==e?void 0:e.slice(0))&&void 0!==t?t:[],this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!r.has(t.phase))throw new Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!r.has(t.afterPhase))throw new Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){const t=[];return this._policies=this._policies.filter((n=>!(e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase)||(t.push(n.policy),!1))),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight(((e,t)=>n=>t.sendRequest(n,e)),(t=>e.sendRequest(t)))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new o(this._policies)}static create(){return new o}orderPolicies(){const e=[],t=new Map;function n(e){return{name:e,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}const r=n("Serialize"),o=n("None"),i=n("Deserialize"),s=n("Retry"),a=n("Sign"),c=[r,o,i,s,a];function d(e){return"Retry"===e?s:"Serialize"===e?r:"Deserialize"===e?i:"Sign"===e?a:o}for(const e of this._policies){const n=e.policy,r=e.options,o=n.name;if(t.has(o))throw new Error("Duplicate policy names not allowed in pipeline");const i={policy:n,dependsOn:new Set,dependants:new Set};r.afterPhase&&(i.afterPhase=d(r.afterPhase),i.afterPhase.hasAfterPolicies=!0),t.set(o,i),d(r.phase).policies.add(i)}for(const e of this._policies){const{policy:n,options:r}=e,o=n.name,i=t.get(o);if(!i)throw new Error(`Missing node for policy ${o}`);if(r.afterPolicies)for(const e of r.afterPolicies){const n=t.get(e);n&&(i.dependsOn.add(n),n.dependants.add(i))}if(r.beforePolicies)for(const e of r.beforePolicies){const n=t.get(e);n&&(n.dependsOn.add(i),i.dependants.add(n))}}function u(n){n.hasRun=!0;for(const r of n.policies)if((!r.afterPhase||r.afterPhase.hasRun&&!r.afterPhase.policies.size)&&0===r.dependsOn.size){e.push(r.policy);for(const e of r.dependants)e.dependsOn.delete(r);t.delete(r.policy.name),n.policies.delete(r)}}function l(){for(const e of c){if(u(e),e.policies.size>0&&e!==o)return void(o.hasRun||u(o));e.hasAfterPolicies&&u(o)}}let p=0;for(;t.size>0;){p++;const t=e.length;if(l(),e.length<=t&&p>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}function i(){return o.create()}var s=n(3526);const a=(0,s.KV)("core-rest-pipeline");var c=n(5777);const d="REDACTED",u=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],l=["api-version"];class p{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=u.concat(e),t=l.concat(t),this.allowedHeaderNames=new Set(e.map((e=>e.toLowerCase()))),this.allowedQueryParameters=new Set(t.map((e=>e.toLowerCase())))}sanitize(e){const t=new Set;return JSON.stringify(e,((e,n)=>{if(n instanceof Error)return Object.assign(Object.assign({},n),{name:n.name,message:n.message});if("headers"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||(0,c.isObject)(n)){if(t.has(n))return"[Circular]";t.add(n)}return n}}),2)}sanitizeUrl(e){if("string"!=typeof e||null===e||""===e)return e;const t=new URL(e);if(!t.search)return e;for(const[e]of t.searchParams)this.allowedQueryParameters.has(e.toLowerCase())||t.searchParams.set(e,d);return t.toString()}sanitizeHeaders(e){const t={};for(const n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?t[n]=e[n]:t[n]=d;return t}sanitizeQuery(e){if("object"!=typeof e||null===e)return e;const t={};for(const n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?t[n]=e[n]:t[n]=d;return t}}const h="logPolicy";function f(e={}){var t;const n=null!==(t=e.logger)&&void 0!==t?t:a.info,r=new p({additionalAllowedHeaderNames:e.additionalAllowedHeaderNames,additionalAllowedQueryParameters:e.additionalAllowedQueryParameters});return{name:h,async sendRequest(e,t){if(!n.enabled)return t(e);n(`Request: ${r.sanitize(e)}`);const o=await t(e);return n(`Response status code: ${o.status}`),n(`Headers: ${r.sanitize(o.headers)}`),o}}}const g="redirectPolicy",m=["GET","HEAD"];function v(e={}){const{maxRetries:t=20}=e;return{name:g,async sendRequest(e,n){const r=await n(e);return y(n,r,t)}}}async function y(e,t,n,r=0){const{request:o,status:i,headers:s}=t,a=s.get("location");if(a&&(300===i||301===i&&m.includes(o.method)||302===i&&m.includes(o.method)||303===i&&"POST"===o.method||307===i)&&r<n){const t=new URL(a,o.url);o.url=t.toString(),303===i&&(o.method="GET",o.headers.delete("Content-Length"),delete o.body),o.headers.delete("Authorization");const s=await e(o);return y(e,s,n,r+1)}return t}const S="1.18.2",E=3;async function T(e){const t=new Map;t.set("core-rest-pipeline",S),await async function(e){const t=globalThis.navigator;let n="unknown";if(null==t?void 0:t.userAgentData){const r=await t.userAgentData.getHighEntropyValues(["architecture","platformVersion"]);n=`${r.architecture}-${r.platform}-${r.platformVersion}`;const o=function(e){const t=["Google Chrome","Microsoft Edge","Opera","Brave","Chromium"];for(const n of t){const t=e.find((e=>e.brand===n));if(t)return t}}(t.userAgentData.brands);o&&e.set(o.brand,o.version)}else if(null==t?void 0:t.platform){n=t.platform;const r=function(e){const t=[{name:"Firefox",regex:/Firefox\/([\d.]+)/},{name:"Safari",regex:/Version\/([\d.]+).*Safari/}];for(const n of t){const t=e.match(n.regex);if(t)return{brand:n.name,version:t[1]}}}(t.userAgent);r&&e.set(r.brand,r.version)}else"string"==typeof globalThis.EdgeRuntime&&e.set("EdgeRuntime",globalThis.EdgeRuntime);e.set("OS",n)}(t);const n=function(e){const t=[];for(const[n,r]of e){const e=r?`${n}/${r}`:n;t.push(e)}return t.join(" ")}(t);return e?`${e} ${n}`:n}const C="x-ms-useragent",A="userAgentPolicy";function b(e={}){const t=T(e.userAgentPrefix);return{name:A,sendRequest:async(e,n)=>(e.headers.has(C)||e.headers.set(C,await t),n(e))}}function I(e){return Boolean(e&&"function"==typeof e.pipe)}function R(e){return Boolean(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}const w={arrayBuffer:()=>{throw new Error("Not implemented")},bytes:()=>{throw new Error("Not implemented")},slice:()=>{throw new Error("Not implemented")},text:()=>{throw new Error("Not implemented")}},O=Symbol("rawContent");function _(e){return"function"==typeof e[O]?e[O]():e.stream()}function P(e,t,n={}){var r,o,i,s;return Object.assign(Object.assign({},w),{type:null!==(r=n.type)&&void 0!==r?r:"",lastModified:null!==(o=n.lastModified)&&void 0!==o?o:(new Date).getTime(),webkitRelativePath:null!==(i=n.webkitRelativePath)&&void 0!==i?i:"",size:null!==(s=n.size)&&void 0!==s?s:-1,name:t,stream:()=>{const t=e();if(I(t))throw new Error("Not supported: a Node stream was provided as input to createFileFromStream.");return t},[O]:e})}function D(e,t,n={}){var r,o,i;return c.isNodeLike?Object.assign(Object.assign({},w),{type:null!==(r=n.type)&&void 0!==r?r:"",lastModified:null!==(o=n.lastModified)&&void 0!==o?o:(new Date).getTime(),webkitRelativePath:null!==(i=n.webkitRelativePath)&&void 0!==i?i:"",size:e.byteLength,name:t,arrayBuffer:async()=>e.buffer,stream:()=>new Blob([e]).stream(),[O]:()=>e}):new File([e],t,n)}async function N(e){if(e instanceof Blob||e instanceof Uint8Array)return e;if(R(e))return new Response(e).blob();const t=_(e);if(I(t))throw new Error("Encountered unexpected type. In the browser, `concat` supports Web ReadableStream, Blob, Uint8Array, and files created using `createFile` only.");return N(t)}function k(e){let t="";for(const[n,r]of e)t+=`${n}: ${r}\r\n`;return t}function M(e){return e instanceof Uint8Array?e.byteLength:"function"==typeof e.stream?-1===e.size?void 0:e.size:void 0}const U="multipartPolicy",x=70,L=new Set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?");function j(){return{name:U,async sendRequest(e,t){var n;if(!e.multipartBody)return t(e);if(e.body)throw new Error("multipartBody and regular body cannot be set at the same time");let r=e.multipartBody.boundary;const o=null!==(n=e.headers.get("Content-Type"))&&void 0!==n?n:"multipart/mixed",i=o.match(/^(multipart\/[^ ;]+)(?:; *boundary=(.+))?$/);if(!i)throw new Error(`Got multipart request body, but content-type header was not multipart: ${o}`);const[,s,a]=i;if(a&&r&&a!==r)throw new Error(`Multipart boundary was specified as ${a} in the header, but got ${r} in the request body`);return null!=r||(r=a),r?function(e){if(e.length>x)throw new Error(`Multipart boundary "${e}" exceeds maximum length of 70 characters`);if(Array.from(e).some((e=>!L.has(e))))throw new Error(`Multipart boundary "${e}" contains invalid characters`)}(r):r=`----AzSDKFormBoundary${(0,c.randomUUID)()}`,e.headers.set("Content-Type",`${s}; boundary=${r}`),await async function(e,t,n){const r=[(0,c.stringToUint8Array)(`--${n}`,"utf-8"),...t.flatMap((e=>[(0,c.stringToUint8Array)("\r\n","utf-8"),(0,c.stringToUint8Array)(k(e.headers),"utf-8"),(0,c.stringToUint8Array)("\r\n","utf-8"),e.body,(0,c.stringToUint8Array)(`\r\n--${n}`,"utf-8")])),(0,c.stringToUint8Array)("--\r\n\r\n","utf-8")],o=function(e){let t=0;for(const n of e){const e=M(n);if(void 0===e)return;t+=e}return t}(r);o&&e.headers.set("Content-Length",o),e.body=await async function(e){const t=[];for(const n of e)t.push(await N("function"==typeof n?n():n));return new Blob(t)}(r)}(e,e.multipartBody.parts,r),e.multipartBody=void 0,t(e)}}}const q="decompressResponsePolicy";function F(){throw new Error("decompressResponsePolicy is not supported in browser environment")}class G extends Error{constructor(e){super(e),this.name="AbortError"}}const B="The operation was aborted.";function H(e,t,n){return new Promise(((r,o)=>{let i,s;const a=()=>o(new G((null==n?void 0:n.abortErrorMsg)?null==n?void 0:n.abortErrorMsg:B)),c=()=>{(null==n?void 0:n.abortSignal)&&s&&n.abortSignal.removeEventListener("abort",s)};if(s=()=>(i&&clearTimeout(i),c(),a()),(null==n?void 0:n.abortSignal)&&n.abortSignal.aborted)return a();i=setTimeout((()=>{c(),r(t)}),e),(null==n?void 0:n.abortSignal)&&n.abortSignal.addEventListener("abort",s)}))}function z(e,t){const n=e.headers.get(t);if(!n)return;const r=Number(n);return Number.isNaN(r)?void 0:r}const $="Retry-After",V=["retry-after-ms","x-ms-retry-after-ms",$];function W(e){if(e&&[429,503].includes(e.status))try{for(const t of V){const n=z(e,t);if(0===n||n)return n*(t===$?1e3:1)}const t=e.headers.get($);if(!t)return;const n=Date.parse(t)-Date.now();return Number.isFinite(n)?Math.max(0,n):void 0}catch(e){return}}function K(){return{name:"throttlingRetryStrategy",retry({response:e}){const t=W(e);return Number.isFinite(t)?{retryAfterInMs:t}:{skipStrategy:!0}}}}const J=1e3,Y=64e3;function X(e={}){var t,n;const r=null!==(t=e.retryDelayInMs)&&void 0!==t?t:J,o=null!==(n=e.maxRetryDelayInMs)&&void 0!==n?n:Y;return{name:"exponentialRetryStrategy",retry({retryCount:t,response:n,responseError:i}){const s=!!(p=i)&&("ETIMEDOUT"===p.code||"ESOCKETTIMEDOUT"===p.code||"ECONNREFUSED"===p.code||"ECONNRESET"===p.code||"ENOENT"===p.code||"ENOTFOUND"===p.code),a=s&&e.ignoreSystemErrors,d=function(e){return Boolean(e&&void 0!==e.status&&(e.status>=500||408===e.status)&&501!==e.status&&505!==e.status)}(n),u=d&&e.ignoreHttpStatusCodes,l=n&&(function(e){return Number.isFinite(W(e))}(n)||!d);var p;return l||u||a?{skipStrategy:!0}:!i||s||d?(0,c.calculateRetryDelay)(t,{retryDelayInMs:r,maxRetryDelayInMs:o}):{errorToThrow:i}}}}const Q=(0,s.KV)("core-rest-pipeline retryPolicy"),Z="retryPolicy";function ee(e,t={maxRetries:E}){const n=t.logger||Q;return{name:Z,async sendRequest(r,o){var i,s;let a,c,d=-1;e:for(;;){d+=1,a=void 0,c=void 0;try{n.info(`Retry ${d}: Attempting to send request`,r.requestId),a=await o(r),n.info(`Retry ${d}: Received a response from request`,r.requestId)}catch(e){if(n.error(`Retry ${d}: Received an error from request`,r.requestId),c=e,!e||"RestError"!==c.name)throw e;a=c.response}if(null===(i=r.abortSignal)||void 0===i?void 0:i.aborted)throw n.error(`Retry ${d}: Request aborted.`),new G;if(d>=(null!==(s=t.maxRetries)&&void 0!==s?s:E)){if(n.info(`Retry ${d}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),c)throw c;if(a)return a;throw new Error("Maximum retries reached with no response or error to throw")}n.info(`Retry ${d}: Processing ${e.length} retry strategies.`);t:for(const t of e){const e=t.logger||Q;e.info(`Retry ${d}: Processing retry strategy ${t.name}.`);const n=t.retry({retryCount:d,response:a,responseError:c});if(n.skipStrategy){e.info(`Retry ${d}: Skipped.`);continue t}const{errorToThrow:o,retryAfterInMs:i,redirectTo:s}=n;if(o)throw e.error(`Retry ${d}: Retry strategy ${t.name} throws error:`,o),o;if(i||0===i){e.info(`Retry ${d}: Retry strategy ${t.name} retries after ${i}`),await H(i,void 0,{abortSignal:r.abortSignal});continue e}if(s){e.info(`Retry ${d}: Retry strategy ${t.name} redirects to ${s}`),r.url=s;continue e}}if(c)throw n.info("None of the retry strategies could work with the received error. Throwing it."),c;if(a)return n.info("None of the retry strategies could work with the received response. Returning it."),a}}}}const te="defaultRetryPolicy";function ne(e={}){var t;return{name:te,sendRequest:ee([K(),X(e)],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:E}).sendRequest}}function re(e){return e.toLowerCase()}class oe{constructor(e){if(this._headersMap=new Map,e)for(const t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(re(e),{name:e,value:String(t).trim()})}get(e){var t;return null===(t=this._headersMap.get(re(e)))||void 0===t?void 0:t.value}has(e){return this._headersMap.has(re(e))}delete(e){this._headersMap.delete(re(e))}toJSON(e={}){const t={};if(e.preserveCase)for(const e of this._headersMap.values())t[e.name]=e.value;else for(const[e,n]of this._headersMap)t[e]=n.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return function*(e){for(const t of e.values())yield[t.name,t.value]}(this._headersMap)}}function ie(e){return new oe(e)}const se="formDataPolicy";function ae(){return{name:se,async sendRequest(e,t){if(c.isNodeLike&&"undefined"!=typeof FormData&&e.body instanceof FormData&&(e.formData=function(e){var t;const n={};for(const[r,o]of e.entries())null!==(t=n[r])&&void 0!==t||(n[r]=[]),n[r].push(o);return n}(e.body),e.body=void 0),e.formData){const t=e.headers.get("Content-Type");t&&-1!==t.indexOf("application/x-www-form-urlencoded")?e.body=function(e){const t=new URLSearchParams;for(const[n,r]of Object.entries(e))if(Array.isArray(r))for(const e of r)t.append(n,e.toString());else t.append(n,r.toString());return t.toString()}(e.formData):await async function(e,t){const n=t.headers.get("Content-Type");if(n&&!n.startsWith("multipart/form-data"))return;t.headers.set("Content-Type",null!=n?n:"multipart/form-data");const r=[];for(const[t,n]of Object.entries(e))for(const e of Array.isArray(n)?n:[n])if("string"==typeof e)r.push({headers:ie({"Content-Disposition":`form-data; name="${t}"`}),body:(0,c.stringToUint8Array)(e,"utf-8")});else{if(null==e||"object"!=typeof e)throw new Error(`Unexpected value for key ${t}: ${e}. Value should be serialized to string first.`);{const n=e.name||"blob",o=ie();o.set("Content-Disposition",`form-data; name="${t}"; filename="${n}"`),o.set("Content-Type",e.type||"application/octet-stream"),r.push({headers:o,body:e})}}t.multipartBody={parts:r}}(e.formData,e),e.formData=void 0}return t(e)}}}const ce="proxyPolicy",de="proxyPolicy is not supported in browser environment";function ue(){throw new Error(de)}function le(){throw new Error(de)}const pe="setClientRequestIdPolicy";function he(e="x-ms-client-request-id"){return{name:pe,sendRequest:async(t,n)=>(t.headers.has(e)||t.headers.set(e,t.requestId),n(t))}}const fe="tlsPolicy";function ge(e){return{name:fe,sendRequest:async(t,n)=>(t.tlsSettings||(t.tlsSettings=e),n(t))}}var me=n(947);const ve={},ye=new p;class Se extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,Object.defineProperty(this,"request",{value:t.request,enumerable:!1}),Object.defineProperty(this,"response",{value:t.response,enumerable:!1}),Object.setPrototypeOf(this,Se.prototype)}[ve](){return`RestError: ${this.message} \n ${ye.sanitize(Object.assign(Object.assign({},this),{request:this.request,response:this.response}))}`}}function Ee(e){return e instanceof Se||(0,c.isError)(e)&&"RestError"===e.name}Se.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR",Se.PARSE_ERROR="PARSE_ERROR";const Te="tracingPolicy";function Ce(e={}){const t=T(e.userAgentPrefix),n=new p({additionalAllowedQueryParameters:e.additionalAllowedQueryParameters}),r=Ae();return{name:Te,async sendRequest(e,o){var i;if(!r)return o(e);const s=await t,d={"http.url":n.sanitizeUrl(e.url),"http.method":e.method,"http.user_agent":s,requestId:e.requestId};s&&(d["http.user_agent"]=s);const{span:u,tracingContext:l}=null!==(i=function(e,t,n){try{const{span:r,updatedOptions:o}=e.startSpan(`HTTP ${t.method}`,{tracingOptions:t.tracingOptions},{spanKind:"client",spanAttributes:n});if(!r.isRecording())return void r.end();const i=e.createRequestHeaders(o.tracingOptions.tracingContext);for(const[e,n]of Object.entries(i))t.headers.set(e,n);return{span:r,tracingContext:o.tracingOptions.tracingContext}}catch(e){return void a.warning(`Skipping creating a tracing span due to an error: ${(0,c.getErrorMessage)(e)}`)}}(r,e,d))&&void 0!==i?i:{};if(!u||!l)return o(e);try{const t=await r.withContext(l,o,e);return function(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),t.status>=400&&e.setStatus({status:"error"}),e.end()}catch(e){a.warning(`Skipping tracing span processing due to an error: ${(0,c.getErrorMessage)(e)}`)}}(u,t),t}catch(e){throw function(e,t){try{e.setStatus({status:"error",error:(0,c.isError)(t)?t:void 0}),Ee(t)&&t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){a.warning(`Skipping tracing span processing due to an error: ${(0,c.getErrorMessage)(e)}`)}}(u,e),e}}}}function Ae(){try{return(0,me.y)({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:S})}catch(e){return void a.warning(`Error when creating the TracingClient: ${(0,c.getErrorMessage)(e)}`)}}function be(e){var t;const n=i();return c.isNodeLike&&(e.tlsOptions&&n.addPolicy(ge(e.tlsOptions)),n.addPolicy(le(e.proxyOptions)),n.addPolicy(F())),n.addPolicy(ae(),{beforePolicies:[U]}),n.addPolicy(b(e.userAgentOptions)),n.addPolicy(he(null===(t=e.telemetryOptions)||void 0===t?void 0:t.clientRequestIdHeaderName)),n.addPolicy(j(),{afterPhase:"Deserialize"}),n.addPolicy(ne(e.retryOptions),{phase:"Retry"}),n.addPolicy(Ce(Object.assign(Object.assign({},e.userAgentOptions),e.loggingOptions)),{afterPhase:"Retry"}),c.isNodeLike&&n.addPolicy(v(e.redirectOptions),{afterPhase:"Retry"}),n.addPolicy(f(e.loggingOptions),{afterPhase:"Sign"}),n}class Ie{async sendRequest(e){if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await async function(e){const{abortController:t,abortControllerCleanup:n}=function(e){const t=new AbortController;let n,r;if(e.abortSignal){if(e.abortSignal.aborted)throw new G("The operation was aborted.");r=e=>{"abort"===e.type&&t.abort()},e.abortSignal.addEventListener("abort",r),n=()=>{var t;r&&(null===(t=e.abortSignal)||void 0===t||t.removeEventListener("abort",r))}}return e.timeout>0&&setTimeout((()=>{t.abort()}),e.timeout),{abortController:t,abortControllerCleanup:n}}(e);try{const o=function(e){const t=new Headers;for(const[n,r]of e)t.append(n,r);return t}(e.headers),{streaming:i,body:s}=function(e){const t="function"==typeof e.body?e.body():e.body;if(I(t))throw new Error("Node streams are not supported in browser environment.");return R(t)?{streaming:!0,body:Re(t,{onProgress:e.onUploadProgress})}:{streaming:!1,body:t}}(e),a=Object.assign(Object.assign({body:s,method:e.method,headers:o,signal:t.signal},"credentials"in Request.prototype?{credentials:e.withCredentials?"include":"same-origin"}:{}),"cache"in Request.prototype?{cache:"no-store"}:{});i&&(a.duplex="half");const c=await fetch(e.url,a);return r=e.body,("function"==typeof Blob||"object"==typeof Blob)&&r instanceof Blob&&e.onUploadProgress&&e.onUploadProgress({loadedBytes:e.body.size}),async function(e,t,n){var r,o;const i=function(e){const t=ie();for(const[n,r]of e.headers)t.set(n,r);return t}(e),s={request:t,headers:i,status:e.status},a=R(e.body)?Re(e.body,{onProgress:t.onDownloadProgress,onEnd:n}):e.body;if((null===(r=t.streamResponseStatusCodes)||void 0===r?void 0:r.has(Number.POSITIVE_INFINITY))||(null===(o=t.streamResponseStatusCodes)||void 0===o?void 0:o.has(s.status)))if(t.enableBrowserStreams)s.browserStreamBody=null!=a?a:void 0;else{const e=new Response(a);s.blobBody=e.blob(),null==n||n()}else{const e=new Response(a);s.bodyAsText=await e.text(),null==n||n()}return s}(c,e,n)}catch(e){throw null==n||n(),e}var r}(e)}catch(t){throw function(e,t){var n;return e&&"AbortError"===(null==e?void 0:e.name)?e:new Se(`Error sending request: ${e.message}`,{code:null!==(n=null==e?void 0:e.code)&&void 0!==n?n:Se.REQUEST_SEND_ERROR,request:t})}(t,e)}}}function Re(e,t={}){let n=0;const{onProgress:r,onEnd:o}=t;if(function(e){return void 0!==e.pipeThrough&&void 0!==self.TransformStream}(e))return e.pipeThrough(new TransformStream({transform(e,t){null!==e?(t.enqueue(e),n+=e.length,r&&r({loadedBytes:n})):t.terminate()},flush(){null==o||o()}}));{const t=e.getReader();return new ReadableStream({async pull(e){var i;const{done:s,value:a}=await t.read();if(s||!a)return null==o||o(),e.close(),void t.releaseLock();n+=null!==(i=null==a?void 0:a.length)&&void 0!==i?i:0,e.enqueue(a),r&&r({loadedBytes:n})},cancel:e=>(null==o||o(),t.cancel(e))})}}function we(){return new Ie}class Oe{constructor(e){var t,n,r,o,i,s,a;this.url=e.url,this.body=e.body,this.headers=null!==(t=e.headers)&&void 0!==t?t:ie(),this.method=null!==(n=e.method)&&void 0!==n?n:"GET",this.timeout=null!==(r=e.timeout)&&void 0!==r?r:0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=null!==(o=e.disableKeepAlive)&&void 0!==o&&o,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=null!==(i=e.withCredentials)&&void 0!==i&&i,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||(0,c.randomUUID)(),this.allowInsecureConnection=null!==(s=e.allowInsecureConnection)&&void 0!==s&&s,this.enableBrowserStreams=null!==(a=e.enableBrowserStreams)&&void 0!==a&&a}}function _e(e){return new Oe(e)}const Pe="exponentialRetryPolicy";function De(e={}){var t;return ee([X(Object.assign(Object.assign({},e),{ignoreSystemErrors:!0}))],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:E})}const Ne="systemErrorRetryPolicy";function ke(e={}){var t;return{name:Ne,sendRequest:ee([X(Object.assign(Object.assign({},e),{ignoreHttpStatusCodes:!0}))],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:E}).sendRequest}}const Me="throttlingRetryPolicy";function Ue(e={}){var t;return{name:Me,sendRequest:ee([K()],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:E}).sendRequest}}const xe={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};function Le(e,t){let n,r=null,o=null;const i=Object.assign(Object.assign({},xe),t),s={get isRefreshing(){return null!==r},get shouldRefresh(){var e;return!s.isRefreshing&&(!!((null==o?void 0:o.refreshAfterTimestamp)&&o.refreshAfterTimestamp<Date.now())||(null!==(e=null==o?void 0:o.expiresOnTimestamp)&&void 0!==e?e:0)-i.refreshWindowInMs<Date.now())},get mustRefresh(){return null===o||o.expiresOnTimestamp-i.forcedRefreshWindowInMs<Date.now()}};function a(t,a){var c;return s.isRefreshing||(r=async function(e,t,n){async function r(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch(e){return null}}let o=await r();for(;null===o;)await H(t),o=await r();return o}((()=>e.getToken(t,a)),i.retryIntervalInMs,null!==(c=null==o?void 0:o.expiresOnTimestamp)&&void 0!==c?c:Date.now()).then((e=>(r=null,o=e,n=a.tenantId,o))).catch((e=>{throw r=null,o=null,n=void 0,e}))),r}return async(e,t)=>{const r=Boolean(t.claims),i=n!==t.tenantId;return r&&(o=null),i||r||s.mustRefresh?a(e,t):(s.shouldRefresh&&a(e,t),o)}}const je="bearerTokenAuthenticationPolicy";async function qe(e,t){try{return[await t(e),void 0]}catch(e){if(Ee(e)&&e.response)return[e.response,e];throw e}}async function Fe(e){const{scopes:t,getAccessToken:n,request:r}=e,o={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions,enableCae:!0},i=await n(t,o);i&&e.request.headers.set("Authorization",`Bearer ${i.token}`)}function Ge(e){return 401===e.status&&e.headers.has("WWW-Authenticate")}async function Be(e,t){var n;const{scopes:r}=e,o=await e.getAccessToken(r,{enableCae:!0,claims:t});return!!o&&(e.request.headers.set("Authorization",`${null!==(n=o.tokenType)&&void 0!==n?n:"Bearer"} ${o.token}`),!0)}function He(e){var t,n,r;const{credential:o,scopes:i,challengeCallbacks:s}=e,c=e.logger||a,d={authorizeRequest:null!==(n=null===(t=null==s?void 0:s.authorizeRequest)||void 0===t?void 0:t.bind(s))&&void 0!==n?n:Fe,authorizeRequestOnChallenge:null===(r=null==s?void 0:s.authorizeRequestOnChallenge)||void 0===r?void 0:r.bind(s)},u=o?Le(o):()=>Promise.resolve(null);return{name:je,async sendRequest(e,t){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");let n,r,o;if(await d.authorizeRequest({scopes:Array.isArray(i)?i:[i],request:e,getAccessToken:u,logger:c}),[n,r]=await qe(e,t),Ge(n)){let s=ze(n.headers.get("WWW-Authenticate"));if(s){let a;try{a=atob(s)}catch(e){return c.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${s}`),n}o=await Be({scopes:Array.isArray(i)?i:[i],response:n,request:e,getAccessToken:u,logger:c},a),o&&([n,r]=await qe(e,t))}else if(d.authorizeRequestOnChallenge&&(o=await d.authorizeRequestOnChallenge({scopes:Array.isArray(i)?i:[i],request:e,response:n,getAccessToken:u,logger:c}),o&&([n,r]=await qe(e,t)),Ge(n)&&(s=ze(n.headers.get("WWW-Authenticate")),s))){let a;try{a=atob(s)}catch(e){return c.warning(`The WWW-Authenticate header contains "claims" that cannot be parsed. Unable to perform the Continuous Access Evaluation authentication flow. Unparsable claims: ${s}`),n}o=await Be({scopes:Array.isArray(i)?i:[i],response:n,request:e,getAccessToken:u,logger:c},a),o&&([n,r]=await qe(e,t))}}if(r)throw r;return n}}}function ze(e){var t;if(!e)return;const n=function(e){const t=/(\w+)\s+((?:\w+=(?:"[^"]*"|[^,]*),?\s*)+)/g,n=/(\w+)="([^"]*)"/g,r=[];let o;for(;null!==(o=t.exec(e));){const e=o[1],t=o[2],i={};let s;for(;null!==(s=n.exec(t));)i[s[1]]=s[2];r.push({scheme:e,params:i})}return r}(e);return null===(t=n.find((e=>"Bearer"===e.scheme&&e.params.claims&&"insufficient_claims"===e.params.error)))||void 0===t?void 0:t.params.claims}const $e="ndJsonPolicy";function Ve(){return{name:$e,async sendRequest(e,t){if("string"==typeof e.body&&e.body.startsWith("[")){const t=JSON.parse(e.body);Array.isArray(t)&&(e.body=t.map((e=>JSON.stringify(e)+"\n")).join(""))}return t(e)}}}const We="auxiliaryAuthenticationHeaderPolicy",Ke="x-ms-authorization-auxiliary";async function Je(e){var t,n;const{scopes:r,getAccessToken:o,request:i}=e,s={abortSignal:i.abortSignal,tracingOptions:i.tracingOptions};return null!==(n=null===(t=await o(r,s))||void 0===t?void 0:t.token)&&void 0!==n?n:""}function Ye(e){const{credentials:t,scopes:n}=e,r=e.logger||a,o=new WeakMap;return{name:We,async sendRequest(e,i){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication for auxiliary header is not permitted for non-TLS protected (non-https) URLs.");if(!t||0===t.length)return r.info(`${We} header will not be set due to empty credentials.`),i(e);const s=[];for(const i of t){let t=o.get(i);t||(t=Le(i),o.set(i,t)),s.push(Je({scopes:Array.isArray(n)?n:[n],request:e,getAccessToken:t,logger:r}))}const a=(await Promise.all(s)).filter((e=>Boolean(e)));return 0===a.length?(r.warning(`None of the auxiliary tokens are valid. ${Ke} header will not be set.`),i(e)):(e.headers.set(Ke,a.map((e=>`Bearer ${e}`)).join(", ")),i(e))}}}},5777:(e,t,n)=>{"use strict";n.r(t),n.d(t,{calculateRetryDelay:()=>c,cancelablePromiseRace:()=>d,computeSha256Hash:()=>T,computeSha256Hmac:()=>E,createAbortablePromise:()=>o,delay:()=>a,getErrorMessage:()=>p,getRandomIntegerInclusive:()=>i,isBrowser:()=>N,isBun:()=>U,isDefined:()=>C,isDeno:()=>M,isError:()=>l,isNode:()=>L,isNodeLike:()=>x,isNodeRuntime:()=>j,isObject:()=>u,isObjectWithProperties:()=>A,isReactNative:()=>q,isWebWorker:()=>k,objectHasProperty:()=>b,randomUUID:()=>w,stringToUint8Array:()=>f,uint8ArrayToString:()=>h});class r extends Error{constructor(e){super(e),this.name="AbortError"}}function o(e,t){const{cleanupBeforeAbort:n,abortSignal:o,abortErrorMsg:i}=null!=t?t:{};return new Promise(((t,s)=>{function a(){s(new r(null!=i?i:"The operation was aborted."))}function c(){null==o||o.removeEventListener("abort",d)}function d(){null==n||n(),c(),a()}if(null==o?void 0:o.aborted)return a();try{e((e=>{c(),t(e)}),(e=>{c(),s(e)}))}catch(e){s(e)}null==o||o.addEventListener("abort",d)}))}function i(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}const s="The delay was aborted.";function a(e,t){let n;const{abortSignal:r,abortErrorMsg:i}=null!=t?t:{};return o((t=>{n=setTimeout(t,e)}),{cleanupBeforeAbort:()=>clearTimeout(n),abortSignal:r,abortErrorMsg:null!=i?i:s})}function c(e,t){const n=t.retryDelayInMs*Math.pow(2,e),r=Math.min(t.maxRetryDelayInMs,n);return{retryAfterInMs:r/2+i(0,r/2)}}async function d(e,t){var n,r;const o=new AbortController;function i(){o.abort()}null===(n=null==t?void 0:t.abortSignal)||void 0===n||n.addEventListener("abort",i);try{return await Promise.race(e.map((e=>e({abortSignal:o.signal}))))}finally{o.abort(),null===(r=null==t?void 0:t.abortSignal)||void 0===r||r.removeEventListener("abort",i)}}function u(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof RegExp||e instanceof Date)}function l(e){if(u(e)){const t="string"==typeof e.name,n="string"==typeof e.message;return t&&n}return!1}function p(e){if(l(e))return e.message;{let t;try{t="object"==typeof e&&e?JSON.stringify(e):String(e)}catch(e){t="[unable to stringify input]"}return`Unknown error ${t}`}}function h(e,t){switch(t){case"utf-8":return function(e){return(new TextDecoder).decode(e)}(e);case"base64":return g(e);case"base64url":return function(e){return g(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(e);case"hex":return function(e){return[...e].map((e=>e.toString(16).padStart(2,"0"))).join("")}(e)}}function f(e,t){switch(t){case"utf-8":return function(e){return(new TextEncoder).encode(e)}(e);case"base64":return m(e);case"base64url":return function(e){return m(e.replace(/-/g,"+").replace(/_/g,"/"))}(e);case"hex":return function(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length/2;++n){const r=e[2*n],o=e[2*n+1];if(!v.has(r)||!v.has(o))return t.slice(0,n);t[n]=parseInt(`${r}${o}`,16)}return t}(e)}}function g(e){return btoa([...e].map((e=>String.fromCharCode(e))).join(""))}function m(e){return new Uint8Array([...atob(e)].map((e=>e.charCodeAt(0))))}const v=new Set("0123456789abcdefABCDEF");let y;function S(){if(y)return y;if(!self.crypto||!self.crypto.subtle)throw new Error("Your browser environment does not support cryptography functions.");return y=self.crypto.subtle,y}async function E(e,t,n){const r=S(),o=f(e,"base64"),i=f(t,"utf-8"),s=await r.importKey("raw",o,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),a=await r.sign({name:"HMAC",hash:{name:"SHA-256"}},s,i);return h(new Uint8Array(a),n)}async function T(e,t){const n=f(e,"utf-8"),r=await S().digest({name:"SHA-256"},n);return h(new Uint8Array(r),t)}function C(e){return null!=e}function A(e,t){if(!C(e)||"object"!=typeof e)return!1;for(const n of t)if(!b(e,n))return!1;return!0}function b(e,t){return C(e)&&"object"==typeof e&&t in e}var I;const R="function"==typeof(null===(I=null===globalThis||void 0===globalThis?void 0:globalThis.crypto)||void 0===I?void 0:I.randomUUID)?globalThis.crypto.randomUUID.bind(globalThis.crypto):function(){let e="";for(let t=0;t<32;t++){const n=Math.floor(16*Math.random());e+=12===t?"4":16===t?3&n|8:n.toString(16),7!==t&&11!==t&&15!==t&&19!==t||(e+="-")}return e};function w(){return R()}var O,_,P,D;const N="undefined"!=typeof window&&void 0!==window.document,k="object"==typeof self&&"function"==typeof(null===self||void 0===self?void 0:self.importScripts)&&("DedicatedWorkerGlobalScope"===(null===(O=self.constructor)||void 0===O?void 0:O.name)||"ServiceWorkerGlobalScope"===(null===(_=self.constructor)||void 0===_?void 0:_.name)||"SharedWorkerGlobalScope"===(null===(P=self.constructor)||void 0===P?void 0:P.name)),M="undefined"!=typeof Deno&&void 0!==Deno.version&&void 0!==Deno.version.deno,U="undefined"!=typeof Bun&&void 0!==Bun.version,x=void 0!==globalThis.process&&Boolean(globalThis.process.version)&&Boolean(null===(D=globalThis.process.versions)||void 0===D?void 0:D.node),L=x,j=x&&!U&&!M,q="undefined"!=typeof navigator&&"ReactNative"===(null===navigator||void 0===navigator?void 0:navigator.product)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{ActivityType:()=>cr,BOT_ADAPTIVE_CARD_METADATA_KEY:()=>Er,BOT_ADAPTIVE_CARD_METADATA_VALUE:()=>Tr,ChannelDataTypes:()=>Sr,DIRECT_LINE_ACTIVITY_ENTITIES_MESSAGE_STREAMING_VALUE:()=>ur,LogEvent:()=>Ee,LogLevel:()=>ge,Logger:()=>Se,OneDriveFileManager:()=>fo,ReadyState:()=>e,Role:()=>dr,StateKey:()=>fe,createACSAdapter:()=>go});var e,t={};n.r(t),n.d(t,{AddChatParticipantsRequest:()=>pt,AddChatParticipantsResult:()=>ht,ChatAttachment:()=>rt,ChatError:()=>et,ChatMessage:()=>st,ChatMessageContent:()=>at,ChatMessageReadReceipt:()=>We,ChatMessageReadReceiptsCollection:()=>Ve,ChatMessagesCollection:()=>it,ChatParticipant:()=>ct,ChatParticipantsCollection:()=>lt,ChatRetentionPolicy:()=>gt,ChatThreadItem:()=>Et,ChatThreadProperties:()=>vt,ChatThreadsItemCollection:()=>St,CommunicationErrorResponse:()=>Ze,CommunicationIdentifierModel:()=>Ke,CommunicationUserIdentifierModel:()=>Je,CreateChatThreadRequest:()=>ft,CreateChatThreadResult:()=>mt,ErrorDetail:()=>Rt,ErrorModel:()=>It,ErrorResponse:()=>bt,MessagingPolicy:()=>yt,MicrosoftTeamsAppIdentifierModel:()=>Qe,MicrosoftTeamsUserIdentifierModel:()=>Xe,NoneRetentionPolicy:()=>Ot,PhoneNumberIdentifierModel:()=>Ye,PolicyViolation:()=>dt,SendChatMessageRequest:()=>nt,SendChatMessageResult:()=>ot,SendReadReceiptRequest:()=>tt,SendTypingNotificationRequest:()=>Ct,ThreadCreationDateRetentionPolicy:()=>wt,UpdateChatMessageRequest:()=>ut,UpdateChatThreadRequest:()=>Tt,UploadChatImageResult:()=>At,discriminators:()=>_t}),function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=2]="CLOSED"}(e||(e={})),"function"==typeof Symbol&&Symbol.observable;var o=function(){return Math.random().toString(36).substring(7).split("").join(".")};function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function s(e,t){return(...n)=>r=>o=>{const s=r(o);if(Object.getPrototypeOf(s)!==Object.prototype)throw new Error("One of the enhancer is returning the adapter as a class object. This is not supported.");let a=()=>{throw new Error("Calling function while constructing your middleware is not allowed. Other middleware would not be applied to this function.")};const c=t(function(e){return{close:(...t)=>e.close(...t),egress:(...t)=>e.egress(...t),getReadyState:(...t)=>e.getReadyState(...t),getState:t=>e.getState(t),ingress:(...t)=>e.ingress(...t),setReadyState:(...t)=>e.setReadyState(...t),setState:(t,n)=>e.setState(t,n),subscribe:(...t)=>e.subscribe(...t)}}(s),((...e)=>a(...e))),d=n.map((e=>e(c)));if(d.some((e=>"function"!=typeof e)))throw new Error("All middlewares must return a function after caling with middleware API.");return a=i(...d)(e(s)),Object.assign(Object.assign({},s),t(s,a))}}function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function c(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function d(e){return this instanceof d?(this.v=e,this):new d(e)}function u(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=o[e](t)).value instanceof d?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function l(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:d(e[r](t)),done:!1}:o?o(t):t}:o}}function p(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}function h(){const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e}o(),o(),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError,n(2440),n(5245);var f=n(8435),g=n.n(f);const m=Symbol();function v(e,t,...n){if(!e)throw new TypeError(y(t,n))}function y(e,t){let n=0;return e.replace(/%[os]/gu,(()=>S(t[n++])))}function S(e){return"object"!=typeof e||null===e?String(e):Object.prototype.toString.call(e)}const E="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:void 0;let T;class C{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{T;const n=(null!==(t=(new Error).stack)&&void 0!==t?t:"").replace(/^(?:.+?\n){2}/gu,"\n");console.warn(this.message,...e,n)}catch(e){}}}const A=new C("W01","Unable to initialize event under dispatching."),b=new C("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),I=new C("W03","Assigning any truthy value to 'returnValue' property has no effect."),R=new C("W04","Unable to preventDefault on non-cancelable events."),w=new C("W05","Unable to preventDefault inside passive event listener invocation."),O=new C("W06","An event listener wasn't added because it has been added already: %o, %o"),_=new C("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),P=new C("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),D=new C("W09","Event attribute handler must be a function: %o");class N{static get NONE(){return k}static get CAPTURING_PHASE(){return M}static get AT_TARGET(){return U}static get BUBBLING_PHASE(){return x}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=null!=t?t:{};L.set(this,{type:String(e),bubbles:Boolean(n.bubbles),cancelable:Boolean(n.cancelable),composed:Boolean(n.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return j(this).type}get target(){return j(this).target}get srcElement(){return j(this).target}get currentTarget(){return j(this).currentTarget}composedPath(){const e=j(this).currentTarget;return e?[e]:[]}get NONE(){return k}get CAPTURING_PHASE(){return M}get AT_TARGET(){return U}get BUBBLING_PHASE(){return x}get eventPhase(){return j(this).dispatchFlag?2:0}stopPropagation(){j(this).stopPropagationFlag=!0}get cancelBubble(){return j(this).stopPropagationFlag}set cancelBubble(e){e?j(this).stopPropagationFlag=!0:b.warn()}stopImmediatePropagation(){const e=j(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return j(this).bubbles}get cancelable(){return j(this).cancelable}get returnValue(){return!j(this).canceledFlag}set returnValue(e){e?I.warn():q(j(this))}preventDefault(){q(j(this))}get defaultPrevented(){return j(this).canceledFlag}get composed(){return j(this).composed}get isTrusted(){return!1}get timeStamp(){return j(this).timeStamp}initEvent(e,t=!1,n=!1){const r=j(this);r.dispatchFlag?A.warn():L.set(this,{...r,type:String(e),bubbles:Boolean(t),cancelable:Boolean(n),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}const k=0,M=1,U=2,x=3,L=new WeakMap;function j(e,t="this"){const n=L.get(e);return v(null!=n,"'%s' must be an object that Event constructor created, but got another one: %o",t,e),n}function q(e){e.inPassiveListenerFlag?w.warn():e.cancelable?e.canceledFlag=!0:R.warn()}Object.defineProperty(N,"NONE",{enumerable:!0}),Object.defineProperty(N,"CAPTURING_PHASE",{enumerable:!0}),Object.defineProperty(N,"AT_TARGET",{enumerable:!0}),Object.defineProperty(N,"BUBBLING_PHASE",{enumerable:!0});const F=Object.getOwnPropertyNames(N.prototype);for(let e=0;e<F.length;++e)"constructor"!==F[e]&&Object.defineProperty(N.prototype,F[e],{enumerable:!0});let G;void 0!==E&&void 0!==E.Event&&Object.setPrototypeOf(N.prototype,E.Event.prototype);const B={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function H(e){const t=Object.keys(B);for(let n=0;n<t.length;++n){const r=t[n],o=B[r];Object.defineProperty(e,r,{get:()=>o,configurable:!0,enumerable:!0})}}class z extends N{static wrap(e){return new(K(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),$.set(this,{original:e});const t=Object.keys(e);for(let n=0;n<t.length;++n){const r=t[n];r in this||Object.defineProperty(this,r,J(e,r))}}stopPropagation(){super.stopPropagation();const{original:e}=V(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;const{original:t}=V(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:e}=V(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;const{original:t}=V(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();const{original:e}=V(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){const{original:e}=V(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}}const $=new WeakMap;function V(e){const t=$.get(e);return v(null!=t,"'this' is expected an Event object, but got",e),t}const W=new WeakMap;function K(e){const t=Object.getPrototypeOf(e);if(null==t)return z;let n=W.get(t);return null==n&&(n=function(e,t){class n extends e{}const r=Object.keys(t);for(let e=0;e<r.length;++e)Object.defineProperty(n.prototype,r[e],J(t,r[e]));return n}(K(t),t),W.set(t,n)),n}function J(e,t){const n=Object.getOwnPropertyDescriptor(e,t);return{get(){const e=V(this).original,n=e[t];return"function"==typeof n?n.bind(e):n},set(e){V(this).original[t]=e},configurable:n.configurable,enumerable:n.enumerable}}function Y(e){return!(1&~e.flags)}function X(e){return!(2&~e.flags)}function Q(e){return!(4&~e.flags)}function Z(e){return!(8&~e.flags)}function ee({callback:e},t,n){try{"function"==typeof e?e.call(t,n):"function"==typeof e.handleEvent&&e.handleEvent(n)}catch(e){!function(e){try{const t=e instanceof Error?e:new Error(S(e));if("function"==typeof dispatchEvent&&"function"==typeof ErrorEvent)dispatchEvent(new ErrorEvent("error",{error:t,message:t.message}));else if("undefined"!=typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",t);console.error(t)}catch(e){}}(e)}}function te({listeners:e},t,n){for(let r=0;r<e.length;++r)if(e[r].callback===t&&Y(e[r])===n)return r;return-1}function ne(e,t,n,r,o,i){let s;i&&(s=re.bind(null,e,t,n),i.addEventListener("abort",s));const a=function(e,t,n,r,o,i){return{callback:e,flags:(t?1:0)|(n?2:0)|(r?4:0),signal:o,signalListener:i}}(t,n,r,o,i,s);return e.cow?(e.cow=!1,e.listeners=[...e.listeners,a]):e.listeners.push(a),a}function re(e,t,n){const r=te(e,t,n);return-1!==r&&oe(e,r)}function oe(e,t,n=!1){const r=e.listeners[t];return function(e){e.flags|=8}(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!n?(e.cow=!1,e.listeners=e.listeners.filter(((e,n)=>n!==t)),!1):(e.listeners.splice(t,1),!0)}function ie(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e[t]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}W.set(Object.prototype,z),void 0!==E&&void 0!==E.Event&&W.set(E.Event.prototype,z);class se{constructor(){ae.set(this,Object.create(null))}addEventListener(e,t,n){const r=ce(this),{callback:o,capture:i,once:s,passive:a,signal:c,type:d}=function(e,t,n){var r;return de(t),"object"==typeof n&&null!==n?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:null!==(r=n.signal)&&void 0!==r?r:void 0}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}(e,t,n);if(null==o||(null==c?void 0:c.aborted))return;const u=ie(r,d),l=te(u,o,i);-1===l?ne(u,o,i,a,s,c):function(e,t,n,r){O.warn(Y(e)?"capture":"bubble",e.callback),X(e)!==t&&_.warn("passive"),Q(e)!==n&&_.warn("once"),e.signal!==r&&_.warn("signal")}(u.listeners[l],a,s,c)}removeEventListener(e,t,n){const r=ce(this),{callback:o,capture:i,type:s}=function(e,t,n){return de(t),"object"==typeof n&&null!==n?{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n.capture)}:{type:String(e),callback:null!=t?t:void 0,capture:Boolean(n)}}(e,t,n),a=r[s];null!=o&&a&&re(a,o,i)}dispatchEvent(e){const t=ce(this)[String(e.type)];if(null==t)return!0;const n=e instanceof N?e:z.wrap(e),r=j(n,"event");if(r.dispatchFlag)throw o="This event has been in dispatching.",E.DOMException?new E.DOMException(o,"InvalidStateError"):(null==G&&(G=class e extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,e)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(G.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),H(G),H(G.prototype)),new G(o));var o;if(r.dispatchFlag=!0,r.target=r.currentTarget=this,!r.stopPropagationFlag){const{cow:e,listeners:o}=t;t.cow=!0;for(let i=0;i<o.length;++i){const s=o[i];if(!Z(s)&&(Q(s)&&oe(t,i,!e)&&(i-=1),r.inPassiveListenerFlag=X(s),ee(s,this,n),r.inPassiveListenerFlag=!1,r.stopImmediatePropagationFlag))break}e||(t.cow=!1)}return r.target=null,r.currentTarget=null,r.stopImmediatePropagationFlag=!1,r.stopPropagationFlag=!1,r.dispatchFlag=!1,!r.canceledFlag}}const ae=new WeakMap;function ce(e,t="this"){const n=ae.get(e);return v(null!=n,"'%s' must be an object that EventTarget constructor created, but got another one: %o",t,e),n}function de(e){if("function"!=typeof e&&("object"!=typeof e||null===e||"function"!=typeof e.handleEvent)){if(null!=e&&"object"!=typeof e)throw new TypeError(y(P.message,[e]));P.warn(e)}}const ue=Object.getOwnPropertyNames(se.prototype);for(let e=0;e<ue.length;++e)"constructor"!==ue[e]&&Object.defineProperty(se.prototype,ue[e],{enumerable:!0});function le(e,t,n){Object.defineProperty(e,`on${t}`,{get(){return function(e,t){var n,r;return null!==(r=null===(n=ce(e,"target")[t])||void 0===n?void 0:n.attrCallback)&&void 0!==r?r:null}(this,t)},set(e){!function(e,t,n){null!=n&&"function"!=typeof n&&D.warn(n),"function"==typeof n||"object"==typeof n&&null!==n?function(e,t,n){const r=ie(ce(e,"target"),String(t));r.attrCallback=n,null==r.attrListener&&(r.attrListener=ne(r,function(e){return function(t){const n=e.attrCallback;"function"==typeof n&&n.call(this,t)}}(r),!1,!1,!1,void 0))}(e,t,n):function(e,t){const n=ce(e,"target")[String(t)];n&&n.attrListener&&(re(n,n.attrListener.callback,!1),n.attrCallback=n.attrListener=void 0)}(e,t)}(this,t,e)},configurable:!0,enumerable:!0})}void 0!==E&&void 0!==E.EventTarget&&Object.setPrototypeOf(se.prototype,E.EventTarget.prototype);const pe=se,he=e=>t=>e(t);var fe,ge,me=n(2493),ve=n.n(me);function ye(e){let t,n=[];return new(ve())((r=>(n=[...n,r],t||(t=e.subscribe({complete:()=>n.forEach((e=>e.complete())),error:e=>n.forEach((t=>t.error(e))),next:e=>n.forEach((t=>t.next(e)))})),()=>{n=n.filter((e=>e!==r)),n.length||(t.unsubscribe(),t=void 0)})))}!function(e){e.BotId="acs.botId",e.ChatClient="acs.chatClient",e.ChatThreadClient="acs.chatThreadClient",e.Reconnect="acs.reconnect",e.UserId="acs.userId",e.UserDisplayName="acs.userDisplayName",e.AuthConfig="acs.authConfig",e.ConnectionStatusObserverReady="dl.connectionStatusObserverReady",e.ThreadId="acs.threadId",e.DisconnectUTC="acs.disconnectUTC",e.AdapterOptions="acs.adapterOptions",e.EventManager="acs.eventManager",e.EnvironmentUrl="acs.environmentUrl",e.Token="acs.token",e.FileManager="fileManager",e.PollingInterval="pollingInterval",e.WebChatStatus="webChatStatus",e.MessagePollingHandleInstance="messagePollingHandleInstance"}(fe||(fe={})),function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR"}(ge||(ge={}));const Se={loggerInstance:void 0,setInstance:e=>{Se.loggerInstance=e},logEvent:(e,t)=>{void 0!==Se.loggerInstance&&Se.loggerInstance.logEvent(e,t)}};var Ee,Te;function Ce(e){return new Promise((t=>setTimeout((()=>{t()}),e)))}!function(e){e.ADAPTER_STATE_UPDATE="ADAPTER_STATE_UPDATE",e.ACS_SDK_START_INIT="ACS_SDK_START_INIT",e.ACS_SDK_START_INIT_ERROR="ACS_SDK_START_INIT_ERROR",e.ACS_SDK_CHATCLIENT_ERROR="ACS_SDK_CHATCLIENT_ERROR",e.ACS_SDK_JOINTHREAD_ERROR="ACS_SDK_JOINTHREAD_ERROR",e.ACS_SDK_CHATCLIENT_RECONNECT_ERROR="ACS_SDK_CHATCLIENT_RECONNECT_ERROR",e.ACS_ADAPTER_ATTACHMENT_DOWNLOADED="ACS_ADAPTER_ATTACHMENT_DOWNLOADED",e.ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR="ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR",e.ACS_ADAPTER_ATTACHMENT_NEW="ACS_ADAPTER_ATTACHMENT_NEW",e.ACS_ADAPTER_ATTACHMENT_ALREADY_DOWNLOADED="ACS_ADAPTER_ATTACHMENT_ALREADY_DOWNLOADED",e.ACS_ADAPTER_PROCESSED_ATTACHMENTS="ACS_ADAPTER_PROCESSED_ATTACHMENTS",e.ACS_ADAPTER_CONVERT_HISTORY="ACS_ADAPTER_CONVERT_HISTORY",e.ACS_ADAPTER_CONVERT_TYPING_MESSAGE="ACS_ADAPTER_CONVERT_TYPING_MESSAGE",e.ACS_ADAPTER_CONVERT_MESSAGE="ACS_ADAPTER_CONVERT_MESSAGE",e.ACS_ADAPTER_CONVERT_EDITED_MESSAGE="ACS_ADAPTER_CONVERT_EDITED_MESSAGE",e.ACS_ADAPTER_CONVERT_DELETED_MESSAGE="ACS_ADAPTER_CONVERT_DELETED_MESSAGE",e.ACS_ADAPTER_CONVERT_THREAD_UPDATED="ACS_ADAPTER_CONVERT_THREAD_UPDATED",e.ACS_ADAPTER_CONVERT_THREAD_DELETED="ACS_ADAPTER_CONVERT_THREAD_DELETED",e.ACS_ADAPTER_INGRESS_MESSAGE="ACS_ADAPTER_INGRESS_MESSAGE",e.ACS_ADAPTER_INGRESS_FAILED="ACS_ADAPTER_INGRESS_FAILED",e.ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED="ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED",e.ACS_ADAPTER_EGRESS_MESSAGE="ACS_ADAPTER_EGRESS_MESSAGE",e.ACS_ADAPTER_EGRESS_SEND_MESSAGE="ACS_ADAPTER_EGRESS_SEND_MESSAGE",e.ACS_ADAPTER_EGRESS_FAILED="ACS_ADAPTER_EGRESS_FAILED",e.ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS="ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS",e.ACS_ADAPTER_SEND_MESSAGE_FAILED="ACS_ADAPTER_SEND_MESSAGE_FAILED",e.ACS_ADAPTER_SEND_MESSAGE_SUCCESS="ACS_ADAPTER_SEND_MESSAGE_SUCCESS",e.ACS_ADAPTER_SEND_MESSAGE_RETRY="ACS_ADAPTER_SEND_MESSAGE_RETRY",e.ACS_ADAPTER_INGRESS_TYPING_FAILED="ACS_ADAPTER_INGRESS_TYPING_FAILED",e.ACS_ADAPTER_INGRESS_TYPING_SUCCESS="ACS_ADAPTER_INGRESS_TYPING_SUCCESS",e.ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST="ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST",e.ACS_ADAPTER_EGRESS_TYPING_FAILED="ACS_ADAPTER_EGRESS_TYPING_FAILED",e.ACS_ADAPTER_EGRESS_TYPING_SUCCESS="ACS_ADAPTER_EGRESS_TYPING_SUCCESS",e.ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED="ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED",e.ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED="ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED",e.ACS_PROCESSING_POLLED_MESSAGE="ACS_PROCESSING_POLLED_MESSAGE",e.ACS_PROCESSING_NEW_MESSAGE="ACS_PROCESSING_NEW_MESSAGE",e.ACS_PROCESSING_EDITED_MESSAGE="ACS_PROCESSING_EDITED_MESSAGE",e.ACS_PROCESSING_DELETED_MESSAGE="ACS_PROCESSING_DELETED_MESSAGE",e.ACS_SKIP_POLLED_MESSAGE="ACS_SKIP_POLLED_MESSAGE",e.ACS_CANCEL_POLLING_CALLBACK="ACS_CANCEL_POLLING_CALLBACK",e.ACS_CREATE_POLLING_CALLBACK="ACS_CREATE_POLLING_CALLBACK",e.ACS_ADAPTER_POLLING_STATUSCODE="ACS_ADAPTER_POLLING_STATUSCODE",e.ACS_SEND_POLLING_REQUEST="ACS_SEND_POLLING_REQUEST",e.ACS_ADAPTER_POLLING_SKIPPED="ACS_ADAPTER_POLLING_SKIPPED",e.ACS_ADAPTER_POLLING_STOPPED="ACS_ADAPTER_POLLING_STOPPED",e.ACS_SKIP_NEW_MESSAGE="ACS_SKIP_NEW_MESSAGE",e.ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK="ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK",e.ACS_SKIP_EDITED_MESSAGE="ACS_SKIP_EDITED_MESSAGE",e.ACS_SKIP_DELETED_MESSAGE="ACS_SKIP_DELETED_MESSAGE",e.ACS_ADAPTER_POST_ACTIVITY="ACS_ADAPTER_POST_ACTIVITY",e.ACS_ADAPTER_POST_FILE_ACTIVITY="ACS_ADAPTER_POST_FILE_ACTIVITY",e.ACS_SDK_RECONNECT="ACS_SDK_RECONNECT",e.MESSAGE_RECEIVED="ADAPTER_MESSAGE_RECEIVED",e.PROCESS_CACHED_PAGED_HISTORY_MESSAGE="PROCESS_CACHED_PAGED_HISTORY_MESSAGE",e.PROCESS_CACHED_HISTORY_MESSAGE="PROCESS_CACHED_HISTORY_MESSAGE",e.PROCESS_CACHED_NEW_MESSAGE="PROCESS_CACHED_NEW_MESSAGE",e.CACHE_PAGED_HISTORY_MESSAGE="CACHE_PAGED_HISTORY_MESSAGE",e.CACHE_POLLED_HISTORY_MESSAGE="CACHE_POLLED_HISTORY_MESSAGE",e.CACHE_NEW_MESSAGE="CACHE_NEW_MESSAGE",e.TYPING_MESSAGE_RECEIVED="ADAPTER_TYPING_MESSAGE_RECEIVED",e.THREAD_THREAD_UPDATED="ADAPTER_THREAD_UPDATED_RECEIVED",e.THREAD_DELETED_RECEIVED="ADAPTER_THREAD_DELETED_RECEIVED",e.PARTICIPANT_REMOVED_RECEIVED="ADAPTER_PARTICIPANT_REMOVED_RECEIVED",e.PARTICIPANT_ADDED_RECEIVED="ADAPTER_PARTICIPANT_ADDED_RECEIVED",e.MESSAGE_EDIT_RECEIVED="ADAPTER_MESSAGE_EDIT_RECEIVED",e.MESSAGE_DELETED_RECEIVED="ADAPTER_MESSAGE_DELETED_RECEIVED",e.REGISTER_ON_NEW_MESSAGE="ADAPTER_REGISTER_ON_NEW_MESSAGE",e.REGISTER_ON_TYPING_INDICATOR="ADAPTER_REGISTER_ON_TYPING_INDICATOR",e.REGISTER_ON_MESSAGE_EDIT="ADAPTER_REGISTER_ON_MESSAGE_EDIT",e.REGISTER_ON_MESSAGE_DELETED="REGISTER_ON_MESSAGE_DELETED",e.REGISTER_ON_THREAD_DELETED="ADAPTER_REGISTER_ON_THREAD_DELETED",e.REGISTER_ON_THREAD_UPDATED="ADAPTER_REGISTER_ON_THREAD_UPDATED",e.REGISTER_ON_PARTICIPANT_ADDED="ADAPTER_REGISTER_ON_PARTICIPANT_ADDED",e.REGISTER_ON_PARTICIPANT_REMOVED="ADAPTER_REGISTER_ON_PARTICIPANT_REMOVED",e.REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED="ADAPTER_REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED",e.REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED="ADAPTER_REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED",e.NETWORK_ONLINE="NETWORK_ONLINE",e.NETWORK_OFFLINE="NETWORK_OFFLINE",e.FILEMANAGER_DOWNLOAD_FILE_FAILED="FILEMANAGER_DOWNLOAD_FILE_FAILED",e.FILEMANAGER_UPLOAD_FILE_FAILED="FILEMANAGER_UPLOAD_FILE_FAILED",e.FILEMANAGER_UPLOAD_FILE_REQUEST="FILEMANAGER_UPLOAD_FILE_REQUEST",e.WEBCHAT_SUBSCRIPTION_TIMEOUT="WEBCHAT_SUBSCRIPTION_TIMEOUT",e.WEBCHAT_SUBSCRIPTION_SUCCESS="WEBCHAT_SUBSCRIPTION_SUCCESS",e.WEBCHAT_STATUS_CONNECTED="WEBCHAT_STATUS_CONNECTED",e.REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED="ADAPTER_REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED",e.STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED="ADAPTER_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED",e.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK="ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK",e.ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK="ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK",e.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT="ACS_PROCESSING_PARTICIPANT_ADDED_EVENT",e.ACS_PROCESSING_PARTICIPANT_REMOVED_EVENT="ACS_PROCESSING_PARTICIPANT_REMOVED_EVENT",e.ACS_PARTICIPANT_ADDED_EVENT_PROCESSED="ACS_PARTICIPANT_ADDED_EVENT_PROCESSED",e.ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED="ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED",e.UNSUPPORTED_MESSAGE_TYPE="UNSUPPORTED_MESSAGE_TYPE"}(Ee||(Ee={})),function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.FailedToConnect=4]="FailedToConnect"}(Te||(Te={}));const Ae=function(t={},n=he){const r={};let o,i=!1;const s=n((()=>{const t=new pe,n=[];let a=e.CONNECTING;return{addEventListener:t.addEventListener.bind(t),dispatchEvent:t.dispatchEvent.bind(t),removeEventListener:t.removeEventListener.bind(t),activities:({signal:e}={})=>{const t=function(e={}){const t=function(e){const t=new Error("aborted");if(e&&e.aborted)return Promise.reject(t);const n=h(),r=()=>{e.removeEventListener("abort",r),n.reject(t)};return e&&e.addEventListener("abort",r),n.promise}(e.signal),n=[];let r,o;return t.catch((()=>{})),{iterable:{[Symbol.asyncIterator](){return u(this,arguments,(function*(){if(r)throw new Error("asyncIterableQueue: You can only iterate once. The iteration has already started or finished.");for(r=!0;;){n.length?yield d(e.signal&&e.signal.aborted&&t):(yield d(Promise.race([t,(o||(o=h())).promise])),o=null);const r=n.shift();if(g()(r,m))break;yield yield d(r)}}))}},end(){n.push(m)},push(e){n.push(e),o&&o.resolve()},watermark:()=>n.length}}({signal:e});return n.push(t),e&&e.addEventListener("abort",(()=>{const e=n.indexOf(t);~e||n.splice(e,1)})),t.iterable},close:()=>{n.forEach((e=>e.end())),n.splice(0,1/0),o&&o.unsubscribe(),o=null},egress:()=>Promise.resolve(),getState:e=>r[e],getReadyState:()=>a,ingress:e=>{n.forEach((t=>t.push(e)))},setState:(e,t)=>{if(i&&!(e in r))throw new Error(`Cannot set config "${String(e)}" because it was not set before being sealed.`);r[e]=t},setReadyState:n=>{if(n!==a){if(a===e.CLOSED)throw new Error('Cannot change "readyState" after it is CLOSED.');if(n!==e.CLOSED&&n!==e.CONNECTING&&n!==e.OPEN)throw new Error('"readyState" must be either CLOSED, CONNECTING or OPEN.');a=n,n===e.CLOSED&&(o&&o.unsubscribe(),o=null),t.dispatchEvent(new N(n===e.OPEN?"open":"error"))}},subscribe:e=>{if(o&&o.unsubscribe(),o=null,!e)return;let t;e.subscribe({start(e){o=e,t=e},complete(){o===t&&(o=null)},error(){o===t&&(o=null)},next(e){s.ingress(e)}})}}}))(t);if(Object.getPrototypeOf(s)!==Object.prototype)throw new Error("Object returned from enhancer must not be a class object.");const c=function(e,t){const{getReadyState:n}=e,r=a(e,["getReadyState"]),o=Object.assign(Object.assign({},r),{readyState:-1});for(const e in t)Object.defineProperty(o,e,{enumerable:!0,get:()=>t[e]});return Object.defineProperty(o,"readyState",{get:()=>n()}),Object.seal(o)}(s,r);return i=!0,c},{CLOSED:be,CONNECTING:Ie,OPEN:Re}=e,we=e=>(e=>"string"==typeof e.communicationUserId)(e)?Object.assign(Object.assign({},e),{kind:"communicationUser"}):(e=>"string"==typeof e.phoneNumber)(e)?Object.assign(Object.assign({},e),{kind:"phoneNumber"}):(e=>"string"==typeof e.microsoftTeamsUserId)(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsUser"}):(e=>"string"==typeof e.teamsAppId)(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsApp"}):Object.assign(Object.assign({},e),{kind:"unknown"}),Oe=e=>{const t=we(e);switch(t.kind){case"communicationUser":return t.communicationUserId;case"microsoftTeamsUser":{const{microsoftTeamsUserId:e,rawId:n,cloud:r,isAnonymous:o}=t;if(n)return n;if(o)return`8:teamsvisitor:${e}`;switch(r){case"dod":return`8:dod:${e}`;case"gcch":return`8:gcch:${e}`;case"public":return`8:orgid:${e}`}return`8:orgid:${e}`}case"microsoftTeamsApp":{const{teamsAppId:e,rawId:n,cloud:r}=t;if(n)return n;switch(r){case"dod":return`28:dod:${e}`;case"gcch":return`28:gcch:${e}`}return`28:orgid:${e}`}case"phoneNumber":{const{phoneNumber:e,rawId:n}=t;return n||`4:${e}`}case"unknown":return t.id}},_e=(e,t)=>{const n=Object.keys(e)[0],r=e[n];if(t in r)return r[t];throw new Error(`Property ${t} is required for identifier of type ${n}.`)},Pe=e=>{var t,n,r,o,i,s;const a=we(e);switch(a.kind){case"communicationUser":return{rawId:Oe(a),communicationUser:{id:a.communicationUserId}};case"phoneNumber":return{rawId:null!==(t=a.rawId)&&void 0!==t?t:Oe(a),phoneNumber:{value:a.phoneNumber}};case"microsoftTeamsUser":return{rawId:null!==(n=a.rawId)&&void 0!==n?n:Oe(a),microsoftTeamsUser:{userId:a.microsoftTeamsUserId,isAnonymous:null!==(r=a.isAnonymous)&&void 0!==r&&r,cloud:null!==(o=a.cloud)&&void 0!==o?o:"public"}};case"microsoftTeamsApp":return{rawId:null!==(i=a.rawId)&&void 0!==i?i:Oe(a),microsoftTeamsApp:{appId:a.teamsAppId,cloud:null!==(s=a.cloud)&&void 0!==s?s:"public"}};case"unknown":return{rawId:a.id};default:throw new Error(`Can't serialize an identifier with kind ${a.kind}`)}},De=e=>{var t;(e=>{const t=[];if(void 0!==e.communicationUser&&t.push("communicationUser"),void 0!==e.microsoftTeamsUser&&t.push("microsoftTeamsUser"),void 0!==e.microsoftTeamsApp&&t.push("microsoftTeamsApp"),void 0!==e.phoneNumber&&t.push("phoneNumber"),t.length>1)throw new Error(`Only one of the properties in ${JSON.stringify(t)} should be present.`)})(e);const{communicationUser:n,microsoftTeamsUser:r,microsoftTeamsApp:o,phoneNumber:i}=e,s=null!==(t=e.kind)&&void 0!==t?t:(e=>e.communicationUser?"communicationUser":e.phoneNumber?"phoneNumber":e.microsoftTeamsUser?"microsoftTeamsUser":e.microsoftTeamsApp?"microsoftTeamsApp":"unknown")(e);return"communicationUser"===s&&n?{kind:"communicationUser",communicationUserId:_e({communicationUser:n},"id")}:"phoneNumber"===s&&i?{kind:"phoneNumber",phoneNumber:_e({phoneNumber:i},"value"),rawId:_e({phoneNumber:e},"rawId")}:"microsoftTeamsUser"===s&&r?{kind:"microsoftTeamsUser",microsoftTeamsUserId:_e({microsoftTeamsUser:r},"userId"),isAnonymous:_e({microsoftTeamsUser:r},"isAnonymous"),cloud:_e({microsoftTeamsUser:r},"cloud"),rawId:_e({microsoftTeamsUser:e},"rawId")}:"microsoftTeamsApp"===s&&o?{kind:"microsoftTeamsApp",teamsAppId:_e({microsoftTeamsApp:o},"appId"),cloud:_e({microsoftTeamsApp:o},"cloud"),rawId:_e({microsoftTeamsApp:e},"rawId")}:{kind:"unknown",id:_e({unknown:e},"rawId")}},Ne=e=>{const{id:t}=e,n=a(e,["id"]);return Object.assign(Object.assign({},n),{communicationIdentifier:Pe(t)})},ke=e=>{const{attachmentType:t}=e,n=a(e,["attachmentType"]);if("unknown"===t)throw new Error("'unknown' attachmentType not supported");return Object.assign(Object.assign({},n),{attachmentType:t})},Me=e=>{const{communicationIdentifier:t}=e,n=a(e,["communicationIdentifier"]);return Object.assign(Object.assign({},n),{id:De(t)})},Ue=e=>{const{participants:t,attachments:n,initiatorCommunicationIdentifier:r}=e,o=a(e,["participants","attachments","initiatorCommunicationIdentifier"]);let i=Object.assign({},o);if(r){const e=De(r);i=Object.assign(Object.assign({},i),{initiator:e})}return t&&(i=Object.assign(Object.assign({},i),{participants:null==t?void 0:t.map((e=>Me(e)))})),n&&(i=Object.assign(Object.assign({},i),{attachments:null==n?void 0:n.map((e=>(e=>{const{attachmentType:t}=e,n=a(e,["attachmentType"]);return Object.assign(Object.assign({},n),{attachmentType:t})})(e)))})),i},xe=e=>{const{state:t}=e;return{result:t}},Le=e=>{const{content:t,senderCommunicationIdentifier:n,policyViolation:r}=e,o=a(e,["content","senderCommunicationIdentifier","policyViolation"]);let i=Object.assign({},o);if(t&&(i=Object.assign(Object.assign({},i),{content:Ue(t)})),n){const e=De(n);i=Object.assign(Object.assign({},i),{sender:e})}return r&&(i=Object.assign(Object.assign({},i),{policyViolation:xe(r)})),i},je=e=>{if("threadCreationDate"===e.kind)return e;if("none"===e.kind)return e;throw new Error(`Retention Policy ${e.kind} is not supported`)},qe=e=>{const{createdByCommunicationIdentifier:t,retentionPolicy:n}=e,r=a(e,["createdByCommunicationIdentifier","retentionPolicy"]);let o=Object.assign({},r);return t&&(o=Object.assign(Object.assign({},o),{createdBy:De(t)})),n&&(o=Object.assign(Object.assign({},o),{retentionPolicy:je(n)})),o},Fe=e=>{const{senderCommunicationIdentifier:t}=e,n=a(e,["senderCommunicationIdentifier"]);return Object.assign(Object.assign({},n),{sender:De(t)})};var Ge,Be,He;!function(e){e.Unknown="unknown",e.CommunicationUser="communicationUser",e.PhoneNumber="phoneNumber",e.MicrosoftTeamsUser="microsoftTeamsUser",e.MicrosoftTeamsApp="microsoftTeamsApp"}(Ge||(Ge={})),function(e){e.Public="public",e.Dod="dod",e.Gcch="gcch"}(Be||(Be={})),function(e){e.Original="original",e.Small="small"}(He||(He={}));var ze=n(1219);const $e=(0,n(947).y)({namespace:"Azure.Communication",packageName:"@azure/communication-chat",packageVersion:"1.6.0-beta.4"}),Ve={type:{name:"Composite",className:"ChatMessageReadReceiptsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessageReadReceipt"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},We={type:{name:"Composite",className:"ChatMessageReadReceipt",modelProperties:{senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}},readOn:{serializedName:"readOn",required:!0,type:{name:"DateTime"}}}}},Ke={type:{name:"Composite",className:"CommunicationIdentifierModel",modelProperties:{kind:{serializedName:"kind",type:{name:"String"}},rawId:{serializedName:"rawId",type:{name:"String"}},communicationUser:{serializedName:"communicationUser",type:{name:"Composite",className:"CommunicationUserIdentifierModel"}},phoneNumber:{serializedName:"phoneNumber",type:{name:"Composite",className:"PhoneNumberIdentifierModel"}},microsoftTeamsUser:{serializedName:"microsoftTeamsUser",type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel"}},microsoftTeamsApp:{serializedName:"microsoftTeamsApp",type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel"}}}}},Je={type:{name:"Composite",className:"CommunicationUserIdentifierModel",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},Ye={type:{name:"Composite",className:"PhoneNumberIdentifierModel",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"String"}}}}},Xe={type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel",modelProperties:{userId:{serializedName:"userId",required:!0,type:{name:"String"}},isAnonymous:{serializedName:"isAnonymous",type:{name:"Boolean"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},Qe={type:{name:"Composite",className:"MicrosoftTeamsAppIdentifierModel",modelProperties:{appId:{serializedName:"appId",required:!0,type:{name:"String"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},Ze={type:{name:"Composite",className:"CommunicationErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ChatError"}}}}},et={type:{name:"Composite",className:"ChatError",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},target:{serializedName:"target",readOnly:!0,type:{name:"String"}},details:{serializedName:"details",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}},innerError:{serializedName:"innererror",type:{name:"Composite",className:"ChatError"}}}}},tt={type:{name:"Composite",className:"SendReadReceiptRequest",modelProperties:{chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}}}},nt={type:{name:"Composite",className:"SendChatMessageRequest",modelProperties:{content:{serializedName:"content",required:!0,type:{name:"String"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},type:{serializedName:"type",type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}}}}},rt={type:{name:"Composite",className:"ChatAttachment",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",required:!0,type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}},url:{serializedName:"url",type:{name:"String"}},previewUrl:{serializedName:"previewUrl",type:{name:"String"}}}}},ot={type:{name:"Composite",className:"SendChatMessageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},it={type:{name:"Composite",className:"ChatMessagesCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessage"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},st={type:{name:"Composite",className:"ChatMessage",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},type:{serializedName:"type",required:!0,type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},sequenceId:{serializedName:"sequenceId",required:!0,type:{name:"String"}},version:{serializedName:"version",required:!0,type:{name:"String"}},content:{serializedName:"content",type:{name:"Composite",className:"ChatMessageContent"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},editedOn:{serializedName:"editedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},policyViolation:{serializedName:"policyViolation",type:{name:"Composite",className:"PolicyViolation"}}}}},at={type:{name:"Composite",className:"ChatMessageContent",modelProperties:{message:{serializedName:"message",type:{name:"String"}},topic:{serializedName:"topic",type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}},initiatorCommunicationIdentifier:{serializedName:"initiatorCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}}}}},ct={type:{name:"Composite",className:"ChatParticipant",modelProperties:{communicationIdentifier:{serializedName:"communicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},displayName:{serializedName:"displayName",type:{name:"String"}},shareHistoryTime:{serializedName:"shareHistoryTime",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},dt={type:{name:"Composite",className:"PolicyViolation",modelProperties:{state:{serializedName:"state",required:!0,type:{name:"Enum",allowedValues:["contentBlocked","warning"]}}}}},ut={type:{name:"Composite",className:"UpdateChatMessageRequest",modelProperties:{content:{serializedName:"content",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},attachments:{serializedName:"attachments",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatAttachment"}}}}}}},lt={type:{name:"Composite",className:"ChatParticipantsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},pt={type:{name:"Composite",className:"AddChatParticipantsRequest",modelProperties:{participants:{serializedName:"participants",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},ht={type:{name:"Composite",className:"AddChatParticipantsResult",modelProperties:{invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},ft={type:{name:"Composite",className:"CreateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",required:!0,type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}}}}},gt={type:{name:"Composite",className:"ChatRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:{serializedName:"kind",clientName:"kind"},modelProperties:{kind:{serializedName:"kind",required:!0,type:{name:"Enum",allowedValues:["threadCreationDate","none"]}}}}},mt={type:{name:"Composite",className:"CreateChatThreadResult",modelProperties:{chatThread:{serializedName:"chatThread",type:{name:"Composite",className:"ChatThreadProperties"}},invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},vt={type:{name:"Composite",className:"ChatThreadProperties",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},createdByCommunicationIdentifier:{serializedName:"createdByCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}},messagingPolicy:{serializedName:"messagingPolicy",type:{name:"Composite",className:"MessagingPolicy"}}}}},yt={type:{name:"Composite",className:"MessagingPolicy",modelProperties:{textOnlyChat:{serializedName:"textOnlyChat",type:{name:"Boolean"}}}}},St={type:{name:"Composite",className:"ChatThreadsItemCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatThreadItem"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Et={type:{name:"Composite",className:"ChatThreadItem",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},lastMessageReceivedOn:{serializedName:"lastMessageReceivedOn",readOnly:!0,type:{name:"DateTime"}}}}},Tt={type:{name:"Composite",className:"UpdateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}},retentionPolicy:{serializedName:"retentionPolicy",type:{name:"Composite",className:"ChatRetentionPolicy"}}}}},Ct={type:{name:"Composite",className:"SendTypingNotificationRequest",modelProperties:{senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}}}}},At={type:{name:"Composite",className:"UploadChatImageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},attachmentType:{serializedName:"attachmentType",type:{name:"Enum",allowedValues:["image","file"]}},name:{serializedName:"name",type:{name:"String"}}}}},bt={type:{name:"Composite",className:"ErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ErrorModel"}}}}},It={type:{name:"Composite",className:"ErrorModel",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},details:{serializedName:"details",type:{name:"Sequence",element:{type:{name:"Composite",className:"ErrorDetail"}}}}}}},Rt={type:{name:"Composite",className:"ErrorDetail",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}}}}},wt={serializedName:"threadCreationDate",type:{name:"Composite",className:"ThreadCreationDateRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:gt.type.polymorphicDiscriminator,modelProperties:Object.assign(Object.assign({},gt.type.modelProperties),{deleteThreadAfterDays:{serializedName:"deleteThreadAfterDays",required:!0,type:{name:"Number"}}})}},Ot={serializedName:"none",type:{name:"Composite",className:"NoneRetentionPolicy",uberParent:"ChatRetentionPolicy",polymorphicDiscriminator:gt.type.polymorphicDiscriminator,modelProperties:Object.assign({},gt.type.modelProperties)}};let _t={ChatRetentionPolicy:gt,"ChatRetentionPolicy.threadCreationDate":wt,"ChatRetentionPolicy.none":Ot};const Pt={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},Dt={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},Nt={parameterPath:"chatThreadId",mapper:{serializedName:"chatThreadId",required:!0,type:{name:"String"}}},kt={parameterPath:["options","maxPageSize"],mapper:{serializedName:"maxPageSize",type:{name:"Number"}}},Mt={parameterPath:["options","skip"],mapper:{serializedName:"skip",type:{name:"Number"}}},Ut={parameterPath:"apiVersion",mapper:{defaultValue:"2024-06-05-preview",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},xt={parameterPath:["options","contentType"],mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},Lt={parameterPath:"sendReadReceiptRequest",mapper:tt},jt={parameterPath:"sendChatMessageRequest",mapper:nt},qt={parameterPath:["options","startTime"],mapper:{serializedName:"startTime",type:{name:"DateTime"}}},Ft={parameterPath:"chatMessageId",mapper:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}},Gt={parameterPath:["options","contentType"],mapper:{defaultValue:"application/merge-patch+json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},Bt={parameterPath:"updateChatMessageRequest",mapper:ut},Ht={parameterPath:"participantCommunicationIdentifier",mapper:Ke},zt={parameterPath:"addChatParticipantsRequest",mapper:pt},$t={parameterPath:"updateChatThreadRequest",mapper:Tt},Vt={parameterPath:["options","sendTypingNotificationRequest"],mapper:Ct},Wt={parameterPath:"imageId",mapper:{serializedName:"imageId",required:!0,type:{name:"String"}}},Kt={parameterPath:"nextLink",mapper:{serializedName:"nextLink",required:!0,type:{name:"String"}},skipEncoding:!0},Jt={parameterPath:"createChatThreadRequest",mapper:ft};class Yt{constructor(e){this.client=e}async listChatReadReceipts(e,t){return $e.withSpan("ChatApiClient.listChatReadReceipts",null!=t?t:{},(async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},Qt)))}async sendChatReadReceipt(e,t,n){return $e.withSpan("ChatApiClient.sendChatReadReceipt",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,sendReadReceiptRequest:t,options:n},Zt)))}async sendChatMessage(e,t,n){return $e.withSpan("ChatApiClient.sendChatMessage",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,sendChatMessageRequest:t,options:n},en)))}async listChatMessages(e,t){return $e.withSpan("ChatApiClient.listChatMessages",null!=t?t:{},(async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},tn)))}async getChatMessage(e,t,n){return $e.withSpan("ChatApiClient.getChatMessage",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},nn)))}async updateChatMessage(e,t,n,r){return $e.withSpan("ChatApiClient.updateChatMessage",null!=r?r:{},(async r=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,updateChatMessageRequest:n,options:r},rn)))}async deleteChatMessage(e,t,n){return $e.withSpan("ChatApiClient.deleteChatMessage",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},on)))}async listChatParticipants(e,t){return $e.withSpan("ChatApiClient.listChatParticipants",null!=t?t:{},(async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},sn)))}async removeChatParticipant(e,t,n){return $e.withSpan("ChatApiClient.removeChatParticipant",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,participantCommunicationIdentifier:t,options:n},an)))}async addChatParticipants(e,t,n){return $e.withSpan("ChatApiClient.addChatParticipants",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,addChatParticipantsRequest:t,options:n},cn)))}async updateChatThreadProperties(e,t,n){return $e.withSpan("ChatApiClient.updateChatThreadProperties",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,updateChatThreadRequest:t,options:n},dn)))}async getChatThreadProperties(e,t){return $e.withSpan("ChatApiClient.getChatThreadProperties",null!=t?t:{},(async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},un)))}async sendTypingNotification(e,t){return $e.withSpan("ChatApiClient.sendTypingNotification",null!=t?t:{},(async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},ln)))}async uploadChatImage(e,t,n){return $e.withSpan("ChatApiClient.uploadChatImage",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,chatImageFile:t,options:n},pn)))}async getChatImage(e,t,n,r){return $e.withSpan("ChatApiClient.getChatImage",null!=r?r:{},(async r=>this.client.sendOperationRequest({chatThreadId:e,imageId:t,imageViewType:n,options:r},hn)))}async deleteChatImage(e,t,n){return $e.withSpan("ChatApiClient.deleteChatImage",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,imageId:t,options:n},fn)))}async listChatReadReceiptsNext(e,t,n){return $e.withSpan("ChatApiClient.listChatReadReceiptsNext",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},gn)))}async listChatMessagesNext(e,t,n){return $e.withSpan("ChatApiClient.listChatMessagesNext",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},mn)))}async listChatParticipantsNext(e,t,n){return $e.withSpan("ChatApiClient.listChatParticipantsNext",null!=n?n:{},(async n=>this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},vn)))}}const Xt=ze.createSerializer(t,!1),Qt={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"GET",responses:{200:{bodyMapper:Ve},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[kt,Mt,Ut],urlParameters:[Dt,Nt],headerParameters:[Pt],serializer:Xt},Zt={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"POST",responses:{200:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Lt,queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt,xt],mediaType:"json",serializer:Xt},en={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"POST",responses:{201:{bodyMapper:ot},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:jt,queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt,xt],mediaType:"json",serializer:Xt},tn={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"GET",responses:{200:{bodyMapper:it},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[kt,Ut,qt],urlParameters:[Dt,Nt],headerParameters:[Pt],serializer:Xt},nn={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"GET",responses:{200:{bodyMapper:st},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Ut],urlParameters:[Dt,Nt,Ft],headerParameters:[Pt],serializer:Xt},rn={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Bt,queryParameters:[Ut],urlParameters:[Dt,Nt,Ft],headerParameters:[Pt,Gt],mediaType:"json",serializer:Xt},on={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Ut],urlParameters:[Dt,Nt,Ft],headerParameters:[Pt],serializer:Xt},sn={path:"/chat/threads/{chatThreadId}/participants",httpMethod:"GET",responses:{200:{bodyMapper:lt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[kt,Mt,Ut],urlParameters:[Dt,Nt],headerParameters:[Pt],serializer:Xt},an={path:"/chat/threads/{chatThreadId}/participants/:remove",httpMethod:"POST",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Ht,queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt,xt],mediaType:"json",serializer:Xt},cn={path:"/chat/threads/{chatThreadId}/participants/:add",httpMethod:"POST",responses:{201:{bodyMapper:ht},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:zt,queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt,xt],mediaType:"json",serializer:Xt},dn={path:"/chat/threads/{chatThreadId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:$t,queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt,Gt],mediaType:"json",serializer:Xt},un={path:"/chat/threads/{chatThreadId}",httpMethod:"GET",responses:{200:{bodyMapper:vt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt],serializer:Xt},ln={path:"/chat/threads/{chatThreadId}/typing",httpMethod:"POST",responses:{200:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Vt,queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt,xt],mediaType:"json",serializer:Xt},pn={path:"/chat/threads/{chatThreadId}/images",httpMethod:"POST",responses:{201:{bodyMapper:At},default:{bodyMapper:bt}},requestBody:{parameterPath:"chatImageFile",mapper:{serializedName:"chatImageFile",required:!0,type:{name:"Stream"}}},queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[{parameterPath:["options","contentType"],mapper:{defaultValue:"application/octet-stream",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},{parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},{parameterPath:["options","imageFilename"],mapper:{serializedName:"image-filename",type:{name:"String"}}}],mediaType:"binary",serializer:Xt},hn={path:"/chat/threads/{chatThreadId}/images/{imageId}/view/{imageViewType}",httpMethod:"GET",responses:{200:{bodyMapper:{type:{name:"Stream"},serializedName:"parsedResponse"}},default:{bodyMapper:bt}},queryParameters:[Ut],urlParameters:[Dt,Nt,Wt,{parameterPath:"imageViewType",mapper:{serializedName:"imageViewType",required:!0,type:{name:"String"}}}],headerParameters:[{parameterPath:"accept",mapper:{defaultValue:"application/json, image/gif, image/jpeg, image/png, image/bmp, image/tiff",isConstant:!0,serializedName:"Accept",type:{name:"String"}}}],serializer:Xt},fn={path:"/chat/threads/{chatThreadId}/images/{imageId}",httpMethod:"DELETE",responses:{204:{},default:{bodyMapper:bt}},queryParameters:[Ut],urlParameters:[Dt,Nt,Wt],headerParameters:[Pt],serializer:Xt},gn={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Ve},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Dt,Nt,Kt],headerParameters:[Pt],serializer:Xt},mn={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:it},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Dt,Nt,Kt],headerParameters:[Pt],serializer:Xt},vn={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:lt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Dt,Nt,Kt],headerParameters:[Pt],serializer:Xt};class yn{constructor(e){this.client=e}async createChatThread(e,t){return $e.withSpan("ChatApiClient.createChatThread",null!=t?t:{},(async t=>this.client.sendOperationRequest({createChatThreadRequest:e,options:t},En)))}async listChatThreads(e){return $e.withSpan("ChatApiClient.listChatThreads",null!=e?e:{},(async e=>this.client.sendOperationRequest({options:e},Tn)))}async deleteChatThread(e,t){return $e.withSpan("ChatApiClient.deleteChatThread",null!=t?t:{},(async t=>this.client.sendOperationRequest({chatThreadId:e,options:t},Cn)))}async listChatThreadsNext(e,t){return $e.withSpan("ChatApiClient.listChatThreadsNext",null!=t?t:{},(async t=>this.client.sendOperationRequest({nextLink:e,options:t},An)))}}const Sn=ze.createSerializer(t,!1),En={path:"/chat/threads",httpMethod:"POST",responses:{201:{bodyMapper:mt},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},requestBody:Jt,queryParameters:[Ut],urlParameters:[Dt],headerParameters:[Pt,xt,{parameterPath:["options","repeatabilityRequestId"],mapper:{serializedName:"repeatability-request-id",type:{name:"String"}}}],mediaType:"json",serializer:Sn},Tn={path:"/chat/threads",httpMethod:"GET",responses:{200:{bodyMapper:St},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[kt,Ut,qt],urlParameters:[Dt],headerParameters:[Pt],serializer:Sn},Cn={path:"/chat/threads/{chatThreadId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},queryParameters:[Ut],urlParameters:[Dt,Nt],headerParameters:[Pt],serializer:Sn},An={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:St},401:{bodyMapper:Ze,isError:!0},403:{bodyMapper:Ze,isError:!0},429:{bodyMapper:Ze,isError:!0},503:{bodyMapper:Ze,isError:!0}},urlParameters:[Dt,Kt],headerParameters:[Pt],serializer:Sn};class bn extends ze.ServiceClient{constructor(e,t){var n,r;if(void 0===e)throw new Error("'endpoint' cannot be null");t||(t={});const o="azsdk-js-communication-chat/1.6.0-beta.4",i=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${o}`:`${o}`;super(Object.assign(Object.assign(Object.assign({},{requestContentType:"application/json; charset=utf-8"}),t),{userAgentOptions:{userAgentPrefix:i},endpoint:null!==(r=null!==(n=t.endpoint)&&void 0!==n?n:t.baseUri)&&void 0!==r?r:"{endpoint}"})),this.endpoint=e,this.apiVersion=t.apiVersion||"2024-06-05-preview",this.chatThread=new Yt(this),this.chat=new yn(this),this.addCustomApiVersionPolicy(t.apiVersion)}addCustomApiVersionPolicy(e){if(!e)return;const t={name:"CustomApiVersionPolicy",async sendRequest(t,n){const r=t.url.split("?");if(r.length>1){const n=r[1].split("&").map((t=>t.indexOf("api-version")>-1?"api-version="+e:t));t.url=r[0]+"?"+n.join("&")}return n(t)}};this.pipeline.addPolicy(t)}}const In=(0,n(3526).KV)("communication-chat");class Rn extends Error{constructor(e){super(e),this.name="AbortError"}}var wn=n(5923);function On(e){return Boolean(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}class _n{async sendRequest(e){var t;if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);const n=new XMLHttpRequest;if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");const r=e.abortSignal;if(r){if(r.aborted)throw new Rn("The operation was aborted.");const e=()=>{n.abort()};r.addEventListener("abort",e),n.addEventListener("readystatechange",(()=>{n.readyState===XMLHttpRequest.DONE&&r.removeEventListener("abort",e)}))}Pn(n.upload,e.onUploadProgress),Pn(n,e.onDownloadProgress),n.open(e.method,e.url),n.timeout=e.timeout,n.withCredentials=e.withCredentials;for(const[t,r]of e.headers)n.setRequestHeader(t,r);n.responseType=(null===(t=e.streamResponseStatusCodes)||void 0===t?void 0:t.size)?"blob":"text";const o="function"==typeof e.body?e.body():e.body;if(function(e){return e&&"function"==typeof e.pipe}(o)||On(o))throw new Error("Streams are not supported by xhrHttpClient.");return n.send(void 0===o?null:o),"blob"===n.responseType?new Promise(((t,r)=>{!function(e,t,n,r){e.addEventListener("readystatechange",(()=>{var o,i;if(e.readyState===XMLHttpRequest.HEADERS_RECEIVED)if((null===(o=t.streamResponseStatusCodes)||void 0===o?void 0:o.has(Number.POSITIVE_INFINITY))||(null===(i=t.streamResponseStatusCodes)||void 0===i?void 0:i.has(e.status))){const r=new Promise(((n,r)=>{e.addEventListener("load",(()=>{n(e.response)})),Nn(t,e,r)}));n({request:t,status:e.status,headers:Dn(e),blobBody:r})}else e.addEventListener("load",(()=>{e.response?e.response.text().then((r=>{n({request:t,status:e.status,headers:Dn(e),bodyAsText:r})})).catch((e=>{r(e)})):n({request:t,status:e.status,headers:Dn(e)})}))}))}(n,e,t,r),Nn(e,n,r)})):new Promise((function(t,r){n.addEventListener("load",(()=>t({request:e,status:n.status,headers:Dn(n),bodyAsText:n.responseText}))),Nn(e,n,r)}))}}function Pn(e,t){t&&e.addEventListener("progress",(e=>t({loadedBytes:e.loaded})))}function Dn(e){const t=(0,wn.createHttpHeaders)(),n=e.getAllResponseHeaders().trim().split(/[\r\n]+/);for(const e of n){const n=e.indexOf(":"),r=e.slice(0,n),o=e.slice(n+2);t.set(r,o)}return t}function Nn(e,t,n){t.addEventListener("error",(()=>n(new wn.RestError(`Failed to send request to ${e.url}`,{code:wn.RestError.REQUEST_SEND_ERROR,request:e}))));const r=new Rn("The operation was aborted.");t.addEventListener("abort",(()=>n(r))),t.addEventListener("timeout",(()=>n(r)))}const kn=e=>{const t={credential:{getToken:(t,n)=>e.getToken({abortSignal:null==n?void 0:n.abortSignal})},scopes:[]};return(0,wn.bearerTokenAuthenticationPolicy)(t)};class Mn{constructor(e,t,n,r={}){this.endpoint=e,this.timeOfLastTypingRequest=void 0,this.threadId=t,this.tokenCredential=n;const o=Object.assign(Object.assign({},r),{loggingOptions:{logger:In.info}});this.client=new bn(this.endpoint,Object.assign({endpoint:this.endpoint},o));const i=kn(this.tokenCredential);this.client.pipeline.addPolicy(i),"undefined"!=typeof XMLHttpRequest&&(this.xhrClient=new bn(this.endpoint,Object.assign(Object.assign({endpoint:this.endpoint},o),{httpClient:new _n})),this.xhrClient.pipeline.addPolicy(i))}getProperties(e={}){return $e.withSpan("ChatClient-GetProperties",e,(async e=>{const t=await this.client.chatThread.getChatThreadProperties(this.threadId,e);return qe(t)}))}updateTopic(e,t={}){return $e.withSpan("ChatThreadClient-UpdateTopic",t,(async t=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,{topic:e},t)}))}updateProperties(e={}){return $e.withSpan("ChatThreadClient-UpdateProperties",e,(async t=>{await this.client.chatThread.updateChatThreadProperties(this.threadId,e,t)}))}sendMessage(e,t={}){return $e.withSpan("ChatThreadClient-SendMessage",t,(async n=>{this.timeOfLastTypingRequest=void 0;const r=await this.client.chatThread.sendChatMessage(this.threadId,((e,t)=>{const{attachments:n}=t,r=a(t,["attachments"]);let o=Object.assign(Object.assign({},e),r);return n&&(o=Object.assign(Object.assign({},o),{attachments:null==n?void 0:n.map((e=>ke(e)))})),o})(e,t),n);return r}))}getMessage(e,t={}){return $e.withSpan("ChatThreadClient-GetMessage",t,(async t=>{const n=await this.client.chatThread.getChatMessage(this.threadId,e,t);return Le(n)}))}listMessagesPage(e){return u(this,arguments,(function*(e,t={}){if(!e.continuationToken){const n=yield d(this.client.chatThread.listChatMessages(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield d(n.value.map(Le,this)))}for(;e.continuationToken;){const n=yield d(this.client.chatThread.listChatMessagesNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield d(n.value.map(Le,this))}}))}listMessagesAll(e){return u(this,arguments,(function*(){var t,n,r,o;try{for(var i,s=!0,a=p(this.listMessagesPage({},e));!(t=(i=yield d(a.next())).done);s=!0){o=i.value,s=!1;const e=o;yield d(yield*l(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield d(r.call(a)))}finally{if(n)throw n.error}}}))}listMessages(e={}){const{span:t,updatedOptions:n}=$e.startSpan("ChatThreadClient-ListMessages",e);try{const e=this.listMessagesAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listMessagesPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}deleteMessage(e,t={}){return $e.withSpan("ChatThreadClient-DeleteMessage",t,(async t=>{await this.client.chatThread.deleteChatMessage(this.threadId,e,t)}))}async updateMessage(e,t={}){return $e.withSpan("ChatThreadClient-UpdateMessage",t,(async n=>{await this.client.chatThread.updateChatMessage(this.threadId,e,(e=>{const{attachments:t}=e,n=a(e,["attachments"]);let r=Object.assign({},n);return t&&(r=Object.assign(Object.assign({},r),{attachments:null==t?void 0:t.map((e=>ke(e)))})),r})(t),n)}))}async addParticipants(e,t={}){return $e.withSpan("ChatThreadClient-AddParticipants",t,(async t=>{var n,r;return await this.client.chatThread.addChatParticipants(this.threadId,(n=e,{participants:null===(r=n.participants)||void 0===r?void 0:r.map((e=>Ne(e)))}),t)}))}listParticipantsPage(e){return u(this,arguments,(function*(e,t={}){if(!e.continuationToken){const n=yield d(this.client.chatThread.listChatParticipants(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield d(n.value.map(Me,this)))}for(;e.continuationToken;){const n=yield d(this.client.chatThread.listChatParticipantsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield d(n.value.map(Me,this))}}))}listParticipantsAll(e){return u(this,arguments,(function*(){var t,n,r,o;try{for(var i,s=!0,a=p(this.listParticipantsPage({},e));!(t=(i=yield d(a.next())).done);s=!0){o=i.value,s=!1;const e=o;yield d(yield*l(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield d(r.call(a)))}finally{if(n)throw n.error}}}))}listParticipants(e={}){const{span:t,updatedOptions:n}=$e.startSpan("ChatThreadClient-ListParticipants",e);try{const e=this.listParticipantsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listParticipantsPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}async removeParticipant(e,t={}){return $e.withSpan("ChatThreadClient-RemoveParticipant",t,(async t=>{await this.client.chatThread.removeChatParticipant(this.threadId,Pe(e),t)}))}async sendTypingNotification(e={}){return $e.withSpan("ChatThreadClient-SendTypingNotification",e,(async e=>{const t=new Date,{senderDisplayName:n}=e,r=a(e,["senderDisplayName"]);return this.canPostTypingNotification(t)?(this.timeOfLastTypingRequest=t,await this.client.chatThread.sendTypingNotification(this.threadId,Object.assign({sendTypingNotificationRequest:{senderDisplayName:n}},r)),!0):(In.info(`Typing Notification NOT Send. [thread_id=${this.threadId}]`),!1)}))}async sendReadReceipt(e,t={}){return $e.withSpan("ChatThreadClient-SendReadReceipt",t,(async t=>{await this.client.chatThread.sendChatReadReceipt(this.threadId,e,t)}))}listReadReceiptsPage(e){return u(this,arguments,(function*(e,t={}){if(!e.continuationToken){const n=yield d(this.client.chatThread.listChatReadReceipts(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield d(n.value.map(Fe,this)))}for(;e.continuationToken;){const n=yield d(this.client.chatThread.listChatReadReceiptsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield d(n.value.map(Fe,this))}}))}listReadReceiptsAll(e){return u(this,arguments,(function*(){var t,n,r,o;try{for(var i,s=!0,a=p(this.listReadReceiptsPage({},e));!(t=(i=yield d(a.next())).done);s=!0){o=i.value,s=!1;const e=o;yield d(yield*l(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield d(r.call(a)))}finally{if(n)throw n.error}}}))}listReadReceipts(e={}){const{span:t,updatedOptions:n}=$e.startSpan("ChatThreadClient-ListChatReadReceipts",e);try{const e=this.listReadReceiptsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listReadReceiptsPage(e,n)}}catch(e){throw t.setStatus({status:"error",error:e}),e}finally{t.end()}}canPostTypingNotification(e){return!(this.timeOfLastTypingRequest&&e.getTime()-this.timeOfLastTypingRequest.getTime()<8e3)||(In.info(`Typing interval check failed. [last_request=${this.timeOfLastTypingRequest}]`),!1)}async uploadImage(e,t,n,r={}){let o={};return void 0!==n&&(o="number"==typeof n?Object.assign(Object.assign({},r),{imageBytesLength:n}):Object.assign(Object.assign({},r),n)),$e.withSpan("ChatThreadClient-UploadImage",o,(async n=>{let r;if(this.xhrClient&&(!this.supportsReadableStream()&&On(e)||!On(e)))r=await this.xhrClient.chatThread.uploadChatImage(this.threadId,On(e)?await this.getArrayBufferFromReadableStream(e):e,Object.assign({imageFilename:t},n));else{let o=e;("function"==typeof Blob||"object"==typeof Blob)&&e instanceof Blob?o=await this.getArrayBufferFromBlob(e):On(e)&&(o=await this.getArrayBufferFromReadableStream(e)),r=await this.client.chatThread.uploadChatImage(this.threadId,o,Object.assign({imageFilename:t},n))}return r}))}deleteImage(e,t={}){return $e.withSpan("ChatThreadClient-DeleteImage",t,(async t=>{await this.client.chatThread.deleteChatImage(this.threadId,e,t)}))}supportsReadableStream(){let e=!1;const t=new Request("",{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}async getArrayBufferFromReadableStream(e){const t=await new Response(e).arrayBuffer();return new Uint8Array(t)}async getArrayBufferFromBlob(e){return new Uint8Array(await e.arrayBuffer())}}var Un=n(7007),xn=n(5777),Ln=n(781);class jn{constructor(e,t,n={}){this.endpoint=e,this.signalingClient=void 0,this.emitter=new Un.EventEmitter,this.isRealtimeNotificationsStarted=!1,this.tokenCredential=t;const r=Object.assign(Object.assign({},n),{loggingOptions:{logger:In.info}});this.client=new bn(this.endpoint,Object.assign({endpoint:this.endpoint},r));const o=kn(this.tokenCredential);this.client.pipeline.addPolicy(o),this.clientOptions=Object.assign({},n),this.clientOptions.signalingClientOptions=Object.assign(Object.assign({},this.clientOptions.signalingClientOptions),{resourceEndpoint:this.endpoint,gatewayApiVersion:this.client.apiVersion}),this.signalingClient=((e,t,n)=>{var r,o,i,s;return new Ln.CommunicationSignalingClient(e,t,{resourceEndpoint:null!==(r=null==n?void 0:n.resourceEndpoint)&&void 0!==r?r:void 0,gatewayApiVersion:null!==(o=null==n?void 0:n.gatewayApiVersion)&&void 0!==o?o:void 0,additionalPolicies:null!==(i=null==n?void 0:n.additionalPolicies)&&void 0!==i?i:void 0,userAgentOptions:null!==(s=null==n?void 0:n.userAgentOptions)&&void 0!==s?s:void 0})})(t,In,this.clientOptions.signalingClientOptions)}getChatThreadClient(e){return new Mn(this.endpoint,e,this.tokenCredential,this.clientOptions)}async createChatThread(e,t={}){return $e.withSpan("ChatClient-CreateChatThread",t,(async n=>{var r,o;n.idempotencyToken=null!==(r=n.idempotencyToken)&&void 0!==r?r:(0,xn.randomUUID)();const i=(e=>{const{participants:t,idempotencyToken:n}=e,r=a(e,["participants","idempotencyToken"]);return Object.assign({repeatabilityRequestId:n},r)})(n);return(e=>{const{chatThread:t}=e,n=a(e,["chatThread"]);return t?Object.assign(Object.assign({},n),{chatThread:qe(t)}):Object.assign({},n)})(await this.client.chat.createChatThread({topic:e.topic,participants:null===(o=t.participants)||void 0===o?void 0:o.map((e=>Ne(e))),metadata:t.metadata,retentionPolicy:t.retentionPolicy},i))}))}listChatThreadsPage(e){return u(this,arguments,(function*(e,t={}){if(!e.continuationToken){const n=yield d(this.client.chat.listChatThreads(t));e.continuationToken=n.nextLink,n.value&&(yield yield d(n.value))}for(;e.continuationToken;){const n=yield d(this.client.chat.listChatThreadsNext(e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield d(n.value)}}))}listChatThreadsAll(e){return u(this,arguments,(function*(){var t,n,r,o;try{for(var i,s=!0,a=p(this.listChatThreadsPage({},e));!(t=(i=yield d(a.next())).done);s=!0){o=i.value,s=!1;const e=o;yield d(yield*l(p(e)))}}catch(e){n={error:e}}finally{try{s||t||!(r=a.return)||(yield d(r.call(a)))}finally{if(n)throw n.error}}}))}listChatThreads(e={}){const{span:t,updatedOptions:n}=$e.startSpan("ChatClient-ListChatThreads",e);try{const e=this.listChatThreadsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listChatThreadsPage(e,n)}}catch(e){throw t.setStatus({error:e,status:"error"}),e}finally{t.end()}}async deleteChatThread(e,t={}){return $e.withSpan("ChatClient-DeleteChatThread",t,(async t=>{await this.client.chat.deleteChatThread(e,t)}))}async startRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted||(this.isRealtimeNotificationsStarted=!0,await this.signalingClient.start(),this.subscribeToSignalingEvents())}async stopRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted=!1,await this.signalingClient.stop(),this.emitter.removeAllListeners()}on(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");if(!this.isRealtimeNotificationsStarted&&"realTimeNotificationConnected"!==e&&"realTimeNotificationDisconnected"!==e)throw new Error("You must call startRealtimeNotifications before you can subscribe to events.");this.emitter.on(e,t)}off(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.emitter.removeListener(e,t)}subscribeToSignalingEvents(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.signalingClient.on("connectionChanged",(e=>{2===e?this.emitter.emit("realTimeNotificationConnected"):3===e&&this.emitter.emit("realTimeNotificationDisconnected")})),this.signalingClient.on("chatMessageReceived",(e=>{this.emitter.emit("chatMessageReceived",e)})),this.signalingClient.on("chatMessageEdited",(e=>{this.emitter.emit("chatMessageEdited",e)})),this.signalingClient.on("chatMessageDeleted",(e=>{this.emitter.emit("chatMessageDeleted",e)})),this.signalingClient.on("typingIndicatorReceived",(e=>{this.emitter.emit("typingIndicatorReceived",e)})),this.signalingClient.on("readReceiptReceived",(e=>{this.emitter.emit("readReceiptReceived",e)})),this.signalingClient.on("chatThreadCreated",(e=>{this.emitter.emit("chatThreadCreated",e)})),this.signalingClient.on("chatThreadDeleted",(e=>{this.emitter.emit("chatThreadDeleted",e)})),this.signalingClient.on("chatThreadPropertiesUpdated",(e=>{this.emitter.emit("chatThreadPropertiesUpdated",e)})),this.signalingClient.on("participantsAdded",(e=>{this.emitter.emit("participantsAdded",e)})),this.signalingClient.on("participantsRemoved",(e=>{this.emitter.emit("participantsRemoved",e)})),this.signalingClient.on("streamingChatMessageStarted",(e=>{this.emitter.emit("streamingChatMessageStarted",e)})),this.signalingClient.on("streamingChatMessageChunkReceived",(e=>{this.emitter.emit("streamingChatMessageChunkReceived",e)}))}}class qn extends Error{}qn.prototype.name="InvalidTokenError";const Fn=e=>{const{exp:t}=function(e,t){if("string"!=typeof e)throw new qn("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new qn(`Invalid token specified: missing part #${n+1}`);let o;try{o=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return atob(t)}}(r)}catch(e){throw new qn(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(o)}catch(e){throw new qn(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}(e);return{token:e,expiresOnTimestamp:1e3*t}},Gn={token:"",expiresOnTimestamp:-10};class Bn{constructor(e){this.expiringSoonIntervalInMs=6e5,this.refreshAfterLifetimePercentage=.5,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.disposed=!1;const{tokenRefresher:t,token:n,refreshProactively:r}=e;this.refresh=t,this.currentToken=n?Fn(n):Gn,this.refreshProactively=null!=r&&r,this.refreshProactively&&this.scheduleRefresh()}async getToken(e){if(!this.isTokenExpiringSoon(this.currentToken))return this.currentToken;if(!this.isTokenValid(this.currentToken)){const t=this.updateTokenAndReschedule(null==e?void 0:e.abortSignal);await t}return this.currentToken}dispose(){this.disposed=!0,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.currentToken=Gn,this.activeTimeout&&clearTimeout(this.activeTimeout)}async updateTokenAndReschedule(e){if(this.activeTokenUpdating)return this.activeTokenUpdating;this.activeTokenUpdating=this.refreshTokenAndReschedule(e);try{await this.activeTokenUpdating}finally{this.activeTokenUpdating=null}}async refreshTokenAndReschedule(e){const t=await this.refreshToken(e);if(!this.isTokenValid(t))throw new Error("The token returned from the tokenRefresher is expired.");this.currentToken=t,this.refreshProactively&&this.scheduleRefresh()}async refreshToken(e){try{return this.activeTokenFetching||(this.activeTokenFetching=this.refresh(e)),Fn(await this.activeTokenFetching)}finally{this.activeTokenFetching=null}}scheduleRefresh(){if(this.disposed)return;this.activeTimeout&&clearTimeout(this.activeTimeout);const e=this.currentToken.expiresOnTimestamp-Date.now();let t=null;t=this.isTokenExpiringSoon(this.currentToken)?e*this.refreshAfterLifetimePercentage:e-this.expiringSoonIntervalInMs,this.activeTimeout=setTimeout((()=>this.updateTokenAndReschedule()),t)}isTokenValid(e){return e&&Date.now()<e.expiresOnTimestamp}isTokenExpiringSoon(e){return!e||Date.now()>=e.expiresOnTimestamp-this.expiringSoonIntervalInMs}}class Hn{constructor(e){this.token=e}async getToken(){return this.token}dispose(){}}class zn{constructor(e){this.disposed=!1,this.tokenCredential="string"==typeof e?new Hn(Fn(e)):new Bn(e)}async getToken(e){this.throwIfDisposed();const t=await this.tokenCredential.getToken(e);return this.throwIfDisposed(),t}dispose(){this.disposed=!0,this.tokenCredential.dispose()}throwIfDisposed(){if(this.disposed)throw new Error("User credential is disposed")}}const $n={id:"",environmentUrl:"",token:""},Vn={displayName:""},Wn={errorEventSubscriberInstance:void 0,setInstance:e=>{Wn.errorEventSubscriberInstance=e},notifyErrorEvent:e=>{void 0!==Wn.errorEventSubscriberInstance&&Wn.errorEventSubscriberInstance.notifyErrorEvent(e)}};var Kn;!function(e){e.EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED="EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED",e.HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED="HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED",e.NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED="NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED",e.MESSAGE_POLLING_FAILED="MESSAGE_POLLING_FAILED",e.INGRESS_MESSAGE_INVALID_JSON="INGRESS_MESSAGE_INVALID_JSON",e.EGRESS_ATTACHMENT_UPLOAD_FAILED="EGRESS_ATTACHMENT_UPLOAD_FAILED",e.EGRESS_SEND_MESSAGE_FAILED="EGRESS_SEND_MESSAGE_FAILED",e.ADAPTER_INIT_TOKEN_MISSING_ERROR="ADAPTER_INIT_TOKEN_MISSING_ERROR",e.ADAPTER_INIT_THREAD_ID_MISSING_ERROR="ADAPTER_INIT_THREAD_ID_MISSING_ERROR",e.ADAPTER_INIT_EXCEPTION="ADAPTER_INIT_EXCEPTION",e.ADAPTER_RECONNECT_FAILED="ADAPTER_RECONNECT_FAILED",e.MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED="MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED"}(Kn||(Kn={}));const Jn=(e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_POLLING_SKIPPED,Description:t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})},Yn=(e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_SKIP_POLLED_MESSAGE,Description:"ACS Adapter: Skipping polled message, already processed",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t,ACSRequesterUserId:e(fe.UserId)})},Xn=(e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_PROCESSING_POLLED_MESSAGE,Description:"ACS Adapter: Processing polled message "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t,ACSRequesterUserId:e(fe.UserId)})},Qn=(e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.CACHE_POLLED_HISTORY_MESSAGE,Description:"ACS Adapter: Cache polled history message",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId),ChatMessageId:t})},Zn=(e,t)=>{const n="text"===t.type?t.sender:t.content.initiator;Se.logEvent(ge.DEBUG,{Event:Ee.PROCESS_CACHED_PAGED_HISTORY_MESSAGE,Description:`ACS Adapter: Process cached history message with id ${t.id}`,MessageSender:n.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t.id})},er=(e,t)=>{const n="sender"in t?t.sender:"initiator"in t.content.initiator?t.content.initiator:void 0;Se.logEvent(ge.DEBUG,{Event:Ee.PROCESS_CACHED_HISTORY_MESSAGE,Description:`ACS Adapter: Process polled cached history message with Id ${t.id}`,MessageSender:n&&n.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:t.id})},tr=e=>{Se.logEvent(ge.DEBUG,{Event:Ee.PROCESS_CACHED_NEW_MESSAGE,Description:`ACS Adapter: Process cached new message with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})},nr=e=>{Se.logEvent(ge.DEBUG,{Event:Ee.PROCESS_CACHED_NEW_MESSAGE,Description:"ACS Adapter: Process cached new participants removed event",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:e.removedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsRemoved.map((e=>e.id.communicationUserId))})},rr=e=>{Se.logEvent(ge.DEBUG,{Event:Ee.UNSUPPORTED_MESSAGE_TYPE,Description:`Message with ${e.id} has unsupported message type: ${e.type}`,TimeStamp:(new Date).toISOString()})},or=e=>{Se.logEvent(ge.ERROR,{Event:Ee.FILEMANAGER_DOWNLOAD_FILE_FAILED,Description:"Downloading attachment for message failed.",ExceptionDetails:e})},ir=(e,t,n,r)=>{Se.logEvent(ge.ERROR,{Event:Ee.ACS_SDK_START_INIT_ERROR,ChatThreadId:e,ACSRequesterUserId:t,Description:n,ExceptionDetails:r})};class sr extends N{constructor(e,t){super(e),this.detail=t}}class ar extends pe{raiseCustomEvent(e,t){const n=t?{payload:t}:void 0;let r=null;try{r=new sr(e,n)}catch(e){}this.dispatchEvent(r)}constructor(){super(),this.handleOnline=()=>c(this,void 0,void 0,(function*(){this.raiseCustomEvent("online")})),this.handleOffline=()=>c(this,void 0,void 0,(function*(){return this.raiseCustomEvent("offline")})),this.handleLeaveChat=()=>c(this,void 0,void 0,(function*(){return this.raiseCustomEvent("acs-adapter-leavechat")})),this.handleAcsChatOnline=()=>c(this,void 0,void 0,(function*(){return this.raiseCustomEvent("acschat-online")})),this.handleBeforeunload=()=>{this.raiseCustomEvent("beforeunload")},this.handleError=e=>c(this,void 0,void 0,(function*(){this.raiseCustomEvent("error",e)})),this.handleLoadMoreHistoryMessages=()=>c(this,void 0,void 0,(function*(){this.raiseCustomEvent("acs-adapter-loadnextpage")})),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),window.addEventListener("beforeunload",this.handleBeforeunload),window.addEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.addEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}end(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("beforeunload",this.handleBeforeunload),window.removeEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.removeEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}}var cr,dr;le(ar.prototype,"online"),le(ar.prototype,"offline"),le(ar.prototype,"error"),le(ar.prototype,"beforeunload"),le(ar.prototype,"leavechat"),function(e){e.Message="message",e.Typing="typing"}(cr||(cr={})),function(e){e.Bot="bot",e.Channel="channel",e.Unknown="",e.User="user"}(dr||(dr={}));const ur="streaminfo",lr={},pr=JSON.parse('{"rE":"0.0.1-beta.5","El":{"oY":"1.6.0-beta.5"}}'),hr={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${pr.rE} azsdk-js-communication-chat/${pr.El.oY}`}}};const fr={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${pr.rE} azsdk-js-communication-chat/${pr.El.oY}`}}};function gr(e){return function(...e){return s((e=>e.egress),((e,t)=>Object.assign(Object.assign({},e),{egress:t})))(...e)}(...e&&e.egressMiddleware?e.egressMiddleware:[],function(){return({getState:e})=>t=>n=>c(this,void 0,void 0,(function*(){var r,o;if(n.type!==cr.Message||!(n.attachments||[]).length)return t(n);const{attachments:i}=n,s=e(fe.FileManager),a=e(fe.EventManager);n.channelData=Object.assign(Object.assign({},n.channelData),{uploadedFiles:[]}),Se.logEvent(ge.ERROR,{Event:Ee.FILEMANAGER_UPLOAD_FILE_FAILED,Description:"Sending upload file request",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)});try{const e=yield s.uploadFiles(i);n.channelData.uploadedFiles=e}catch(t){Se.logEvent(ge.ERROR,{Event:Ee.FILEMANAGER_UPLOAD_FILE_FAILED,Description:"Uploading file failed",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ExceptionDetails:t}),Wn.notifyErrorEvent({ErrorType:Kn.EGRESS_ATTACHMENT_UPLOAD_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:n.timestamp,AcsChatDetails:{ThreadId:e(fe.ThreadId),RequesterUserId:e(fe.UserId)},AdditionalParams:{activity:n},CorrelationVector:null===(o=null===(r=null==t?void 0:t.request)||void 0===r?void 0:r.headers)||void 0===o?void 0:o.get("ms-cv")}),a.handleError(t)}t(n)}))}(),function(){return({getState:e})=>t=>n=>c(this,void 0,void 0,(function*(){var r,o,i,s,a,c,d,u,l,p;if(n.type!==cr.Message)return t(n);const h=e(fe.ChatThreadClient),f=e(fe.UserDisplayName),g=e(fe.EventManager),m=e(fe.FileManager);if(!h){const t="ACS Adapter: Failed to egress message without an active chatThreadClient.";throw Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_EGRESS_FAILED,Description:t,ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid}),new Error(t)}Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_EGRESS_MESSAGE,Description:"Convert activity to egress ACS message",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid});const{text:v,value:y}=n,S=Date.now().toString();n.clientmessageid=S;let E=v||"";const T={},C=null===(o=null===(r=n.channelData)||void 0===r?void 0:r.uploadedFiles)||void 0===o?void 0:o.map((e=>null==e?void 0:e.fileId)),A=C?m.createFileIdProperty(C):void 0,b=null===(s=null===(i=n.channelData)||void 0===i?void 0:i.uploadedFiles)||void 0===s?void 0:s.map((e=>null==e?void 0:e.metadata)),I=b?m.createFileMetadataProperty(b):void 0,R=m.createBotAttachment(Object.assign(Object.assign({},A),I));R&&0!==Object.keys(R).length&&(T.attachments=[R]);const w=null===(a=n.channelData)||void 0===a?void 0:a.tags,O=w?{tags:w}:void 0;let _=null===(c=n.channelData)||void 0===c?void 0:c.metadata;(null===(d=n.channelData)||void 0===d?void 0:d.clientActivityID)&&(_=Object.assign(Object.assign({},_),{clientActivityId:n.channelData.clientActivityID.toString()})),y&&(T.value=y),n.attachmentLayout&&(T.attachmentLayout=n.attachmentLayout),"{}"!==JSON.stringify(T)&&(v&&(T.text=v),E=JSON.stringify(T),_=Object.assign(Object.assign({},_),{"microsoft.azure.communication.chat.bot.contenttype":"azurebotservice.adaptivecard"}));const P=Object.assign(Object.assign({},hr),{senderDisplayName:f||void 0});(_||w||C)&&(P.metadata=Object.assign(Object.assign(Object.assign(Object.assign({},_),O),A),I));const D={content:E};try{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_EGRESS_SEND_MESSAGE,Description:"Convert activity to egress ACS message",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid});const t=yield h.sendMessage(D,P);N=t.id,k=n.channelData.clientActivityID,lr[N]=k,Se.logEvent(ge.DEBUG,{Event:Ee.ACS_ADAPTER_SEND_MESSAGE_SUCCESS,Description:`Adapter: Successfully sent a message with messageid ${t.id}.`,CustomProperties:D,ACSRequesterUserId:e(fe.UserId),TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid,ClientActivityId:null==n?void 0:n.channelData.clientActivityID})}catch(t){const r=null==t?void 0:t.request;Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_SEND_MESSAGE_FAILED,Description:"Send message failed.",CustomProperties:D,ACSRequesterUserId:e(fe.UserId),TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid,ClientActivityId:null==n?void 0:n.channelData.clientActivityID,ExceptionDetails:t}),Wn.notifyErrorEvent({StatusCode:null===(u=t.response)||void 0===u?void 0:u.status,ErrorType:Kn.EGRESS_SEND_MESSAGE_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:e(fe.ThreadId),RequesterUserId:e(fe.UserId)},AdditionalParams:{activity:n,sendMessageRequest:D,sendMessageOptions:P,httpRequest:r},CorrelationVector:null===(p=null===(l=null==t?void 0:t.request)||void 0===l?void 0:l.headers)||void 0===p?void 0:p.get("ms-cv")}),g.handleError(t)}var N,k}))}(),function(){return({getState:e})=>t=>n=>c(this,void 0,void 0,(function*(){var r,o,i;if(n.type!==cr.Typing)return t(n);const s=e(fe.ChatThreadClient),a=e(fe.AdapterOptions);if(!s){const t="ACS Adapter: Failed to egress typing activity with an undefined chatThreadClient.";throw Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_EGRESS_TYPING_FAILED,Description:t,ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)}),new Error(t)}const c=(null==a?void 0:a.enableSenderDisplayNameInTypingNotification)?Object.assign(Object.assign({},fr),{senderDisplayName:e(fe.UserDisplayName)}):Object.assign({},fr);try{Se.logEvent(ge.DEBUG,{Event:Ee.ACS_ADAPTER_EGRESS_TYPING_SENDING_REQUEST,Description:"ACS Adapter: Request sending a typing indication",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)}),yield s.sendTypingNotification(c),Se.logEvent(ge.DEBUG,{Event:Ee.ACS_ADAPTER_INGRESS_TYPING_SUCCESS,Description:"ACS Adapter: Successfully sent a typing indication",ACSRequesterUserId:e(fe.UserId),TimeStamp:n.timestamp,ChatThreadId:e(fe.ThreadId)})}catch(t){const s=null==t?void 0:t.request;Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_SEND_MESSAGE_FAILED,Description:"Send message failed.",CustomProperties:c,ACSRequesterUserId:e(fe.UserId),TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ChatMessageId:n.messageid,ClientActivityId:null==n?void 0:n.channelData.clientActivityID,ExceptionDetails:t}),Wn.notifyErrorEvent({StatusCode:null===(r=t.response)||void 0===r?void 0:r.status,ErrorType:Kn.EGRESS_SEND_MESSAGE_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:e(fe.ThreadId),RequesterUserId:e(fe.UserId)},AdditionalParams:{activity:n,httpRequest:s},CorrelationVector:null===(i=null===(o=null==t?void 0:t.request)||void 0===o?void 0:o.headers)||void 0===i?void 0:i.get("ms-cv")})}}))}())}const mr="ACS_CHANNEL",vr="joined",yr="left";var Sr;!function(e){e.THREAD="Thread",e.ERROR="Error"}(Sr||(Sr={}));const Er="microsoft.azure.communication.chat.bot.contenttype",Tr="azurebotservice.adaptivecard";var Cr;!function(e){e[e.READ=0]="READ",e[e.WRITE=1]="WRITE"}(Cr||(Cr={}));const Ar=e=>"text"===e||"participantAdded"===e||"participantRemoved"===e,br=e=>"participantsAdded"in e,Ir=e=>"participantsRemoved"in e,Rr=e=>new Promise((t=>setTimeout(t,e))),wr=(e,t,n)=>{const r=null==e?void 0:e.get(t);if(r){const e=r.content===n.content,t=!Pr(r.updatedOn,n.updatedOn),o=Pr(r.deletedOn,n.deletedOn),i=r.fileIds?new Set(r.fileIds):void 0,s=n.fileIds?new Set(n.fileIds):void 0,a=!i&&!s||i.size===s.size&&[...i].every((e=>s.has(e)));return e&&!t&&a&&o}return!1},Or=(e,t,n)=>{const r=null==e?void 0:e.get(t);if(r){let e=!1;return n.addedParticipants?e=_r(n.addedParticipants,r.addedParticipants):n.removedParticipants&&(e=_r(n.removedParticipants,r.removedParticipants)),e}return!1},_r=(e,t)=>{if(e.length!==t.length)return!1;const n=new Map;for(const e of t){const t="communicationUserId"in e.id?e.id.communicationUserId:JSON.stringify(e.id);n.set(t,e)}for(const t of e){const e="communicationUserId"in t.id?t.id.communicationUserId:JSON.stringify(t.id),r=n.get(e);if(!r||t.displayName!==r.displayName||!Pr(t.shareHistoryTime,r.shareHistoryTime))return!1}return!0},Pr=(e,t)=>!e&&!t||!(!e||!t)&&kr(e)===kr(t),Dr=e=>{var t,n,r;if(!(null===(t=e.content)||void 0===t?void 0:t.initiator))throw new Error("Message does not contain initiator information");if(!(null===(n=e.content)||void 0===n?void 0:n.participants))throw new Error("Message does not contain participants information");return Mr((null===(r=e.content)||void 0===r?void 0:r.initiator).communicationUserId,e.createdOn,e.content.participants)},Nr=e=>{if(br(e))return Mr(e.addedBy.id.communicationUserId,e.addedOn,e.participantsAdded);if(Ir(e))return Mr(e.removedBy.id.communicationUserId,e.removedOn,e.participantsRemoved);throw new Error("Event does not contain participants information")},kr=e=>e.toISOString().substring(0,19),Mr=(e,t,n)=>{const r=n.map((e=>e.id.communicationUserId)).sort().join("_"),o=Ur(r);return`${kr(t)}_${e}_${o}`},Ur=e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return Math.abs(t).toString(16)},xr=e=>{const t=we(e);switch(t.kind){case"communicationUser":return t.communicationUserId;case"microsoftTeamsUser":return t.microsoftTeamsUserId;case"phoneNumber":return t.phoneNumber;case"unknown":return t.id}},Lr=(e,t,n,r)=>c(void 0,void 0,void 0,(function*(){try{let r;return r=t?e.map(((e,n)=>({fileId:e,metadata:t[n]}))):e.map((e=>({fileId:e}))),yield n.downloadFiles(r)}catch(e){or(e),r.handleError(e)}})),jr=e=>c(void 0,void 0,void 0,(function*(){return Promise.all(e.map((e=>c(void 0,void 0,void 0,(function*(){if(e){const t=yield(e=>new Promise((t=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.readAsDataURL(e)})))(e);return{contentType:e.type,contentUrl:t,name:e.name,thumbnailUrl:e.type.match("(image|video|audio).*")?t:void 0}}})))))})),qr=e=>e.map((e=>null==e?void 0:e.size)),Fr=(e,t,n,r,o)=>{const i=wr(e,t.id,{content:t.message,deletedOn:t.deletedOn,updatedOn:t.editedOn,fileIds:null==r?void 0:r.getFileIds(t.metadata)});return i||(Se.logEvent(ge.INFO,{Event:o,Description:"ACS Adapter: Processing message",MessageSender:t.sender.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:n(fe.ThreadId),ChatMessageId:t.id}),e.set(t.id,{content:t.message,updatedOn:t.editedOn,deletedOn:t.deletedOn,fileIds:null==r?void 0:r.getFileIds(t.metadata)})),i},Gr=(e,t,n)=>{switch(e.type){case"text":return wr(t,e.id,{content:e.content.message,updatedOn:e.editedOn,deletedOn:e.deletedOn,fileIds:null==n?void 0:n.getFileIds(e.metadata)});case"participantAdded":{const n=Dr(e);return Or(t,n,{addedParticipants:e.content.participants})}case"participantRemoved":{const n=Dr(e);return Or(t,n,{removedParticipants:e.content.participants})}default:return rr(e),!1}},Br=(e,t,n)=>{switch(e.type){case"text":t.set(e.id,{content:e.content.message,updatedOn:e.editedOn,deletedOn:e.deletedOn,fileIds:null==n?void 0:n.getFileIds(e.metadata)});break;case"participantAdded":{const n=Dr(e);t.set(n,{addedParticipants:e.content.participants});break}case"participantRemoved":{const n=Dr(e);t.set(n,{removedParticipants:e.content.participants});break}default:rr(e)}};var Hr=n(7162),zr=n.n(Hr);function $r(){return zr()().toString(36).substr(2)}function Vr(e,t,n,r=!0,o){var i,s,a,d;return c(this,void 0,void 0,(function*(){const c=xr(t.sender);let u,l,p,h,f,g;if((t.metadata?t.metadata[`${Er}`]:void 0)===Tr)try{const e=JSON.parse(t.content);n&&e.attachments&&(u=[],u=u.concat(e.attachments),g=e.attachmentLayout),r&&(h=null==e?void 0:e.value),f=null==e?void 0:e.suggestedActions,p=null==e?void 0:e.text}catch(n){const r="Valid JSON object is expected.";if(((e,t,n)=>{Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_INGRESS_FAILED,Description:t,ACSRequesterUserId:e.currentUserId,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.messageId,ExceptionDetails:n})})(t,r,n),Wn.notifyErrorEvent({ErrorType:Kn.INGRESS_MESSAGE_INVALID_JSON,ErrorMessage:n.message,ErrorStack:n.stack,ErrorDetails:null==n?void 0:n.details,Timestamp:t.createdOn.toISOString(),AcsChatDetails:{MessageId:t.messageId,ThreadId:t.threadId,MessageSenderId:t.sender.communicationUserId,RequesterUserId:t.currentUserId},AdditionalParams:{SenderDisplayName:t.senderDisplayName,MessageText:t.content,Metadata:t.metadata}}),o){const n=new Error(r);n.details={type:"MESSAGE_PARSING_FAILED",actualMessage:t.content},e.handleError(n)}}else p=t.content;t.files&&!u&&(u=yield jr(t.files),l=qr(t.files));let m=(v=t.messageId,lr[v]);var v;let y;void 0===m&&(m=null===(i=t.metadata)||void 0===i?void 0:i.clientActivityId),t.sequenceId&&Math.sign(parseInt(t.sequenceId))>0&&(y=parseInt(t.sequenceId));const S={attachments:u,channelId:mr,channelData:{"webchat:sequence-id":y,attachmentSizes:l,fromUserId:c,clientActivityID:m,messageId:t.messageId,state:"sent",tags:null===(s=t.metadata)||void 0===s?void 0:s.tags,metadata:t.metadata,additionalMessageMetadata:{editedOn:null===(a=t.editedOn)||void 0===a?void 0:a.toISOString(),deletedOn:null===(d=t.deletedOn)||void 0===d?void 0:d.toISOString()}},conversation:{id:t.threadId},from:{id:c,name:t.senderDisplayName?t.senderDisplayName:void 0,role:c===t.currentUserId?dr.User:dr.Bot},id:t.messageId?t.messageId:$r(),text:p,timestamp:new Date(t.createdOn).toISOString(),type:cr.Message,messageid:t.messageId?t.messageId:"",value:h,suggestedActions:f,attachmentLayout:g};return t.streamingMetadata&&(S.channelData.streamType=t.streamingMetadata.streamingMessageType,S.channelData.streamId=t.messageId,S.entities=[{type:ur,streamType:t.streamingMetadata.streamingMessageType,streamId:t.messageId}]),S}))}const Wr=(e,t,n,r)=>{var o,i;return{messageId:e.id,content:null===(o=e.content)||void 0===o?void 0:o.message,createdOn:e.createdOn,editedOn:e.editedOn,deletedOn:e.deletedOn,sender:e.sender,senderDisplayName:e.senderDisplayName,currentUserId:n,threadId:t,metadata:e.metadata,tags:null===(i=e.metadata)||void 0===i?void 0:i.tags,sequenceId:e.id,files:r}};const Kr=(e,t,n)=>c(void 0,void 0,void 0,(function*(){const{chatMessage:r,options:o}=e.detail.payload;let i,s;const a=n(fe.EventManager),d=n(fe.FileManager);try{s=d.getFileIds(r.metadata);const e=d.getFileMetadata(r.metadata);if(s){const u=Jr(t,r.id,s,e);if((null==u?void 0:u.length)<=0)return;Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: attachments download queued: "+u.map((e=>e.fileId)).join(","),ACSRequesterUserId:n(fe.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),i=yield((e,t,n,r,o)=>c(void 0,void 0,void 0,(function*(){try{if(r){o||(o=9e4);const n=new Promise(((e,t)=>{setTimeout((()=>{t(new Error("Attachment download timed out."))}),o)}));return Promise.race([t.downloadFiles(e),n])}return yield t.downloadFiles(e)}catch(e){or(e),n.handleError(e)}})))(u,d,this,null==o?void 0:o.shouldFileAttachmentDownloadTimeout,null==o?void 0:o.fileAttachmentDownloadTimeout),Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: attachments downloaded: ",ACSRequesterUserId:n(fe.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),a.raiseCustomEvent("acs-attachment-downloaded",{chatMessage:r,files:i})}}catch(e){Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_ATTACHMENT_DOWNLOAD_ERROR,Description:"ACS Adapter: Failed to download attachments",ACSRequesterUserId:n(fe.UserId),MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id,ExceptionDetails:e}),(null==o?void 0:o.enableMessageErrorHandler)&&(new Error("Failed to download attachments.").details={type:"ATTACHMENT_DOWNLOAD_FAILED",actualMessage:s},a.handleError(e))}})),Jr=(e,t,n,r)=>{const o=[];if(e&&Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_PROCESSED_ATTACHMENTS,Description:`ACS Adapter: Attachments processed on this thread ${[...Object.keys(e)]}`,TimeStamp:(new Date).toISOString(),ChatMessageId:t}),Object.prototype.hasOwnProperty.call(e,t))for(let i=0;i<n.length;++i)e[t].has(n[i])||(o.push({fileId:n[i],metadata:r[i]}),e[t].set(n[i],r[i]));else{e[t]=new Map,Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_ATTACHMENT_NEW,Description:`ACS Adapter: New attachment download ${null==n?void 0:n.join(",")}`,TimeStamp:(new Date).toISOString(),ChatMessageId:t});for(let i=0;i<n.length;++i)o.push({fileId:n[i],metadata:r[i]}),e[t].set(n[i],r[i])}return o};const Yr=(e,t,n,r)=>c(void 0,void 0,void 0,(function*(){for(const o of e){const e=yield Xr(n,o,t);r(e)}})),Xr=(e,t,n)=>c(void 0,void 0,void 0,(function*(){const r=xr(t.id),o={displayName:t.displayName,tag:n,id:r},i=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){return((e,t,n)=>({channelId:mr,conversation:{id:void 0},channelData:{type:Sr.THREAD,members:[{id:e.id,displayName:e.displayName,tag:e.tag}]},from:{id:void 0,name:void 0,role:dr.Channel},id:t,timestamp:n,type:cr.Message,messageid:void 0,text:JSON.stringify(`${e.displayName} ${e.tag} chat`)}))(t,e(fe.UserId),(new Date).toISOString())}))}({getState:e})()(o);return Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_THREAD_UPDATED,Description:"ACS Adapter: convert thread update"}),i})),Qr=(e,t,n,r,o,i)=>c(void 0,void 0,void 0,(function*(){if(!Ar(t.type))return!1;if(o(fe.WebChatStatus)!==Te.Connected)return((e,t,n)=>{Se.logEvent(ge.INFO,{Event:Ee.CACHE_PAGED_HISTORY_MESSAGE,Description:e,TimeStamp:(new Date).toISOString(),ChatThreadId:n(fe.ThreadId),ACSRequesterUserId:n(fe.UserId),ChatMessageId:t.id})})(n,t,o),e.push(t),!0;if(!r)switch(t.type){case"text":{const e=yield to(t,o);i(e);break}case"participantAdded":t.content.participants&&Yr(t.content.participants,vr,o,i);break;case"participantRemoved":t.content.participants&&Yr(t.content.participants,yr,o,i)}return!0})),Zr=(e,t,n,r)=>c(void 0,void 0,void 0,(function*(){switch(e.type){case"text":{const o=yield to(e,t);eo(o,e,t,n,r);break}case"participantAdded":for(const o of e.content.participants){const i=yield Xr(t,o,vr);eo(i,e,t,n,r)}break;case"participantRemoved":for(const o of e.content.participants){const i=yield Xr(t,o,yr);eo(i,e,t,n,r)}}})),eo=(e,t,n,r,o)=>{e&&(((e,t,n)=>{const r="text"===n.type?n.sender:n.content.initiator;Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_POST_ACTIVITY,Description:t,MessageSender:r.communicationUserId,TimeStamp:n.createdOn.toISOString(),ChatMessageId:n.id,ACSRequesterUserId:e(fe.UserId)})})(n,o+e.messageid,t),e.channelData||(e.channelData={}),e.channelData.fromList=!0,r(e))},to=(e,t)=>c(void 0,void 0,void 0,(function*(){const n=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){var n,r;const o=e(fe.ChatClient),i=e(fe.AdapterOptions),s=e(fe.FileManager),a=e(fe.EventManager),c=e(fe.ThreadId),d=e(fe.UserId);if(!o){const n="ACS Adapter: Failed to ingress history message without an active chatClient.";throw Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_INGRESS_FAILED,Description:n,ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id}),new Error(n)}let u;try{if(u=s.getFileIds(t.metadata),u)return a.raiseCustomEvent("queue-attachment-download",{chatMessage:t,options:i}),null}catch(o){Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to queue attachments download",ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id,ExceptionDetails:o}),Wn.notifyErrorEvent({ErrorType:Kn.HISTORY_MESSAGE_METADATA_FILEID_FETCH_FAILED,ErrorMessage:o.message,ErrorStack:o.stack,ErrorDetails:null==o?void 0:o.details,Timestamp:t.createdOn.toISOString(),AcsChatDetails:{MessageId:t.id,ThreadId:c,MessageSenderId:t.sender.communicationUserId,RequesterUserId:e(fe.UserId)},AdditionalParams:{MessageDetails:t},CorrelationVector:null===(r=null===(n=null==o?void 0:o.request)||void 0===n?void 0:n.headers)||void 0===r?void 0:r.get("ms-cv")}),(null==i?void 0:i.enableMessageErrorHandler)&&(new Error("Failed to download attachments.").details={type:"QUEUE_ATTACHMENT_DOWNLOAD_FAILED",actualMessage:u},a.handleError(o))}const l=Wr(t,c,d,void 0);return yield Vr(a,l,null==i?void 0:i.enableAdaptiveCards,null==i?void 0:i.enableAdaptiveCardsResponses,null==i?void 0:i.enableMessageErrorHandler)}))}({getState:t})()(e);var r;return r=e,Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: convert history message:",CustomProperties:r,MessageSender:r.sender.communicationUserId,TimeStamp:r.createdOn.toISOString(),ChatMessageId:r.id}),n}));const no=(e,t)=>c(void 0,void 0,void 0,(function*(){try{const n=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){var n,r,o,i;const s=e(fe.ChatClient),a=e(fe.FileManager),c=e(fe.EventManager);if(!s)throw new Error("ACS Adapter: Failed to ingress edited message without an active chatClient.");const d=xr(t.sender),u={channelId:mr,channelData:{"webchat:sequence-id":parseInt(t.id),additionalMessageMetadata:{editedOn:t.editedOn.toISOString()}},conversation:{id:e(fe.UserId)},from:{id:d,name:t.senderDisplayName,role:d===e(fe.UserId)?dr.User:dr.Bot},messageid:t.id,id:t.id?t.id:$r(),text:t.message,timestamp:t.createdOn.toISOString(),type:cr.Message};if(t.metadata&&0!==Object.keys(t.metadata).length){let s,d,l;try{const e=a.getFileIds(t.metadata),n=a.getFileMetadata(t.metadata);e&&(s=yield Lr(e,n,a,c),d=yield jr(s),l=qr(s))}catch(o){((e,t,n)=>{Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to parse ChatMessage metadata",ACSRequesterUserId:n(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id,ExceptionDetails:t})})(t,o,e),Wn.notifyErrorEvent({ErrorType:Kn.EDITED_MESSAGE_ATTACHMENT_DOWNLOAD_FAILED,ErrorMessage:o.message,ErrorStack:o.stack,ErrorDetails:null==o?void 0:o.details,Timestamp:t.editedOn.toISOString(),AcsChatDetails:{MessageId:t.id,ThreadId:t.threadId,MessageSenderId:t.sender.communicationUserId,RequesterUserId:e(fe.UserId)},AdditionalParams:{MessageEditedEvent:t},CorrelationVector:null===(r=null===(n=null==o?void 0:o.request)||void 0===n?void 0:n.headers)||void 0===r?void 0:r.get("ms-cv")}),c.handleError(o)}u.channelData.metadata=t.metadata,d&&(u.attachments=d,u.channelData.attachmentSizes=l),(null===(o=t.metadata)||void 0===o?void 0:o.tags)&&(u.channelData.tags=null===(i=t.metadata)||void 0===i?void 0:i.tags)}return u}))}({getState:t})()(e);return(e=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_EDITED_MESSAGE,Description:"ACS Adapter: convert edited message",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),n}catch(n){((e,t,n)=>{Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_INGRESS_FAILED,Description:t,ACSRequesterUserId:n(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e,n.message,t)}})),ro=(e,t)=>c(void 0,void 0,void 0,(function*(){try{const n=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){if(!e(fe.ChatClient))throw new Error("ACS Adapter: Failed to ingress deleted message without an active chatClient.");const n=xr(t.sender);return{channelId:mr,channelData:{"webchat:sequence-id":parseInt(t.id),additionalMessageMetadata:{deletedOn:t.deletedOn.toISOString()}},conversation:{id:e(fe.UserId)},from:{id:n,name:t.senderDisplayName,role:n===e(fe.UserId)?dr.User:dr.Bot},messageid:t.id,id:t.id?t.id:$r(),text:"",timestamp:t.createdOn.toISOString(),type:cr.Message}}))}({getState:t})()(e);return(e=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_DELETED_MESSAGE,Description:"ACS Adapter: convert edited deleted message event",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),n}catch(n){((e,t,n)=>{Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_INGRESS_FAILED,Description:t,ACSRequesterUserId:n(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e,n.message,t)}}));let oo,io,so;const ao=[],co={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${pr.rE} azsdk-js-communication-chat/${pr.El.oY}`}}};function uo(){return function(...e){return s((e=>e.setState),((e,t)=>Object.assign(Object.assign({},e),{setState:t})))(...e)}((({getState:t,setState:n,getReadyState:r,setReadyState:o,subscribe:i})=>{const s=e=>c(this,void 0,void 0,(function*(){const n=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){var n,r,o;const i=e(fe.ChatClient),s=e(fe.AdapterOptions),a=e(fe.FileManager),c=e(fe.EventManager),d=e(fe.UserId);if(!i){const n="ACS Adapter: Failed to ingress message without an active chatClient.";throw Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_INGRESS_FAILED,Description:n,ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),new Error(n)}let u,l;if(t.metadata&&0!==Object.keys(t.metadata).length){let o;u=t.metadata;try{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_REQUEST_DOWNLOAD_ATTACHMENTS,Description:"Preparing to download attachments",ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),o=a.getFileIds(t.metadata);const n=a.getFileMetadata(t.metadata);o&&(l=yield Lr(o,n,a,c))}catch(i){if(Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to download attachments",ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id,ExceptionDetails:i}),Wn.notifyErrorEvent({ErrorType:Kn.NEW_MESSAGE_DOWNLOAD_ATTACHMENT_FAILED,ErrorMessage:i.message,ErrorStack:i.stack,ErrorDetails:null==i?void 0:i.details,Timestamp:t.createdOn.toISOString(),AcsChatDetails:{MessageId:t.id,ThreadId:t.threadId,MessageSenderId:t.sender.communicationUserId,RequesterUserId:d},AdditionalParams:{SenderDisplayName:t.senderDisplayName,MessageText:t.message,Metadata:t.metadata},CorrelationVector:null===(r=null===(n=null==i?void 0:i.request)||void 0===n?void 0:n.headers)||void 0===r?void 0:r.get("ms-cv")}),null==s?void 0:s.enableMessageErrorHandler){const e=new Error("Failed to download attachments.");e.details={type:"ATTACHMENT_DOWNLOAD_FAILED",actualMessage:o},c.handleError(e)}}}const p={messageId:t.id,content:t.message,createdOn:t.createdOn,sender:t.sender,senderDisplayName:t.senderDisplayName,currentUserId:d,threadId:t.threadId,metadata:u,tags:null===(o=t.metadata)||void 0===o?void 0:o.tags,sequenceId:t.id,streamingMetadata:t.streamingMetadata,files:l};return yield Vr(c,p,null==s?void 0:s.enableAdaptiveCards,null==s?void 0:s.enableAdaptiveCardsResponses,null==s?void 0:s.enableMessageErrorHandler)}))}({getState:t})()(e);return Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_MESSAGE,Description:"ACS Adapter: convert normal message",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id}),n})),a=(e,n)=>c(this,void 0,void 0,(function*(){const r=yield function({getState:e}){return()=>({message:t,files:n})=>c(this,void 0,void 0,(function*(){const r=e(fe.AdapterOptions),o=e(fe.EventManager),i=e(fe.ThreadId),s=e(fe.UserId);if(!n)return null;const a=Wr(t,i,s,n);return yield Vr(o,a,null==r?void 0:r.enableAdaptiveCards,null==r?void 0:r.enableAdaptiveCardsResponses,null==r?void 0:r.enableMessageErrorHandler)}))}({getState:t})()({message:e,files:n});return Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: convert attachment history message:",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatMessageId:e.id}),r})),d=e=>c(this,void 0,void 0,(function*(){const n=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){return((e,t,n)=>{const r={message:e.message,stack:e.stack,details:null==e?void 0:e.details};return{channelId:mr,conversation:{id:void 0},channelData:{type:Sr.ERROR},from:{id:void 0,name:void 0,role:dr.Channel},id:t,timestamp:n,type:cr.Message,messageid:void 0,text:JSON.stringify(r)}})(t,e(fe.UserId),(new Date).toISOString())}))}({getState:t})()(e);return Se.logEvent(ge.ERROR,{Event:Ee.ACS_SDK_CHATCLIENT_ERROR,Description:"ACS Adapter: convert error message",ExceptionDetails:e.message}),n})),u=e=>c(this,void 0,void 0,(function*(){const n=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){if(!e(fe.ChatClient)){const n="ACS Adapter: Failed to ingress typing message without an active chatClient.";throw Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_INGRESS_FAILED,Description:n,ACSRequesterUserId:e(fe.UserId),MessageSender:t.sender.communicationUserId,TimeStamp:t.receivedOn.toISOString(),ChatThreadId:t.threadId}),new Error(n)}const{receivedOn:n,sender:r}=t,o=xr(r);return{channelId:mr,conversation:{id:e(fe.UserId)},from:{id:o,name:t.senderDisplayName,role:o===e(fe.UserId)?dr.User:dr.Bot},timestamp:new Date(n).toISOString(),type:cr.Typing}}))}({getState:t})()(e);return Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_TYPING_MESSAGE,Description:"ACS Adapter: convert typing message.",MessageSender:e.sender.communicationUserId,TimeStamp:e.receivedOn.toISOString(),ChatThreadId:e.threadId}),n})),l=e=>c(this,void 0,void 0,(function*(){const n=yield function({getState:e}){return()=>t=>c(this,void 0,void 0,(function*(){return((e,t)=>({channelId:mr,conversation:{id:void 0},channelData:{type:Sr.THREAD,properties:{deleteTime:e.deletedOn.toISOString(),isDeleted:"True"}},from:{id:void 0,name:void 0,role:dr.Channel},id:t,timestamp:e.deletedOn.toISOString(),type:cr.Message,messageid:void 0}))(t,e(fe.UserId))}))}({getState:t})()(e);return Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_THREAD_DELETED,Description:"ACS Adapter: convert thread delete",ACSRequesterUserId:e.deletedBy.id.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId}),n})),p=(e,t,n)=>c(this,void 0,void 0,(function*(){const r=yield d(n);!e&&t(r)})),h=(e,{unsubscribed:n},r,o=void 0,i=void 0)=>c(this,void 0,void 0,(function*(){if(void 0===i){const i=e.listMessages(Object.assign(Object.assign({},co),{startTime:o}));let s=yield i.next();for(;!s.done;){const e=s.value;Qr(ao,e,"ACS Adapter: Cache paged history message",n,t,r),s=yield i.next()}}else{let s=io;void 0===s&&(s=e.listMessages(Object.assign(Object.assign({},co),{maxPageSize:i,startTime:o})).byPage());const a="ACS Adapter: Cache paged history message  (with pagesize limit)";let c=0;for(;c<i;){const e=oo;if(e)for(let o=so>=0?so:0;o<e.value.length;o++){const i=e.value[o];Qr(ao,i,a,n,t,r)&&c++}const o=yield s.next();if(o.done)break;for(let e=0;e<o.value.length;e++){if(c>=i){io=s,so=e,oo=o;break}const d=o.value[e];Qr(ao,d,a,n,t,r)&&c++}}}})),f=(e,{unsubscribed:n},r,o=void 0)=>c(this,void 0,void 0,(function*(){const i=t(fe.EventManager);null==i||i.addEventListener("acs-adapter-loadnextpage",(()=>{h(e,{unsubscribed:n},r,void 0,o)}))})),g=({unsubscribed:e},n)=>c(this,void 0,void 0,(function*(){const r=t(fe.EventManager);null==r||r.addEventListener("error",(t=>{var r;p(e,n,null===(r=null==t?void 0:t.detail)||void 0===r?void 0:r.payload)}))})),m=({unsubscribed:e},n)=>c(this,void 0,void 0,(function*(){const r=t(fe.EventManager);null==r||r.addEventListener("acs-adapter-leavechat",(()=>{const r=t(fe.UserId);!e&&n.removeParticipant({communicationUserId:r},co)}))}));return d=>(p,v)=>c(this,void 0,void 0,(function*(){return(p===fe.ChatThreadClient&&v||p===fe.Reconnect&&v)&&i(new(ve())((i=>{const d=t(fe.ChatClient),p=t(fe.AdapterOptions),y=t(fe.MessagePollingHandleInstance);let S=t(fe.FileManager);const E=i.next.bind(i);let T,C,A=!0;const b={},I={unsubscribed:!1},R=!0===v?t(fe.ChatThreadClient):v,w=new Map,O=[],_=[],P=(n,i,s,a,d=0)=>c(this,void 0,void 0,(function*(){var u,l,h,f;const g=p&&p.serverPageSizeLimit;let m;if(r()!==e.CLOSED)try{if(!A)return void Jn(t,"ACS Adapter: Polling call issued too soon: skipping");if(!(null==y?void 0:y.getIsPollingEnabled()))return void Jn(t,"ACS Adapter: Polling call disabled from the client: skipping");(e=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_SEND_POLLING_REQUEST,Description:"ACS Adapter: Send polling request",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t);const e=i.listMessages(Object.assign(Object.assign({},co),{startTime:s,maxPageSize:g}));let n=yield e.next();for(;!n.done;){const r=n.value;if(Ar(r.type)&&r.sequenceId!==a)if(S||(S=t(fe.FileManager)),Gr(r,w,S))Yn(t,r.id);else{if(Xn(t,r.id),t(fe.WebChatStatus)!==Te.Connected){Qn(t,r.id),_.push(r),n=yield e.next();continue}Br(r,w,S),Zr(r,t,E,"ACS Adapter: Post activity, messageId: ")}(!s||parseInt(r.sequenceId)>parseInt(a))&&(s=r.createdOn,a=r.sequenceId),n=yield e.next()}}catch(e){m=e,((e,t)=>{Se.logEvent(ge.ERROR,{Event:Ee.ACS_SDK_CHATCLIENT_ERROR,Description:"ACS Adapter: Polling message fetch failed.",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ExceptionDetails:t})})(t,e),Wn.notifyErrorEvent({StatusCode:null===(u=e.response)||void 0===u?void 0:u.status,ErrorType:Kn.MESSAGE_POLLING_FAILED,ErrorMessage:e.message,ErrorStack:e.stack,ErrorDetails:null==e?void 0:e.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:t(fe.ThreadId)},CorrelationVector:null===(h=null===(l=null==e?void 0:e.request)||void 0===l?void 0:l.headers)||void 0===h?void 0:h.get("ms-cv")})}finally{const r=null===(f=null==m?void 0:m.response)||void 0===f?void 0:f.status;A=!1,window.setTimeout((()=>A=!0),15e3),(null==y?void 0:y.stopPolling())||m&&!D(r)?((null==y?void 0:y.stopPolling())&&(e=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_POLLING_STOPPED,Description:"ACS Adapter: Polling call stopped from the client",TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t),o(e.CLOSED)):(T&&(((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling callback with Id "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,T),clearTimeout(T)),T=window.setTimeout((()=>c(this,void 0,void 0,(function*(){d<=45&&(A=!0),yield P(n,i,s,a,d+1)}))),d<=45?1e3:n),((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_CREATE_POLLING_CALLBACK,Description:"ACS Adapter: Created polling callback with Id "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,T))}else Jn(t,"ACS Adapter: Polling skipped because of thread deletion.")})),D=e=>(((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_POLLING_STATUSCODE,Description:"ACS Adapter: Polling status code "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,e),!(401===e||403===e||404===e)),N=()=>c(this,void 0,void 0,(function*(){T&&(((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling in RTN connected callback Id "+t,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),ACSRequesterUserId:e(fe.UserId)})})(t,T),clearTimeout(T)),yield P(t(fe.PollingInterval),R)})),k=e=>c(this,void 0,void 0,(function*(){if(e.threadId===t(fe.ThreadId)){if(Se.logEvent(ge.DEBUG,{Event:Ee.MESSAGE_RECEIVED,Description:`ACS Adapter: Received a message with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id}),S||(S=t(fe.FileManager)),t(fe.WebChatStatus)!==Te.Connected)return Se.logEvent(ge.INFO,{Event:Ee.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new message",TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ACSRequesterUserId:t(fe.UserId),ChatMessageId:e.id}),void O.push(e);if(Fr(w,e,t,S,Ee.ACS_PROCESSING_NEW_MESSAGE))return void Se.logEvent(ge.INFO,{Event:Ee.ACS_SKIP_NEW_MESSAGE,Description:"ACS Adapter: Skipping RTN message, already processed",MessageSender:e.sender.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ChatMessageId:e.id});const n=yield s(e);n&&E(n)}})),M=e=>c(this,void 0,void 0,(function*(){if(xr(e.sender)!==t(fe.UserId)&&e.threadId===t(fe.ThreadId)){Se.logEvent(ge.DEBUG,{Event:Ee.TYPING_MESSAGE_RECEIVED,Description:"ACS Adapter: Received a typing message",MessageSender:e.sender.communicationUserId,TimeStamp:e.receivedOn.toISOString(),ChatThreadId:e.threadId});const t=yield u(e);E(t)}})),U=e=>c(this,void 0,void 0,(function*(){if(e.threadId===t(fe.ThreadId)){(e=>{Se.logEvent(ge.DEBUG,{Event:Ee.MESSAGE_DELETED_RECEIVED,Description:`ACS Adapter: Received a message delete event with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e);const n=Object.assign(Object.assign({},e),{message:""});if(Fr(w,n,t,S,Ee.ACS_PROCESSING_DELETED_MESSAGE))return void((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_SKIP_DELETED_MESSAGE,Description:"ACS Adapter: Skipping deleted message RTN, already processed",TimeStamp:(new Date).toISOString(),MessageSender:e.sender.communicationUserId,ChatThreadId:t(fe.ThreadId),ChatMessageId:e.id})})(e,t);const r=yield ro(e,t);r&&E(r)}})),x=e=>c(this,void 0,void 0,(function*(){if(e.threadId===t(fe.ThreadId)){if((e=>{Se.logEvent(ge.DEBUG,{Event:Ee.MESSAGE_EDIT_RECEIVED,Description:`ACS Adapter: Received a message edit event with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),S||(S=t(fe.FileManager)),Fr(w,e,t,S,Ee.ACS_PROCESSING_EDITED_MESSAGE))return void((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_SKIP_EDITED_MESSAGE,Description:"ACS Adapter: Skipping edited RTN message, already processed",TimeStamp:(new Date).toISOString(),MessageSender:e.sender.communicationUserId,ChatThreadId:t(fe.ThreadId),ChatMessageId:e.id})})(e,t);const n=yield no(e,t);n&&E(n)}})),L=e=>c(this,void 0,void 0,(function*(){if(e.threadId===t(fe.ThreadId)){(e=>{Se.logEvent(ge.DEBUG,{Event:Ee.STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED,Description:`ACS Adapter: Received a message streaming chunk event with id ${e.id}`,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),S||(S=t(fe.FileManager));const n=w.has(e.id);if(Fr(w,e,t,S,Ee.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK))return void(e=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_SKIP_STREAMING_CHAT_MESSAGE_CHUNK,Description:"ACS Adapter: Skipping RTN streaming message chunk, already processed",MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e);const r=yield((e,t,n)=>c(void 0,void 0,void 0,(function*(){var r;try{const r=(({getState:e,isFirstChunk:t})=>()=>n=>c(void 0,void 0,void 0,(function*(){var r,o,i,s;const a=e(fe.ChatClient),c=e(fe.FileManager),d=e(fe.EventManager);if(!a)throw new Error("ACS Adapter: Failed to ingress streaming message chunk event without an active chatClient.");const u=xr(n.sender),l={channelId:mr,channelData:{"webchat:sequence-id":parseInt(n.id)},conversation:{id:e(fe.ThreadId)},from:{id:u,name:n.senderDisplayName?n.senderDisplayName:void 0,role:u===e(fe.UserId)?dr.User:dr.Bot},messageid:n.id,id:n.id?n.id:$r(),text:n.message,timestamp:n.editedOn.toISOString(),type:cr.Typing};if(n.metadata&&0!==Object.keys(n.metadata).length){let t,a,u;try{const e=c.getFileIds(n.metadata),r=c.getFileMetadata(n.metadata);e&&(t=yield Lr(e,r,c,d),a=yield jr(t),u=qr(t))}catch(t){Se.logEvent(ge.ERROR,{Event:Ee.ACS_PROCESSING_STREAMING_CHAT_MESSAGE_CHUNK,Description:"Failed to parse StreamingChatMessageChunk metadata",ACSRequesterUserId:e(fe.UserId),MessageSender:n.sender.communicationUserId,TimeStamp:n.editedOn.toISOString(),ChatThreadId:n.threadId,ChatMessageId:n.id,ExceptionDetails:t}),Wn.notifyErrorEvent({ErrorType:Kn.MESSAGE_STREAMING_CHUNK_ATTACHMENT_DOWNLOAD_FAILED,ErrorMessage:t.message,ErrorStack:t.stack,ErrorDetails:null==t?void 0:t.details,Timestamp:n.editedOn.toISOString(),AcsChatDetails:{MessageId:n.id,ThreadId:n.threadId,MessageSenderId:n.sender.communicationUserId,RequesterUserId:e(fe.UserId)},AdditionalParams:{MessageEditedEvent:n},CorrelationVector:null===(o=null===(r=null==t?void 0:t.request)||void 0===r?void 0:r.headers)||void 0===o?void 0:o.get("ms-cv")}),d.handleError(t)}l.channelData.metadata=n.metadata,a&&a.length>0&&(l.attachments=a,l.channelData.attachmentSizes=u),(null===(i=n.metadata)||void 0===i?void 0:i.tags)&&n.metadata.tags.length>0&&(l.channelData.tags=null===(s=n.metadata)||void 0===s?void 0:s.tags)}return n.streamingMetadata&&(l.channelData.streamType=n.streamingMetadata.streamingMessageType,l.channelData.streamSequence=n.streamingMetadata.streamingSequenceNumber,l.entities=[{type:ur,streamType:n.streamingMetadata.streamingMessageType,streamSequence:n.streamingMetadata.streamingSequenceNumber}],t||(l.channelData.streamId=n.id,l.entities[0].streamId=n.id)),l})))({getState:t,isFirstChunk:!n}),o=r(),i=yield o(e);return(e=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_CONVERT_STREAMING_CHAT_MESSAGE_CHUNK,Description:"ACS Adapter: convert streaming message chunk",CustomProperties:e,MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e),i}catch(n){((e,t,n)=>{Se.logEvent(ge.ERROR,{Event:Ee.ACS_ADAPTER_INGRESS_STREAMING_CHAT_MESSAGE_CHUNK_FAILED,Description:n,ACSRequesterUserId:t(fe.UserId),MessageSender:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})})(e,t,null!==(r=n.message)&&void 0!==r?r:"")}})))(e,t,n);r&&E(r)}})),j=e=>c(this,void 0,void 0,(function*(){if(e.threadId===t(fe.ThreadId)){if(t(fe.WebChatStatus)!==Te.Connected)return(e=>{Se.logEvent(ge.INFO,{Event:Ee.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new participant added event",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:e.addedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsAdded.map((e=>e.id.communicationUserId))})})(e),void O.push(e);if((e=>{Se.logEvent(ge.DEBUG,{Event:Ee.PARTICIPANT_ADDED_RECEIVED,Description:"ACS Adapter: Received a participant added event",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:e.addedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsAdded.map((e=>e.id.communicationUserId))})})(e),((e,t,n)=>{const r=Nr(t),o=Or(e,r,{addedParticipants:t.participantsAdded});return o||(((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT,Description:"ACS Adapter: Processing participant added event",ACSRequesterUserId:t.addedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserAdded:t.participantsAdded.map((e=>e.id.communicationUserId))})})(n,t),e.set(r,{addedParticipants:t.participantsAdded})),o})(w,e,t))return void((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_PARTICIPANT_ADDED_EVENT_PROCESSED,Description:"ACS Adapter: Skipping RTN participant added event, already processed",ACSRequesterUserId:t.addedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserAdded:t.participantsAdded.map((e=>e.id.communicationUserId))})})(t,e);Yr(e.participantsAdded,vr,t,E)}})),q=e=>c(this,void 0,void 0,(function*(){if(e.threadId===t(fe.ThreadId)){if(t(fe.WebChatStatus)!==Te.Connected)return(e=>{Se.logEvent(ge.INFO,{Event:Ee.CACHE_NEW_MESSAGE,Description:"ACS Adapter: Cache new participant added even",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:e.removedOn.toISOString(),ChatThreadId:e.threadId,UserRemoved:e.participantsRemoved.map((e=>e.id.communicationUserId))})})(e),void O.push(e);if((e=>{Se.logEvent(ge.DEBUG,{Event:Ee.PARTICIPANT_REMOVED_RECEIVED,Description:"ACS Adapter: Received a participant removed event",ACSRequesterUserId:e.removedBy.id.communicationUserId,TimeStamp:e.removedOn.toISOString(),ChatThreadId:e.threadId,UserRemoved:e.participantsRemoved.map((e=>e.id.communicationUserId))})})(e),((e,t,n)=>{const r=Nr(t),o=Or(e,r,{removedParticipants:t.participantsRemoved});return o||(((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_PROCESSING_PARTICIPANT_ADDED_EVENT,Description:"ACS Adapter: Processing participant removed event",ACSRequesterUserId:t.removedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserRemoved:t.participantsRemoved.map((e=>e.id.communicationUserId))})})(n,t),e.set(r,{removedParticipants:t.participantsRemoved})),o})(w,e,t))return void((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_PARTICIPANT_REMOVED_EVENT_PROCESSED,Description:"ACS Adapter: Skipping RTN participant removed event, already processed",ACSRequesterUserId:t.removedBy.id.communicationUserId,TimeStamp:(new Date).toISOString(),ChatThreadId:e(fe.ThreadId),UserRemoved:t.participantsRemoved.map((e=>e.id.communicationUserId))})})(t,e);Yr(e.participantsRemoved,yr,t,E)}})),F=e=>c(this,void 0,void 0,(function*(){if(e.threadId===t(fe.ThreadId)){Se.logEvent(ge.DEBUG,{Event:Ee.THREAD_DELETED_RECEIVED,Description:"ACS Adapter: Received a thread deleted event",ACSRequesterUserId:e.deletedBy.id.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId});const t=yield l(e);E(t)}}));return d.on("chatMessageReceived",k),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_NEW_MESSAGE,Description:"ACS Adapter: Registering on new message success"}),d.on("typingIndicatorReceived",M),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_TYPING_INDICATOR,Description:"ACS Adapter: Registering on typing indicator success"}),d.on("chatMessageEdited",x),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_MESSAGE_EDIT,Description:"ACS Adapter: Registering on message edit success"}),d.on("chatMessageDeleted",U),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_MESSAGE_DELETED,Description:"ACS Adapter: Registering on message delete success"}),d.on("chatThreadDeleted",F),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_THREAD_DELETED,Description:"ACS Adapter: Registering on thread delete success"}),d.on("realTimeNotificationConnected",(()=>c(this,void 0,void 0,(function*(){Se.logEvent(ge.DEBUG,{Event:Ee.ACS_ADAPTER_REALTIME_NOTIFICATION_CONNECTED,Description:"ACS Adapter: Realtime notification connected",TimeStamp:(new Date).toISOString()}),yield N()})))),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_REALTIME_NOTIFICATION_CONNECTED,Description:"ACS Adapter: Registering on realtime notification connected"}),d.on("realTimeNotificationDisconnected",(()=>c(this,void 0,void 0,(function*(){C=new Date,Se.logEvent(ge.DEBUG,{Event:Ee.ACS_ADAPTER_REALTIME_NOTIFICATION_DISCONNECTED,Description:"ACS Adapter: Realtime notification disconnected",TimeStamp:C.toISOString()})})))),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_REALTIME_NOTIFICATION_DISCONNECTED,Description:"ACS Adapter: Registering on realtime notification disconnected"}),d.on("streamingChatMessageChunkReceived",L),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_STREAMING_CHAT_MESSAGE_CHUNK_RECEIVED,Description:"ACS Adapter: Registering on streaming chat message chunk received"}),(null==p?void 0:p.enableThreadMemberUpdateNotification)&&(d.on("participantsAdded",j),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_PARTICIPANT_ADDED,Description:"ACS Adapter: Registering on participant added success"}),d.on("participantsRemoved",q),Se.logEvent(ge.DEBUG,{Event:Ee.REGISTER_ON_PARTICIPANT_REMOVED,Description:"ACS Adapter: Registering on participant removed success"})),(null==p?void 0:p.enableLeaveThreadOnWindowClosed)&&t(fe.EventManager).addEventListener("beforeunload",(()=>{const e=t(fe.Token),n=t(fe.EnvironmentUrl),r=t(fe.ThreadId),o=t(fe.UserId);fetch(`${n}/chat/threads/${r}/members/${o}?api-version=2020-09-21-preview2`,{keepalive:!0,method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})})),g(I,E),(()=>{c(this,void 0,void 0,(function*(){const e=t(fe.EventManager);null==e||e.addEventListener("queue-attachment-download",(e=>c(this,void 0,void 0,(function*(){yield Kr(e,b,t)}))))}))})(),(()=>{c(this,void 0,void 0,(function*(){const e=t(fe.EventManager);null==e||e.addEventListener("acs-attachment-downloaded",(e=>c(this,void 0,void 0,(function*(){const{chatMessage:t,files:n}=e.detail.payload;Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_ATTACHMENT_DOWNLOADED,Description:"ACS Adapter: Attachment downloaded "+(null==n?void 0:n.map((e=>e.name)).join(",")),MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id});const r=yield a(t,n);r&&(Se.logEvent(ge.INFO,{Event:Ee.ACS_ADAPTER_POST_FILE_ACTIVITY,Description:"ACS Adapter: Post file attachment activity, messageId: "+r.messageid,MessageSender:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id}),E(r))}))))}))})(),(()=>{c(this,void 0,void 0,(function*(){const e=t(fe.EventManager);null==e||e.addEventListener("webchat-status-connected",(()=>c(this,void 0,void 0,(function*(){for(Se.logEvent(ge.DEBUG,{Event:Ee.WEBCHAT_STATUS_CONNECTED,Description:"ACS Adapter: Event Webchat connected received"});ao.length>0;){const e=ao.pop();Zn(t,e),Zr(e,t,E,"ACS Adapter: Post activity, paged history message with Id: ")}for(;_.length>0;){const e=_.pop();er(t,e),Br(e,w,S);const n="ACS Adapter: Post activity, history messageId: "+e.id;Zr(e,t,E,n)}for(;O.length>0;){const n=O.pop();br(n)?(e=n,Se.logEvent(ge.DEBUG,{Event:Ee.PROCESS_CACHED_NEW_MESSAGE,Description:"ACS Adapter: Process cached new participants added event",ACSRequesterUserId:e.addedBy.id.communicationUserId,TimeStamp:e.addedOn.toISOString(),ChatThreadId:e.threadId,UserAdded:e.participantsAdded.map((e=>e.id.communicationUserId))}),Yr(n.participantsAdded,vr,t,E)):Ir(n)?(nr(n),Yr(n.participantsRemoved,yr,t,E)):"message"in n&&(tr(n),yield k(n))}var e}))))}))})(),m(I,R),(e=>{c(this,void 0,void 0,(function*(){const r=t(fe.EventManager);null==r||r.addEventListener("online",(()=>c(this,void 0,void 0,(function*(){const r=t(fe.DisconnectUTC);Se.logEvent(ge.DEBUG,{Event:Ee.NETWORK_ONLINE,Description:`ACS Adapter: ACS Chat reconnected event since disconnect at ${r}`,TimeStamp:(new Date).toISOString()}),r&&(n(fe.DisconnectUTC,void 0),T&&(Se.logEvent(ge.INFO,{Event:Ee.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling in network connected Id "+T,TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ACSRequesterUserId:t(fe.UserId)}),clearTimeout(T)),A=!0,yield P(t(fe.PollingInterval),e,r))}))))}))})(R),p.historyPageSizeLimit?(h(v,I,E,void 0,p&&p.historyPageSizeLimit),f(v,I,E,p&&p.historyPageSizeLimit)):(T&&(Se.logEvent(ge.INFO,{Event:Ee.ACS_CANCEL_POLLING_CALLBACK,Description:"ACS Adapter: Canceling polling, if any, at the start "+T,TimeStamp:(new Date).toISOString(),ChatThreadId:t(fe.ThreadId),ACSRequesterUserId:t(fe.UserId)}),clearTimeout(T)),P(t(fe.PollingInterval),R)),()=>{I.unsubscribed=!0,d.off("chatMessageReceived",k),d.off("typingIndicatorReceived",M),d.off("chatMessageEdited",x),d.off("chatMessageDeleted",U),d.off("participantsAdded",j),d.off("participantsRemoved",q),d.off("chatThreadDeleted",F),d.off("streamingChatMessageChunkReceived",L)}}))),d(p,v)}))}))}const lo={requestOptions:{customHeaders:{"x-ms-useragent":`acs-webchat-adapter-${pr.rE}  azsdk-js-communication-chat/${pr.El.oY}`}}};class po{static isACSConnected(e,t){var n,r,o,i;return c(this,void 0,void 0,(function*(){let s=0;for(;s<5;)try{return t&&e?(yield t.getProperties(lo),!0):(Se.logEvent(ge.ERROR,{Event:Ee.ACS_SDK_CHATCLIENT_RECONNECT_ERROR,Description:"Trying to reconnect failed as ACS Client is in uninitialized state"}),!1)}catch(e){s++;const t=null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.status;if(s>=5||t&&this.isNotRetryable(t))return Se.logEvent(ge.ERROR,{Event:Ee.ACS_SDK_CHATCLIENT_RECONNECT_ERROR,Description:`Trying to reconnect failed with status ${t} after retries ${s}`,ExceptionDetails:e}),Wn.notifyErrorEvent({StatusCode:null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.status,ErrorType:Kn.ADAPTER_RECONNECT_FAILED,ErrorMessage:null==e?void 0:e.message,ErrorStack:null==e?void 0:e.stack,ErrorDetails:null==e?void 0:e.details,Timestamp:(new Date).toISOString(),CorrelationVector:null===(i=null===(o=null==e?void 0:e.request)||void 0===o?void 0:o.headers)||void 0===i?void 0:i.get("ms-cv")}),!1;yield Rr(1e3*Math.pow(2,s))}return!1}))}static isNotRetryable(e){return 401===e||403===e||404===e}}class ho{constructor(e){this.getIsPollingEnabled=()=>!this.messagePoller||this.messagePoller.getIsPollingEnabled(),this.stopPolling=()=>!!this.messagePoller&&this.messagePoller.stopPolling(),this.messagePoller=e}}class fo{constructor(e,t,n){this.accessToken=e,this.downloadUrl=t,this.uploadUrl=n}downloadBlob(e){return c(this,void 0,void 0,(function*(){const t=yield fetch(e);if(!t.ok)throw new Error("Failed to fetch file contents.");return yield t.blob()}))}downloadDriveItem(e){var t;return c(this,void 0,void 0,(function*(){const n=this.downloadUrl(e),r={method:"GET",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"}},o=yield fetch(n,r),i=yield o.json();if(!o.ok)throw new Error(`Failed to download drive item from OneDrive: ${null===(t=i.error)||void 0===t?void 0:t.message}`);return i}))}downloadDriveItemContents(e){var t;return c(this,void 0,void 0,(function*(){const n=yield fetch(e);if(!n.ok){const e=yield n.json();throw new Error(`Failed to download drive item contents from OneDrive: ${null===(t=e.error)||void 0===t?void 0:t.message}`)}return yield n.blob()}))}uploadFiles(e){return c(this,void 0,void 0,(function*(){return Promise.all(e.map((e=>c(this,void 0,void 0,(function*(){const t=yield this.downloadBlob(e.contentUrl),n=this.uploadUrl(e.name),r={method:"PUT",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":e.contentType},body:t},o=yield fetch(n,r),i=yield o.json();if(i.error)throw new Error(`Failed to upload file to OneDrive. ${i.error.message}`);return{fileId:i.id,metadata:{filename:e.name}}})))))}))}downloadFiles(e){return c(this,void 0,void 0,(function*(){return Promise.all(e.map((e=>c(this,void 0,void 0,(function*(){var t,n;const r=yield this.downloadDriveItem(e.fileId),o=r["@microsoft.graph.downloadUrl"],i=yield this.downloadDriveItemContents(o);return e.metadata&&console.log(`File name: ${null===(t=e.metadata)||void 0===t?void 0:t.name}`),new File([i],r.name,{type:null===(n=r.file)||void 0===n?void 0:n.mimeType,lastModified:r.lastModifiedDateTime})})))))}))}updatePermissions(){return c(this,void 0,void 0,(function*(){throw new Error("Method not implemented.")}))}getFileIds(e){if(null==e?void 0:e.onedriveReferences)try{return JSON.parse(null==e?void 0:e.onedriveReferences)}catch(e){throw new Error("Failed to parse onedriveReferences in ChatMessage metadata.")}}createFileIdProperty(e){return{onedriveReferences:JSON.stringify(e)}}getFileMetadata(e){if(null==e?void 0:e.onedriveMetadata)try{return JSON.parse(null==e?void 0:e.onedriveMetadata)}catch(e){throw new Error("Failed to parse onedriveMetadata in ChatMessage metadata.")}}createFileMetadataProperty(e){return{onedriveMetadata:JSON.stringify(e)}}createBotAttachment(e){if(!e||0===Object.keys(e).length)return null;const t=this.getFileMetadata(e),n=this.getFileIds(e);let r,o;return n&&n.length>0&&(r=n[0]),t&&t.length>0&&(o=t[0]),r?{contentType:null==o?void 0:o.contentType,name:null==o?void 0:o.fileName,content:{uniqueId:r}}:null}}const go=(t,n,r,o,a,d=3e4,u,l,h,f,g)=>(d=d>=5e3?d:5e3,Ae(g,i(function(){return t=>n=>{const r=t(n);let o;r.setState(fe.WebChatStatus,Te.Uninitialized),r.addEventListener("open",(()=>c(this,void 0,void 0,(function*(){const e=r.getState(fe.EventManager);if(Se.logEvent(ge.INFO,{Event:Ee.ADAPTER_STATE_UPDATE,Description:"Adapter state has been changed to open"}),o)Se.logEvent(ge.INFO,{Event:Ee.WEBCHAT_SUBSCRIPTION_SUCCESS,Description:"WebChat already connected"}),o.next(Te.Connected),r.setState(fe.WebChatStatus,Te.Connected),e.raiseCustomEvent("webchat-status-connected",{});else{let t=5;const i=(null==n?void 0:n.webChatInitTimeout)?null==n?void 0:n.webChatInitTimeout:2e3;for(;!o&&t<i;)yield Ce(t),t*=2;o?(Se.logEvent(ge.INFO,{Event:Ee.WEBCHAT_SUBSCRIPTION_SUCCESS,Description:`WebChat subscribed to connection status changes in ${t} ms`}),o.next(Te.Connected),r.setState(fe.WebChatStatus,Te.Connected),e.raiseCustomEvent("webchat-status-connected",{})):(Se.logEvent(ge.ERROR,{Event:Ee.WEBCHAT_SUBSCRIPTION_TIMEOUT,Description:`WebChat couldn't subscribe to connection status changes in ${i} ms`}),e.handleError(new Error("WebChat subscription timeout to connection status changes")),r.setState(fe.WebChatStatus,Te.FailedToConnect))}})))),r.addEventListener("error",(()=>{Se.logEvent(ge.INFO,{Event:Ee.ADAPTER_STATE_UPDATE,Description:"Adapter state has been changed to error"});const t=r.getReadyState()===e.CLOSED?Te.FailedToConnect:Te.Connecting;o&&o.next(t),r.setState(fe.WebChatStatus,t)}));let i=!0;return Object.assign(Object.assign({},r),{activity$:ye(new(ve())((t=>{const n=new AbortController;return function(){var e,o,i,s;c(this,void 0,void 0,(function*(){try{try{for(var a,c=!0,d=p(r.activities({signal:n.signal}));a=yield d.next(),!(e=a.done);){s=a.value,c=!1;try{const e=s;t.next(e)}finally{c=!0}}}catch(e){o={error:e}}finally{try{c||e||!(i=d.return)||(yield i.call(d))}finally{if(o)throw o.error}}t.complete()}catch(e){t.error(e)}}))}(),i?i=!1:(r.setReadyState(e.CONNECTING),r.setReadyState(e.OPEN),r.setState(fe.Reconnect,!0)),()=>{n.abort()}}))),connectionStatus$:ye(new(ve())((e=>(e.next(Te.Uninitialized),e.next(Te.Connecting),o=e,()=>{o=void 0})))),end:()=>{r.close()},postActivity:e=>new(ve())((t=>{!function(){c(this,void 0,void 0,(function*(){yield r.egress(e,{progress:({id:e})=>e&&t.next(e)}),t.complete()}))}()}))})}}(),function(t,n,r,o,a,d,u,l,p,h,f){return i((i=>s=>{Se.setInstance(h),Wn.setInstance(u);const g=new ho(f.messagePollingHandle),m=i(s),v=new ar;return m.setState(fe.BotId,void 0),m.setState(fe.ChatClient,void 0),m.setState(fe.UserId,void 0),m.setState(fe.AuthConfig,void 0),m.setState(fe.ChatThreadClient,void 0),m.setState(fe.UserDisplayName,void 0),m.setState(fe.ConnectionStatusObserverReady,!1),m.setState(fe.DisconnectUTC,void 0),m.setState(fe.EventManager,v),m.setState(fe.AdapterOptions,f),m.setState(fe.EnvironmentUrl,void 0),m.setState(fe.ThreadId,void 0),m.setState(fe.Token,void 0),m.setState(fe.Reconnect,!1),m.setState(fe.FileManager,void 0),m.setState(fe.PollingInterval,d),m.setState(fe.MessagePollingHandleInstance,g),function(){c(this,void 0,void 0,(function*(){const i=yield((e,t,n,r,o,i)=>c(void 0,void 0,void 0,(function*(){var s,a;const c={chatClient:void 0,chatThreadClient:void 0};try{e||(ir(n,t,"ACS Adapter: ACS Adapter start init error. Token is null."),Wn.notifyErrorEvent({ErrorType:Kn.ADAPTER_INIT_TOKEN_MISSING_ERROR,Timestamp:(new Date).toISOString(),AcsChatDetails:{ThreadId:n,RequesterUserId:t}})),n||(ir(n,t,"ACS Adapter: ACS Adapter start init error. ThreadId is null."),Wn.notifyErrorEvent({ErrorType:Kn.ADAPTER_INIT_THREAD_ID_MISSING_ERROR,Timestamp:(new Date).toISOString(),AcsChatDetails:{RequesterUserId:t}})),$n.id=t,$n.environmentUrl=r,$n.token=e,Vn.displayName=null!=o?o:"",((e,t)=>{Se.logEvent(ge.INFO,{Event:Ee.ACS_SDK_START_INIT,ChatThreadId:e,ACSRequesterUserId:t,Description:"ACS Adapter: ACS Adapter start init."})})(n,t);const s=new zn(e);return c.chatClient=null!=i?i:new jn($n.environmentUrl,s),c.chatThreadClient=c.chatClient.getChatThreadClient(n),c.chatThreadClient||Se.logEvent(ge.ERROR,{Event:Ee.ACS_SDK_JOINTHREAD_ERROR,Description:"ACS Adapter: failed to join the thread."}),yield c.chatClient.startRealtimeNotifications(),c}catch(e){ir(n,t,"ACS Adapter: ACS Adapter start init error.",e),Wn.notifyErrorEvent({ErrorType:Kn.ADAPTER_INIT_EXCEPTION,ErrorMessage:e.message,ErrorStack:e.stack,ErrorDetails:null==e?void 0:e.details,Timestamp:(new Date).toISOString(),AcsChatDetails:{RequesterUserId:t,ThreadId:t},CorrelationVector:null===(a=null===(s=null==e?void 0:e.request)||void 0===s?void 0:s.headers)||void 0===a?void 0:a.get("ms-cv")})}})))(t,n,r,o,l,p);m.setState(fe.ThreadId,r),m.setState(fe.ChatClient,i.chatClient),m.setState(fe.ChatThreadClient,i.chatThreadClient),m.setState(fe.UserId,$n.id),m.setState(fe.UserDisplayName,l),m.setState(fe.AuthConfig,$n),m.setState(fe.EnvironmentUrl,o),m.setState(fe.Token,t),m.setState(fe.FileManager,a),m.setReadyState(e.OPEN),v.addEventListener("online",(()=>c(this,void 0,void 0,(function*(){(yield po.isACSConnected(i.chatClient,i.chatThreadClient))?(m.setReadyState(e.OPEN),Se.logEvent(ge.INFO,{Event:Ee.ACS_SDK_RECONNECT,Description:"ACS Adapter: Reconnect to network."})):v.handleError(new Error("ACS Chat client could not reconnect"))})))),v.addEventListener("offline",(()=>{m.setReadyState(e.CONNECTING),m.setState(fe.DisconnectUTC,new Date)}))}))}(),m}),function(e){return i(function(...e){return s((e=>e.ingress),((e,t)=>Object.assign(Object.assign({},e),{ingress:t})))(...e)}(...e&&e.ingressMiddleware?e.ingressMiddleware:[]),uo())}(f),gr(f))}(t,n,r,o,a,d,u,l,h,f,g))))})(),r})()));